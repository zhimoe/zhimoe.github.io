<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Java Generic - 香取海</title>
<meta property="og:title" content="Java Generic - 香取海"><meta name=twitter:card content="summary"><link rel=stylesheet href=../../css/style.css><link rel=stylesheet href=../../css/fonts.css><link rel=stylesheet href=../../css/custom.css><link rel=icon type=image/png href=../../img/logo.png><link rel=apple-touch-icon href=../../img/logo.png><link rel=apple-touch-icon-precomposed href=../../img/logo.png></head><body class="single post"><div class=crop-h></div><div class=crop-v></div><div class=crop-c></div><nav class="nav-top small"><div class=logo><a href=../../>香取海</a></div><div class=menu><span class=active><a href=../../post/>博客</a></span>
<span><a href=../../categories/%E7%BC%96%E7%A8%8B/>编程</a></span>
<span><a href=../../categories/%E7%BF%BB%E8%AF%91/>翻译</a></span>
<span><a href=../../categories/%E9%9A%8F%E6%83%B3/>随想</a></span>
<span><a href=../../search/>搜索</a></span></div></nav><div class=article-meta><h1 class=title>Java Generic</h1><h3 class=meta-line><span><span class=date>2016-05-01</span>
</span><span class=term><a href=../../categories/%E7%BC%96%E7%A8%8B/ class=term-cat>编程</a>
<a href=../../tags/java/ class=term-tag>#java </a><a href=../../tags/%E6%B3%9B%E5%9E%8B/ class=term-tag>#泛型</a></span></h3></div><div class=main><nav id=TableOfContents><ul><li><a href=#泛型>泛型</a></li><li><a href=#类型擦除>类型擦除</a></li><li><a href=#约束>约束</a></li><li><a href=#泛型继承>泛型继承</a></li><li><a href=#通配符-和-pecs>通配符 和 PECS</a></li><li><a href=#反射和泛型>反射和泛型</a></li></ul></nav><h3 id=泛型>泛型</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#177500>// 类</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Tuple</span><span style=color:#000>&lt;</span><span style=color:#000>T</span>, <span style=color:#000>S</span><span style=color:#000>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#000>T</span> <span style=color:#000>first</span>;
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#000>S</span> <span style=color:#000>second</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// 泛型方法也可在非泛型类里面</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>ArrayAlg</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#a90d91>static</span> <span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>getMiddle</span>(<span style=color:#000>T</span>... <span style=color:#000>a</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a90d91>return</span> <span style=color:#000>a</span><span style=color:#000>[</span><span style=color:#000>a</span>.<span style=color:#836c28>length</span> <span style=color:#000>/</span> <span style=color:#000>2</span><span style=color:#000>]</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>middle</span> <span style=color:#000>=</span> <span style=color:#000>ArrayAlg</span>.<span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;</span><span style=color:#000>getMiddle</span>(<span style=color:#c41a16>&#34;]ohnM, &#34;</span><span style=color:#000>Q</span>.<span style=color:#836c28>n</span>, <span style=color:#c41a16>&#34;Public&#34;</span>);<span style=color:#177500>// right,&lt;String&gt;可以省略</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>middle</span> <span style=color:#000>=</span> <span style=color:#000>GenericCls</span>.<span style=color:#836c28>getMiddle</span>(<span style=color:#c41a16>&#34;hello&#34;</span>,<span style=color:#000>0</span>,<span style=color:#a90d91>null</span>);<span style=color:#177500>// error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//  Errr:(7, 45) java: 不兼容的类型：推断类型不符合上限</span>
</span></span><span style=display:flex><span><span style=color:#177500>//     推断：java.lang.Object&amp;java.io.Serializable&amp;java.lang.Comparable&lt;? extends java.lang.Object&amp;java.io.Serializable&amp;java.lang.Comparable&lt;?&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#177500>//     上限：java.lang.String,java.lang.Object </span>
</span></span></code></pre></div><h4 id=类型限定>类型限定</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>static</span> <span style=color:#000>&lt;</span><span style=color:#000>T</span> <span style=color:#a90d91>extends</span> <span style=color:#000>Comparable</span><span style=color:#000>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>min</span>(<span style=color:#000>T</span> <span style=color:#000>a</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// 如果多个类型，则：T extends Comparable &amp; Serializable</span>
</span></span><span style=display:flex><span><span style=color:#177500>// 只能有一个类，且类必须紧跟 extends，但是可以有多个接口</span>
</span></span></code></pre></div><h3 id=类型擦除>类型擦除</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//Tuple&lt;T,S&gt;在虚拟机变为</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Tuple</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#000>Object</span> <span style=color:#000>first</span>;<span style=color:#177500>//当调用 getFirst 时，则发生强制转换</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#000>Object</span> <span style=color:#000>second</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//泛型方法同样有擦除</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>static</span> <span style=color:#000>&lt;</span><span style=color:#000>T</span> <span style=color:#a90d91>extends</span> <span style=color:#000>Comparable</span><span style=color:#000>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>min</span>(<span style=color:#000>T</span> <span style=color:#000>a</span>)
</span></span><span style=display:flex><span><span style=color:#177500>// =&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>static</span> <span style=color:#000>Comparable</span> <span style=color:#000>min</span>(<span style=color:#000>Comparable</span> <span style=color:#000>a</span>)
</span></span></code></pre></div><h3 id=约束>约束</h3><ul><li>不能用基本类型实例化泛型，<code>Pair&lt;double></code>不允许</li><li>运行时参数类型检查只能检查原始类型</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a90d91>if</span> (<span style=color:#000>a</span> <span style=color:#a90d91>instanceof</span> <span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;</span>) <span style=color:#177500>// Error</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>if</span> (<span style=color:#000>a</span> <span style=color:#a90d91>instanceof</span> <span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span>) <span style=color:#177500>// Error</span>
</span></span><span style=display:flex><span><span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;</span> <span style=color:#000>p</span> <span style=color:#000>=</span> (<span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;</span>) <span style=color:#000>a</span>; <span style=color:#177500>//warning</span>
</span></span></code></pre></div><ul><li>不能创建参数化类型的数组</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;[]</span> <span style=color:#000>table</span> <span style=color:#000>=</span> <span style=color:#a90d91>new</span> <span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;[</span><span style=color:#000>10</span><span style=color:#000>]</span>; <span style=color:#177500>// Error</span>
</span></span><span style=display:flex><span><span style=color:#000>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>String</span><span style=color:#000>&gt;[]</span> <span style=color:#000>table</span>; <span style=color:#177500>//声明是合法的，只是无法实例化</span>
</span></span></code></pre></div><ul><li>借助@SafeVarargs 参数化类型的数组</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>@SafeVarargs</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>static</span> <span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>void</span> <span style=color:#000>addAll</span>(<span style=color:#000>Collection</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> <span style=color:#000>coll</span>, <span style=color:#000>T</span>... <span style=color:#000>ts</span>)
</span></span></code></pre></div><ul><li>Class 类本身是泛型。例如，String.daSS 是一个 Class<string> 的实例（事实上，它是唯一的实例.) 因此，makePair 方法能够推断出 pair 的类型</li><li>泛型类的静态上下文中类型变量无效</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Singleton</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#a90d91>static</span> <span style=color:#000>T</span> <span style=color:#000>singlelnstance</span>; <span style=color:#177500>// Error</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#a90d91>static</span> <span style=color:#000>T</span> <span style=color:#000>getSinglelnstance</span>{<span style=color:#177500>// Error</span>
</span></span><span style=display:flex><span>        <span style=color:#a90d91>if</span> (<span style=color:#000>singleinstance</span> <span style=color:#000>==</span> <span style=color:#a90d91>null</span>) {<span style=color:#177500>//construct new instance of T</span>
</span></span><span style=display:flex><span>            <span style=color:#a90d91>return</span> <span style=color:#000>singlelnstance</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>不能抛出或捕获泛型类的实例</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Problem</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>extends</span> <span style=color:#000>Exception</span> { <span style=color:#177500>/* . . . */</span> } <span style=color:#177500>// Error can&#39;t extend Throwable</span>
</span></span></code></pre></div><ul><li>泛型擦除的方法冲突</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Pair</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#000>T</span> <span style=color:#000>first</span>;
</span></span><span style=display:flex><span>    <span style=color:#000>T</span> <span style=color:#000>second</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#a90d91>boolean</span> <span style=color:#000>equals</span>(<span style=color:#000>T</span> <span style=color:#000>value</span>) { <span style=color:#177500>//error 和 Object.equals 冲突</span>
</span></span><span style=display:flex><span>        <span style=color:#a90d91>return</span> <span style=color:#000>first</span>.<span style=color:#836c28>equals</span>(<span style=color:#000>value</span>) <span style=color:#000>&amp;&amp;</span> <span style=color:#000>second</span>, <span style=color:#000>equals</span>(<span style=color:#000>value</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=泛型继承>泛型继承</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Employee</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Manager</span> <span style=color:#a90d91>extends</span> <span style=color:#000>Employee</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//Pair&lt;Employee&gt; 和 Pair&lt;Manager&gt; 没用任何继承关系</span>
</span></span></code></pre></div><h3 id=通配符-和-pecs>通配符 和 PECS</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Pair</span><span style=color:#000>&lt;?</span> <span style=color:#a90d91>extends</span> <span style=color:#000>Employee</span><span style=color:#000>〉</span>
</span></span><span style=display:flex><span><span style=color:#000>Pair</span><span style=color:#000>&lt;?</span> <span style=color:#a90d91>super</span> <span style=color:#000>Manager</span>
</span></span></code></pre></div><h3 id=反射和泛型>反射和泛型</h3><nav class="post-nav fullwidth"><span>&larr; <a href=../../post/java-how-test-void-method-with-parameter/>Java 单元测试如何 Mock 有参数的 void 方法</a></span>
<span class=post-nav-next><a href=../../post/java-io-basic/>Java Stream Write Reader notes</a> &rarr;</span></nav></div><footer class=small><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fix-toc.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js defer></script><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/copy-button.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/copy-button.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/heading-anchor.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fullwidth.min.js defer></script><hr><p class=nav-bottom><span><a href=https://zhi.moe>xdh</a> © 2024</span>
<span class=menu-bottom><a href=../../categories/>分类</a> <a href=../../tags/>标签</a>
<a href=../../post/index.xml type=application/rss+xml title="RSS feed">订阅</a>
<a href=#>回到顶部</a></span></p></footer></body></html>