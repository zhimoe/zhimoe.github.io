<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Spring FactoryBean and ContextAware - 新街记事</title>
<meta property="og:title" content="Spring FactoryBean and ContextAware - 新街记事"><meta name=twitter:card content="summary"><meta property="description" content="理解 Spring 的 FactoryBean 和 ContextAware 接口。
[&amp;hellip;] 一句话就是 FactoryBean 用于返回其他对象实例的，而不是自身类型的实例。
[&amp;hellip;] public class Tool { private int id; // standard constructors, getters and setters } public &amp;hellip;"><meta property="og:description" content="理解 Spring 的 FactoryBean 和 ContextAware 接口。
[&amp;hellip;] 一句话就是 FactoryBean 用于返回其他对象实例的，而不是自身类型的实例。
[&amp;hellip;] public class Tool { private int id; // standard constructors, getters and setters } public &amp;hellip;"><link rel=stylesheet href=../../css/style.css><link rel=stylesheet href=../../css/fonts.css><link rel=stylesheet href=../../css/custom.css></head><body class="single post"><div class=crop-h></div><div class=crop-v></div><div class=crop-c></div><nav class="nav-top small"><div class=logo><a href=../../>新街记事</a></div><div class=menu><span class=active><a href=../../post/>博客</a></span>
<span><a href=../../categories/%E7%BC%96%E7%A8%8B/>编程</a></span>
<span><a href=../../categories/%E7%BF%BB%E8%AF%91/>翻译</a></span>
<span><a href=../../categories/%E9%9A%8F%E6%83%B3/>随想</a></span>
<span><a href=../../search/>搜索</a></span></div></nav><div class=article-meta><h1 class=title>Spring FactoryBean and ContextAware</h1><h3 class=meta-line><span><span class=date>2019-05-16</span>
</span><span class=term><a href=../../categories/%E7%BC%96%E7%A8%8B/ class=term-cat>编程</a>
<a href=../../tags/code/ class=term-tag>#code </a><a href=../../tags/spring/ class=term-tag>#spring</a></span></h3></div><div class=main><p>理解 Spring 的 FactoryBean 和 ContextAware 接口。</p><h2 id=factorybean>FactoryBean</h2><p>一句话就是 FactoryBean 用于返回其他对象实例的，而不是自身类型的实例。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Tool</span> {
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#a90d91>int</span> <span style=color:#000>id</span>;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#177500>// standard constructors, getters and setters</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>ToolFactory</span> <span style=color:#a90d91>implements</span> <span style=color:#000>FactoryBean</span><span style=color:#000>&lt;</span><span style=color:#000>Tool</span><span style=color:#000>&gt;</span> {
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#a90d91>int</span> <span style=color:#000>factoryId</span>;
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#a90d91>int</span> <span style=color:#000>toolId</span>;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#000>Tool</span> <span style=color:#000>getObject</span>() <span style=color:#a90d91>throws</span> <span style=color:#000>Exception</span> {
</span></span><span style=display:flex><span>        <span style=color:#a90d91>return</span> <span style=color:#a90d91>new</span> <span style=color:#000>Tool</span>(<span style=color:#000>toolId</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#000>Class</span><span style=color:#000>&lt;?&gt;</span> <span style=color:#000>getObjectType</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a90d91>return</span> <span style=color:#000>Tool</span>.<span style=color:#836c28>class</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#a90d91>boolean</span> <span style=color:#000>isSingleton</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a90d91>return</span> <span style=color:#a90d91>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#177500>// standard setters and getters</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>注册 Tool:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#177500>&lt;!-- factorybean-spring-ctx.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>&lt;beans&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>&lt;bean</span> <span style=color:#836c28>id=</span><span style=color:#c41a16>&#34;tool&#34;</span> <span style=color:#836c28>class=</span><span style=color:#c41a16>&#34;com.baeldung.factorybean.ToolFactory&#34;</span><span style=color:#000>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>&lt;property</span> <span style=color:#836c28>name=</span><span style=color:#c41a16>&#34;factoryId&#34;</span> <span style=color:#836c28>value=</span><span style=color:#c41a16>&#34;9090&#34;</span><span style=color:#000>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>&lt;property</span> <span style=color:#836c28>name=</span><span style=color:#c41a16>&#34;toolId&#34;</span> <span style=color:#836c28>value=</span><span style=color:#c41a16>&#34;1&#34;</span><span style=color:#000>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>&lt;/beans&gt;</span>
</span></span></code></pre></div><p>使用注解注册：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>@Bean</span>(<span style=color:#000>name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;tool&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#000>ToolFactory</span> <span style=color:#000>toolFactory</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>ToolFactory</span> <span style=color:#000>factory</span> <span style=color:#000>=</span> <span style=color:#a90d91>new</span> <span style=color:#000>ToolFactory</span>();
</span></span><span style=display:flex><span>    <span style=color:#000>factory</span>.<span style=color:#836c28>setFactoryId</span>(<span style=color:#000>7070</span>);
</span></span><span style=display:flex><span>    <span style=color:#000>factory</span>.<span style=color:#836c28>setToolId</span>(<span style=color:#000>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a90d91>return</span> <span style=color:#000>factory</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>使用 Tool:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>@RunWith</span>(<span style=color:#000>SpringJUnit4ClassRunner</span>.<span style=color:#836c28>class</span>)
</span></span><span style=display:flex><span><span style=color:#000>@ContextConfiguration</span>(<span style=color:#000>locations</span> <span style=color:#000>=</span> { <span style=color:#c41a16>&#34;classpath:factorybean-spring-ctx.xml&#34;</span> })
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>FactoryBeanXmlConfigTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#000>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#000>Tool</span> <span style=color:#000>tool</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>testConstructWorkerByXml</span>() {
</span></span><span style=display:flex><span>        <span style=color:#000>assertThat</span>(<span style=color:#000>tool</span>.<span style=color:#836c28>getId</span>(), <span style=color:#000>equalTo</span>(<span style=color:#000>1</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>访问 ToolFactory，在 bean id 前面添加 <code>&</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>@RunWith</span>(<span style=color:#000>SpringJUnit4ClassRunner</span>.<span style=color:#836c28>class</span>)
</span></span><span style=display:flex><span><span style=color:#000>@ContextConfiguration</span>(<span style=color:#000>locations</span> <span style=color:#000>=</span> { <span style=color:#c41a16>&#34;classpath:factorybean-spring-ctx.xml&#34;</span> })
</span></span><span style=display:flex><span><span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>FactoryBeanXmlConfigTest</span> {
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>@Resource</span>(<span style=color:#000>name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;&amp;tool&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a90d91>private</span> <span style=color:#000>ToolFactory</span> <span style=color:#000>toolFactory</span>;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>testConstructWorkerByXml</span>() {
</span></span><span style=display:flex><span>        <span style=color:#000>assertThat</span>(<span style=color:#000>toolFactory</span>.<span style=color:#836c28>getFactoryId</span>(), <span style=color:#000>equalTo</span>(<span style=color:#000>9090</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=和-beanfactory-的区别>和 BeanFactory 的区别</h2><p>除了 FactoryBean，还有一个 BeanFactory 的接口及其实现。</p><nav class="post-nav fullwidth"><span>&larr; <a href=../../post/frontend-assets-optimize-gtmetrix/>使用 GTmetrix 对前端静态资源图片优化[翻译]</a></span>
<span><a href=../../post/learn-clojure-by-example/>通过例子学习 Clojure</a> &rarr;</span></nav></div><footer class=small><link rel=stylesheet href=//cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js defer></script><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/copy-button.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/copy-button.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/heading-anchor.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fullwidth.min.js defer></script><hr><p class=nav-bottom><span><a href=https://zhi.moe>xdh</a> © 2024</span>
<span class=menu-bottom><a href=../../categories/>分类</a> <a href=../../tags/>标签</a>
<a href=../../post/index.xml type=application/rss+xml title="RSS feed">订阅</a>
<a href=#>回到顶部</a></span></p></footer></body></html>