<!doctype html><html lang=zh dir=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>在macOS通过SSH访问Windows的WSL2 Ubuntu - zhimoe</title><meta name=keywords content="读书,代码,架构,JVM,Java,Kotlin,Python,Rust"><meta name=author content="zhimoe"><meta property="og:title" content="在macOS通过SSH访问Windows的WSL2 Ubuntu"><meta property="og:site_name" content="zhimoe"><meta property="og:image" content="/img/author.jpg"><meta name=title content="在macOS通过SSH访问Windows的WSL2 Ubuntu - zhimoe"><meta name=description content="编程是一门手艺"><link rel="shortcut icon" href=https://zhimoe.github.io/img/favicon.ico><link rel=apple-touch-icon href=https://zhimoe.github.io/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://zhimoe.github.io/img/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/typeface-fira-sans@1.1.13/index.min.css rel=stylesheet type=text/css><link href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href=https://cdn.jsdelivr.net/npm/imageviewer@1.1.0/dist/viewer.min.css rel=stylesheet><link href=https://zhimoe.github.io/css/main.css rel=stylesheet type=text/css><link href=https://zhimoe.github.io/css/syntax.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=G-CJJZFN2DZR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CJJZFN2DZR")</script><script>const apiEndpoint="https://pageview.zhimoe.workers.dev/write",payload={url:document.location.href,title:document.title,referrer:window.frames.top.document.referrer};fetch(`${apiEndpoint}?${new URLSearchParams(payload)}`,{mode:"no-cors"}).catch(console.log)</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class="site-meta custom-logo"><div class=custom-logo-site-title><a href=https://zhimoe.github.io/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>zhimoe</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>Captain your own Ship.</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=https://zhimoe.github.io/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=https://zhimoe.github.io/post/ rel=section><i class="menu-item-icon fa fa-fw fa-list-alt"></i><br>归档</a></li><li class=menu-item><a href=https://zhimoe.github.io/categories/%E7%BC%96%E7%A8%8B/ rel=section><i class="menu-item-icon fa fa-fw fa-wpexplorer"></i><br>编程</a></li><li class=menu-item><a href=https://zhimoe.github.io/categories/%E7%BF%BB%E8%AF%91/ rel=section><i class="menu-item-icon fa fa-fw fa-language"></i><br>翻译</a></li><li class=menu-item><a href=https://zhimoe.github.io/categories/%E9%A1%B9%E7%9B%AE/ rel=section><i class="menu-item-icon fa fa-fw fa-bathtub"></i><br>项目</a></li><li class=menu-item><a href=https://zhimoe.github.io/about/ rel=section><i class="menu-item-icon fa fa-fw fa-grav"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://zhimoe.github.io/post/access-into-wsl2-ubuntu-from-macos/ itemprop=url>在macOS通过SSH访问Windows的WSL2 Ubuntu</a></h1><div class=post-meta><span class=post-time><span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2022-10-30">2022-10-30</time></span>
<span class=post-category>&nbsp; | &nbsp;
<span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=https://zhimoe.github.io/categories/%E7%BC%96%E7%A8%8B itemprop=url rel=index style=text-decoration:underline><span itemprop=name>编程</span></a>
&nbsp;</span></span>
<span>|
<span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>1459 字</span></span>
<span>|
<span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>3分钟</span></span></div></header><div class=post-body itemprop=articleBody><p>配置Windows和WSL2, 使得能通过其他电脑远程SSH到WSL2 Ubuntu.</p><h3 id=背景>背景</h3><p>之前的电脑配置是LinuxMint台式机 + M1 macbook笔记本. 使用Linux主要原因是命令行和Docker. 最近由于二十大, 工作VPN在macOS不让用, 只能将台式机安装上Win10, 发现docker在WSL2运行非常丝滑, 这样正好可以当作macbook的Docker服务器. 切换到Windows还有一个原因就是, Linux的桌面真的不行, 最近三年各种版本的桌面使用一圈, Budgie,Gnome,Cinnamon,Xfce这些桌面总是偶尔界面失去响应,KDE用的不多, 卡顿没遇到但是启动总是慢半秒. Win10除了没有Bash/Zsh, 中文字体垃圾点, 其他的都完胜Linux.<br>下面的教程主要参考:<a href=https://jmmv.dev/2022/02/wsl-ssh-access.html>Configuring SSH access into WSL 1 and WSL 2</a></p><h3 id=1-win10-安装-wsl2-ubuntu>1 Win10 安装 WSL2 Ubuntu</h3><p>注意, 是安装WSL2. 方法参考这个<a href=https://learn.microsoft.com/zh-cn/windows/wsl/install-manual#step-3---enable-virtual-machine-feature>enable-virtual-machine-feature</a>:</p><ol><li>以管理员身份打开 PowerShell（“开始”菜单 >“PowerShell” >单击右键 >“以管理员身份运行”）, 然后输入以下命令:<br><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</code>;</li><li>安装 &ldquo;适用于 x64 计算机的 WSL2 Linux 内核更新包&rdquo;;</li><li>将WSL设置默认version 2, in PowerShell: <code>wsl --set-default-version 2</code>;</li><li>安装Ubuntu, in PowerShell: <code>wsl --install -d Ubuntu-22.04</code>;</li></ol><p><a href=https://learn.microsoft.com/zh-cn/windows/wsl/install>更多参考</a> .</p><h3 id=2-配置ssh-server在ubuntu执行>2 配置SSH server（在Ubuntu执行）</h3><p>进入Ubuntu</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:green>#修改软件源</span>
</span></span><span style=display:flex><span>sudo sed -i <span style=color:#a31515>&#34;s@http://.*archive.ubuntu.com@https://mirrors.tuna.tsinghua.edu.cn@g&#34;</span> /etc/apt/sources.list
</span></span><span style=display:flex><span>sudo sed -i <span style=color:#a31515>&#34;s@http://.*security.ubuntu.com@https://mirrors.tuna.tsinghua.edu.cn@g&#34;</span> /etc/apt/sources.list
</span></span><span style=display:flex><span>sudo apt update &amp;&amp; sudo apt upgrade -y
</span></span></code></pre></div><p>安装配置ssh服务</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt install openssh-server
</span></span><span style=display:flex><span>sudo vim /etc/ssh/sshd_config
</span></span><span style=display:flex><span><span style=color:green># 修改下面几个配置</span>
</span></span><span style=display:flex><span><span style=color:green># Port 2222</span>
</span></span><span style=display:flex><span><span style=color:green># AddressFamily any</span>
</span></span><span style=display:flex><span><span style=color:green># ListenAddress 0.0.0.0</span>
</span></span><span style=display:flex><span><span style=color:green># PasswordAuthentication yes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># 如果启动遇到这个错误, 请执行下面命令: sshd: no hostkeys available -- exiting</span>
</span></span><span style=display:flex><span>sudo ssh-keygen -A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># 启动ssh服务</span>
</span></span><span style=display:flex><span>sudo /usr/sbin/service ssh start
</span></span></code></pre></div><h3 id=3-win10防火墙设置>3 Win10防火墙设置</h3><p>打开控制面板\系统和安全\Windows Defender 防火墙.</p><ul><li>最左边有高级设置</li><li>右键点击入站规则</li><li>新建入站规则</li><li>点击端口,特定端口设置2222</li><li>然后命名之后一路下一步就行</li></ul><p>或者通过shell设置,以管理员身份打开 PowerShell:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>New-NetFirewallRule -Name sshd -DisplayName <span style=color:#a31515>&#39;sshd for WSL&#39;</span> -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 2222
</span></span></code></pre></div><h3 id=4-本地验证ssh访问ubuntu>4 本地验证SSH访问Ubuntu</h3><p>打开Windows Terminal, 尝试ssh访问Ubuntu</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ssh -p 2222 wsluser@localhost
</span></span></code></pre></div><p>如果连接上说明ssh配置已经完成.</p><h3 id=5-ubuntu-ssh服务开机自动启动>5 Ubuntu ssh服务开机自动启动</h3><p>WSL2 Ubuntu 的ssh服务不是跟着Win10开机自动启动的. 在Win10的<code>%USERPROFILE%</code>目录下面新建文件<code>sshd.bat</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>rem sshd.bat
</span></span><span style=display:flex><span>@echo off
</span></span><span style=display:flex><span>setlocal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\Windows\System32\bash.exe -c &#34;sudo /usr/sbin/service ssh start&#34;
</span></span><span style=display:flex><span>rem C:\Windows\System32\wsl.exe -e &#34;sudo /usr/sbin/service ssh start&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>endlocal
</span></span></code></pre></div><p>注意上面 <code>bash.exe -c</code> 和 <code>wsl.exe -e</code> 两个功能是一样的. bash后面不维护了, wsl是官方推荐命令, 但是bash有输出.</p><p>接下来把上面的脚本配置成开机自动执行:</p><ul><li>按下Win键, 搜索“任务计划程序”, 右边点击“创建任务”,</li><li>常规:设置任务名字“Start WSL SSH”, 勾选上“使用最高权限运行”（这是给后面网卡映射命令的权限）</li><li>触发器: 新建, 选择“启动时”</li><li>操作: 选择上面的sshd.bat脚本文件.</li></ul><p>保存, 重启电脑, 打开Terminal, 重新试试<code>ssh -p 2222 wsluser@localhost</code></p><h3 id=5-网卡映射>5 网卡映射</h3><p>到目前为止, 在Win10本地已经可以在开机后直接通过SSH访问Ubuntu了, 但是你如果在局域网内的其他电脑访问, 还是连不上的. 这是因为WSL2是个虚拟机.</p><blockquote><p>WSL 2 is a well-hidden virtual machine, but it is still a virtual machine—and the consequences of this design are leaky. The network interface we see within WSL is a virtual interface that does not match the physical interface that Windows manages. Windows does a good job at hiding this fact when operating directly on the local machine (e.g. you can SSH into WSL from localhost and it will work), but attempts to reach WSL from a separate machine will fail.</p></blockquote><p>设置开机自动执行网卡映射命令, 将上面的sshd.bat文件改成如下:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat><span style=display:flex><span><span style=color:green>rem sshd.bat</span>
</span></span><span style=display:flex><span>@<span style=color:#00f>echo</span> off
</span></span><span style=display:flex><span><span style=color:#00f>setlocal</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\Windows\System32\bash.exe<span style=color:green> -c &#34;sudo /usr/sbin/service ssh start&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>rem C:\Windows\System32\wsl.exe -e &#34;sudo /usr/sbin/service ssh start&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\Windows\System32\netsh.exe<span style=color:green> interface portproxy delete v4tov4 listenport=2222 listenaddress=0.0.0.0 protocol=tcp</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00f>for</span> <span style=color:#00f>/f</span> <span style=color:#a31515>%%</span>i <span style=color:#00f>in</span> (<span style=color:#a31515>&#39;wsl hostname -I&#39;</span>) <span style=color:#00f>do</span> <span style=color:#00f>set</span> IP=<span style=color:#a31515>%%</span>i
</span></span><span style=display:flex><span>C:\Windows\System32\netsh.exe<span style=color:green> interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=2222 connectaddress=%IP%</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00f>endlocal</span>
</span></span></code></pre></div><p>保存后启动, 在macbook试试, 成功.</p></div><footer class=post-footer><div class=post-tags><a href=https://zhimoe.github.io/tags/ssh rel=tag title=ssh>#ssh#</a>
<a href=https://zhimoe.github.io/tags/mac rel=tag title=mac>#mac#</a>
<a href=https://zhimoe.github.io/tags/wsl rel=tag title=wsl>#wsl#</a></div><div class=post-nav><div class=article-copyright><div class=article-copyright-info><p><span>文章：</span><a href=https://zhimoe.github.io/post/access-into-wsl2-ubuntu-from-macos/> 在macOS通过SSH访问Windows的WSL2 Ubuntu by zhimoe</a></p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作不易，打赏作者 ^_^</div><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=https://zhimoe.github.io/img/wechat-pay.jpg alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=https://zhimoe.github.io/img/ali-pay.jpg alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href=https://zhimoe.github.io/post/quarkus-notes/ rel=prev title=云原生Java开发框架Quarkus学习笔记>云原生Java开发框架Quarkus学习笔记
<i class="fa fa-chevron-right"></i></a></div></div><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://zhimoe.github.io/post/access-into-wsl2-ubuntu-from-macos/",this.page.identifier="https://zhimoe.github.io/post/access-into-wsl2-ubuntu-from-macos/"};(function(){var e=document,t=e.createElement("script");t.src="https://zhimoe.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=https://zhimoe.github.io/img/avatar.png alt=zhimoe><p class=site-author-name itemprop=name>zhimoe</p><p class="site-description motion-element" itemprop=description>Captain your own Ship.</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=https://zhimoe.github.io/post/><span class=site-state-item-count>64</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=https://zhimoe.github.io/categories/><span class=site-state-item-count>4</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=https://zhimoe.github.io/tags/><span class=site-state-item-count>41</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/zhimoe/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://www.zhihu.com/question/21142149/answer/52383396 target=_blank title=ZhiHu><i class="fa fa-fw fa-globe"></i>
ZhiHu</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-external-link"></i>
书签</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://learngitbranching.js.org/ title=可视化学习Git target=_blank>可视化学习Git</a></li><li class=links-of-blogroll-item><a href=https://gallerix.asia/ title=艺术绘画博物馆 target=_blank>艺术绘画博物馆</a></li><li class=links-of-blogroll-item><a href=https://cheats.rs/ title=RustCheatsheet target=_blank>RustCheatsheet</a></li><li class=links-of-blogroll-item><a href=https://developers.google.com/machine-learning/crash-course/ title=谷歌机器学习课程 target=_blank>谷歌机器学习课程</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/code>Code</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/java>Java</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/scala>Scala</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/python>Python</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/rust>Rust</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/spring>Spring</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/docker>Docker</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/git>Git</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/wsl>Wsl</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/aop>Aop</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#背景>背景</a></li><li><a href=#1-win10-安装-wsl2-ubuntu>1 Win10 安装 WSL2 Ubuntu</a></li><li><a href=#2-配置ssh-server在ubuntu执行>2 配置SSH server（在Ubuntu执行）</a></li><li><a href=#3-win10防火墙设置>3 Win10防火墙设置</a></li><li><a href=#4-本地验证ssh访问ubuntu>4 本地验证SSH访问Ubuntu</a></li><li><a href=#5-ubuntu-ssh服务开机自动启动>5 Ubuntu ssh服务开机自动启动</a></li><li><a href=#5-网卡映射>5 网卡映射</a></li></ul></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2016 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>zhimoe</span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.4/dist/jquery.min.js></script>
<script type=text/javascript src=https://zhimoe.github.io/js/search.js></script>
<script type=text/javascript src=https://zhimoe.github.io/js/affix.js></script>
<script type=text/javascript src=https://zhimoe.github.io/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){let e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){let t=$("#content").height(),e=$(window).height();return t>e?t-e:$(document).height()-e}function getScrollbarWidth(){let e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){let t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);let s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){let e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){let t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){let e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){let e;$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){let e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);let t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){let t=$(".header-inner").height()+10;$("#sidebar").css({"margin-top":t}).show();let n=parseInt($("#sidebar").css("margin-top")),s=parseInt($(".sidebar-inner").css("height")),e=n+s,o=$(".content-wrap").height();o<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){let e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=https://cdn.jsdelivr.net/npm/imageviewer@1.1.0/dist/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script></body></html>