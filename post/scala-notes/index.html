<!doctype html><html lang=zh dir=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>Scala 学习笔记 - zhimoe</title><meta name=keywords content="读书,代码,架构,JVM,Java,Kotlin,Python,Rust"><meta name=author content="zhimoe"><meta property="og:title" content="Scala 学习笔记"><meta property="og:site_name" content="zhimoe"><meta property="og:image" content="/img/author.jpg"><meta name=title content="Scala 学习笔记 - zhimoe"><meta name=description content="Captain your own Ship."><link rel="shortcut icon" href=https://zhimoe.github.io/img/favicon.ico><link rel=apple-touch-icon href=https://zhimoe.github.io/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://zhimoe.github.io/img/apple-touch-icon.png><link href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href=https://cdn.bootcdn.net/ajax/libs/imageviewer/1.1.0/viewer.min.css rel=stylesheet><link href="https://zhimoe.github.io/css/main.css?v=20230708" rel=stylesheet type=text/css><link href=https://zhimoe.github.io/css/syntax.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=G-CJJZFN2DZR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CJJZFN2DZR")</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-Hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class="site-meta custom-logo"><div class=custom-logo-site-title><a href=https://zhimoe.github.io/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>zhimoe</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>Captain your own Ship.</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=https://zhimoe.github.io/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=https://zhimoe.github.io/post/ rel=section><i class="menu-item-icon fa fa-fw fa-list-alt"></i><br>归档</a></li><li class=menu-item><a href=https://zhimoe.github.io/categories/%E7%BC%96%E7%A8%8B/ rel=section><i class="menu-item-icon fa fa-fw fa-wpexplorer"></i><br>编程</a></li><li class=menu-item><a href=https://zhimoe.github.io/categories/%E7%BF%BB%E8%AF%91/ rel=section><i class="menu-item-icon fa fa-fw fa-language"></i><br>翻译</a></li><li class=menu-item><a href=https://zhimoe.github.io/categories/%E9%9A%8F%E6%83%B3/ rel=section><i class="menu-item-icon fa fa-fw fa-bathtub"></i><br>随想</a></li><li class=menu-item><a href=https://zhimoe.github.io/about/ rel=section><i class="menu-item-icon fa fa-fw fa-grav"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><div class=search-icon><i class="fa fa-search"></i></div><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div><div class=popup-btn-close><i class="fa fa-times-circle"></i></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://zhimoe.github.io/post/scala-notes/ itemprop=url>Scala 学习笔记</a></h1><div class=post-meta><span class=post-time><time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2019-03-31">2019-03-31</time></span>
<span class=post-category>&nbsp; | &nbsp;
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a class=post-category-list-link href=https://zhimoe.github.io/categories/%E7%BC%96%E7%A8%8B itemprop=url rel=index style=text-decoration:underline><span itemprop=name>编程</span></a>
&nbsp;</span></span></div></header><div class=post-body itemprop=articleBody><p>some notes on scala, includes:</p><ul><li><input checked disabled type=checkbox> setup with maven</li><li><input checked disabled type=checkbox> import</li><li><input checked disabled type=checkbox> == and eq</li><li><input checked disabled type=checkbox> case class</li><li><input checked disabled type=checkbox> for&mldr;yield</li><li><input checked disabled type=checkbox> companion object and class</li><li><input checked disabled type=checkbox> method and function(def val)</li><li><input checked disabled type=checkbox> _ in scala</li><li><input checked disabled type=checkbox> => in scala</li><li><input checked disabled type=checkbox> () {} in scala</li><li><input checked disabled type=checkbox> implicit</li><li><input checked disabled type=checkbox> string</li></ul><h2 id=setup-with-maven>setup with maven</h2><p>目前用sbt的项目比较少,maven的更多. 而且sbt烧cpu. maven项目使用scala参考我的gist:<a href=https://gist.github.com/zhimoe/db6caeed070bfabe70102e2bace0e5b0>scala_maven_pom.xml</a></p><p>学习scala可以使用scala插件的worksheet,这是一个基于脚本互动的REPL. 本文后面的代码全部在worksheet中测试.</p><h2 id=import>import</h2><p>scala的import语句很灵活,可以在任何地方导入class内部外部,方法内部,代码块内部,这样做有一个好处,限制导入方法和对象的scope,防止污染变量.在后面学了implicit隐式转换后,就知道import scope有多重要了.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#000>scala.math._</span> <span style=color:#177500>// import everything in math package 
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>import</span> <span style=color:#000>java.util.</span><span style=color:#000>{</span> <span style=color:#3f6e75>ArrayList</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#a90d91>_</span><span style=color:#000>,</span> <span style=color:#a90d91>_</span><span style=color:#000>}</span> 
</span></span><span style=display:flex><span><span style=color:#177500>//第一个下划线表示隐藏ArrayList,第二个表示通配符,导入所有
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>//默认,scala导入:
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>java</span><span style=color:#000>.</span><span style=color:#000>lang</span><span style=color:#000>.</span><span style=color:#a90d91>_</span>
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>.</span><span style=color:#a90d91>_</span>
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>.</span><span style=color:#3f6e75>Predef</span><span style=color:#000>.</span><span style=color:#a90d91>_</span> 
</span></span><span style=display:flex><span><span style=color:#177500>//推荐看一下Predef的源代码包括：
</span></span></span><span style=display:flex><span><span style=color:#177500>//Predef中定义的方法和属性
</span></span></span><span style=display:flex><span><span style=color:#177500>//常用方法和类
</span></span></span><span style=display:flex><span><span style=color:#177500>//打印方法 println等
</span></span></span><span style=display:flex><span><span style=color:#177500>//一些调试和错误方法
</span></span></span><span style=display:flex><span><span style=color:#177500>//一个特殊的方法表示方法未实现  
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>def</span> <span style=color:#000>???</span> <span style=color:#a90d91>:</span> <span style=color:#a90d91>Nothing</span> <span style=color:#000>=</span> <span style=color:#a90d91>throw</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>NotImplementedError</span>
</span></span><span style=display:flex><span><span style=color:#177500>//Predef还有大量的隐式转换和隐式参数
</span></span></span></code></pre></div><h2 id=-and-eq>== and eq</h2><p>scala里面<code>==</code>等价于java的<code>equals</code>方法即内容比较,并且可以正确处理<code>null</code>(还记得java规范里面烦人的 <code>"A".equals(m)</code>规范么?). 而地址(引用)比较使用<code>eq</code> 方法,这个方法其实很少用到,应用代码一般无需比较2个变量的地址.</p><h2 id=case-class>case class</h2><p>case class类似data class,即java的pojo bean,但是提供了更多的方法.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>// 5个特性
</span></span></span><span style=display:flex><span><span style=color:#177500>// 1.添加companion object,apply方法,unapply方法
</span></span></span><span style=display:flex><span><span style=color:#177500>// 2.toString, hashCode and equals and copy methods
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>case</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Student</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span> <span style=color:#000>marks</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>s1</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>Student</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;Rams&#34;</span><span style=color:#000>,</span> <span style=color:#1c01ce>550</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>s2</span> <span style=color:#a90d91>=</span> <span style=color:#000>s1</span><span style=color:#000>.</span><span style=color:#000>copy</span><span style=color:#000>()</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>s3</span> <span style=color:#a90d91>=</span> <span style=color:#000>s1</span><span style=color:#000>.</span><span style=color:#000>copy</span><span style=color:#000>(</span><span style=color:#000>marks</span> <span style=color:#a90d91>=</span> <span style=color:#1c01ce>590</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>s2</span> <span style=color:#000>==</span> <span style=color:#000>s1</span> <span style=color:#177500>//true
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>s3</span> <span style=color:#000>==</span> <span style=color:#000>s1</span> <span style=color:#177500>//false
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>// 3. 构造函数参数自动成为成员变量,即自动给构造参数添加val前缀
</span></span></span><span style=display:flex><span><span style=color:#177500>// 4. 可以用于模式匹配
</span></span></span><span style=display:flex><span><span style=color:#177500>// 5. 默认的,case class和case object是可序列化的(实现Serializable),也即是可以网络传输的
</span></span></span></code></pre></div><h2 id=foryield>for&mldr;yield</h2><blockquote><p>Scala’s “for comprehensions” are syntactic sugar for composition of multiple operations with <code>foreach, map, flatMap, filter or withFilter</code><br>scala的for推导其实就是组合多个<code>foreach, map, flatMap, filter or withFilter</code>的语法糖.<br>以下代码结果r1,r2完全一致:</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>c1</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>List</span><span style=color:#000>(</span><span style=color:#1c01ce>1</span><span style=color:#000>,</span> <span style=color:#1c01ce>2</span><span style=color:#000>,</span> <span style=color:#1c01ce>3</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>c2</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>List</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;a&#34;</span><span style=color:#000>,</span> <span style=color:#c41a16>&#34;b&#34;</span><span style=color:#000>,</span> <span style=color:#c41a16>&#34;c&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>c3</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>List</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;!&#34;</span><span style=color:#000>,</span> <span style=color:#c41a16>&#34;@&#34;</span><span style=color:#000>,</span> <span style=color:#c41a16>&#34;#&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>r1</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>for</span> <span style=color:#000>(</span><span style=color:#000>x</span> <span style=color:#a90d91>&lt;-</span> <span style=color:#000>c1</span><span style=color:#000>;</span> <span style=color:#000>y</span> <span style=color:#a90d91>&lt;-</span> <span style=color:#000>c2</span><span style=color:#000>;</span> <span style=color:#000>z</span> <span style=color:#a90d91>&lt;-</span> <span style=color:#000>c3</span><span style=color:#000>)</span> <span style=color:#a90d91>yield</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>x</span> <span style=color:#000>+</span> <span style=color:#000>y</span> <span style=color:#000>+</span> <span style=color:#000>z</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//&lt;==&gt;
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>r2</span> <span style=color:#a90d91>=</span> <span style=color:#000>c1</span><span style=color:#000>.</span><span style=color:#000>flatMap</span><span style=color:#000>(</span><span style=color:#000>x</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>c2</span><span style=color:#000>.</span><span style=color:#000>flatMap</span><span style=color:#000>(</span><span style=color:#000>y</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>c3</span><span style=color:#000>.</span><span style=color:#000>map</span><span style=color:#000>(</span><span style=color:#000>z</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>x</span> <span style=color:#000>+</span> <span style=color:#000>y</span> <span style=color:#000>+</span> <span style=color:#000>z</span>
</span></span><span style=display:flex><span><span style=color:#000>})))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>assert</span><span style=color:#000>(</span><span style=color:#000>r1</span> <span style=color:#000>==</span> <span style=color:#000>r2</span><span style=color:#000>)</span><span style=color:#177500>//true
</span></span></span></code></pre></div><h2 id=companion-object>companion object</h2><p>Scala中,除了方法,一切都是对象！函数也是对象,根据参数的个数,函数的类型为FunctionN.N为函数参数个数.<br>伴生对象用于定义一些静态方法(工厂方法),其中apply和unapply方法常用. apply方法用于代替new的工厂方法.<br>同时,companion objects can access private fields and methods of their companion trait/class.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Person</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span> <span style=color:#000>age</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>private</span> <span style=color:#a90d91>var</span> <span style=color:#000>skill</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;no skill&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>introduce</span><span style=color:#000>()</span> <span style=color:#a90d91>=</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>s&#34;my name is </span><span style=color:#c41a16>$name</span><span style=color:#c41a16>, I am </span><span style=color:#c41a16>$age</span><span style=color:#c41a16> years old&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// companion object name should be identical to the class name. 
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>Person</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>apply</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span> <span style=color:#000>age</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Person</span> <span style=color:#000>=</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>new</span> <span style=color:#3f6e75>Person</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#000>,</span> <span style=color:#000>age</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>}</span>
</span></span><span style=display:flex><span>  <span style=color:#177500>//apply method override
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#a90d91>def</span> <span style=color:#000>apply</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span> <span style=color:#000>age</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>,</span> <span style=color:#000>skill</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Person</span> <span style=color:#000>=</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>val</span> <span style=color:#000>p</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>Person</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#000>,</span> <span style=color:#000>age</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>p</span><span style=color:#000>.</span><span style=color:#000>skill</span> <span style=color:#a90d91>=</span> <span style=color:#000>skill</span>
</span></span><span style=display:flex><span>    <span style=color:#000>p</span>
</span></span><span style=display:flex><span>  <span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>dahu</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>Person</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;dahu&#34;</span><span style=color:#000>,</span> <span style=color:#1c01ce>30</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>dahu</span><span style=color:#000>.</span><span style=color:#000>introduce</span>
</span></span></code></pre></div><p>伴生对象在模式匹配和抽取器的应用</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>//关于抽取器和unapply方法的进一步示例:
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>trait</span> <span style=color:#3f6e75>User</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>FreeUser</span><span style=color:#000>(</span>
</span></span><span style=display:flex><span>                <span style=color:#a90d91>val</span> <span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span>
</span></span><span style=display:flex><span>                <span style=color:#a90d91>val</span> <span style=color:#000>score</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>,</span>
</span></span><span style=display:flex><span>                <span style=color:#a90d91>val</span> <span style=color:#000>upgradeProbability</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Double</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>extends</span> <span style=color:#3f6e75>User</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>PremiumUser</span><span style=color:#000>(</span>
</span></span><span style=display:flex><span>                   <span style=color:#a90d91>val</span> <span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span>
</span></span><span style=display:flex><span>                   <span style=color:#a90d91>val</span> <span style=color:#000>score</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>extends</span> <span style=color:#3f6e75>User</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>FreeUser</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>unapply</span><span style=color:#000>(</span><span style=color:#000>user</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>FreeUser</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Option</span><span style=color:#000>[(</span><span style=color:#a90d91>String</span>, <span style=color:#a90d91>Int</span>, <span style=color:#a90d91>Double</span><span style=color:#000>)]</span> <span style=color:#a90d91>=</span>
</span></span><span style=display:flex><span>    <span style=color:#3f6e75>Some</span><span style=color:#000>((</span><span style=color:#000>user</span><span style=color:#000>.</span><span style=color:#000>name</span><span style=color:#000>,</span> <span style=color:#000>user</span><span style=color:#000>.</span><span style=color:#000>score</span><span style=color:#000>,</span> <span style=color:#000>user</span><span style=color:#000>.</span><span style=color:#000>upgradeProbability</span><span style=color:#000>))</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>PremiumUser</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>unapply</span><span style=color:#000>(</span><span style=color:#000>user</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>PremiumUser</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Option</span><span style=color:#000>[(</span><span style=color:#a90d91>String</span>, <span style=color:#a90d91>Int</span><span style=color:#000>)]</span> <span style=color:#a90d91>=</span>
</span></span><span style=display:flex><span>    <span style=color:#3f6e75>Some</span><span style=color:#000>((</span><span style=color:#000>user</span><span style=color:#000>.</span><span style=color:#000>name</span><span style=color:#000>,</span> <span style=color:#000>user</span><span style=color:#000>.</span><span style=color:#000>score</span><span style=color:#000>))</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>freeUsr</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>FreeUser</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;john&#34;</span><span style=color:#000>,</span> <span style=color:#1c01ce>70</span><span style=color:#000>,</span> <span style=color:#1c01ce>0.5</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>freeUsr</span> <span style=color:#a90d91>match</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#3f6e75>FreeUser</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#000>,</span> <span style=color:#a90d91>_</span><span style=color:#000>,</span> <span style=color:#000>p</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#a90d91>if</span> <span style=color:#000>(</span><span style=color:#000>p</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>0.75</span><span style=color:#000>)</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>s&#34;what can I do for you,</span><span style=color:#c41a16>$name</span><span style=color:#c41a16>&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>else</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>s&#34;hello,</span><span style=color:#c41a16>$name</span><span style=color:#c41a16>&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#a90d91>_</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;who are you&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//bool抽取器
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>premiumCandidate</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>unapply</span><span style=color:#000>(</span><span style=color:#000>user</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>FreeUser</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Boolean</span> <span style=color:#000>=</span> <span style=color:#000>user</span><span style=color:#000>.</span><span style=color:#000>upgradeProbability</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>0.4</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// bool抽取器的用法
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>freeUsr</span> <span style=color:#a90d91>match</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#000>freeUser</span><span style=color:#000>@premiumCandidate</span><span style=color:#000>()</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>s&#34;恭喜成为黄金会员候选人&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#a90d91>_</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;欢迎回来&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#177500>//来源: [Scala初学者指南](http://danielwestheide.com/scala/neophytes.html)
</span></span></span></code></pre></div><h2 id=method-and-functiondef-val>method and function(def val)</h2><p>先看函数定义</p><blockquote><p>A function can be invoked with a list of arguments to produce a result.<br>A function has a parameter list, a body, and a result type. Functions that are<br>members of a class, trait, or singleton object are called methods.<br>Functions defined inside other functions are called local functions. Functions<br>with the result type of Unit are called procedures. Anonymous functions in<br>source code are called function literals. At run time, function literals are<br>instantiated into objects called function values.</p><p>quote from：<programming in scala second edition><br>Martin Odersky - Lex Spoon - Bill Venners</p></blockquote><p>函数由一个参数列表,一个函数体,一个结果类型构成.函数如果作为class,trait或者object（注意,这里的object是scala特有的单例对象,不是Java中的instance）的成员,那么这个函数叫方法.函数和方法的区别就是函数时FunctionN的一个实例,编译后是一个单独的class文件,而方法是依附对象的,调用方法的格式是obj.method(param),而调用函数的格式本质是将调用函数对象的apply方法.<br>函数定义在别的函数内部叫局部函数.函数返回值是Unit称为过程（procedures）.<br>匿名函数是通过函数字面量（ ()=>{函数体} ）定义的函数.在运行时,函数字面量被实例化对象,叫函数值.<br>函数和方法的区别,大部分情况下不用在意区别：<br>函数是有类型的： (T1, &mldr;, Tn) => U,是trait FunctionN的一个实例对象,函数有一个apply方法,用来实际执行function的函数体.函数还有toString, andThen ,conpose等方法.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>fn</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span> <span style=color:#000>=&gt;</span> <span style=color:#3f6e75>String</span> <span style=color:#a90d91>=</span> <span style=color:#000>i</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>i</span><span style=color:#000>+</span><span style=color:#c41a16>&#34;123&#34;</span> <span style=color:#177500>//声明一个函数
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fn</span><span style=color:#000>(</span><span style=color:#1c01ce>3</span><span style=color:#000>)</span> <span style=color:#177500>//实际背后是fn.apply(3);
</span></span></span></code></pre></div><p>scala中除了method,一切都是instance<br>method只能用def 声明,function可以是val和def声明<br>method可以有类型参数[] ,function不能有,函数在声明时就需要知道具体类型.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>fn</span><span style=color:#000>(</span><span style=color:#000>p</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>List</span><span style=color:#000>[</span><span style=color:#a90d91>String</span><span style=color:#000>])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Map</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span> <span style=color:#000>{...}</span> <span style=color:#177500>//is function
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>def</span> <span style=color:#000>m</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>](</span><span style=color:#000>t</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>List</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Map</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span> <span style=color:#000>{...}</span> <span style=color:#177500>//is method,可以有泛型参数.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#000>将method转换成function有两种方法</span><span style=color:#000>：</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>f1</span> <span style=color:#a90d91>=</span> <span style=color:#000>m1</span> <span style=color:#a90d91>_</span>   <span style=color:#177500>//下划线表示参数列表 eta-expansion
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>f2</span><span style=color:#a90d91>:</span> <span style=color:#000>(</span><span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#000>=&gt;</span> <span style=color:#3f6e75>Int</span> <span style=color:#a90d91>=</span> <span style=color:#000>m1</span>  <span style=color:#177500>//m1 的入参和返回值要和f2的一样
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>//scala可以自动将method转换为function,如果一个方法需要一个函数作为参数,
</span></span></span><span style=display:flex><span><span style=color:#177500>//那么可以直接将m1传递给他,不需要 下划线.
</span></span></span><span style=display:flex><span><span style=color:#177500>//每一次将方法转换成function都是得到一个新的function object.
</span></span></span><span style=display:flex><span><span style=color:#177500>//function既然是一个instance,那么编译成class文件会有一个class文件.
</span></span></span></code></pre></div><h2 id=_-in-scala>_ in scala</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>/**
</span></span></span><span style=display:flex><span><span style=color:#177500>  * class Reference[T] {
</span></span></span><span style=display:flex><span><span style=color:#177500>  * private var contents: T = _  
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //使用类型默认值初始化变量,如果T是Int,则contents是0,T是boolean,则是false；Unit则是()
</span></span></span><span style=display:flex><span><span style=color:#177500>  * }
</span></span></span><span style=display:flex><span><span style=color:#177500>  * 
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * List(1, 2, 3) foreach (print _ ) //output 123,表示实参
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //在匿名函数中作为参数占位符：
</span></span></span><span style=display:flex><span><span style=color:#177500>  * List(1, 2, 3) map ( _ + 2 )
</span></span></span><span style=display:flex><span><span style=color:#177500>  * // _ + 2是一个匿名函数
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //模式匹配中的最后一行作为通配符
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case _ =&gt; &#34;this is match anything other than before cases &#34;
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * expr match {
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case List(1,_,_) =&gt; &#34; a list with three element and the first element is 1&#34;
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case List(_*)  =&gt; &#34; a list with zero or more elements &#34;
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case Map[_,_] =&gt; &#34; matches a map with any key type and any value type &#34;
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case _ =&gt;
</span></span></span><span style=display:flex><span><span style=color:#177500>  * }
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //import中作为通配符和隐藏符
</span></span></span><span style=display:flex><span><span style=color:#177500>  * import java.util.{ ArrayList =&gt; _, _} 
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //第一个下划线表示隐藏ArrayList,第二个表示通配符,导入所有
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //将方法变为value
</span></span></span><span style=display:flex><span><span style=color:#177500>  * method _     // Eta expansion of method into method value
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //tuple 的访问
</span></span></span><span style=display:flex><span><span style=color:#177500>  * tpl._2 //返回tpl第二个元素,注意,tuple是从1开始的
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  *
</span></span></span><span style=display:flex><span><span style=color:#177500>  * //还有很多高级的概念,目前还不理解,so上给出的答案
</span></span></span><span style=display:flex><span><span style=color:#177500>  * def f[M[_]]       // Higher kinded type parameter
</span></span></span><span style=display:flex><span><span style=color:#177500>  * def f(m: M[_])    // Existential type
</span></span></span><span style=display:flex><span><span style=color:#177500>  * _ + _             // Anonymous function placeholder parameter
</span></span></span><span style=display:flex><span><span style=color:#177500>  * m _               // Eta expansion of method into method value
</span></span></span><span style=display:flex><span><span style=color:#177500>  * m(_)              // Partial function application
</span></span></span><span style=display:flex><span><span style=color:#177500>  * _ =&gt; 5            // Discarded parameter
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case _ =&gt;         // Wild card pattern -- matches anything
</span></span></span><span style=display:flex><span><span style=color:#177500>  * val (a, _) = (1, 2) // same thing
</span></span></span><span style=display:flex><span><span style=color:#177500>  * for (_ &lt;- 1 to 10)  // same thing
</span></span></span><span style=display:flex><span><span style=color:#177500>  * f(xs: _*)         // Sequence xs is passed as multiple parameters to f(ys: T*)
</span></span></span><span style=display:flex><span><span style=color:#177500>  * case Seq(xs @ _*) // Identifier xs is bound to the whole matched sequence
</span></span></span><span style=display:flex><span><span style=color:#177500>  * var i: Int = _    // Initialization to the default value
</span></span></span><span style=display:flex><span><span style=color:#177500>  * def abc_&lt;&gt;!       // An underscore must separate alphanumerics from symbols on identifiers
</span></span></span><span style=display:flex><span><span style=color:#177500>  * t._2
</span></span></span><span style=display:flex><span><span style=color:#177500>  */</span>
</span></span></code></pre></div><h2 id=-in-scala>=> in scala</h2><h3 id=函数字面量分隔参数和函数体>函数字面量分隔参数和函数体</h3><p>在函数字面量中 <code>=></code>分隔参数和函数体. 也可以表示一个函数类型.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>x</span> <span style=color:#000>*</span> <span style=color:#1c01ce>2</span><span style=color:#000>表示一个匿名函数</span><span style=color:#000>,</span><span style=color:#000>接收一个整数</span><span style=color:#000>,</span><span style=color:#000>返回参数乘以2的结果</span><span style=color:#000>.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>val</span> <span style=color:#000>f</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Function1</span><span style=color:#000>[</span><span style=color:#a90d91>Int</span>,<span style=color:#a90d91>String</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span> <span style=color:#000>argInt</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#c41a16>&#34;my int: &#34;</span><span style=color:#000>+</span><span style=color:#000>argInt</span><span style=color:#000>.</span><span style=color:#000>toString</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span> <span style=color:#000>=&gt;</span> <span style=color:#3f6e75>String</span> <span style=color:#a90d91>=</span> <span style=color:#000>&lt;</span><span style=color:#000>function1</span><span style=color:#000>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// Int =&gt; String 等价 Function1[Int,String]
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>val</span> <span style=color:#000>f2</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span> <span style=color:#000>=&gt;</span> <span style=color:#3f6e75>String</span> <span style=color:#a90d91>=</span> <span style=color:#000>myInt</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#c41a16>&#34;my int v2: &#34;</span><span style=color:#000>+</span><span style=color:#000>myInt</span><span style=color:#000>.</span><span style=color:#000>toString</span>
</span></span><span style=display:flex><span><span style=color:#000>f2</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span> <span style=color:#000>=&gt;</span> <span style=color:#3f6e75>String</span> <span style=color:#a90d91>=</span> <span style=color:#000>&lt;</span><span style=color:#000>function1</span><span style=color:#000>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#177500>//注意,匿名函数没有参数也要括号 ()=&gt;{}；
</span></span></span><span style=display:flex><span><span style=color:#177500>//() =&gt; Unit表示没有返回值的函数
</span></span></span></code></pre></div><h3 id=call-by-name-parameter>call-by-name parameter</h3><p>在函数的参数声明中使用<code>=></code>(e.g. <code>def f(arg: => T</code>))表示这个参数是"by-name parameter",表示这个参数只有在函数体中包含这个参数的语句被执行才会被evaluate.<br>这个特点叫call-by-name,arg可以是一个代码块,甚至函数,在传递给f时不会evaluate,只有f函数体内部调用arg时,arg才会被执行.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>def</span> <span style=color:#000>now</span><span style=color:#000>()={</span><span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;nano time:&#34;</span><span style=color:#000>);</span><span style=color:#3f6e75>System</span><span style=color:#000>.</span><span style=color:#000>nanoTime</span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>def</span> <span style=color:#000>callByName</span><span style=color:#000>(</span><span style=color:#000>p</span><span style=color:#a90d91>:</span> <span style=color:#000>=&gt;</span> <span style=color:#3f6e75>Long</span><span style=color:#000>)</span><span style=color:#a90d91>:</span><span style=color:#a90d91>Long</span> <span style=color:#000>=</span> <span style=color:#000>{</span><span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;call-by-name:&#34;</span><span style=color:#000>+</span><span style=color:#000>p</span><span style=color:#000>);</span><span style=color:#000>p</span><span style=color:#000>;}</span>
</span></span><span style=display:flex><span>	<span style=color:#000>callByName</span><span style=color:#a90d91>:</span> <span style=color:#000>(</span><span style=color:#a90d91>p:</span> <span style=color:#000>=&gt;</span> <span style=color:#a90d91>Long</span><span style=color:#000>)</span><span style=color:#3f6e75>Long</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#a90d91>def</span> <span style=color:#000>justCall</span><span style=color:#000>(</span><span style=color:#000>p</span> <span style=color:#a90d91>:</span> <span style=color:#a90d91>Long</span><span style=color:#000>)</span> <span style=color:#a90d91>:</span><span style=color:#a90d91>Long</span> <span style=color:#000>=</span> <span style=color:#000>{</span><span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;just-call:&#34;</span><span style=color:#000>+</span><span style=color:#000>p</span><span style=color:#000>);</span><span style=color:#000>p</span><span style=color:#000>;}</span>
</span></span><span style=display:flex><span>	<span style=color:#000>justCall</span><span style=color:#a90d91>:</span> <span style=color:#000>(</span><span style=color:#a90d91>p:</span> <span style=color:#a90d91>Long</span><span style=color:#000>)</span><span style=color:#a90d91>Long</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#000>callByName</span><span style=color:#000>(</span><span style=color:#000>now</span><span style=color:#000>())</span>
</span></span><span style=display:flex><span>	<span style=color:#000>nano</span> <span style=color:#000>time</span><span style=color:#a90d91>:</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>call-by-name:</span><span style=color:#000>5664511571389</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>nano</span> <span style=color:#a90d91>time:</span>
</span></span><span style=display:flex><span>	<span style=color:#000>res2</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Long</span> <span style=color:#000>=</span> <span style=color:#1c01ce>5664511727048</span>
</span></span><span style=display:flex><span><span style=color:#177500>//now()在callByName的函数体的每个出现的地方都执行了
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#000>scala</span><span style=color:#000>&gt;</span> <span style=color:#000>justCall</span><span style=color:#000>(</span><span style=color:#000>now</span><span style=color:#000>())</span>
</span></span><span style=display:flex><span>	<span style=color:#000>nano</span> <span style=color:#000>time</span><span style=color:#a90d91>:</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>just-call:</span><span style=color:#000>5667489483159</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>res3:</span> <span style=color:#a90d91>Long</span> <span style=color:#000>=</span> <span style=color:#1c01ce>5667489483159</span>
</span></span><span style=display:flex><span><span style=color:#177500>//now()只在传递参数的时候被执行了.
</span></span></span></code></pre></div><h3 id=模式匹配中分隔case模式和返回值>模式匹配中分隔case模式和返回值</h3><p>在case语句中,=> 分隔模式和返回表达式.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>a</span> <span style=color:#a90d91>=</span> <span style=color:#1c01ce>1</span>  
</span></span><span style=display:flex><span><span style=color:#000>a</span> <span style=color:#a90d91>match</span><span style=color:#000>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#a90d91>case</span> <span style=color:#1c01ce>1</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;One&#34;</span><span style=color:#000>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#a90d91>case</span> <span style=color:#1c01ce>2</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;Two&#34;</span><span style=color:#000>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#a90d91>case</span> <span style=color:#a90d91>_</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;No&#34;</span><span style=color:#000>)</span>  
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span></code></pre></div><h2 id=--in-method-call>() {} in method call</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>// 规则1:{}表示code block,你可以在里面放几乎任何语句,block的返回值是由最后一句决定
</span></span></span><span style=display:flex><span><span style=color:#177500>// 规则2:block内容如果只有一句可以省略{},但是case clause除外:{case ...}
</span></span></span><span style=display:flex><span><span style=color:#177500>// 规则3: 单参数方法如果实参是code block,那么可以省略()
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>import</span> <span style=color:#000>util.Try</span>
</span></span><span style=display:flex><span>  <span style=color:#000>println</span><span style=color:#000>{</span><span style=color:#c41a16>&#34;hello&#34;</span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>  <span style=color:#1c01ce>5</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>tupleList</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>List</span><span style=color:#000>[(</span><span style=color:#a90d91>String</span>, <span style=color:#a90d91>String</span><span style=color:#000>)]()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//规则2
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>tupleList</span> <span style=color:#000>takeWhile</span><span style=color:#000>(</span> <span style=color:#000>{</span> <span style=color:#a90d91>case</span><span style=color:#000>(</span><span style=color:#000>t1</span><span style=color:#000>,</span><span style=color:#000>t2</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>t1</span><span style=color:#000>==</span><span style=color:#000>t2</span> <span style=color:#000>}</span> <span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// 规则2
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#3f6e75>List</span><span style=color:#000>(</span><span style=color:#1c01ce>1</span><span style=color:#000>,</span> <span style=color:#1c01ce>2</span><span style=color:#000>,</span> <span style=color:#1c01ce>3</span><span style=color:#000>).</span><span style=color:#000>reduceLeft</span><span style=color:#000>(</span><span style=color:#a90d91>_</span><span style=color:#000>+</span><span style=color:#a90d91>_</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// 一种特殊情况,提示:隐式转换
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>r</span> <span style=color:#a90d91>=</span> <span style=color:#3f6e75>List</span><span style=color:#000>(</span><span style=color:#1c01ce>1</span><span style=color:#000>,</span> <span style=color:#1c01ce>2</span><span style=color:#000>,</span> <span style=color:#1c01ce>3</span><span style=color:#000>).</span><span style=color:#000>foldLeft</span><span style=color:#000>(</span><span style=color:#1c01ce>0</span><span style=color:#000>)</span> <span style=color:#000>{</span><span style=color:#a90d91>_</span><span style=color:#000>+</span><span style=color:#a90d91>_</span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#177500>//val l = r{&#34;hello&#34;}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>//不要调用这个方法
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>def</span> <span style=color:#000>loopf</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span> <span style=color:#000>=</span> <span style=color:#000>loopf</span> <span style=color:#000>{</span><span style=color:#000>x</span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//使用{}的特殊情况:for推导可以和()互换,一般建议是除了yield的其他情况都用()
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>for</span><span style=color:#000>{</span><span style=color:#000>tpl</span> <span style=color:#a90d91>&lt;-</span><span style=color:#000>tupleList</span><span style=color:#000>}</span> <span style=color:#a90d91>yield</span> <span style=color:#000>tpl</span><span style=color:#000>.</span><span style=color:#000>_2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//不建议
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>for</span><span style=color:#000>{</span><span style=color:#000>tpl</span> <span style=color:#a90d91>&lt;-</span><span style=color:#000>tupleList</span><span style=color:#000>}</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#000>tpl</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#177500>//推荐
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>for</span><span style=color:#000>(</span><span style=color:#000>tpl</span> <span style=color:#a90d91>&lt;-</span><span style=color:#000>tupleList</span><span style=color:#000>)</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#000>tpl</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//补充, 方法定义时如果没有返回值可以省略=,称为procedure,scala 2.13已经废弃,不要这么写
</span></span></span><span style=display:flex><span><span style=color:#177500>//don&#39;t
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>def</span> <span style=color:#000>p</span><span style=color:#000>(</span><span style=color:#000>in</span><span style=color:#a90d91>:</span><span style=color:#a90d91>String</span> <span style=color:#000>){</span>
</span></span><span style=display:flex><span>  <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>s&#34;hello </span><span style=color:#c41a16>$in</span><span style=color:#c41a16>&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span></code></pre></div><h2 id=implicit>implicit</h2><p>implicit分为隐式参数和隐式转换方法.</p><h3 id=隐式参数>隐式参数</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>//1.隐式参数
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Prefixer</span><span style=color:#000>(</span><span style=color:#a90d91>val</span> <span style=color:#000>prefix</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>addPrefix</span><span style=color:#000>(</span><span style=color:#000>s</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>)(</span><span style=color:#a90d91>implicit</span> <span style=color:#000>p</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Prefixer</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#000>p</span><span style=color:#000>.</span><span style=color:#000>prefix</span> <span style=color:#000>+</span> <span style=color:#000>s</span>
</span></span><span style=display:flex><span><span style=color:#177500>// addPrefix需要提供一个隐式实际参数,否则报错.当然可以在调用时显式传递一个参数
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>val</span> <span style=color:#000>myImplicitPrefixer</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>Prefixer</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;***&#34;</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>addPrefix</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;abc&#34;</span><span style=color:#000>)</span> 
</span></span><span style=display:flex><span><span style=color:#177500>// returns &#34;***abc&#34;
</span></span></span></code></pre></div><h3 id=隐式转换>隐式转换</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>//1. 定义一个含有目标方法的class
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>BlingString</span><span style=color:#000>(</span><span style=color:#000>s</span><span style=color:#a90d91>:</span><span style=color:#a90d91>String</span><span style=color:#000>)</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>bling</span> <span style=color:#a90d91>=</span> <span style=color:#c41a16>&#34;*&#34;</span><span style=color:#000>+</span><span style=color:#000>s</span><span style=color:#000>+</span><span style=color:#c41a16>&#34;*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//2. 定义隐式转换方法
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>def</span> <span style=color:#000>str2BlingString</span><span style=color:#000>(</span><span style=color:#000>s</span><span style=color:#a90d91>:</span><span style=color:#a90d91>String</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>BlingString</span><span style=color:#000>(</span><span style=color:#000>s</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//3. 使用目标方法
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>s</span> <span style=color:#a90d91>=</span> <span style=color:#c41a16>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>s</span><span style=color:#000>.</span><span style=color:#000>bling</span> <span style=color:#177500>// *hello*
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>//在scala.Predef中定义了大量的隐式转换,例如RichInt,StringOps这些,提供类似mkString这些方法
</span></span></span><span style=display:flex><span><span style=color:#177500>//太阳底下无新事,scala常用对象的灵活丰富的语法都是通过隐式转换添加的.
</span></span></span></code></pre></div><h3 id=implicit-class>implicit class</h3><p>可以看到上面的第1,2步非常的繁琐,于是<a href="http://link.zhihu.com/?target=https%3A//docs.scala-lang.org/sips/implicit-classes.html">SIP-13</a>提出一个<code>implicit class</code>,将上面的2步合并:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>BlingString</span><span style=color:#000>(</span><span style=color:#000>s</span><span style=color:#a90d91>:</span><span style=color:#a90d91>String</span><span style=color:#000>)</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>bling</span> <span style=color:#a90d91>=</span> <span style=color:#c41a16>&#34;*&#34;</span><span style=color:#000>+</span><span style=color:#000>s</span><span style=color:#000>+</span><span style=color:#c41a16>&#34;*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#177500>//implicit def str2BlingString(s:String) = new BlingString(s)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>hi</span> <span style=color:#a90d91>=</span> <span style=color:#c41a16>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>hi</span><span style=color:#000>.</span><span style=color:#000>bling</span> <span style=color:#177500>// *hello*
</span></span></span></code></pre></div><p>注意,这个只是一个语法糖.去糖后就是上面的那个形式. implicit class有3个约束和一个注解问题：</p><ol><li><p>必须要有主一个构造函数且只能一个构造参数（implicit参数除外）.构造参数就是源类型. 这个构造函数即等价上面第2步的隐式转换方法：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>RichDate</span><span style=color:#000>(</span><span style=color:#000>date</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>java.util.Date</span><span style=color:#000>)</span> <span style=color:#177500>// OK!
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Indexer</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>](</span><span style=color:#000>collecton</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>],</span> <span style=color:#000>index</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#177500>// BAD!
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Indexer</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>](</span><span style=color:#000>collecton</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>])(</span><span style=color:#a90d91>implicit</span> <span style=color:#000>index</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Index</span><span style=color:#000>)</span> <span style=color:#177500>// OK!
</span></span></span></code></pre></div></li><li><p>只能定义在其他trait/class/object中：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>Helpers</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>RichInt</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#177500>// OK!
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>RichDouble</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Double</span><span style=color:#000>)</span> <span style=color:#177500>// BAD!
</span></span></span></code></pre></div></li><li><p>在当前scope内,不允许有和implicit class同名的方法,对象,变量.因为case class会自动生成同名object对象,所以implicit class不能是case class.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>Bar</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Bar</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#177500>// BAD!
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>x</span> <span style=color:#a90d91>=</span> <span style=color:#1c01ce>5</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>x</span><span style=color:#000>(</span><span style=color:#000>y</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#177500>// BAD!
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>//cuz case class has companion object by default 
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>case</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Baz</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#177500>// BAD! conflict with the companion object
</span></span></span></code></pre></div></li><li><p>还有就是implicit class的注解在去语法糖后会自动添加到类和方法,除非在注解中指明范围：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>@bar</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//desugar
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>@bar</span> <span style=color:#a90d91>implicit</span> <span style=color:#a90d91>def</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Foo</span> <span style=color:#000>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>@bar</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span><span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//除非在注解中指明：genClass / method
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>@(</span><span style=color:#000>bar</span> <span style=color:#000>@genClass</span><span style=color:#000>)</span> <span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//desugar得到
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>@bar</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>def</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Foo</span> <span style=color:#000>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>Foo</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#000>)</span>
</span></span></code></pre></div></li></ol><h3 id=value-class>value class</h3><p>scala 还有一个概念：<a href="http://link.zhihu.com/?target=https%3A//docs.scala-lang.org/overviews/core/value-classes.html">value class</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>Wrapper</span><span style=color:#000>(</span><span style=color:#a90d91>val</span> <span style=color:#000>underlying</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#a90d91>extends</span> <span style=color:#3f6e75>AnyVal</span>
</span></span><span style=display:flex><span><span style=color:#177500>//1. 一个public val参数表示runtime类型,这里是Int. 编译时是Wrapper类型,所以value class目的是降低分配开销.
</span></span></span><span style=display:flex><span><span style=color:#177500>//2. value class 需要 extends AnyVal
</span></span></span><span style=display:flex><span><span style=color:#177500>//3. value class 只能有 defs, 不能有vals, vars, or nested traits, classes or objects,
</span></span></span><span style=display:flex><span><span style=color:#177500>//   因为def是通过静态方法实现的,而val,var这些则必须创建相应类型了.
</span></span></span><span style=display:flex><span><span style=color:#177500>//4. value class 只能扩展通用trait（universal traits）,
</span></span></span><span style=display:flex><span><span style=color:#177500>//   universal traits是A universal trait is a trait that extends Any, only has defs as members, and does no initialization.
</span></span></span><span style=display:flex><span><span style=color:#177500>//
</span></span></span></code></pre></div><h3 id=extension-method>extension method</h3><p>当implicit class类型参数是AnyVal子类时,value class和上面的implicit class形式相近,所以可以通过value class降低implicit class的分配开销.例如RichtInt</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>RichInt</span><span style=color:#000>(</span><span style=color:#a90d91>val</span> <span style=color:#000>self</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#a90d91>extends</span> <span style=color:#3f6e75>AnyVal</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>toHexString</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span> <span style=color:#000>=</span> <span style=color:#000>java</span><span style=color:#000>.</span><span style=color:#000>lang</span><span style=color:#000>.</span><span style=color:#3f6e75>Integer</span><span style=color:#000>.</span><span style=color:#000>toHexString</span><span style=color:#000>(</span><span style=color:#000>self</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span></code></pre></div><p>因为RichInt是value class,在运行时（runtime）不会有RichInt这个类,而是Int,而<code>3.toHexString</code>实际是通过静态方法实现的： <code>RichInt$.MODULE$.extension$toHexString(3)</code>,这么做好处是减少对象分配开销(avoid the overhead of allocation).如果implicit class的类型参数不是AnyVal子类,那么在runtime时会有相应类型对象被创建,用户察觉不到区别.<br>value class还有其他作用和局限性,可以参考上面链接.如果发现错误,请指出,先谢过.</p><p><a href=http://www.lihaoyi.com/post/ImplicitDesignPatternsinScala.html>Implicit Design Patterns in Scala​www.lihaoyi.com</a><br><a href=https://danielwestheide.com/scala/neophytes.html>The Neophyte&rsquo;s Guide to Scala​</a></p><h3 id=集合类的implicit转换>集合类的implicit转换</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>//scala集合和java集合的转换是scala编程最常用的,毕竟java有大量第三方库.
</span></span></span><span style=display:flex><span><span style=color:#177500>//scala提供了两种方法,第一种方法就是隐式转换collection.JavaConversions(scala 2.8)
</span></span></span><span style=display:flex><span><span style=color:#177500>//很快意识到隐式转换对于使用者的代码阅读比较复杂,在2.8.1提供了显示转换collection.JavaConverters,
</span></span></span><span style=display:flex><span><span style=color:#177500>//先看JavaConversions隐式转换:
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>JavaConversions</span> <span style=color:#a90d91>extends</span> <span style=color:#3f6e75>WrapAsScala</span> <span style=color:#a90d91>with</span> <span style=color:#3f6e75>WrapAsJava</span>
</span></span><span style=display:flex><span><span style=color:#177500>//在WrapAsJava
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#a90d91>implicit</span> <span style=color:#a90d91>def</span> <span style=color:#000>mapAsJavaMap</span><span style=color:#000>[</span><span style=color:#a90d91>A</span>, <span style=color:#a90d91>B</span><span style=color:#000>](</span><span style=color:#000>m</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Map</span><span style=color:#000>[</span><span style=color:#a90d91>A</span>, <span style=color:#a90d91>B</span><span style=color:#000>])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>ju.Map</span><span style=color:#000>[</span><span style=color:#a90d91>A</span>, <span style=color:#a90d91>B</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span> <span style=color:#000>m</span> <span style=color:#a90d91>match</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>case</span> <span style=color:#a90d91>null</span>                 <span style=color:#a90d91>=&gt;</span> <span style=color:#a90d91>null</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>case</span> <span style=color:#3f6e75>JMapWrapper</span><span style=color:#000>(</span><span style=color:#000>wrapped</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>wrapped</span><span style=color:#000>.</span><span style=color:#000>asInstanceOf</span><span style=color:#000>[</span><span style=color:#a90d91>ju.Map</span><span style=color:#000>[</span><span style=color:#a90d91>A</span>, <span style=color:#a90d91>B</span><span style=color:#000>]]</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>case</span> <span style=color:#a90d91>_</span>                    <span style=color:#a90d91>=&gt;</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>MapWrapper</span><span style=color:#000>(</span><span style=color:#000>m</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//然后看下collection.JavaConverters._,稍微复杂一些,但是换汤不换药,底层还是隐式转换,
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>JavaConverters</span> <span style=color:#a90d91>extends</span> <span style=color:#3f6e75>DecorateAsJava</span> <span style=color:#a90d91>with</span> <span style=color:#3f6e75>DecorateAsScala</span>
</span></span><span style=display:flex><span><span style=color:#177500>//在DecorateAsJava中有很多隐式转换方法,这些方法将scala集合转换为AsJava对象
</span></span></span><span style=display:flex><span><span style=color:#177500>//(注意下面的ju,是java.util缩写,详情见[征服scala_1](https://zhuanlan.zhihu.com/p/22670426))
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>implicit</span> <span style=color:#a90d91>def</span> <span style=color:#000>seqAsJavaListConverter</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>](</span><span style=color:#000>b</span> <span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>AsJava</span><span style=color:#000>[</span><span style=color:#a90d91>ju.List</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>]]</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>AsJava</span><span style=color:#000>(</span><span style=color:#000>seqAsJavaList</span><span style=color:#000>(</span><span style=color:#000>b</span><span style=color:#000>))</span>
</span></span><span style=display:flex><span><span style=color:#177500>// 而AsJava中定义了asJava方法,这样我们就可以在scala集合上面调用asJava
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>AsJava</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>](</span><span style=color:#000>op</span><span style=color:#a90d91>:</span> <span style=color:#000>=&gt;</span> <span style=color:#000>A</span><span style=color:#000>)</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>    <span style=color:#177500>/** Converts a Scala collection to the corresponding Java collection */</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>def</span> <span style=color:#000>asJava</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>A</span> <span style=color:#000>=</span> <span style=color:#000>op</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#177500>//并且asJava方法的实现是作为构造参数传入AsJava的
</span></span></span><span style=display:flex><span><span style=color:#177500>//上面的seqAsJavaList就是将scala.Seq转换为ju.List的具体实现
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>def</span> <span style=color:#000>seqAsJavaList</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>](</span><span style=color:#000>s</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>ju.List</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span> <span style=color:#000>s</span> <span style=color:#a90d91>match</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#a90d91>null</span>                   <span style=color:#a90d91>=&gt;</span> <span style=color:#a90d91>null</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#3f6e75>JListWrapper</span><span style=color:#000>(</span><span style=color:#000>wrapped</span><span style=color:#000>)</span>  <span style=color:#a90d91>=&gt;</span> <span style=color:#000>wrapped</span><span style=color:#000>.</span><span style=color:#000>asInstanceOf</span><span style=color:#000>[</span><span style=color:#a90d91>ju.List</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#a90d91>_</span>                      <span style=color:#a90d91>=&gt;</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>SeqWrapper</span><span style=color:#000>(</span><span style=color:#000>s</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>//综上,JavaConverters用的还是隐式转换,只不过增加了一个中间类AsJava/AsScala.
</span></span></span></code></pre></div><h3 id=隐式转换的scope>隐式转换的scope</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#177500>//无论是隐式参数还是隐式转换,编译器都要知道去哪里查找这些implicit参数或者方法,
</span></span></span><span style=display:flex><span><span style=color:#177500>//例如import collection.JavaConverters._
</span></span></span><span style=display:flex><span><span style=color:#177500>//由于scala import可以出现在任何地方,这为控制implicit的scope提供了灵活性
</span></span></span><span style=display:flex><span><span style=color:#177500>//这一块我不是完全清楚,只提供一个自己的理解
</span></span></span><span style=display:flex><span><span style=color:#177500>// 1.首先是当前scope的Implicits定义,例如,当前方法内,class内
</span></span></span><span style=display:flex><span><span style=color:#177500>// 2.显式导入 import collection.JavaConversions.asScalaIterator
</span></span></span><span style=display:flex><span><span style=color:#177500>// 3.通配符导入 import collection.JavaConverters._
</span></span></span><span style=display:flex><span><span style=color:#177500>// 4.类型的伴生对象内(这个常用)
</span></span></span><span style=display:flex><span><span style=color:#177500>// 5.参数类型的隐式scope (2.9.1添加):class构造参数的隐式转换搜索返回会被应用到
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>A</span><span style=color:#000>(</span><span style=color:#a90d91>val</span> <span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>def</span> <span style=color:#000>+(</span><span style=color:#000>other</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>A</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#000>A</span><span style=color:#000>(</span><span style=color:#000>n</span> <span style=color:#000>+</span> <span style=color:#000>other</span><span style=color:#000>.</span><span style=color:#000>n</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>A</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>implicit</span> <span style=color:#a90d91>def</span> <span style=color:#000>fromInt</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#000>A</span><span style=color:#000>(</span><span style=color:#000>n</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>new</span> <span style=color:#000>A</span><span style=color:#000>(</span><span style=color:#1c01ce>1</span><span style=color:#000>)</span> <span style=color:#000>+</span> <span style=color:#1c01ce>2</span> <span style=color:#177500>// new A(1) + A.fromInt(2)
</span></span></span><span style=display:flex><span><span style=color:#177500>//6.类型参数的隐式转换,下面的sorted方法期望有一个Ordering[A],
</span></span></span><span style=display:flex><span><span style=color:#177500>//在伴生对象中提供了一个 A -&gt; Ordering[A] ,
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>class</span> <span style=color:#3f6e75>A</span><span style=color:#000>(</span><span style=color:#a90d91>val</span> <span style=color:#000>n</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>object</span> <span style=color:#3f6e75>A</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>implicit</span> <span style=color:#a90d91>val</span> <span style=color:#000>ord</span> <span style=color:#a90d91>=</span> <span style=color:#a90d91>new</span> <span style=color:#3f6e75>Ordering</span><span style=color:#000>[</span><span style=color:#a90d91>A</span><span style=color:#000>]</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a90d91>def</span> <span style=color:#000>compare</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>A</span><span style=color:#000>,</span> <span style=color:#000>y</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>A</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#000>implicitly</span><span style=color:#000>[</span><span style=color:#a90d91>Ordering</span><span style=color:#000>[</span><span style=color:#a90d91>Int</span><span style=color:#000>]].</span><span style=color:#000>compare</span><span style=color:#000>(</span><span style=color:#000>x</span><span style=color:#000>.</span><span style=color:#000>n</span><span style=color:#000>,</span> <span style=color:#000>y</span><span style=color:#000>.</span><span style=color:#000>n</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#3f6e75>List</span><span style=color:#000>(</span><span style=color:#a90d91>new</span> <span style=color:#000>A</span><span style=color:#000>(</span><span style=color:#1c01ce>5</span><span style=color:#000>),</span> <span style=color:#a90d91>new</span> <span style=color:#000>A</span><span style=color:#000>(</span><span style=color:#1c01ce>2</span><span style=color:#000>)).</span><span style=color:#000>sorted</span>
</span></span><span style=display:flex><span><span style=color:#177500>// 注意implicitly[Ordering[Int]] 表示在当前scope内搜索一个隐式参数值
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>def</span> <span style=color:#000>implicitly</span><span style=color:#000>[</span><span style=color:#a90d91>T</span><span style=color:#000>](</span><span style=color:#a90d91>implicit</span> <span style=color:#000>e</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>T</span><span style=color:#000>)</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>T</span> <span style=color:#000>=</span> <span style=color:#000>e</span>
</span></span></code></pre></div><h2 id=string>string</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// The s String Interpolator:
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>name</span> <span style=color:#a90d91>=</span> <span style=color:#c41a16>&#34;James&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>s&#34;Hello, </span><span style=color:#c41a16>$name</span><span style=color:#c41a16>&#34;</span><span style=color:#000>)</span>  <span style=color:#177500>// Hello, James
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>// The f Interpolator
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>height</span> <span style=color:#a90d91>=</span> <span style=color:#1c01ce>1.9d</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>name</span> <span style=color:#a90d91>=</span> <span style=color:#c41a16>&#34;James&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#c41a16>f&#34;</span><span style=color:#c41a16>$name</span><span style=color:#c41a16>%s is </span><span style=color:#c41a16>$height</span><span style=color:#c41a16>%2.2f meters tall&#34;</span><span style=color:#000>)</span>  <span style=color:#177500>// James is 1.90 meters tall
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>// The raw Interpolator
</span></span></span><span style=display:flex><span><span style=color:#177500>// The raw interpolator is similar to the s interpolator except that 
</span></span></span><span style=display:flex><span><span style=color:#177500>// it performs no escaping of literals within the string. 
</span></span></span><span style=display:flex><span><span style=color:#177500>// Here’s an example processed string
</span></span></span><span style=display:flex><span><span style=color:#177500>// 即不翻译转义字符
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>scala</span><span style=color:#000>&gt;</span><span style=color:#c41a16>raw&#34;a\nb&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>res1</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span> <span style=color:#000>=</span> <span style=color:#000>a\nb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// &#34;&#34;&#34; triple quotes string
</span></span></span><span style=display:flex><span><span style=color:#177500>// triple quotes &#34;&#34;&#34; to escape characters
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>val</span> <span style=color:#000>donutJson4</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span> <span style=color:#000>=</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      |{
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      |&#34;donut_name&#34;:&#34;Glazed Donut&#34;,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      |&#34;taste_level&#34;:&#34;Very Tasty&#34;,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      |&#34;price&#34;:2.50
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      |}
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>.</span><span style=color:#000>stripMargin</span>
</span></span><span style=display:flex><span><span style=color:#177500>// |会被忽略
</span></span></span><span style=display:flex><span><span style=color:#177500>// &#34;&#34;&#34;还有个很好的用处,正则表达式:
</span></span></span><span style=display:flex><span><span style=color:#177500>// 在java中表示一个或多个空格,&#34;\\s+&#34;
</span></span></span><span style=display:flex><span><span style=color:#177500>// 在scala中只要 &#34;&#34;&#34;\s+&#34;&#34;&#34;,对于复杂正则表达式非常有用.
</span></span></span></code></pre></div><h2 id=links>links</h2><p><a href=https://www.btbytes.com/scala.html>https://www.btbytes.com/scala.html</a></p><p><a href=https://booksites.artima.com/programming_in_scala_2ed/examples/index.html>https://booksites.artima.com/programming_in_scala_2ed/examples/index.html</a></p><p><a href=http://blog.higher-order.com/assets/fpiscompanion.pdf>http://blog.higher-order.com/assets/fpiscompanion.pdf</a></p><p><a href=https://courses.cs.washington.edu/courses/cse341/09au/notes/scala.html>https://courses.cs.washington.edu/courses/cse341/09au/notes/scala.html</a></p><p><a href=https://github.com/dnvriend/my-scala-notes>https://github.com/dnvriend/my-scala-notes</a></p><p><a href=https://gist.github.com/jamesyang124/d65b067327452792287a>https://gist.github.com/jamesyang124/d65b067327452792287a</a></p></div><footer class=post-footer><div class=post-tags><a href=https://zhimoe.github.io/tags/code rel=tag title=code>#code</a></div><div class=reward-qr-info><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>打赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=https://zhimoe.github.io/img/wechat-pay.jpg alt=WeChatPay><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=https://zhimoe.github.io/img/ali-pay.jpg alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://zhimoe.github.io/post/scala-type-class/ rel=next title="Scala Type Class"><i class="fa fa-chevron-left"></i> Scala Type Class</a></div><div class="post-nav-prev post-nav-item"><a href=https://zhimoe.github.io/post/%E4%BD%BF%E7%94%A8redis%E7%9A%84hash%E4%BC%98%E5%8C%96%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8/ rel=prev title=使用redis的hash优化内存使用[翻译]>使用redis的hash优化内存使用[翻译]
<i class="fa fa-chevron-right"></i></a></div></div><div id=giscus class=giscus>评论加载中... 如果长时间无法加载，请针对 giscus.app 启用代理。</div><script src=https://giscus.app/client.js data-repo=zhimoe/zhimoe data-repo-id="MDEwOlJlcG9zaXRvcnkzMzQ2NjI4MDY=" data-category=General data-category-id=DIC_kwDOE_KMls4CXm1t data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=noborder_light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=https://zhimoe.github.io/img/avatar.png alt=zhimoe><p class=site-author-name itemprop=name>zhimoe</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=https://zhimoe.github.io/post/><span class=site-state-item-count>71</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=https://zhimoe.github.io/categories/><span class=site-state-item-count>4</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=https://zhimoe.github.io/tags/><span class=site-state-item-count>44</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/zhimoe/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://www.zhihu.com/question/21142149/answer/52383396 target=_blank title=ZhiHu><i class="fa fa-fw fa-globe"></i>
ZhiHu</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-external-link"></i>
书签</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://learngitbranching.js.org/ title=可视化Git target=_blank>可视化Git</a></li><li class=links-of-blogroll-item><a href=https://gallerix.asia/ title=绘画博物馆 target=_blank>绘画博物馆</a></li><li class=links-of-blogroll-item><a href=https://cheats.rs/ title=Rust小抄 target=_blank>Rust小抄</a></li><li class=links-of-blogroll-item><a href=https://developers.google.com/machine-learning/crash-course/ title=谷歌机器学习 target=_blank>谷歌机器学习</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/code>code</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/java>java</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/scala>scala</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/python>python</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/rust>rust</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/spring>spring</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/qq%E7%A9%BA%E9%97%B4>qq空间</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/%E5%B9%B6%E5%8F%91>并发</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/git>git</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/docker>docker</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/aop>aop</a></li><li class=tagcloud-of-blogroll-item><a href=https://zhimoe.github.io/tags/aurulent>aurulent</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#setup-with-maven>setup with maven</a></li><li><a href=#import>import</a></li><li><a href=#-and-eq>== and eq</a></li><li><a href=#case-class>case class</a></li><li><a href=#foryield>for&mldr;yield</a></li><li><a href=#companion-object>companion object</a></li><li><a href=#method-and-functiondef-val>method and function(def val)</a></li><li><a href=#_-in-scala>_ in scala</a></li><li><a href=#-in-scala>=> in scala</a><ul><li><a href=#函数字面量分隔参数和函数体>函数字面量分隔参数和函数体</a></li><li><a href=#call-by-name-parameter>call-by-name parameter</a></li><li><a href=#模式匹配中分隔case模式和返回值>模式匹配中分隔case模式和返回值</a></li></ul></li><li><a href=#--in-method-call>() {} in method call</a></li><li><a href=#implicit>implicit</a><ul><li><a href=#隐式参数>隐式参数</a></li><li><a href=#隐式转换>隐式转换</a></li><li><a href=#implicit-class>implicit class</a></li><li><a href=#value-class>value class</a></li><li><a href=#extension-method>extension method</a></li><li><a href=#集合类的implicit转换>集合类的implicit转换</a></li><li><a href=#隐式转换的scope>隐式转换的scope</a></li></ul></li><li><a href=#string>string</a></li><li><a href=#links>links</a></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>2016 - 2023</span>
<span class=copyright-icon><i class="fa fa-copyright"></i></span>
<span class=copyright-author>zhimoe</span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=https://cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=https://zhimoe.github.io/js/search.js></script>
<script type=text/javascript src=https://zhimoe.github.io/js/affix.js></script>
<script type=text/javascript src=https://zhimoe.github.io/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){let e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){let t=$("#content").height(),e=$(window).height();return t>e?t-e:$(document).height()-e}function getScrollbarWidth(){let e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){let t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);let s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){let e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){let t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){let e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){let e;$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){let e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);let t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){let t=$(".header-inner").height()+10;$("#sidebar").css({"margin-top":t}).show();let n=parseInt($("#sidebar").css("margin-top")),s=parseInt($(".sidebar-inner").css("height")),e=n+s,o=$(".content-wrap").height();o<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){let e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=https://cdn.bootcdn.net/ajax/libs/imageviewer/1.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script>const apiEndpoint="https://pageview.zhimoe.workers.dev/write",payload={url:document.location.href,title:document.title,referrer:window.frames.top.document.referrer};fetch(`${apiEndpoint}?${new URLSearchParams(payload)}`,{mode:"no-cors"}).catch(console.log)</script></body></html>