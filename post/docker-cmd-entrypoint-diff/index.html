<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Docker CMD ENTRYPOINT 区别 - 香取海</title>
<meta property="og:title" content="Docker CMD ENTRYPOINT 区别 - 香取海"><meta name=twitter:card content="summary"><meta property="description" content="记录 docker 中 exec form 和 shell form 的区别，CMD 和 ENTRYPOINT 区别，以及最佳实践。
[&amp;hellip;] # exec form &amp;lt;instruction&amp;gt; [&amp;#34;executable&amp;#34;, &amp;#34;param1&amp;#34;, &amp;#34;param2&amp;#34;, ...] # shell form &amp;hellip;"><meta property="og:description" content="记录 docker 中 exec form 和 shell form 的区别，CMD 和 ENTRYPOINT 区别，以及最佳实践。
[&amp;hellip;] # exec form &amp;lt;instruction&amp;gt; [&amp;#34;executable&amp;#34;, &amp;#34;param1&amp;#34;, &amp;#34;param2&amp;#34;, ...] # shell form &amp;hellip;"><link rel=stylesheet href=../../css/style.css><link rel=stylesheet href=../../css/fonts.css><link rel=stylesheet href=../../css/custom.css><link rel=icon type=image/png href=../../img/logo.png><link rel=apple-touch-icon href=../../img/logo.png><link rel=apple-touch-icon-precomposed href=../../img/logo.png></head><body class="single post"><div class=crop-h></div><div class=crop-v></div><div class=crop-c></div><nav class="nav-top small"><div class=logo><a href=../../>香取海</a></div><div class=menu><span class=active><a href=../../post/>博客</a></span>
<span><a href=../../categories/%E7%BC%96%E7%A8%8B/>编程</a></span>
<span><a href=../../categories/%E7%BF%BB%E8%AF%91/>翻译</a></span>
<span><a href=../../categories/%E9%9A%8F%E6%83%B3/>随想</a></span>
<span><a href=../../search/>搜索</a></span></div></nav><div class=article-meta><h1 class=title>Docker CMD ENTRYPOINT 区别</h1><h3 class=meta-line><span><span class=date>2020-02-02</span>
</span><span class=term><a href=../../categories/%E7%BC%96%E7%A8%8B/ class=term-cat>编程</a>
<a href=../../tags/code/ class=term-tag>#code </a><a href=../../tags/docker/ class=term-tag>#docker</a></span></h3></div><div class=main><p>记录 docker 中 exec form 和 shell form 的区别，CMD 和 ENTRYPOINT 区别，以及最佳实践。</p><h2 id=exec-form-vs-shell-form>exec form VS shell form</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># exec form
</span></span><span style=display:flex><span>&lt;instruction&gt; [&#34;executable&#34;, &#34;param1&#34;, &#34;param2&#34;, ...]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># shell form
</span></span><span style=display:flex><span>&lt;instruction&gt; &lt;command&gt;
</span></span></code></pre></div><ol><li>exec form 以 JSON 格式解析，所以命令参数必须使用<code>""</code>双引号包裹。</li><li>exec form 不会 invoke shell. 所以<code>CMD [ "echo", "$HOME" ]</code>中<code>$HOME</code>变量不会被替换。</li><li>shell form 实际是执行<code>/bin/sh -c "&lt;command>"</code>。</li><li>优先使用 exec form，因为在 shell form 中<a href=https://hynek.me/articles/docker-signals/ title=docker-signals>spawns your application in a new process and you won’t receive signals from Docker</a>,在 k8s 中会遇到问题。</li><li>在 shell form 也可以使用<code>exec &lt;cmd></code>形式。</li></ol><h2 id=cmd-vs-entrypoint>CMD VS ENTRYPOINT</h2><p><a href=https://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-Dockerfile/21564990#21564990 title=docker-CMD-ENTRYPOINT>直接翻译 SO 上面的回答，比较清楚</a><br>ENTRYPOINT 是容器执行入口，CMD 是参数设置。</p><p>Docker 有默认的 ENTRYPOINT:<code>/bin/sh -c</code>,但是没有默认的 CMD.但是一般镜像都会设置一个默认的 CMD.(注意是<strong>docker</strong>的默认 ENTRYPOINT，和<strong>镜像</strong>的默认<code>CMD</code>,基础镜像一般不设置 ENTRYPOINT)<br><code>docker run -i -t ubuntu bash</code> the ENTRYPOINT is the default <code>/bin/sh -c</code>, the image is <code>ubuntu</code> and the command is <code>bash</code>.<br>所以上面的命令实际上在启动容器中执行了<code>/bin/sh -c bash</code>. 不是所有场景都需要"/bin/sh"的，所以引入了 <code>ENTRYPOINT</code> and <code>--entrypoint</code>.<br><code>docker run -i -t ubuntu</code>中 <code>ubuntu</code>(镜像名) 后面跟的所有内容都作为参数传递给 entrypoint. 这和使用<code>CMD</code>指令是完全一样的，也即是<code>CMD</code>指令可以在<code>docker run</code>中覆盖。<br>由于 ubuntu 镜像设置了默认 CMD: <code>CMD ["bash"]</code>,所以<code>docker run -i -t ubuntu</code>和<code>docker run -i -t ubuntu bash</code>是完全一样的效果。</p><p>所以到此，可以总结：ENTRYPOINT 是容器的执行入口，CMD 是参数设置，不过参数也可以是 bash 中的可执行命令 (例如，<code>CMD ["echo","hello"]</code>,实际执行<code> /bin/sh -c "echo hello"</code>).</p><p>ENTRYPOINT 和 CMD 的搭配可以实现将容器作为一个可执行文件启动，这个特性也是我们日常使用 docker 的主要目的。例如在 Dockerfile 中设置：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#a90d91>ENTRYPOINT</span> [<span style=color:#c41a16>&#34;/bin/cat&#34;</span>]<span style=color:#000>
</span></span></span></code></pre></div><p>运行<code>docker run cat-img /etc/passwd</code>,<code>/etc/passwd</code> 是 cmd, 实际执行的是<code>/bin/cat /etc/passwd</code>. 恭喜你，得到一个 cat 程序，假设你安装了一个 linux 系统，里面没有 cat 命令，cat-img 镜像就可以实现你想要的功能。</p><p>再例如你有个 redis 镜像，与其运行 <code>docker run redis-img redis -H srv-host -u toto get key</code>,<br>不如设置<code>ENTRYPOINT ["redis", "-H", "srv-host", "-u", "toto"]</code> 然后运行<code>docker run redis-img get key</code>.</p><ol><li>Dockerfile 只有最后一个 CMD 会生效;</li><li>可以使用<code>docker inspect &lt;img-id></code>查看默认的<code>CMD</code>参数;</li><li>取消默认 ENTRYPOINT，可以在 Dockerfile 中设置：<code>ENTRYPOINT []</code></li></ol><nav class="post-nav fullwidth"><span>&larr; <a href=../../post/dockerfile-best-practices/>SpringBoot 应用和 Rust 应用的 Dockerfile 最佳实践</a></span>
<span class=post-nav-next><a href=../../post/scala-uniform-access-principle/>scala uniform access principle</a> &rarr;</span></nav></div><footer class=small><link rel=stylesheet href=//cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js defer></script><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/katex/dist/katex.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/math-code.min.js defer></script><script src=//cdn.jsdelivr.net/combine/npm/katex/dist/katex.min.js,npm/katex/dist/contrib/auto-render.min.js,npm/@xiee/utils/js/render-katex.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/copy-button.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/copy-button.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/heading-anchor.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/external-link.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/ol-id.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fullwidth.min.js defer></script><hr><p class=nav-bottom><span><a href=https://zhi.moe>xdh</a> © 2024</span>
<span class=menu-bottom><a href=../../categories/>分类</a> <a href=../../tags/>标签</a>
<a href=../../post/index.xml type=application/rss+xml title="RSS feed">订阅</a>
<a href=#>回到顶部</a></span></p></footer></body></html>