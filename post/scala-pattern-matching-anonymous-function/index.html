<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pattern Matching Anonymous Function - 新街记事</title>
<meta property="og:title" content="Pattern Matching Anonymous Function - 新街记事"><meta name=twitter:card content="summary"><meta property="description" content="Scala 中很多使用 if 的地方都可以用 match case 来替换。常见的就是下面的这种写法：
[&amp;hellip;] val res = msg match { case it if it.contains(&amp;#34;H&amp;#34;) =&amp;gt; &amp;#34;Hello&amp;#34; case _ =&amp;gt; &amp;#34;Other&amp;#34; } //更常见的用法是去匹配参数的模式： case &amp;hellip;"><meta property="og:description" content="Scala 中很多使用 if 的地方都可以用 match case 来替换。常见的就是下面的这种写法：
[&amp;hellip;] val res = msg match { case it if it.contains(&amp;#34;H&amp;#34;) =&amp;gt; &amp;#34;Hello&amp;#34; case _ =&amp;gt; &amp;#34;Other&amp;#34; } //更常见的用法是去匹配参数的模式： case &amp;hellip;"><link rel=stylesheet href=../../css/style.css><link rel=stylesheet href=../../css/fonts.css><link rel=stylesheet href=../../css/custom.css></head><body class="single post"><div class=crop-h></div><div class=crop-v></div><div class=crop-c></div><nav class="nav-top small"><div class=logo><a href=../../>新街记事</a></div><div class=menu><span class=active><a href=../../post/>博客</a></span>
<span><a href=../../categories/%E7%BC%96%E7%A8%8B/>编程</a></span>
<span><a href=../../categories/%E7%BF%BB%E8%AF%91/>翻译</a></span>
<span><a href=../../categories/%E9%9A%8F%E6%83%B3/>随想</a></span>
<span><a href=../../search/>搜索</a></span></div></nav><div class=article-meta><h1 class=title>Pattern Matching Anonymous Function</h1><h3 class=meta-line><span><span class=date>2019-03-31</span>
</span><span class=term><a href=../../categories/%E7%BC%96%E7%A8%8B/ class=term-cat>编程</a>
<a href=../../tags/code/ class=term-tag>#code </a><a href=../../tags/scala/ class=term-tag>#scala</a></span></h3></div><div class=main><p>Scala 中很多使用 if 的地方都可以用 match case 来替换。常见的就是下面的这种写法：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>res</span> <span style=color:#a90d91>=</span> <span style=color:#000>msg</span> <span style=color:#a90d91>match</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>it</span> <span style=color:#a90d91>if</span> <span style=color:#000>it</span><span style=color:#000>.</span><span style=color:#000>contains</span><span style=color:#000>(</span><span style=color:#c41a16>&#34;H&#34;</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#c41a16>&#34;Hello&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#a90d91>_</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#c41a16>&#34;Other&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#177500>//更常见的用法是去匹配参数的模式：
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>case</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>Player</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>String</span><span style=color:#000>,</span> <span style=color:#000>score</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Int</span><span style=color:#000>)</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>message</span><span style=color:#000>(</span><span style=color:#000>player</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Player</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#000>player</span> <span style=color:#a90d91>match</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#3f6e75>Player</span><span style=color:#000>(</span><span style=color:#a90d91>_</span><span style=color:#000>,</span> <span style=color:#000>score</span><span style=color:#000>)</span> <span style=color:#a90d91>if</span> <span style=color:#000>score</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>100000</span> <span style=color:#a90d91>=&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;Get a job, dude!&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#3f6e75>Player</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#000>,</span> <span style=color:#a90d91>_</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;Hey, $name, nice to see you again!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>printMessage</span><span style=color:#000>(</span><span style=color:#000>player</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Player</span><span style=color:#000>)</span> <span style=color:#a90d91>=</span> <span style=color:#000>println</span><span style=color:#000>(</span><span style=color:#000>message</span><span style=color:#000>(</span><span style=color:#000>player</span><span style=color:#000>))</span>
</span></span></code></pre></div><p>其实 case 还有一种在匿名函数中的用法，看如下的代码，在词频统计或者过滤中很常见：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>wordFrequencies</span> <span style=color:#a90d91>=</span> <span style=color:#000>(</span><span style=color:#c41a16>&#34;habitual&#34;</span><span style=color:#000>,</span> <span style=color:#1c01ce>6</span><span style=color:#000>)</span> <span style=color:#a90d91>:</span><span style=color:#a90d91>:</span> <span style=color:#000>(</span><span style=color:#000>&#34;</span><span style=color:#a90d91>and</span><span style=color:#000>&#34;</span><span style=color:#000>,</span> <span style=color:#000>56</span><span style=color:#000>)</span> <span style=color:#a90d91>:</span><span style=color:#a90d91>:</span> <span style=color:#000>(</span><span style=color:#000>&#34;</span><span style=color:#a90d91>consuetudinary</span><span style=color:#000>&#34;</span><span style=color:#000>,</span> <span style=color:#000>2</span><span style=color:#000>)</span>  <span style=color:#a90d91>:</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Nil</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>wordsWithoutOutliers</span><span style=color:#000>(</span><span style=color:#000>wordFrequencies</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[(</span><span style=color:#a90d91>String</span>, <span style=color:#a90d91>Int</span><span style=color:#000>)])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>String</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span>
</span></span><span style=display:flex><span>  <span style=color:#000>wordFrequencies</span><span style=color:#000>.</span><span style=color:#000>filter</span><span style=color:#000>(</span><span style=color:#000>wf</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>wf</span><span style=color:#000>.</span><span style=color:#000>_2</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>3</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>wf</span><span style=color:#000>.</span><span style=color:#000>_2</span> <span style=color:#000>&lt;</span> <span style=color:#1c01ce>25</span><span style=color:#000>).</span><span style=color:#000>map</span><span style=color:#000>(</span><span style=color:#a90d91>_</span><span style=color:#000>.</span><span style=color:#000>_1</span><span style=color:#000>)</span>
</span></span></code></pre></div><p>上面的代码有比较大的问题是访问 tuple 元素的方式比较难看，Scala 提供了一种 pattern matching anonymous function 解决这个问题：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>wordsWithoutOutliers</span><span style=color:#000>(</span><span style=color:#000>wordFrequencies</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[(</span><span style=color:#a90d91>String</span>, <span style=color:#a90d91>Int</span><span style=color:#000>)])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>String</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span>
</span></span><span style=display:flex><span> <span style=color:#000>wordFrequencies</span><span style=color:#000>.</span><span style=color:#000>filter</span> <span style=color:#000>{</span> <span style=color:#a90d91>case</span> <span style=color:#000>(</span><span style=color:#a90d91>_</span><span style=color:#000>,</span> <span style=color:#000>f</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>f</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>3</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>f</span> <span style=color:#000>&lt;</span> <span style=color:#1c01ce>25</span> <span style=color:#000>}</span> <span style=color:#000>map</span> <span style=color:#000>{</span> <span style=color:#a90d91>case</span> <span style=color:#000>(</span><span style=color:#000>w</span><span style=color:#000>,</span> <span style=color:#a90d91>_</span><span style=color:#000>)</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>w</span> <span style=color:#000>}</span>
</span></span></code></pre></div><p>注意到省略了最早版本的 <code>wf =></code>,IDEA 其实会提示你省略这个冗余部分。<br>另一个问题就是上面的操作中我们先过滤想要的序列，然后对序列进行了 map 映射操作.Scala 集合的 API 有一个叫做 <code>collect</code> 的方法，对于 <code>Seq[A]</code> ,它有如下方法签名：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>collect</span><span style=color:#000>[</span><span style=color:#a90d91>B</span><span style=color:#000>](</span><span style=color:#000>pf</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>PartialFunction</span><span style=color:#000>[</span><span style=color:#a90d91>A</span>, <span style=color:#a90d91>B</span><span style=color:#000>])</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>Seq</span><span style=color:#000>[</span><span style=color:#a90d91>B</span><span style=color:#000>]</span>
</span></span></code></pre></div><p>这个方法将给定的_偏函数 (partial function)_ 应用到序列的每一个元素上，最后返回一个满足条件并处理后新的序列 ,这里偏函数做了 <code>filter</code> 和 <code>map</code> 要做的事情。<br>现在，我们来重构 <code>wordsWithoutOutliers</code> ,首先定义需要的偏函数：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a90d91>val</span> <span style=color:#000>pf</span><span style=color:#a90d91>:</span> <span style=color:#a90d91>PartialFunction</span><span style=color:#000>[(</span><span style=color:#a90d91>String</span>, <span style=color:#a90d91>Int</span><span style=color:#000>)</span>, <span style=color:#a90d91>String</span><span style=color:#000>]</span> <span style=color:#a90d91>=</span> <span style=color:#000>{</span>
</span></span><span style=display:flex><span> <span style=color:#a90d91>case</span> <span style=color:#000>(</span><span style=color:#000>word</span><span style=color:#000>,</span> <span style=color:#000>freq</span><span style=color:#000>)</span> <span style=color:#a90d91>if</span> <span style=color:#000>freq</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>3</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>freq</span> <span style=color:#000>&lt;</span> <span style=color:#1c01ce>25</span> <span style=color:#a90d91>=&gt;</span> <span style=color:#000>word</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span><span style=display:flex><span><span style=color:#000>wordFrequencies</span><span style=color:#000>.</span><span style=color:#000>collect</span><span style=color:#000>(</span><span style=color:#000>pf</span><span style=color:#000>)</span>
</span></span></code></pre></div><p>我们为这个案例加入了 <em>守卫语句</em>，不在区间里的元素就没有定义。<br>以上来自<a href=http://danielwestheide.com/scala/neophytes.html>Scala 初学者指南</a><br>当然有中文版：<a href=https://www.gitbook.com/book/windor/beginners-guide-to-scala/details>Scala 初学者指南-gitbook</a></p><nav class="post-nav fullwidth"><span>&larr; <a href=../../post/spring-boot-notes/>Spring Boot Notes</a></span>
<span><a href=../../post/scala-type-class/>Scala Type Class</a> &rarr;</span></nav></div><footer class=small><link rel=stylesheet href=//cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js defer></script><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/copy-button.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/copy-button.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/external-link.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fullwidth.min.js defer></script><hr><p class=nav-bottom><span><a href=https://zhi.moe>xdh</a> © 2024</span>
<span class=menu-bottom><a href=../../categories/>分类</a> <a href=../../tags/>标签</a>
<a href=../../post/index.xml type=application/rss+xml title="RSS feed">订阅</a>
<a href=#>回到顶部</a></span></p></footer></body></html>