<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Associated Type in Rust - 新街记事</title>
<meta property="og:title" content="Associated Type in Rust - 新街记事"><meta name=twitter:card content="summary"><meta property="description" content="Associated Type and generic diff in rust
[&amp;hellip;] a type Foo = Bar outside is just type alias. most used in generic type.
[&amp;hellip;] like: type Thunk = Box&amp;lt;dyn Fn() + Send + &amp;#39;static&amp;gt;; &amp;hellip;"><meta property="og:description" content="Associated Type and generic diff in rust
[&amp;hellip;] a type Foo = Bar outside is just type alias. most used in generic type.
[&amp;hellip;] like: type Thunk = Box&amp;lt;dyn Fn() + Send + &amp;#39;static&amp;gt;; &amp;hellip;"><link rel=stylesheet href=../../css/style.css><link rel=stylesheet href=../../css/fonts.css><link rel=stylesheet href=../../css/custom.css></head><body class="single post"><div class=crop-h></div><div class=crop-v></div><div class=crop-c></div><nav class="nav-top small"><div class=logo><a href=../../>新街记事</a></div><div class=menu><span class=active><a href=../../post/>博客</a></span>
<span><a href=../../categories/%E7%BC%96%E7%A8%8B/>编程</a></span>
<span><a href=../../categories/%E7%BF%BB%E8%AF%91/>翻译</a></span>
<span><a href=../../categories/%E9%9A%8F%E6%83%B3/>随想</a></span>
<span><a href=../../search/>搜索</a></span></div></nav><div class=article-meta><h1 class=title>Associated Type in Rust</h1><h3 class=meta-line><span><span class=date>2020-09-20</span>
</span><span class=term><a href=../../categories/%E7%BC%96%E7%A8%8B/ class=term-cat>编程</a>
<a href=../../tags/rust/ class=term-tag>#rust</a></span></h3></div><div class=main><nav id=TableOfContents><ul><li><a href=#type-outside-impl>type outside impl</a></li><li><a href=#type-inside-impl>type inside impl</a></li><li><a href=#diff-in-associated-type-and-generic>diff in associated type and generic</a></li><li><a href=#when-use>when use</a></li></ul></nav><p>Associated Type and generic diff in rust</p><h2 id=type-outside-impl>type outside impl</h2><p>a <code>type Foo = Bar</code> outside is just type alias. most used in generic type.</p><p>like:<code> type Thunk = Box&lt;dyn Fn() + Send + 'static>;</code></p><h2 id=type-inside-impl>type inside impl</h2><p><code>type</code> in an <code>impl</code> defines an associated type. associated type 可以理解为一个类型占位符，在 trait 的方法声明中使用。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#a90d91>pub</span> <span style=color:#a90d91>trait</span> <span style=color:#a90d91>Iterator</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>type</span> <span style=color:#3f6e75>Item</span>; <span style=color:#177500>// or type T: Display;
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>fn</span> <span style=color:#000>next</span>(<span style=color:#000>&amp;</span><span style=color:#a90d91>mut</span> <span style=color:#5b269a>self</span>) -&gt; <span style=color:#a90d91>Option</span><span style=color:#000>&lt;</span><span style=color:#5b269a>Self</span>::<span style=color:#000>Item</span><span style=color:#000>&gt;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这里 Iterator 的 Implementors 将会指定 Item 的具体类型。例如：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#a90d91>impl</span> <span style=color:#a90d91>Iterator</span> <span style=color:#a90d91>for</span> <span style=color:#000>Counter</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>type</span> <span style=color:#3f6e75>Item</span> <span style=color:#000>=</span> <span style=color:#a90d91>u32</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>fn</span> <span style=color:#000>next</span>(<span style=color:#000>&amp;</span><span style=color:#a90d91>mut</span> <span style=color:#5b269a>self</span>) -&gt; <span style=color:#a90d91>Option</span><span style=color:#000>&lt;</span><span style=color:#5b269a>Self</span>::<span style=color:#000>Item</span><span style=color:#000>&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#177500>// --snip--
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=diff-in-associated-type-and-generic>diff in associated type and generic</h2><p>直接将上面的<code>Iterator</code>声明为如下泛型不是更简单么？</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#a90d91>pub</span> <span style=color:#a90d91>trait</span> <span style=color:#a90d91>Iterator</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span> { 
</span></span><span style=display:flex><span>    <span style=color:#a90d91>fn</span> <span style=color:#000>next</span>(<span style=color:#000>&amp;</span><span style=color:#a90d91>mut</span> <span style=color:#5b269a>self</span>) -&gt; <span style=color:#a90d91>Option</span><span style=color:#000>&lt;</span><span style=color:#000>T</span><span style=color:#000>&gt;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>//  with generice, you can set default type:
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#c41a16>/// trait Iterator&lt;T = String&gt;
</span></span></span><span style=display:flex><span><span style=color:#c41a16>///    where T: Display,
</span></span></span></code></pre></div><p>主要的区别就是 generic 可是有任意多个实现，因为<code>Iterator&lt;Foo></code>和<code>Iterator&lt;Bar></code>是两个不同的类型。<br>而 associated type 只能有一个实现，因为<code>Iterator</code>只有一个类型，所以 associated type 可以用于限制类型。</p><h2 id=when-use>when use</h2><p>The quick and dirty answer to when to use generics and when to use associated types is:<br>Use generics if it makes sense to have multiple implementations of a trait for a specific type (such as the <code>From&lt;T></code> trait).<br>Otherwise, use associated types (like <code>Iterator</code> and <code>Deref</code>).</p><p>假设我们实现一个 redis 客户端，那么比较适合使用 associated types:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#a90d91>trait</span> <span style=color:#000>RedisCommand</span>{
</span></span><span style=display:flex><span>    <span style=color:#a90d91>type</span> <span style=color:#3f6e75>Response</span>;
</span></span><span style=display:flex><span>    <span style=color:#a90d91>fn</span> <span style=color:#000>receive</span>(<span style=color:#000>&amp;</span><span style=color:#5b269a>self</span>, <span style=color:#000>message</span>: <span style=color:#a90d91>String</span>) -&gt; <span style=color:#a90d91>Result</span><span style=color:#000>&lt;</span><span style=color:#5b269a>Self</span>::<span style=color:#000>Response</span><span style=color:#000>&gt;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>impl</span> <span style=color:#000>RedisCommand</span> <span style=color:#a90d91>for</span> <span style=color:#000>PingCommand</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>type</span> <span style=color:#3f6e75>Response</span> <span style=color:#000>=</span> <span style=color:#a90d91>String</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a90d91>fn</span> <span style=color:#000>receive</span>(<span style=color:#000>&amp;</span><span style=color:#5b269a>self</span>, <span style=color:#000>message</span>: <span style=color:#a90d91>String</span>) -&gt; <span style=color:#a90d91>Result</span><span style=color:#000>&lt;</span><span style=color:#5b269a>Self</span>::<span style=color:#000>Response</span><span style=color:#000>&gt;</span>{
</span></span><span style=display:flex><span>        <span style=color:#177500>// -- snip --
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><nav class="post-nav fullwidth"><span>&larr; <a href=../../post/python-spell-correct/>Python 如何实现一个拼写检查器[翻译]</a></span>
<span><a href=../../post/programming-fonts/>一些英文字体推荐</a> &rarr;</span></nav></div><footer class=small><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fix-toc.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js defer></script><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/copy-button.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/copy-button.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/heading-anchor.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fullwidth.min.js defer></script><hr><p class=nav-bottom><span><a href=https://zhi.moe>xdh</a> © 2024</span>
<span class=menu-bottom><a href=../../categories/>分类</a> <a href=../../tags/>标签</a>
<a href=../../post/index.xml type=application/rss+xml title="RSS feed">订阅</a>
<a href=#>回到顶部</a></span></p></footer></body></html>