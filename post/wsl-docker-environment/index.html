<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>wsl-docker-environment - 新街记事</title>
<meta property="og:title" content="wsl-docker-environment - 新街记事"><meta name=twitter:card content="summary"><meta property="description" content="使用 wsl,MobaXterm,cmder,docker 打造可视化的 linux 开发环境
[&amp;hellip;] 离不开 Windows 的理由很多，作为后端开发需要使用 linux 的情况也很多，双系统总归是不方便，而且 linux 下的 GUI 体验也没用 Win 10 好。
如果使用虚拟机，那么文件交换和网络等各种问题也需要解决，对系统的内存要求也更高一些。 &amp;hellip;"><meta property="og:description" content="使用 wsl,MobaXterm,cmder,docker 打造可视化的 linux 开发环境
[&amp;hellip;] 离不开 Windows 的理由很多，作为后端开发需要使用 linux 的情况也很多，双系统总归是不方便，而且 linux 下的 GUI 体验也没用 Win 10 好。
如果使用虚拟机，那么文件交换和网络等各种问题也需要解决，对系统的内存要求也更高一些。 &amp;hellip;"><link rel=stylesheet href=../../css/style.css><link rel=stylesheet href=../../css/fonts.css><link rel=stylesheet href=../../css/custom.css><link rel=stylesheet href=https://indestructibletype.com/fonts/Jost.css></head><body class="single post"><div class=crop-h></div><div class=crop-v></div><div class=crop-c></div><nav class="nav-top small"><div class=logo><a href=../../>新街记事</a></div><div class=menu><span class=active><a href=../../post/>博客</a></span>
<span><a href=../../categories/%E7%BC%96%E7%A8%8B/>编程</a></span>
<span><a href=../../categories/%E7%BF%BB%E8%AF%91/>翻译</a></span>
<span><a href=../../categories/%E9%9A%8F%E6%83%B3/>随想</a></span>
<span><a href=../../search/>搜索</a></span></div></nav><div class=article-meta><h1 class=title>wsl-docker-environment</h1><h3 class=meta-line><span><span class=date>2019-01-01</span>
</span><span class=term><a href=../../categories/%E7%BC%96%E7%A8%8B/ class=term-cat>编程</a>
<a href=../../tags/wsl/ class=term-tag>#wsl </a><a href=../../tags/code/ class=term-tag>#code</a></span></h3></div><div class=main><nav id=TableOfContents><ul><li><a href=#配置-wsl-可视化>配置 wsl 可视化</a><ul><li><a href=#windows-开启-wsl-功能>windows 开启 wsl 功能</a></li><li><a href=#windows-下载-wsl>windows 下载 wsl</a></li><li><a href=#windws-下载-cmder-软件>windws 下载 cmder 软件</a></li><li><a href=#wsl-修改软件源使用阿里云的源>wsl 修改软件源，使用阿里云的源。</a></li><li><a href=#wsl-安装必要软件>wsl 安装必要软件</a></li><li><a href=#修改-wsl-下-windows-磁盘挂载点>修改 wsl 下 Windows 磁盘挂载点</a></li><li><a href=#wsl-安装-vs-code-和中文字体>wsl 安装 vs code 和中文字体</a></li><li><a href=#wsl-设置-ssh-功能>wsl 设置 SSH 功能</a></li><li><a href=#windows-安装-vcxsrv>windows 安装 VcXsrv</a></li><li><a href=#启动-wsl-的-vs-code>启动 wsl 的 vs code</a></li><li><a href=#配置-vs-code>配置 vs code.</a></li></ul></li><li><a href=#在-wsl-使用-docker>在 wsl 使用 docker</a></li></ul></nav><p>使用 wsl,MobaXterm,cmder,docker 打造可视化的 linux 开发环境</p><p>离不开 Windows 的理由很多，作为后端开发需要使用 linux 的情况也很多，双系统总归是不方便，而且 linux 下的 GUI 体验也没用 Win 10 好。<br>如果使用虚拟机，那么文件交换和网络等各种问题也需要解决，对系统的内存要求也更高一些。微软为了让更多的开发人员留在 Win10 上面，开发了 WSL，目前的实际体验已经很棒，<br>今天介绍一下如何打造一个可视化的 linux 开发环境&ndash;即在 Win10 启动 linux 的 GUI 软件，例如 vs code 等。在 wsl 启动 vs code 写代码可以有效避免一些 Windows 和 linux 的编码和换行问题。</p><p>本教程分为 2 部分：</p><ul><li><input checked disabled type=checkbox> 配置 wsl 可视化</li><li><input checked disabled type=checkbox> 在 wsl 使用 docker</li></ul><blockquote><p>以下内容中 <code>wsl</code>和<code>ubuntu</code>含义相同，<code>console</code>和<code>命令行</code>含义相同。</p></blockquote><h2 id=配置-wsl-可视化>配置 wsl 可视化</h2><p>系统要求是 Win 10 1803+ 版本 (低于 1803 的 wsl 功能有问题),必须是专业版或教育版才有 wsl 功能。以下内容的命令行如果开头有<code>></code>字符请忽略。</p><h3 id=windows-开启-wsl-功能>windows 开启 wsl 功能</h3><p>控制面板\程序\程序和功能\开发或关闭 Windows 功能 > 勾选 &lsquo;适用于 linux 的 Windows 子系统&rsquo; 和 &lsquo;hyper-V&rsquo;(docker for Windows 需要这个功能，也可以使用 virtualbox 代替), 重启电脑。</p><h3 id=windows-下载-wsl>windows 下载 wsl</h3><p>Windows store 搜索"wsl"或者"ubuntu"下载 ubuntu 版本。ubuntu 和 ubuntu1804 是一个版本，ubuntu1604 是旧的版本。安装完成你的 Windows 应用列表会有一个 ubuntu 应用，点击图标即可打开 ubuntu 命令行。第一次启动需要等待初始化，然后设置用户名和密码。由于字体难看，所以不用这个自带的命令行而使用下面的 cmder.</p><h3 id=windws-下载-cmder-软件>windws 下载 cmder 软件</h3><p>cmder 是 Windows 下最强的命令行功能。不要下载 mini 那个，里面没用 vim 和 git.第一次启动 cmder 记得修改 cmder 启动目录 (默认是 c 盘) 和显示中文设置，具体方法请 google.</p><h3 id=wsl-修改软件源使用阿里云的源>wsl 修改软件源，使用阿里云的源。</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
</span></span><span style=display:flex><span>&gt; sudo sed -i <span style=color:#c41a16>&#39;s/archive.ubuntu.com/mirrors.aliyun.com/g&#39;</span> /etc/apt/sources.list
</span></span><span style=display:flex><span>&gt; sudo apt update
</span></span><span style=display:flex><span>&gt; sudo apt upgrade -y
</span></span></code></pre></div><h3 id=wsl-安装必要软件>wsl 安装必要软件</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#177500># 安装你需要的软件,git和vim是必须的,后面的编辑命令是使用vim</span>
</span></span><span style=display:flex><span>&gt;sudo apt install openjdk-8-jdk-headless openjdk-8-jre-headless maven git unzip vim -y
</span></span></code></pre></div><h3 id=修改-wsl-下-windows-磁盘挂载点>修改 wsl 下 Windows 磁盘挂载点</h3><p>默认的 Windows 磁盘在 wsl 的访问方式是<code>/mnt/d/</code>开头，d 表示 d 盘。但是 docker on linux 的访问路径是 <code>/d</code>,所以这里需要修改挂载点路径。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/wsl.conf
</span></span><span style=display:flex><span><span style=color:#177500>##添加3行内容</span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>automount<span style=color:#000>]</span> 
</span></span><span style=display:flex><span><span style=color:#000>root</span> <span style=color:#000>=</span> / 
</span></span><span style=display:flex><span><span style=color:#000>options</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;metadata&#34;</span>
</span></span></code></pre></div><p>退出 wsl 重启，发现<code>/mnt</code>已经没了，当前目录应该是<code>/c/xxx</code>或者<code>/d/xxx</code>.</p><h3 id=wsl-安装-vs-code-和中文字体>wsl 安装 vs code 和中文字体</h3><p>因为 wsl 没用中文字体将显示豆腐块。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#177500># install chinese fonts for wsl,font name:  &#39;Noto Sans Mono CJK SC&#39;</span>
</span></span><span style=display:flex><span>sudo apt install -y fonts-noto-cjk fonts-noto-cjk-extra
</span></span><span style=display:flex><span><span style=color:#177500># Win10下载vs code的deb包,cd到该目录,使用下面命令安装</span>
</span></span><span style=display:flex><span>sudo apt install ./code_1.31.1-1549938243_amd64.deb
</span></span><span style=display:flex><span><span style=color:#177500># 在wsl要启动code必要依赖</span>
</span></span><span style=display:flex><span>sudo apt install libgtk2.0-0 libxss1 libasound2
</span></span></code></pre></div><h3 id=wsl-设置-ssh-功能>wsl 设置 SSH 功能</h3><p>这样可以借助 VcXsrv 的 X11 转发功能打开 GUI 软件</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt;sudo vim /etc/ssh/sshd_config
</span></span><span style=display:flex><span><span style=color:#177500>#取消Port的注释,并将端口改为2222 (端口需要大于1000)</span>
</span></span><span style=display:flex><span><span style=color:#177500>#将PasswordAuthentication的值改为yes.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>#重启 ssh server:</span>
</span></span><span style=display:flex><span>sudo service ssh --full-restart
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>#将ssh server设置为服务:</span>
</span></span><span style=display:flex><span>sudo service ssh start
</span></span></code></pre></div><h3 id=windows-安装-vcxsrv>windows 安装 VcXsrv</h3><p>用它的 X11 转发功能。安装后默认选项即可，可以设置为开机启动。</p><h3 id=启动-wsl-的-vs-code>启动 wsl 的 vs code</h3><p>在 wsl 输入<code>code .</code>,等待 2 秒，你会发现 Windows 任务栏启动了一个 vs code，如果没用启动成功，说明你的 VcXsrv 的 X11 转发功能有问题。</p><h3 id=配置-vs-code>配置 vs code.</h3><p>上面打开的 vs code 有 2 个问题：中文显示豆腐块，和不能全屏。打开 vs code 的设置</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#177500>#在字体里面先设置你想要英文字体,逗号跟上&#39;Noto Sans Mono CJK SC&#39;</span>
</span></span><span style=display:flex><span><span style=color:#177500>#搜索titleBarStyle,将&#39;Window: title Bar Style&#39;设置为 native</span>
</span></span><span style=display:flex><span><span style=color:#177500>#上面2个设置也可通过直接编辑文件设置,例如我的vs code文件设置是</span>
</span></span><span style=display:flex><span>&gt; cat ~/.config/Code/User/settings.json
</span></span><span style=display:flex><span><span style=color:#000>{</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;Window.titleBarStyle&#34;</span>: <span style=color:#c41a16>&#34;native&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;editor.fontFamily&#34;</span>: <span style=color:#c41a16>&#34;monospace,&#39;Noto Sans Mono CJK SC&#39;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>}</span>
</span></span></code></pre></div><p>至此，已经可以在 linux 下面开发了。当然，其他 GUI 软件没用测试不确定是不是会有小问题。但是 vs code 已经可以应付很多开发工作了。</p><h2 id=在-wsl-使用-docker>在 wsl 使用 docker</h2><p>目前的 wsl 是不支持运行 docker 的，但是可以在 wsl 使用 Windows 的 docker，在使用上面是无感的。</p><ul><li><p>安装 docker for Windows. 这个就不细说了，注意 docker 社区版也是需要注册才能下载的。</p></li><li><p>启动 docker for Windows，右键任务栏的 docker 图标，&ldquo;settings&rdquo;,勾上 &ldquo;expose the daemon on tcp:/localhost:2375 without TLS&rdquo;,这样在 wsl 可以访问这个 docker 服务。</p></li><li><p>wsl 安装 docker，详细内容可以参考官方文档，下面仅列出必要 bash 命令。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#177500>#安装必要组件</span>
</span></span><span style=display:flex><span>sudo apt install -y apt-transport-https ca-certificates curl software-properties-common
</span></span><span style=display:flex><span><span style=color:#177500>#gpg 签名</span>
</span></span><span style=display:flex><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</span></span><span style=display:flex><span>sudo apt-key fingerprint 0EBFCD88
</span></span><span style=display:flex><span><span style=color:#177500>#添加 docker 安装源</span>
</span></span><span style=display:flex><span>sudo add-apt-repository    <span style=color:#c41a16>&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
</span></span></span><span style=display:flex><span><span style=color:#c41a16>  </span><span style=color:#a90d91>$(</span>lsb_release -cs<span style=color:#a90d91>)</span><span style=color:#c41a16> \
</span></span></span><span style=display:flex><span><span style=color:#c41a16>  stable&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install -y docker-ce
</span></span><span style=display:flex><span><span style=color:#177500>#通过 pip 安装 docker-compose</span>
</span></span><span style=display:flex><span>sudo apt install -y python python-pip
</span></span><span style=display:flex><span>sudo usermod -aG docker <span style=color:#000>$USER</span>
</span></span><span style=display:flex><span>pip install --user docker-compose
</span></span><span style=display:flex><span><span style=color:#177500>#验证 docker 安装是否成功</span>
</span></span><span style=display:flex><span>docker info
</span></span><span style=display:flex><span>docker-compose --version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>#修改 docker 服务为 Windows 的 docker</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>echo</span> <span style=color:#c41a16>&#34;export DOCKER_HOST=tcp://localhost:2375&#34;</span> &gt;&gt; ~/.bashrc <span style=color:#000>&amp;&amp;</span> <span style=color:#a90d91>source</span> ~/.bashrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>#验证是否可以访问Windows的docker服务,看image list命令输出和Windows的命令行下面的image list输出是不是完全一样. 可以先在Windows下用docker拉几个镜像.然后在wsl验证</span>
</span></span><span style=display:flex><span>docker image list
</span></span></code></pre></div></li></ul><p>至此，wsl 的 docker 服务也配置完成。</p><nav class="post-nav fullwidth"><span>&larr; <a href=../../post/publish-markdown-blog-by-travis/>使用 travis 自动发布 markdown 到博客</a></span>
<span><a href=../../post/neo4j-intro/>Neo4j 入门</a> &rarr;</span></nav></div><footer class=small><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fix-toc.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js defer></script><script src=//cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/copy-button.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/copy-button.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js defer></script><link rel=stylesheet href=//cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/heading-anchor.min.js defer></script><script src=//cdn.jsdelivr.net/npm/@xiee/utils/js/fullwidth.min.js defer></script><hr><p class=nav-bottom><span><a href=https://zhi.moe>ZhiMoe</a> © 2024</span>
<span class=menu-bottom><a href=../../categories/>Categories</a> <a href=../../tags/>Tags</a>
<a href=../../post/index.xml type=application/rss+xml title="RSS feed">Subscribe</a>
<a href=#>Back to Top</a></span></p></footer></body></html>