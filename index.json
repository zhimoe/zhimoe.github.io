[{"content":"OpenJDK project panama ä¸­ä¸€ä¸ªé‡ç‚¹åŠŸèƒ½å°±æ˜¯ vector apiï¼Œå¯ä»¥æ˜¾è‘—æå‡çŸ©é˜µè®¡ç®—å¯†é›†å‹ç¨‹åºçš„æ€§èƒ½ï¼Œä¾‹å¦‚åœ¨å›¾å½¢è®¡ç®—ã€æœºå™¨å­¦ä¹ ã€å¤§è§„æ¨¡è®¡ç®—ï¼ˆLuceneï¼‰ç­‰ã€‚ ä»€ä¹ˆæ˜¯ SIMD CPU çš„æ¯ä¸ªå¤„ç†å•å…ƒä¸€æ¬¡è¿ç®—åªèƒ½è®¡ç®—ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æˆä¸ºæ ‡é‡å€¼ï¼ˆscalar valueï¼‰ã€‚å¤„ç†å•å…ƒéœ€è¦ 0 æˆ–å¤šä¸ªå‘¨æœŸï¼ˆå³ CPU é¢‘ç‡ï¼‰å®Œæˆä¸€æ¬¡æ“ä½œè®¡ç®—ã€‚ç°ä»£ CPU åŒ…å«å¤šä¸ªæ ¸å¿ƒï¼Œæ¯ä¸ªæ ¸å¿ƒåŒ…å«å¾ˆå¤šå¤„ç†å•å…ƒï¼Œè¿™æ ·å°±æä¾›äº†å¹¶è¡Œåœ¨å¤„ç†å•å…ƒä¸Šé¢æ‰§è¡Œæ“ä½œçš„èƒ½åŠ›ã€‚ å½“è¿›è¡Œå¤§è§„æ¨¡è®¡ç®—æ—¶ï¼Œä¾‹å¦‚ä»æµ·é‡æ•°æ®æºä¸­æ·»åŠ å¤§é‡æ•°å­—ï¼Œç¨‹åºå¯ä»¥å°†æ•°æ®åˆ†å‰²æˆæ›´å°çš„æ•°æ®å—å¹¶å°†å®ƒä»¬åˆ†å¸ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œèƒ½å¤Ÿè·å¾—æ›´å¿«çš„å¤„ç†é€Ÿåº¦ã€‚è¿™æ˜¯è¿›è¡Œå¹¶è¡Œè®¡ç®—çš„æ–¹æ³•ä¹‹ä¸€ã€‚ä½†æ˜¯å³ä¾¿å¦‚æ­¤ï¼Œè¿™äº›æ“ä½œè¿˜æ˜¯å±äº SISDï¼Œå³å•æŒ‡ä»¤å•æ•°æ®ã€‚ SIMD(Single Instruction Multiple Data) è¡¨ç¤ºå•æŒ‡ä»¤å¤šæ•°æ®ã€‚SIMD å¤„ç†å™¨æ˜¯ç‰¹æ®Šçš„å¤„ç†å™¨ï¼Œå®ƒæ²¡æœ‰å¤šçº¿ç¨‹çš„æ¦‚å¿µï¼Œä¾èµ–å¤šä¸ªå¤„ç†å•å…ƒï¼Œèƒ½å¤Ÿåœ¨ä¸€ä¸ª CPU å‘¨æœŸä¸­æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œä½†æ˜¯æ¯ä¸ªå¤„ç†å•å…ƒçš„æ•°æ®ä¸ç›¸åŒï¼Œå› æ­¤å¾—åã€‚SIMD åœ¨ç°å®ä¸­æœ‰å¾ˆå¤šå®é™…çš„ä¾‹å­ï¼Œæ¯”å¦‚ä¸¤ä¸ªæ•°ç»„ç›¸åŠ ã€‚ ä¸å¤„ç†å™¨ä»å†…å­˜åŠ è½½æ ‡é‡å€¼çš„æ–¹å¼ä¸åŒï¼ŒSIMD æœºå™¨åœ¨æ“ä½œä¹‹å‰å°†å†…å­˜ä¸­çš„æ•´æ•°æ•°ç»„åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ã€‚SIMD ç¡¬ä»¶çš„ç»„ç»‡æ–¹å¼ä½¿å¾—å€¼æ•°ç»„çš„åŠ è½½æ“ä½œèƒ½å¤Ÿåœ¨å•ä¸ªå‘¨æœŸå†…è¿›è¡Œã€‚SIMD æœºå™¨å…è®¸æˆ‘ä»¬å¹¶è¡Œåœ°å¯¹æ•°ç»„æ‰§è¡Œè®¡ç®—ï¼Œè€Œæ— éœ€å®é™…ä¾èµ–å¹¶å‘ç¼–ç¨‹ã€‚ ç”±äº SIMD æœºå™¨å°†å†…å­˜è§†ä¸ºæ•°ç»„æˆ–ä¸€ç³»åˆ—å€¼ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç§°ä¸ºå‘é‡ï¼Œå¹¶ä¸” SIMD æœºå™¨æ‰§è¡Œçš„ä»»ä½•æ“ä½œéƒ½æˆä¸ºå‘é‡æ“ä½œã€‚å› æ­¤ï¼Œè¿™æ˜¯ä¸€ç§åˆ©ç”¨ SIMD æ¶æ„åŸç†æ¥æ‰§è¡Œå¹¶è¡Œå¤„ç†ä»»åŠ¡çš„éå¸¸å¼ºå¤§ä¸”é«˜æ•ˆçš„æ–¹æ³•ã€‚ Java Vector API Vector API å¸Œæœ›è®©å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥ä¸å¹³å°æ— å…³çš„æ–¹å¼ç¼–å†™æ•°æ®å¹¶è¡Œè½¯ä»¶ï¼Œå……åˆ†åˆ©ç”¨ SIMD å¤„ç†å™¨çš„ä¼˜åŠ¿ä½†æ˜¯ä¸ç”¨æ¥è§¦ CPU æ¶æ„ï¼ˆAMD or Intelï¼‰ã€‚ è¿˜æ˜¯ä»¥æ•°ç»„ç›¸åŠ ä¸ºä¾‹å­ï¼š package moe.zhi.boot.app; import jdk.incubator.vector.IntVector; import jdk.incubator.vector.VectorSpecies; import java.util.Arrays; import static java.lang.StringTemplate.STR; public class VectorDemo { public static void main(String[] args) { int[] a = new int[]{1, 2, 3, 4, 9, 8, 7, 6, 9, 8, 7, 6, 9, 8, 7, 6, 1, 1}; int[] b = new int[]{9, 8, 7, 6, 9, 8, 7, 6, 9, 8, 7, 6, 9, 8, 7, 6, 9, 8, 7, 6}; int[] c = simpleSum(a, b); System.out.println(Arrays.toString(c)); int[] d = vectorSum(a, b); System.out.println(Arrays.toString(d)); } public static int[] simpleSum(int[] a, int[] b) { var c = new int[a.length]; for (var i = 0; i \u003c a.length; i++) { c[i] = a[i] + b[i]; } return c; } private static final VectorSpecies SPECIES = IntVector.SPECIES_PREFERRED; public static int[] vectorSum(int[] a, int[] b) { var c = new int[a.length]; var upperBound = SPECIES.loopBound(a.length); System.out.println(STR. \"upperBound = \\{ upperBound }\" ); var i = 0; for (; i \u003c upperBound; i += SPECIES.length()) { var va = IntVector.fromArray(SPECIES, a, i); var vb = IntVector.fromArray(SPECIES, b, i); var vc = va.add(vb); vc.intoArray(c, i); } // Compute elements not fitting in the vector alignment. for (; i \u003c a.length; i++) { System.out.println(STR. \"current i is \\{ i }\" ); c[i] = a[i] + b[i]; } return c; } } // è¿è¡Œ //â¯ java --enable-preview --source 21 --add-modules jdk.incubator.vector VectorDemo.java //WARNING: Using incubator modules: jdk.incubator.vector //æ³¨ï¼šVectorDemo.java ä½¿ç”¨ Java SE 21 çš„é¢„è§ˆåŠŸèƒ½ã€‚ //æ³¨ï¼šæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ -Xlint:preview é‡æ–°ç¼–è¯‘ã€‚ //[10, 10, 10, 10, 18, 16, 14, 12, 18, 16, 14, 12, 18, 16, 14, 12, 10, 9] //upperBound = 16 //current i is 16 //current i is 17 //[10, 10, 10, 10, 18, 16, 14, 12, 18, 16, 14, 12, 18, 16, 14, 12, 10, 9] å¯ä»¥çœ‹åˆ° vector api ç›¸å¯¹æ›´åŠ å¤æ‚ï¼ŒåŒ…å«äº†ä¸€ä¸ªä½å®½ç§»åŠ¨å’Œæ‰«å°¾æ“ä½œã€‚ç®€å•çš„ for å¾ªç¯ä½¿ç”¨ i++ å°†ç´¢å¼•åŠ ä¸€ï¼›ä½†æ˜¯åœ¨ vector api ä¸­ï¼Œéœ€è¦æ ¹æ® SIMD å¯„å­˜å™¨çš„æ•°æ®å®½åº¦è¿›è¡Œç§»ä½ã€‚æœ€åï¼Œè¿˜éœ€è¦å¤„ç†æœªåœ¨æ•°æ®å®½åº¦å†…å¯¹é½çš„æ‰€æœ‰å‰©ä½™é¡¹ç›®ã€‚ Lanes, Shapes and Species CPU çš„ SIMD å¤„ç†å™¨ä½æ•°ä¸€èˆ¬ä¸º 64 åˆ° 512 ä½ï¼Œä¸€ä¸ª int å‘é‡æ¯ä¸ª int å€¼æ˜¯ 32 bitsï¼Œå¯¹äº 64 ä½çš„ SIMD å¤„ç†å™¨ï¼Œåˆ™æœ‰ 2 ä¸ªåˆ†é‡ï¼Œåœ¨ vector api ä¸­ç§°ä¸ºé€šé“ï¼ˆlaneï¼‰ã€‚è¿™é‡Œ 64 ç§°ä¸º vector çš„ shapeã€‚vector çš„ shape å’Œæ•°æ®ç±»å‹ç§°ä¸º species â€“ é€šè¿‡class VectorSpeciesè¡¨ç¤ºã€‚ vector çš„è¿ç®—åˆ†ä¸ºé€šé“è¿ç®—å’Œè·¨é€šé“è¿ç®—ï¼ˆlane-wise operations and cross-lane operationsï¼‰ã€‚æ˜¯ä¸æ˜¯å’Œçº¿æ€§ä»£æ•°çš„çŸ¥è¯†è”ç³»èµ·æ¥äº†ï¼Ÿ class Vector å¯¹äºå…­ç§æ”¯æŒç±»å‹ä¸­çš„æ¯ä¸€ç§éƒ½æœ‰å…­ä¸ªæŠ½è±¡å­ç±»ï¼šByteVectorã€ShortVectorã€IntVectorã€LongVectorã€FloatVector å’Œ DoubleVectorã€‚å¯¹äº SIMD æœºå™¨æ¥è¯´ï¼Œç‰¹å®šçš„å®ç°éå¸¸é‡è¦ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½¢çŠ¶ç‰¹å®šçš„å­ç±»è¿›ä¸€æ­¥æ‰©å±•äº†æ¯ç§ç±»å‹çš„è¿™äº›ç±»ã€‚ä¾‹å¦‚ Int128Vectorã€Int512Vector ç­‰ã€‚ Elasticsearch ä¸­ vector api çš„ä½¿ç”¨ ES åœ¨ JDK20 ä»¥ä¸Šå·²ç»å¯ä»¥ä½¿ç”¨ vector apiï¼Œå…·ä½“ PR:Enable the Panama Vector module #96453ã€‚å…³äºæ€§èƒ½æå‡çš„ä¸€ç‚¹å‚è€ƒï¼š indexing-throughput improved by 30% merge-time decreased by 40% script-score-query-java-latency improved by 40% ä½œè€…æ›´åŠ è¯¦ç»†çš„åšå®¢ï¼šAccelerating vector search with SIMD instructions éœ€è¦æ³¨æ„çš„æ˜¯ SIMD ä¸¥é‡ä¾èµ– CPU æ¶æ„ï¼Œè€Œä¸” API å½“å‰è¿˜æ˜¯ incubator é˜¶æ®µï¼Œä¸Šé¢çš„ç»“æœåªæ˜¯å‚è€ƒã€‚ å…·ä½“ä½¿ç”¨ vector api å‚è€ƒ org.apache.lucene.internal.vectorization.PanamaVectorUtilSupport ","title":"Java Vector Api å’Œ Elasticsearch æ€§èƒ½æå‡","uri":"/post/java-vector-api-with-es/"},{"content":"æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„æƒ…å†µæ¯”è¾ƒå°‘ï¼Œä»Šå¤©å‘ç°å…¶å®æœ‰ä¸€ä¸ªä¸´æ—¶ç¯å¢ƒå˜é‡è®¾ç½®çš„ä½¿ç”¨æ–¹å¼ã€‚ with set_environ(env_name, value): # ä½¿ç”¨åè‡ªåŠ¨æ¸…é™¤ env_name å˜é‡ ... # env_name å·²å¤±æ•ˆ å¯å…³é—­èµ„æºçš„ç®¡ç† with self._operation_context() as conn: ... # ä½¿ç”¨æ•°æ®åº“ connection @contextlib.contextmanager def _operation_context(self) -\u003e Generator[Connection, None, None]: \"\"\"Return a context that optimizes for multiple operations on a single transaction. This essentially allows connect()/close() to be called if we detected that we're against an :class:`_engine.Engine` and not a :class:`_engine.Connection`. \"\"\" conn: Connection if self._op_context_requires_connect: conn = self.bind.connect() # type: ignore[union-attr] else: conn = self.bind # type: ignore[assignment] try: yield conn finally: if self._op_context_requires_connect: conn.close() ä¸´æ—¶ç¯å¢ƒå˜é‡çš„è®¾ç½®ä¸æ¸…é™¤ with set_environ('LOCAL_PROXY', value): # LOCAL_PROXY now is value ... # ç¯å¢ƒå˜é‡ä¸­ LOCAL_PROXY å·²æ¢å¤ï¼ˆåˆ é™¤æˆ–è€…å‰å€¼ï¼‰ @contextlib.contextmanager def set_environ(env_name, value): \"\"\"Set the environment variable 'env_name' to 'value' Save previous value, yield, and then restore the previous value stored in the environment variable 'env_name'. If 'value' is None, do nothing\"\"\" value_changed = value is not None old_value = os.environ.get(env_name) if value_changed: os.environ[env_name] = value try: yield # è¿™é‡Œæ— éœ€ yield å…·ä½“å€¼ï¼Œåªæ˜¯åˆ©ç”¨å‰¯ä½œç”¨ finally: # éœ€è¦æ¢å¤åŸæ¥çš„å˜é‡ if value_changed: if old_value is None: del os.environ[env_name] else: os.environ[env_name] = old_value ","title":"Python @contextmanager çš„ä½¿ç”¨","uri":"/post/python-contextlib/"},{"content":"ä¸ªäººå¯¹äºå­—ä½“æœ‰ä¸¥é‡çš„å¼ºè¿«ç—‡ï¼Œåœ¨è¿‡å»åå¹´é‡Œï¼ˆä»¥ååº”è¯¥ä¹Ÿä¼šï¼‰ä¸€ç›´åœ¨æ¢å„ç§ç¼–ç¨‹å­—ä½“ï¼Œä¹Ÿä¼šä½¿ç”¨ fontforge å¯¹å­—ä½“åšä¸€äº›å°ä¿®æ”¹ï¼Œç”šè‡³åœ¨ reddit ä¸Šé¢çœ‹çš„å’¨è¯¢ç¼–ç¨‹å­—ä½“çš„å›¾ç‰‡å¯ä»¥ä¸€çœ¼è®¤å‡ºã€‚\nå¯¹äºç¼–ç¨‹ç­‰å®½å­—ä½“ï¼Œæ›¾ç»ç”¨è¿‡æ¯”è¾ƒä¹…çš„æœ‰ Fira Codeï¼ŒAurulentï¼ŒTheSansMonoï¼ŒGo Monoï¼ŒSource Code Proï¼ŒPlex Monoï¼ŒDrafting Monoã€‚ä¹Ÿç”¨è¿‡ä¸€äº›æ”¶è´¹å­—ä½“ä¾‹å¦‚ MonoLisaï¼ŒPragmataProï¼ŒOperator Monoï¼ŒGintronic ç­‰ã€‚ç›®å‰æœ€å–œæ¬¢çš„è¿˜æ˜¯ Fira Codeï¼ˆMonoLisaç¬¬äºŒï¼‰ï¼Œåªæ˜¯ Fira Code ä¸ªæ€§çªå‡ºï¼Œåœ¨ä¸­è‹±æ–‡æ··æ’ä¸­çœ‹ç€éå¸¸æ˜¾çœ¼ã€‚\nè€Œå¯¹äºä¸­æ–‡éƒ¨åˆ†ï¼Œå°±æ›´åŠ å›°éš¾äº†ã€‚ç›®å‰çš„é»‘ä½“å’Œå®‹ä½“éƒ½æœ‰å„è‡ªçš„é—®é¢˜ï¼šé»‘ä½“å­—å½¢è¿‡å¤§ï¼Œå¦‚æœæ˜¯ 0.5 å®½åº¦çš„è‹±æ–‡ï¼ˆUbuntu Monoï¼ŒPragmataProï¼ŒIosevka ç­‰ï¼‰ï¼Œä¸­æ–‡æ³¨é‡Šè¿‡äºæ˜¾çœ¼ï¼›å®‹ä½“åˆ™æ˜¯æ¨ªç¬”å¤ªç»†ï¼Œå¥½çœ‹çš„ç¼–ç¨‹å­—ä½“éƒ½æ˜¯éè¡¬çº¿çš„ï¼Œæ­é…ä¸æ˜¯å¾ˆåè°ƒï¼Œåœ¨æ˜¾ç¤ºå™¨ä¸Šé¢å®‹ä½“ä¹Ÿä¸é€‚åˆé•¿æ—¶é—´é˜…è¯»ã€‚\nå»å¹´å¶ç„¶å‘ç°ç½‘å‹æ¨èçš„èšçæ–°ä»¿ã€‚è¿™æ˜¯ä¸€ä¸ªæ°‘å›½è®¾è®¡å­—ä½“ï¼Œå¯ä»¥è¯´æ˜¯å®‹ä½“ã€è¡Œæ¥·çš„èåˆä½“ã€‚ç¬”ç”»ç²—ç»†ä»‹äºé»‘ä½“å’Œå®‹ä½“ä¹‹é—´ã€‚ä»æ­¤å°±ä¸€ç›´ä½¿ç”¨è¿™ä¸ªå­—ä½“ã€‚åœ¨ JetBrains IDE å’Œ VS Code ä¸­è®¾ç½® fallback å­—ä½“éå¸¸ç®€å•ï¼Œä½†æ˜¯åœ¨å…¶ä»–è½¯ä»¶å’Œç³»ç»Ÿä¸Šé¢è®¾ç½® fallback å°±éå¸¸è´¹åŠ²ï¼Œäºæ˜¯å†³å®šåˆå¹¶ä¸€ä¸ªå­—ä½“ã€‚\nå¯¹äºè‹±æ–‡éƒ¨åˆ†ï¼Œè™½ç„¶ Fira Code æ˜¯æˆ‘æœ€å–œæ¬¢çš„å­—ä½“ï¼Œä½†æ˜¯ä»åè°ƒæ€§æ¥çœ‹ï¼Œä»¿å®‹å­—ä½“å±äºè¡¬çº¿å­—ä½“ï¼Œæ˜¾ç„¶å’Œ IBM Plex Mono æœ€åˆé€‚ã€‚å¯æƒœ Plex Mono ç­‰å®½å­—ç¬¦ç¼ºå¤±è¾ƒå¤šï¼Œæœ€ç»ˆæˆ‘é€‰æ‹©äº† Source Code Pro å¹¶å¯¹å­—ç¬¦ l,r,4,0,1 åšäº†æ›¿æ¢æˆ–è€…ä¿®æ”¹ï¼Œä½¿å…¶æ›´åŠ é€‚åˆæ­£æ–‡ã€‚\nå¯¹äºä¸­è‹±å­—ç¬¦å®½åº¦é—®é¢˜ï¼Œä¸­æ–‡å­—ä½“çš„å®½åº¦ä¸€èˆ¬ç­‰äº em-sizeï¼ˆå‡è®¾ 1000ï¼‰ï¼Œå³ 1000ï¼Œè‹±æ–‡å­—ä½“çš„å®½åº¦å°±æ¯”è¾ƒå¤šï¼Œä¸»æµçš„æ˜¯ 600ï¼ŒåŠå®½çš„æ˜¯ 500ï¼ˆIosevka æˆ–è€… PragmataProï¼‰,Fira Code å®½åº¦æ˜¯ 1200/1950ï¼ˆem-sizeï¼‰ï¼ŒSF Mono æ˜¯ 1266/2048ï¼ˆem-sizeï¼‰ï¼Œä¼šæ›´åŠ å®½ä¸€ç‚¹ã€‚\nç›®å‰å”¯ä¸€æ”¯æŒ CJK çš„ç­‰å®½å­—ä½“ Sarasa Gothic çš„æ–¹æ¡ˆæ˜¯å°†æ€æºé»‘ä½“å’Œ Iosevka åˆå¹¶ï¼Œä¸­æ–‡å®½åº¦ 1000ï¼Œè‹±æ–‡ 500ï¼Œä½†æ˜¯ç”±äºé»‘ä½“å­—å½¢è¿‡å¤§è¿‡é»‘ï¼Œæ˜¾å¾—è‹±æ–‡åå°ï¼Œè€Œä¸”ç”±äºçª„å®½å­—ä½“è®¾è®¡æ¯”è¾ƒéš¾ï¼Œä¸ªäººæ„Ÿè§‰ Iosevka å’Œ PramataPro ç¾æ„Ÿä¸è¶³ã€‚æœ€ç»ˆé€‰äº† Source Code Proï¼Œå®½åº¦ 600ï¼Œä¸­æ–‡å®½åº¦ 1000ï¼Œè¿™æ ·å¥½å¤„æ˜¯ 5 ä¸ªè‹±æ–‡å­—ç¬¦å’Œ 3 ä¸ªæ±‰å­—ç­‰å®½ï¼Œå‹‰å¼ºèƒ½ç”¨ã€‚\næœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹ï¼š\n","title":"æ”¯æŒä¸­æ–‡çš„ç­‰å®½ç¼–ç¨‹å­—ä½“ï¼šFangSongCode","uri":"/post/programming-font-fangsongcode/"},{"content":"å¼‚æ­¥ç¼–ç¨‹å¾ˆéš¾ï¼Œä½†å´æ˜¯æœ€è¿‘åå¹´æ‰€æœ‰ç¼–ç¨‹è¯­è¨€åœ¨å‘åŠ›çš„æ–¹å‘ã€‚ åœ¨é¢å‘ CPU è®¡ç®—çš„åœºæ™¯ä¸‹ï¼Œå¤šçº¿ç¨‹åŸºæœ¬éƒ½èƒ½åƒæ»¡ CPU èµ„æºã€‚ä½†æ˜¯åœ¨ IO åœºæ™¯ä¸‹ï¼Œå¤šçº¿ç¨‹å¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå¤§éƒ¨åˆ†æ—¶é—´çº¿ç¨‹éƒ½åœ¨ç­‰å¾… IO è°ƒç”¨çš„è¿”å›ã€‚ å®é™…ä¸Š python çš„å®˜æ–¹æ•™ç¨‹é‡Œé¢å¹¶æ²¡æœ‰ async ç¼–ç¨‹çš„å†…å®¹ï¼Œè€Œæ˜¯åœ¨std lib doc ä¸­ç½‘ç»œç¼–ç¨‹ç« èŠ‚ä»‹ç»äº† asyncio è¿™ä¸ª libï¼Œå®é™…ä¸Šè¿™ä¹Ÿæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³ä½¿ç”¨åœºæ™¯ã€‚ æ­¤å¤–ç»å¸¸ä¼šçœ‹åˆ° â€œUse async sparinglyâ€ï¼Œå› ä¸ºå¼‚æ­¥ç¼–ç¨‹å­˜åœ¨æŸ“è‰²é—®é¢˜ï¼Œä¸€æ—¦ä½¿ç”¨ asyncï¼Œä¼šè¦æ±‚ä½ å…¨é“¾è·¯å…¨éƒ¨ä¸º asyncï¼Œå¦åˆ™åœ¨ block æ—¶ cpu å¹¶æ— æ³•è®©å‡ºçº¿ç¨‹èµ„æºã€‚ å¤§å¤šæ•°æƒ…å†µï¼Œå¦‚æœå‡ºäºæ€§èƒ½åŸå› ä¸éœ€è¦å¼‚æ­¥ï¼Œçº¿ç¨‹é€šå¸¸æ˜¯æ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆã€‚ An event loop essentially manages and distributes the execution of different tasks. It registers them and handles distributing the flow of control between them. Coroutines are special functions that work similarly to Python generators, on await they release the flow of control back to the event loop. A coroutine needs to be scheduled to run on the event loop, once scheduled coroutines are wrapped in Tasks which is a type of Future. Futures are objects that represent the result of a task that may or may not have been executed. This result may be an exception. event loop The event loop is the core of every asyncio application. Event loops run asynchronous tasks and callbacks, perform network IO operations, and run subprocesses. get_event_loopå·²ç»åºŸå¼ƒï¼Œåº”è¯¥ä½¿ç”¨get_running_loop coroutine and future and task coroutines declared with the async/await syntax, is awaitable object. For an object to be awaitable, it must implement the special __await__() method that returns an iterable. an object is an awaitable object if it can be used in an await expression. Many asyncio APIs are designed to accept awaitable objects. There are three main types of awaitable objects: coroutine, Task, and Future. a coroutine function: an async def function; a coroutine object: an object returned by calling a coroutine function. The asyncio.create_task() function to run coroutines concurrently as asyncio Tasks. Tasks are used to schedule coroutines concurrently. A Future is a special low-level awaitable object that represents an eventual result of an asynchronous operation. Normally there is no need to create Future objects at the application level code. Future objects in asyncio are needed to allow callback-based code to be used with async/await.(é‡è¦) A good example of a low-level function that returns a Future object is loop.run_in_executor(). coroutine ç®€å•ç¤ºä¾‹ï¼š import asyncio import time async def say_after(delay, what): await asyncio.sleep(delay) print(what) async def main(): print(f\"started at {time.strftime('%X')}\") await say_after(1, 'hello') await say_after(2, 'world') print(f\"finished at {time.strftime('%X')}\") asyncio.run(main()) future å’Œ coroutine åŒæ—¶ä½¿ç”¨ï¼š async def main(): await function_that_returns_a_future_object() # this is also valid: await asyncio.gather( function_that_returns_a_future_object(), some_python_coroutine() ) å¯ä»¥é€šè¿‡æ³¨è§£å°†æ™®é€šæ–¹æ³•å˜æˆ awaitable object from types import coroutine # NEW: this is an awaitable object! @coroutine def nice(): yield å¸¸ç”¨çš„ apiï¼š # coroutine asyncio.sleep(delay, result=None) # awaitable asyncio.gather(*aws, return_exceptions=False) # loop = asyncio.get_running_loop() # awaitable asyncio.shield(aw): Protect an awaitable object from being cancelled. # asyncio.timeout(delay)/timeout_at(when)/wait_for(aw, timeout): # example async def main(): async with asyncio.timeout(10): await long_running_task() runner runners are built on top of an event loop with the aim to simplify async code usage for common wide-spread scenarios. asyncio.run(coro, *, debug=None) # class asyncio.Runner(*, debug=None, loop_factory=None) # Runner is a context manager that simplifies multiple async function calls in the same context async def main(): await asyncio.sleep(1) print('hello') with asyncio.Runner() as runner: runner.run(main()) future Future objects are used to bridge low-level callback-based code with high-level async/await code. The rule of thumb is to never expose Future objects in user-facing APIs, and the recommended way to create a Future object is to call loop.create_future(). This way alternative event loop implementations can inject their own optimized implementations of a Future object. f: asyncio.Future[R] = asyncio.get_running_loop().create_future() å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ future çš„ä¾‹å­ï¼š # å‚è€ƒ aiohttp # TBD stream Streams are high-level async/await-ready primitives to work with network connections. Streams allow sending and receiving data without using callbacks or low-level protocols and transports. stream å¯ä»¥ç†è§£æˆ channelã€‚ä¸»è¦åŒ…å« asyncio.open_connection asyncio.start_server asyncio.open_unix_connection asyncio.start_unix_server å¤šçº¿ç¨‹å¹¶å‘[ç›¸å…³å†…å®¹] threading version import concurrent.futures import requests import threading import time thread_local = threading.local() def get_session(): if not hasattr(thread_local, \"session\"): thread_local.session = requests.Session() return thread_local.session def download_site(url): session = get_session() with session.get(url) as response: print(f\"Read {len(response.content)} from {url}\") def download_all_sites(sites): with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor: executor.map(download_site, sites) if __name__ == \"__main__\": sites = [ \"https://www.jython.org\", \"http://olympus.realpython.org/dice\", ] * 80 start_time = time.time() download_all_sites(sites) duration = time.time() - start_time print(f\"Downloaded {len(sites)} in {duration} seconds\") multiprocessing version import multiprocessing import time def cpu_bound(number): return sum(i * i for i in range(number)) def find_sums(numbers): with multiprocessing.Pool() as pool: pool.map(cpu_bound, numbers) if __name__ == \"__main__\": numbers = [5_000_000 + x for x in range(20)] start_time = time.time() find_sums(numbers) duration = time.time() - start_time print(f\"Duration {duration} seconds\") generator generator ç¤ºä¾‹ï¼š \u003e\u003e\u003e def multi_yield(): ... yield_str = \"This will print the first string\" ... yield yield_str ... yield_str = \"This will print the second string\" ... yield yield_str ... \u003e\u003e\u003e multi_obj = multi_yield() \u003e\u003e\u003e print(next(multi_obj)) This will print the first string \u003e\u003e\u003e print(next(multi_obj)) This will print the second string \u003e\u003e\u003e print(next(multi_obj)) Traceback (most recent call last): File \"\", line 1, in StopIteration def infinite_sequence(): num = 0 while True: yield num num += 1 å‚è€ƒ asyncio cheatsheet pymotw.com Waiting for a Future AsyncIO for the Working Python Developer Some thoughts on asynchronous API design in a post-async/await world a-tale-of-event-loops ","title":"Python å¼‚æ­¥ç¼–ç¨‹","uri":"/post/python-async-programming/"},{"content":"å›è°ƒå’Œååº”å¼ç¼–ç¨‹éƒ½å¯ä»¥å®ç°ç³»ç»Ÿååé‡æœ‰æ•ˆæå‡ï¼Œä½†æ˜¯è¿™ä¸¤ç§ç¼–ç¨‹æ¨¡å¼å­˜åœ¨é˜…è¯»ã€ç¼–å†™ã€è°ƒè¯•å›°éš¾çš„é—®é¢˜ï¼Œæ‰€ä»¥å®é™…é¡¹ç›®ä¸­è¿˜æ˜¯ä»¥çº¿ç¨‹æ± ä¸ºä¸»ã€‚ä½†æ˜¯ java çš„çº¿ç¨‹æ˜¯å¹³å°çº¿ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºå¹¶è¡Œçº¿ç¨‹æ•°æœ€å¤šç­‰äº CPU æ ¸æ•° (macOS æŸ¥çœ‹æ ¸æ•°sysctl hw.physicalcpu hw.logicalcpu)ï¼Œå¹¶ä¸”å­˜åœ¨çº¿ç¨‹å†…å­˜å ç”¨å¤§ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶é«˜é—®é¢˜ï¼Œæ‰€ä»¥åœ¨é«˜å¹¶å‘è¯·æ±‚ä¸­è¡¨ç°ä¸å¦‚å‰é¢ä¸¤ç§æ¨¡å¼ï¼ˆspring reactive å’Œ vertx æ¨¡å¼å¹¶æ²¡æœ‰æµè¡Œèµ·æ¥ï¼‰ã€‚ JEP 444: Virtual Threads ä¸»è¦ç›®æ ‡åœ¨ä¼˜åŒ– IO å¯†é›†å‹ä»»åŠ¡æ—¶åˆ›å»ºå¹³å°çº¿ç¨‹ä¼šæ¶ˆè€—è¿‡å¤šå†…å­˜ä»¥åŠçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶é—®é¢˜ã€‚ è™šæ‹Ÿçº¿ç¨‹çš„ä¼˜åŠ¿ï¼š1. å’Œçº¿ç¨‹ API å…¼å®¹ï¼ˆå¤§éƒ¨åˆ†å…¼å®¹ï¼‰2. é™ä½åº”ç”¨å†…å­˜ä½¿ç”¨ï¼Œæå‡ç³»ç»Ÿå¯ç”¨æ€§ï¼Œå‡å°‘å†…å­˜ä¸è¶³å¼‚å¸¸ OutOfMemoryError: unable to create new native thread 3. æå‡ä»£ç å¯è¯»æ€§ï¼ˆç›¸æ¯” reactive ç¼–ç¨‹ï¼‰ã€‚ æœ¬æ–‡æ˜¯ VirtualThread å¿«é€Ÿç¬”è®°ï¼ŒåŒ…å« API ä½¿ç”¨ã€é™åˆ¶å’Œåœ¨ Spring Boot çš„å®é™…ä½¿ç”¨ä»¥åŠä¸ Kotlin åç¨‹çš„å¯¹æ¯”ã€‚ VirtualThread API åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹æœ‰ä»¥ä¸‹æ–¹æ³• // 1 Runnable task = () -\u003e { System.out.println(\"Hello Virtual Thread!\"); }; Thread.startVirtualThread(task); // 2 Thread vThread = Thread.ofVirtual().start(task); // 3 Thread vThread = Thread.ofVirtual().unstarted(task); vThread.start(); // 4 Executor vExecutor = Executors.newVirtualThreadPerTaskExecutor(); vExecutor.execute(task); // unlimited virtual threads // 5 newThreadPerTaskExecutor but with VirtualThreadFactory ThreadFactory vThreadFactory = Thread.ofVirtual().name(\"vt-\", 1).factory(); Executor vExecutor = Executors.newThreadPerTaskExecutor(vThreadFactory); vExecutor.execute(task); è™šæ‹Ÿçº¿ç¨‹ç›¸æ¯”å¹³å°çº¿ç¨‹ï¼Œåœ¨åˆ›å»ºè€—æ—¶å’Œå†…å­˜å ç”¨å…·æœ‰å¾ˆå¤§ä¼˜åŠ¿ã€‚ä½œä¸ºå¯¹æ¯”ï¼ŒåŒä¸€å°æœºå™¨ä¸Šåˆ›å»º 1W ä¸ªå¹³å°çº¿ç¨‹å’Œè™šæ‹Ÿçº¿ç¨‹ã€‚ ç±»å‹ åˆ›å»ºæ—¶é—´ å†…å­˜å ç”¨ virtual thread 91 ms 4.4mb platform thread 998 ms 14.3gb limitations of VirtualThread ä¸‹é¢è¯´çš„ carrier thread å°±æ˜¯æ‰§è¡Œè™šæ‹Ÿçº¿ç¨‹çš„ç³»ç»Ÿçº¿ç¨‹ï¼ˆplatform threadï¼‰ã€‚ Avoid synchronized blocks/methods, use ReentrantLock. Object monitor = new Object(); //... public void aMethodThatPinTheCarrierThread() throws Exception { // The virtual thread cannot be unmounted because it holds a lock, // so the carrier thread is blocked. // also called pinned thread or pinning synchronized(monitor) { Thread.sleep(1000); } } Avoid monopolization. å³é¿å… CPU å¯†é›†å‹çš„ä»»åŠ¡ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ã€‚å¦‚æœä¸€ä¸ª task è€—æ—¶éå¸¸é•¿ï¼Œé‚£ä¹ˆè¯¥è™šæ‹Ÿçº¿ç¨‹å¯¹åº”çš„ platform threadï¼ˆå³ the carrier threadï¼‰æ— æ³•è®©å‡ºå»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼ŒJVM ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚è¿™ç§åœºæ™¯åº”è¯¥ä½¿ç”¨çº¿ç¨‹æ± æŠ€æœ¯ã€‚ Cation the carrier thread pool elasticity. å½“å‰å‘ç”Ÿ 1 æˆ–è€… 2 çš„æƒ…å†µæ—¶ï¼ŒJVM ä¼šåˆ›å»ºæ–°çš„ç³»ç»Ÿçº¿ç¨‹ï¼Œå®¹æ˜“å¯¼è‡´ç³»ç»Ÿå†…å­˜è¢«è€—å°½ã€‚ Avoid Object pooling, or reduce ThreadLocal Usage: å› ä¸ºçº¿ç¨‹æ± æ•°é‡æœ‰é™åˆ¶ä¸”çº¿ç¨‹ä¼šå¤ç”¨ï¼Œæ‰€ä»¥åˆ›å»ºæ¯”è¾ƒè€—æ—¶çš„å¯¹è±¡ä¼šè¢«æ± åŒ–ä»¥å¤ç”¨ã€‚ä½†æ˜¯è™šæ‹Ÿçº¿ç¨‹ä¸æ»¡è¶³çº¿ç¨‹çš„è¿™ä¸¤ä¸ªå‡è®¾ï¼Œæ± åŒ–å¯¹è±¡å¹¶ä¸èƒ½è¢«å¤ç”¨ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”±äºè™šæ‹Ÿçº¿ç¨‹ä¸ªæ•°ä¸€èˆ¬æ²¡æœ‰é™åˆ¶ï¼Œæ¯ä¸ªè™šæ‹Ÿçº¿ç¨‹éƒ½æœ‰ ThreadLocal å¯¹è±¡çš„è¯ï¼Œå¯èƒ½è€—å°½ JVM å †å†…å­˜ã€‚JEP 429: Scoped Values will fix this. å…³æ³¨çº¿ç¨‹å®‰å…¨ï¼Œè™šæ‹Ÿçº¿ç¨‹æœ¬è´¨è¿˜æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå’Œå¤šçº¿ç¨‹ä¸€æ ·éœ€è¦å…³æ³¨å…±äº«çŠ¶æ€é—®é¢˜ã€‚ use VirtualThread in Spring Boot @SpringBootApplication @Slf4j public class VirtualthreadApplication { public static void main(String[] args) { SpringApplication.run(VirtualthreadApplication.class, args); } @Bean public TomcatProtocolHandlerCustomizer\u003c?\u003e protocolHandlerVirtualThreadExecutorCustomizer() { return protocolHandler -\u003e { log.info(\"Configuring \" + protocolHandler + \" to use VirtualThreadPerTaskExecutor\"); protocolHandler.setExecutor(Executors.newVirtualThreadPerTaskExecutor()); }; } } use VirtualThread in Quarkus Using virtual threads in Quarkus is straightforward. You only need to use the @RunOnVirtualThread annotation. It indicates to Quarkus to invoke the annotated method on a virtual thread instead of a regular platform thread. @Path(\"/greetings\") public class VirtualThreadApp { @RestClient RemoteService service; @GET @RunOnVirtualThread public String process() { // Runs on a virtual thread because the // method uses the @RunOnVirtualThread annotation. // `service` is a rest client, it executes an I/O operation var response = service.greetings(); // Blocking, but this time, it // does neither block the carrier thread // nor the OS thread. // Only the virtual thread is blocked. return response.toUpperCase(); } } When Quarkus meets Virtual Threads) internal and compare to kotlin coroutine A coroutine is an instance of suspendable computation. - Kotlin doc å’Œ kotlin çš„åç¨‹ç±»ä¼¼ï¼Œjava çš„è™šæ‹Ÿçº¿ç¨‹åŒæ ·ä¸èƒ½è‡ªå·±æ‰§è¡Œï¼Œè€Œæ˜¯éœ€è¦æŒ‚è½½åˆ°å¹³å°çº¿ç¨‹ä¸Šé¢æ‰èƒ½æ‰§è¡Œã€‚ä¸‹é¢æ˜¯è™šæ‹Ÿçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼š /* * Virtual thread state and transitions: * * NEW -\u003e STARTED // Thread.start * STARTED -\u003e TERMINATED // failed to start * STARTED -\u003e RUNNING // first run * * RUNNING -\u003e PARKING // Thread attempts to park * PARKING -\u003e PARKED // cont.yield successful, thread is parked * PARKING -\u003e PINNED // cont.yield failed, thread is pinned * * PARKED -\u003e RUNNABLE // unpark or interrupted * PINNED -\u003e RUNNABLE // unpark or interrupted * * RUNNABLE -\u003e RUNNING // continue execution * * RUNNING -\u003e YIELDING // Thread.yield * YIELDING -\u003e RUNNABLE // yield successful * YIELDING -\u003e RUNNING // yield failed * * RUNNING -\u003e TERMINATED // done */ private static final int NEW = 0; private static final int STARTED = 1; private static final int RUNNABLE = 2; // runnable-unmounted private static final int RUNNING = 3; // runnable-mounted private static final int PARKING = 4; private static final int PARKED = 5; // unmounted private static final int PINNED = 6; // mounted private static final int YIELDING = 7; // Thread.yield private static final int TERMINATED = 99; // final state ç»¿è‰²è¡¨ç¤ºè™šæ‹Ÿçº¿ç¨‹æŒ‚è½½ï¼ˆmountedï¼‰åœ¨ å¹³å°çº¿ç¨‹ï¼ˆcarrier threadï¼‰ã€‚è“è‰²è¡¨ç¤º unmounted å¹¶è®©å‡ºçº¿ç¨‹ï¼ˆå»æ‰§è¡Œå…¶ä»–è™šæ‹Ÿçº¿ç¨‹æˆ–è€…ä»»åŠ¡ï¼‰ã€‚ç´«è‰²è¡¨ç¤º pinnedã€‚ æ ¸å¿ƒä»£ç è§£è¯»å‚è€ƒSome Virtual Threads InternalsPermalink å‚è€ƒ java 21 doc JEP 444: Virtual Threads Why are Thread.stop, Thread.suspend and Thread.resume Deprecated? The Ultimate Guide to Java Virtual Threads When Quarkus meets Virtual Threads) ","title":"Java å¹¶å‘ 5-è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtualThreadï¼‰","uri":"/post/java-concurrency-5-virtualthread/"},{"content":"æˆ‘ä»¬ä¸­çš„è®¸å¤šäººæ¯å¤©éƒ½åœ¨ä½¿ç”¨ gitï¼Œä½†æ˜¯æœ‰å¤šå°‘äººçŸ¥é“å®ƒçš„å†…éƒ¨æ˜¯æ€ä¹ˆè¿ä½œçš„å‘¢ï¼Ÿ ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨ git commit æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæäº¤ï¼ˆcommitï¼‰ä¸æäº¤ä¹‹é—´ä¿å­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿä¸¤æ¬¡æäº¤ä¹‹é—´éš¾é“åªæ˜¯æ–‡ä»¶çš„å·®å¼‚ï¼ˆdiffï¼‰å—ï¼Ÿå¦‚æœæ˜¯ï¼Œè¿™ä¸ªå·®å¼‚æ˜¯å¦‚ä½•ç¼–ç çš„ï¼Ÿè¿˜æ˜¯è¯´æ¯æ¬¡æäº¤éƒ½ä¼šä¿å­˜ä¸€ä¸ªå½“å‰ä»“åº“çš„å®Œæ•´å¿«ç…§ï¼ˆsnapshotï¼‰å‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨ git init æ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ å‘ç°ä¸€ç¯‡éå¸¸ç²¾å½©çš„ Git å†…éƒ¨åŸç†æ–‡ç« Git å†…éƒ¨åŸç†å›¾è§£â€”â€”å¯¹è±¡ã€åˆ†æ”¯ä»¥åŠå¦‚ä½•ä»é›¶å¼€å§‹å»ºä»“åº“ï¼Œä¸­æ–‡ç¿»è¯‘ã€‚æ–‡ç« ä½œè€…ç”šè‡³åˆ¶ä½œäº†é…å¥—è®²è§£è§†é¢‘ Git å¯¹è±¡ git å†…éƒ¨æœ‰ä¸‰ç§å¯¹è±¡ï¼š blob: æ–‡ä»¶çš„å†…å®¹ï¼Œä¸åŒ…å« metadata ä¿¡æ¯ï¼ˆåˆ›å»ºæ—¶é—´ï¼Œä¿®æ”¹æ—¶é—´ï¼Œä½œè€…ç­‰ï¼‰ tree: ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å« blobs æˆ–è€… trees commit: a snapshot of the working treeï¼Œä¸€ä¸ª tree çš„å¿«ç…§ ä¸‰ç§ git å¯¹è±¡éƒ½æ˜¯é€šè¿‡ SHA-1 å“ˆå¸Œå€¼æ¥å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ¯ä¸ª commit å¯¹è±¡ä¸­ï¼Œå¯¹äº tree é‡Œé¢é‚£äº›æ²¡æœ‰æ”¹åŠ¨çš„å†…å®¹ï¼Œç»§ç»­é€šè¿‡åŸ hash å¼•ç”¨ã€‚ åˆ†æ”¯ A branch is just a named reference to a commit. åœ¨ä¸Šé¢çš„å›¾ç‰‡ä¸­ï¼Œå¯ä»¥é€šè¿‡å“ˆå¸Œå€¼æ¥å¼•ç”¨ä¸€ä¸ª commitï¼Œä½†æ˜¯ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥åˆ†æ”¯ç”¨æ¥å¼•ç”¨ commitã€‚å¯ä»¥ç†è§£ä¸ºåˆ†æ”¯æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ª commitï¼Œä¸€èˆ¬é»˜è®¤æ˜¯æŒ‡å‘æœ€åä¸€ä¸ª commitï¼ˆä¹Ÿå¯ä»¥ä¸æ˜¯æœ€åä¸€ä¸ª commitï¼‰ã€‚ git é€šè¿‡HEADæŒ‡é’ˆæ¥ç¡®è®¤å½“å‰æ‰€åœ¨åˆ†æ”¯ã€‚HEADæŒ‡é’ˆå…¶å®æ˜¯.gitç›®å½•ä¸‹çš„ä¸€ä¸ªHEADæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ \u003e cat .git/HEAD ref: refs/heads/master git å¦‚ä½•è®°å½•å˜åŒ– repository æ˜¯ä¸€ç³»åˆ— commit çš„é›†åˆ working dir æ˜¯ä¸€ä¸ªåŒ…å«.gitçš„ç›®å½• staging area æ˜¯å­˜æ”¾é‚£äº›è¢« git è·Ÿè¸ªä½†æ˜¯æ²¡æœ‰ commit çš„å†…å®¹ ä¸‰è€…çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º git åº•å±‚å‘½ä»¤ (plumbing) å’Œä¸Šå±‚å‘½ä»¤ (porcelain) åŒºåˆ† åº•å±‚ï¼ˆplumbingï¼‰å’Œ ä¸Šå±‚ï¼ˆporcelainï¼‰ä¸¤ç±» git å‘½ä»¤ä¼šå¯¹ä½ å¾ˆæœ‰å¸®åŠ©ã€‚è¿™ä¸¤ä¸ªæœ¯è¯­çš„åº”ç”¨å¥‡æ€ªåœ°æ¥è‡ªäºé©¬æ¡¶ï¼ˆæ²¡é”™ï¼Œå°±æ˜¯ğŸš½ï¼‰ã€‚é©¬æ¡¶é€šå¸¸æ˜¯ç”¨é™¶ç“·ï¼ˆporcelainï¼‰åšçš„ï¼Œå®ƒçš„åŸºæœ¬ç»“æ„æ˜¯ç®¡é“ï¼ˆplumbingï¼Œä¸Šæ°´é“å’Œä¸‹æ°´é“ï¼‰ã€‚ ä¸Šå±‚å‘½ä»¤å°±æ˜¯git initã€git addã€ git commitç­‰ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹åº•å±‚å‘½ä»¤ã€‚ # åˆ›å»ºgitå¯¹è±¡ \u003eecho \"git is awesome\" | git hash-object --stdin -w # æŸ¥çœ‹.gitç›®å½•çš„å˜åŒ– \u003etree .git # æŸ¥çœ‹ä¸€ä¸ªgit objectç±»å‹ -t type \u003egit cat-file -t [obj-hash] # blob|tree|commit # æŸ¥çœ‹ä¸€ä¸ªgit objectå†…å®¹ -p pretty-print \u003egit cat-file -p [obj-hash] # æ·»åŠ objectåˆ°staging area \u003egit update-index --add --cacheinfo 100644 # åˆ›å»ºä¸€ä¸ªtreeå¯¹è±¡ åœ¨treeå¯¹è±¡ä¸­è®°å½•indexå†…å®¹ \u003egit write-tree # ä¸ºtreeå¯¹è±¡åˆ›å»ºä¸€ä¸ªcommitå¯¹è±¡ \u003egit commit-tree -m git å®é™…ä¸Šæ˜¯ä½¿ç”¨ SHA-1 å“ˆå¸Œå€¼çš„å‰ä¸¤ä¸ªå­—ç¬¦ä½œä¸ºç›®å½•çš„åå­—ï¼Œå‰©ä½™å­—ç¬¦ç”¨ä½œ blob æ‰€åœ¨æ–‡ä»¶çš„æ–‡ä»¶åã€‚ .git ç›®å½• ä¸€ä¸ª.gitç›®å½•è‡³å°‘åŒ…å«ä¸‰ä¸ªå†…å®¹ âœ” tree .git .git â”œâ”€â”€ HEAD å½“å‰æŒ‡å‘åˆ†æ”¯ï¼Œé»˜è®¤å†…å®¹æ˜¯ ref: refs/heads/main â”œâ”€â”€ objects gitå¯¹è±¡ blobã€treeã€commitçš„ä¸€ç§ï¼Œå…¶ä¸­å¯¹è±¡çš„hashå€¼å‰ä¸¤ä¸ªå­—ç¬¦ç”¨äºç›®å½•åï¼Œå‰©ä½™çš„ç”¨äºå¯¹è±¡å â””â”€â”€ refs åˆ†æ”¯å’Œtag â””â”€â”€ heads å½“å‰working diræ‰€æœ‰åˆ†æ”¯ é»˜è®¤åˆ†æ”¯ä¸å±•ç¤ºï¼Œåªæœ‰å¤šäºä¸€ä¸ªåˆ†æ”¯æ‰ä¼šå±•ç¤º æ·»åŠ ä¸€ä¸ªæ–‡ä»¶å¹¶ commitï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œå†æ¬¡æ£€æŸ¥.git ç›®å½• âœ” tree .git .git â”œâ”€â”€ HEAD â”œâ”€â”€ index â”œâ”€â”€ objects â”‚ â”œâ”€â”€ 8d â”‚ â”‚ â””â”€â”€ 0e41234f24b6da002d962a26c2495ea16a425f â”‚ â”œâ”€â”€ af â”‚ â”‚ â””â”€â”€ 7e0d93b83f49f601f5ef35edf5f9330fb4d7fd â”‚ â””â”€â”€ c8 â”‚ â””â”€â”€ bcfef1da123a980537a5fa4cf9b7c4f387d451 â””â”€â”€ refs â””â”€â”€ heads â”œâ”€â”€ main â””â”€â”€ test_branch 7 directories, 7 files ä¸Šé¢åˆ é™¤äº† logs ç›®å½•ï¼Œindex æ–‡ä»¶ä¿å­˜çš„æ˜¯ staging area ä¿¡æ¯ã€‚æ‰“å° objects ç›®å½•ä¸‹çš„ä¸‰ä¸ªæ–‡ä»¶ âœ” git cat-file -p 8d0e41234f24b6da002d962a26c2495ea16a425f hello git :~/code/temp (main) âœ” git cat-file -p c8bcfef1da123a980537a5fa4cf9b7c4f387d451 100644 blob 8d0e41234f24b6da002d962a26c2495ea16a425f\tfile.txt :~/code/temp (main) âœ” git cat-file -p af7e0d93b83f49f601f5ef35edf5f9330fb4d7fd tree c8bcfef1da123a980537a5fa4cf9b7c4f387d451 author zhimoe 1691313901 +0800 committer zhimoe 1691313901 +0800 first commit å¯ä»¥çœ‹åˆ°åˆ†åˆ«æ˜¯ä¸€ä¸ª blob å¯¹è±¡ï¼ˆfile.txt)ã€ä¸€ä¸ª tree å¯¹è±¡å’Œä¸€ä¸ª commit å¯¹è±¡ï¼Œåè€…ä¾æ¬¡å¼•ç”¨å‰è€…ã€‚ å‚è€ƒ æ–‡ç« é‡Œé¢æåˆ°äº†å¾ˆå¤š git å†…éƒ¨åŸç†å’Œæ¦‚å¿µï¼š Git å†…éƒ¨åŸç† - åº•å±‚å‘½ä»¤ä¸ä¸Šå±‚å‘½ä»¤ Git å†…éƒ¨åŸç† - Git å¯¹è±¡ ","title":"Git å†…éƒ¨åŸç†-å¯¹è±¡ã€åˆ†æ”¯ä»¥åŠåº•å±‚å‘½ä»¤[ç¿»è¯‘]","uri":"/post/git-internal/"},{"content":"åˆå­¦ rust çš„æ—¶å€™ï¼Œä¸Šæ‰‹å†™ä»£ç æ€»æ˜¯é‡åˆ°å¾ˆå¤šä¸ä¸€æ ·çš„ rust çš„Resultç±»å‹ï¼Œä¸åŒ crate ä¸­çš„å‡½æ•°è¿”å›çš„Resultçš„Eéƒ½ä¸ä¸€æ ·ï¼Œåˆšå¼€å§‹éƒ½æ˜¯unwrapæˆ–è€…expectæ¥å¤„ç†ã€‚å¦‚æœä½¿ç”¨try!æˆ–è€…?çš„è¯æ€»æ˜¯ç¼–è¯‘ä¸é€šè¿‡ï¼Œè¿˜æ˜¯å¯¹ Error è½¬æ¢å’Œå¤„ç†ä¸ç†Ÿç»ƒã€‚ Error è½¬æ¢ åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨ä¸åŒçš„å‡½æ•°ä¼šè¿”å›ä¸åŒçš„ error ç±»å‹ï¼Œéœ€è¦ä½ å°†è¿™äº›ç±»å‹è½¬æ¢æˆç»Ÿä¸€çš„è‡ªå®šä¹‰ error ç±»å‹å†è¿”å›ã€‚ä½ æœ‰ä»¥ä¸‹å‡ ç§é€”å¾„ ä½¿ç”¨ map_err fn cook_pasta() -\u003e Result { let water = boil_water().map_err(|_| CookingError::BoilWaterError)?; let pasta = add_pasta(\u0026water).map_err(|_| CookingError::AddPastaError)?; Ok(pasta) } // é€šè¿‡ map_err å°† boil_water() å’Œ add_pasta(\u0026water) è¿”å›çš„ error éƒ½è½¬æ¢æˆäº† CookingError ç±»å‹ ä½¿ç”¨ std::error::Error+From trait å®šä¹‰è‡ªå·±çš„ Error ç±»å‹å¹¶å®ç° From traitã€‚From trait ç”¨äºå°† boil_water() å’Œ add_pasta(\u0026water) çš„ error è½¬æ¢æˆè‡ªå®šä¹‰çš„ Errorã€‚å…¶å®å°±æ˜¯å°†map_errçš„é€»è¾‘ç§»åŠ¨åˆ° From trait ä¸­å®ç°ï¼Œä½¿å¾—æ–¹æ³•è°ƒç”¨å¤„çœ‹èµ·æ¥æ›´ç®€æ´ã€‚ pub enum CookingError{ BoilWaterError(String), AddPastaError } impl std::error::Error for CookingError{ // ... } impl Display for CookingError{ // ... } // å‡è®¾ boil_water è¿”å›çš„ error æ˜¯ NoWaterError impl From for CookingError { fn from(s: NoWaterError) -\u003e Self { CookingError::BoilWaterError(s) } } // å‡è®¾ add_pasta è¿”å›çš„ error æ˜¯ IoError impl From for CustomError { fn from(s: std::io::Error) -\u003e Self { CookingError::AddPastaError(s) } } // æ— éœ€ map_err fn cook_pasta() -\u003e Result { let water = boil_water()?; // å¦‚æœæŠ›å‡º NoWaterErrorï¼Œè‡ªåŠ¨è½¬æˆ CookingError::BoilWaterErrorï¼Œä¸‹é¢åŒç† let pasta = add_pasta(\u0026water)?; Ok(pasta) } thiserror thiserror å¯ä»¥çœ‹ä½œæ˜¯å®šä¹‰ Error çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒåªå¸®ä½ ç”Ÿæˆä¸€äº›å®šä¹‰ Error çš„ä»£ç ï¼Œåˆ«çš„ä»€ä¹ˆéƒ½ä¸åšï¼Œç›¸å½“çº¯ç²¹ã€‚å¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ª crateï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ thiserrorã€‚ fn render() -\u003e Result { let file = std::env::var(\"MARKDOWN\")?; let source = read_to_string(file)?; Ok(source) } ä¸Šé¢çš„ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºenv::var() è¿”å›çš„æ˜¯ std::env::VarErrorï¼Œè€Œ read_to_string() è¿”å›çš„æ˜¯ std::io::Errorã€‚ ä¸ºäº†æ»¡è¶³ render å‡½æ•°çš„ç­¾åï¼Œæˆ‘ä»¬å°±éœ€è¦å°† env::VarError å’Œ io::Error å½’ä¸€åŒ–ä¸ºåŒä¸€ç§é”™è¯¯ç±»å‹ã€‚è¦å®ç°è¿™ä¸ªç›®çš„æœ‰ä¸‰ç§æ–¹å¼ï¼š ä½¿ç”¨ç‰¹å¾å¯¹è±¡ Boxã€‚å®é™…ä¸Šå°±æ˜¯é”™è¯¯ç±»å‹æ³›åŒ–ï¼Œå¤±å»äº†å…·ä½“é”™è¯¯ç±»å‹çš„ä¿¡æ¯ï¼Œç±»ä¼¼äºåœ¨ Java ä¸­ä½¿ç”¨Objectç±»å‹ã€‚ è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚æ¯”è¾ƒç¹çï¼Œä¸Šé¢çš„ä¾‹å­åœ¨è‡ªå®šä¹‰ Error ç±»å‹åï¼Œéœ€è¦åˆ†åˆ«ä¸ºenv::VarError å’Œ io::Errorå®ç°From trait æ‰è¡Œã€‚ ä½¿ç”¨ thiserrorã€‚ç®€åŒ–è‡ªå®šä¹‰é”™è¯¯ç±»å‹çš„ç¹çï¼š use std::fs::read_to_string; fn main() -\u003e Result\u003c(), MyError\u003e { let html = render()?; println!(\"{}\", html); Ok(()) } fn render() -\u003e Result { let file = std::env::var(\"MARKDOWN\")?; let source = read_to_string(file)?; Ok(source) } #[derive(thiserror::Error, Debug)] enum MyError { #[error(\"Environment variable not found\")] EnvironmentVariableNotFound(#[from] std::env::VarError), #[error(transparent)] IOError(#[from] std::io::Error), } thiserroræä¾›#[from] #[error]ç­‰æ³¨è§£ç®€åŒ–é”™è¯¯ç±»å‹è‡ªå®šä¹‰å·¥ä½œã€‚ #[derive(Error)] { // Attributes available to this derive: #[backtrace] // #[error] #[from] #[source] } error(transparent) è¡¨ç¤ºè½¬å‘åº•å±‚ error çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸ä¿®æ”¹ source å’Œ Display ç›¸å…³æ–¹æ³•ã€‚ anyhow anyhow ä¸ºä½ å®šä¹‰å¥½äº†ä¸€ä¸ª Error ç±»å‹ï¼ŒåŸºæœ¬å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª Box ï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€äº›å¦‚ context ç­‰æ‰©å±•åŠŸèƒ½ï¼Œç”¨èµ·æ¥æ›´åŠ æ— è„‘ã€‚å¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ªä¸šåŠ¡ appï¼Œå»ºè®®ä½¿ç”¨ anyhow æ›´åŠ æ–¹ä¾¿ã€‚ use anyhow::Result; fn main() -\u003e Result\u003c()\u003e { let html = render()?; println!(\"{}\", html); Ok(()) } fn render() -\u003e Result { let file = std::env::var(\"MARKDOWN\")?; let source = read_to_string(file).with_context(|| format!(\"read string from {} failed\", \u0026file))? Ok(source) } å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨çš„æ˜¯Result,å®é™…ä¸Šè¿™æ˜¯anyhowçš„ type aliasï¼špub type Result = core::result::Result; anyhow è¿˜æä¾›äº†with_contextç»™ error æ·»åŠ ä¿¡æ¯ï¼Œçœ‹ä¸Šå»å’Œ expect ç±»ä¼¼ï¼Œåªä¸è¿‡é‚£æ˜¯ panicã€‚ å¯¹äºä¸€ä¸ª app æœåŠ¡ï¼Œä¸€äº›æ ¸å¿ƒç™»å½•ç­‰åŠŸèƒ½å¯èƒ½ä¹Ÿéœ€è¦è‡ªå®šä¹‰ error ç±»å‹ï¼Œè¿™æ—¶å¯ä»¥å°†anyhow::Errorä½œä¸ºå…¶ä¸­ä¸€ç§ error ç±»å‹ï¼Œå³ thiserror + anyhowï¼š #[derive(Error, Debug)] pub enum AppError { ... #[error(transparent)] Other(#[from] anyhow::Error), // source and Display delegate to anyhow::Error } å‚è€ƒï¼š rust by example - å¤„ç†å¤šç§é”™è¯¯ç±»å‹ Option å’Œ Result çš„ä¸€äº›æ–¹æ³• rust doc Error Handling ç®€è°ˆ Rust ä¸­çš„é”™è¯¯å¤„ç† ç»†è¯´ rust é”™è¯¯å¤„ç† ?åœ¨ Result ä¸­çš„ä½¿ç”¨ èš‚èšé›†å›¢ CeresDB å›¢é˜Ÿ | å…³äº Rust é”™è¯¯å¤„ç†çš„æ€è€ƒ ","title":"Rust Error Handling Notes","uri":"/post/rust-error-handling-notes/"},{"content":"ä½¿ç”¨ python OpenPyXL è¯»å†™ excel å¤§æ–‡ä»¶æ—¶ï¼Œæœ‰ä¸“é—¨çš„ read_only write-only æ¨¡å¼æ¥æå‡è¯»å†™æ•ˆç‡ã€‚\nopenpyxl read_only mode from openpyxl import load_workbook wb = load_workbook(filename='large_file.xlsx', read_only=True) ws = wb['big_data'] # min_col\u0026max_col: åªå¤„ç† B åˆ—ï¼Œmin_row=2: ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œåªè¯»å–å€¼ col_index_B = openpyxl.utils.column_index_from_string('B') for cell_value in ws.iter_rows(min_row=2, min_col=col_index_B, max_col=col_index_B, values_only=True): print(cell_value) # Close the workbook after reading wb.close() åªè¯»å–ç¬¬ä¸€è¡Œçš„é”™è¯¯ å¦‚æœä½ çš„ excel æ–‡ä»¶æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹è½¯ä»¶ (æ•°æ®åº“å®¢æˆ·ç«¯) æˆ–è€…ä»£ç ç”Ÿæˆçš„ï¼Œå¾ˆå®¹æ˜“é‡åˆ°ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸Šé¢çš„ws.iter_rowsæˆ–ws.rowséå†åªä¼šè¯»å–ç¬¬ä¸€è¡Œã€‚è¿™æ˜¯å› ä¸º read only æ¨¡å¼åœ¨ load_workbook æ—¶åªè¯»å–äº†æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œåœ¨éå†æ—¶ä¹Ÿä¾èµ– worksheet çš„å…ƒä¿¡æ¯ï¼Œå¾ˆå¤šé office ç”Ÿæˆçš„ excel æ²¡æœ‰æ­£ç¡®è®¾ç½®å…ƒä¿¡æ¯ã€‚ä½ å¯ä»¥é€šè¿‡ws.calculate_dimension()æ£€æŸ¥ excel è¡Œåˆ—ä¿¡æ¯ï¼Œå¦‚æœè¿”å›çš„æ˜¯A1:A1ç­‰ä¸å®é™…å¤§å°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ws.reset_dimensions()æ¥é‡ç½®wsçš„max_row and max_columnå±æ€§ã€‚\næ³¨æ„ï¼Œws.reset_dimensions()ä¼šè¯»å–æ•´ä¸ªæ–‡ä»¶ï¼Œæ•ˆç‡ä¼šé™ä½åˆ°é read_only æ¨¡å¼ä¸€æ ·ã€‚\nå“ï¼Œè¿™ä¸ªå‘èŠ±äº†ä¸€ä¸‹åˆçš„æ’æŸ¥ï¼Œå°±æ˜¯ä¸è®¤çœŸçœ‹ä¸€ä¸‹æ–‡æ¡£\nopenpyxl write_only mode ç¡®ä¿å®‰è£…äº†lxml openpyxlä¸¤ä¸ªåº“ ä½¿ç”¨ write_only å†™å¤§æ•°æ® from openpyxl import Workbook wb = Workbook(write_only=True) ws = wb.create_sheet() # now we'll fill it with 100 rows x 200 columns for irow in range(100): ws.append(['%d' % i for i in range(200)]) # save the file wb.save('new_big_file.xlsx') # doctest: +SKIP å®˜æ–¹æ–‡æ¡£ openpyxl Optimised Modes\nopenpyxl vs xlsxwriter ä¸¤ä¸ªå¸¸ç”¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šå·®åˆ«ä¸å¤§ï¼Œéƒ¨åˆ†æ ·å¼è®¾ç½®æœ‰å·®åˆ«ã€‚ pandas æ”¯æŒä¸¤ä¸ªï¼Œå¯ä»¥é€šè¿‡ engine å‚æ•°åˆ‡æ¢ã€‚ ä½¿ç”¨ polars polars æ˜¯ä½¿ç”¨ rust è¯­è¨€ç¼–å†™çš„ DataFrame åº“ï¼ŒåŸºäº arrow æ ¼å¼ï¼Œæä¾› rustã€pythonã€nodejs ä¸‰ç§ç¼–ç¨‹è¯­è¨€æ¥å£ã€‚ç›®å‰ polars æ”¯æŒè¯»å–æ•´ä¸ª excel æ–‡ä»¶ï¼Œä½†æ˜¯å†™æ–‡ä»¶ä¸è¡Œï¼Œåªèƒ½é€šè¿‡è½¬æ¢æˆ pandas çš„ df å†å¤„ç†ã€‚æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ polars è¯»å–æ•´ä¸ª excel æ–‡ä»¶ï¼Œé€Ÿåº¦å¤§çº¦æ˜¯ pandas æ™®é€šæ¨¡å¼çš„ä¸¤å€ï¼Œå†…å­˜ä½¿ç”¨æ˜¯ pandas çš„ 2/3ï¼Œè¿™ä¸ªæ€§èƒ½å’Œå†…å­˜ï¼Œæ„Ÿè§‰åœ¨ python é¢†åŸŸå¸Œæœ›ä¸å¤§ï¼Œçœ‹ rust é‚£è¾¹çš„å‘å±•äº†ã€‚\npolars çš„ API ä¸€èˆ¬æ˜¯å°½å¯èƒ½å’Œ pandas ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé‡åˆ° API ç¼ºå¤±çš„ï¼Œå¯ä»¥ç›´æ¥è½¬æ¢æˆ pandas çš„ df ä½¿ç”¨df.to_pandas()\nimport pandas as pd import polars as pl # read_excel è¿˜éœ€è¦ xlsx2csv lib df = pl.read_excel( \"test.xlsx\", sheet_id=1, xlsx2csv_options={\"skip_empty_lines\": True}, read_csv_options={\"has_header\": True}, ) print(f'{type(df)=}') # class 'polars.dataframe.frame.DataFrame' print(f'{df.shape=}') print(f'{df.head()=}') for cell in df['Courses']: print(f'{cell=}') polars çš„è¾“å‡ºæ ¼å¼æ¯” pandas çš„å¥½çœ‹å¤šäº†ï¼Œä½¿ç”¨äº† box-drawing ç›¸å…³çš„ unicode å­—ç¬¦æ‰“å°è¡¨æ ¼ï¼Œä¸è¿‡éœ€è¦ç¼–ç¨‹å­—ä½“æ”¯æŒæ‰èƒ½å¯¹é½ã€‚\n","title":"ä½¿ç”¨ OpenPyXL è¯»å†™ excel å¤§æ–‡ä»¶","uri":"/post/python-read-large-excel-file/"},{"content":"A coroutine is an instance of suspendable computation. åç¨‹æ˜¯å¯è¢«æŒ‚èµ·çš„è®¡ç®—çš„å®ä¾‹ã€‚æ¢å¥è¯è¯´åç¨‹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¿å­˜ç€ä¸€æ®µå¯ä»¥åˆ‡æ¢çº¿ç¨‹çš„ä»»åŠ¡ + å½“å‰æ‰§è¡Œçš„çŠ¶æ€ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚ æ—¥å¸¸æ¶‰åŠåç¨‹çš„ç¼–ç ï¼Œä¸»è¦æ˜¯æè¿°åç¨‹çš„ä»»åŠ¡å’Œç®¡ç†å¤šä¸ªåç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€å¼‚å¸¸å¤„ç†ç­‰ã€‚ Kotlin ä½¿ç”¨å †æ ˆå¸§ç®¡ç†è¦è¿è¡Œå“ªä¸ªå‡½æ•°ä»¥åŠæ‰€æœ‰å±€éƒ¨å˜é‡ã€‚æŒ‚èµ·åç¨‹æ—¶ï¼Œç³»ç»Ÿä¼šå¤åˆ¶å¹¶ä¿å­˜å½“å‰çš„å †æ ˆå¸§ä»¥ä¾›ç¨åä½¿ç”¨ã€‚æ¢å¤æ—¶ï¼Œä¼šå°†å †æ ˆå¸§ä»å…¶ä¿å­˜ä½ç½®å¤åˆ¶å›æ¥ï¼Œç„¶åå‡½æ•°å†æ¬¡å¼€å§‹è¿è¡Œã€‚å³ä½¿ä»£ç å¯èƒ½çœ‹èµ·æ¥åƒæ™®é€šçš„é¡ºåºé˜»å¡è¯·æ±‚ï¼Œåç¨‹ä¹Ÿèƒ½ç¡®ä¿ç½‘ç»œè¯·æ±‚é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚ é—®é¢˜åœºæ™¯ å‡è®¾ç°åœ¨æœ‰ä¸ªåœºæ™¯ï¼Œæ ¹æ®ç”¨æˆ· id è°ƒç”¨ä¸¤ä¸ªå¤–éƒ¨æ¥å£è·å–ç”¨æˆ·çš„å§“åå’Œå…¬å¸åç§°ï¼Œæ‹¼æ¥åè¿”å›ã€‚ ç”±äºä¸¤ä¸ªå¤–éƒ¨æ¥å£è€—æ—¶è¾ƒé«˜ï¼Œç›´æ¥çš„æ€è·¯å°±æ˜¯ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ¥å‘é€è¯·æ±‚ç„¶åç­‰å¾…è¯·æ±‚å…¨éƒ¨å“åº”åæ‹¼æ¥å“åº”å€¼ã€‚ æ–¹å¼ 1 Java çš„ Callable // å®šä¹‰ä¸¤ä¸ª Callable æ¥å¼‚æ­¥æ‰§è¡Œæ–¹æ³• Callable getUserName = () -\u003e { // æ¨¡æ‹Ÿè°ƒç”¨è€—æ—¶æ–¹æ³•è·å–ç”¨æˆ·å Thread.sleep(1000); return \"John\"; }; Callable getCompany = () -\u003e { // æ¨¡æ‹Ÿè°ƒç”¨è€—æ—¶æ–¹æ³•è·å–å…¬å¸å Thread.sleep(1000); return \"Doe Corp.\"; }; // ä½¿ç”¨ ExecutorService æ‰§è¡Œä¸¤ä¸ª Callable å¹¶è·å– Future ExecutorService executor = Executors.newFixedThreadPool(2); Future nameFuture = executor.submit(getUserName); Future companyFuture = executor.submit(getCompany); // åœ¨ä¸»çº¿ç¨‹ä¸­è·å–ç»“æœå¹¶åˆå¹¶ String name = nameFuture.get(); String company = companyFuture.get(); String info = name + \", \" + company; System.out.println(info); // John, Doe Corp. executor.shutdown(); æ–¹å¼ 2 Java çš„ CompletableFuture // å®šä¹‰ä¸¤ä¸ªå¼‚æ­¥æ“ä½œ CompletableFuture getUserName = CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(1000); return \"John\"; }); CompletableFuture getCompany = CompletableFuture.supplyAsync(() -\u003e { Thread.sleep(1000); return \"Doe Corp.\"; }); // ä½¿ç”¨ thenCombine åˆå¹¶ä¸¤ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœ CompletableFuture combined = getUserName.thenCombine(getCompany, (name, company) -\u003e name + \", \" + company); // è·å–æœ€ç»ˆç»“æœ String result = combined.get(); System.out.println(result); // John, Doe Corp. æ–¹å¼ 3 Kotlin çš„ Coroutine suspend fun getUserName(): String { delay(1000) // æ¨¡æ‹Ÿè°ƒç”¨è€—æ—¶æ–¹æ³• return \"John\" } suspend fun getCompany(): String { delay(1000) // æ¨¡æ‹Ÿè°ƒç”¨è€—æ—¶æ–¹æ³• return \"Doe Corp.\" } fun main() { // ä½¿ç”¨ async å¹¶å‘è°ƒç”¨ä¸¤ä¸ª suspend å‡½æ•° val name = async { getUserName() } val company = async { getCompany() } // ä½¿ç”¨ await ç­‰å¾…ä¸¤ä¸ªä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ val nameResult = name.await() val companyResult = company.await() println(\"$nameResult, $companyResult\") // John, Doe Corp. } // æˆ–è€…ä½¿ç”¨ awaitAll suspend fun fetchTwoDocs() = // called on any Dispatcher (any thread, possibly Main) coroutineScope { val deferreds = listOf( // fetch two docs at the same time async { fetchDoc(1) }, // async returns a result for the first doc async { fetchDoc(2) } // async returns a result for the second doc ) deferreds.awaitAll() // use awaitAll to wait for both network requests // The awaitAll function should be preferred over map { it.await() } } suspend å…³é”®å­— suspend å‡½æ•°æ˜¯åç¨‹ä¸­çš„ä»»åŠ¡æè¿°éƒ¨åˆ†ï¼Œsuspend å…³é”®å­—åªæ˜¯ä¸€ä¸ªè¯­æ³•æç¤ºï¼Œå‘Šè¯‰å‡½æ•°è°ƒç”¨è€…è¯¥å‡½æ•°å¯èƒ½è¢«åˆ‡æ¢çº¿ç¨‹ï¼ŒåŒç†ï¼Œä¹Ÿåªèƒ½åœ¨ suspend å‡½æ•°å†…éƒ¨è°ƒç”¨å…¶ä»– suspend å‡½æ•°ï¼Œä¾‹å¦‚ä¸Šé¢çš„ delay. ç¼–è¯‘å™¨å’Œ IDE æ ¹æ® suspend å…³é”®å­—æ¥åšä¸€ä¸ªè¯­æ³•æç¤ºä¸æ ¡éªŒã€‚ coroutine builder åˆ©ç”¨ suspend fun åªèƒ½æè¿°ä»»åŠ¡/å‡½æ•°ï¼Œè¿˜éœ€è¦ä½¿ç”¨ coroutine builder æ¥åˆ›å»ºåç¨‹ã€‚ launchå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªåç¨‹è¿”å›ä¸€ä¸ªJobä¸åŒ…å«åç¨‹ç»“æœä¿¡æ¯ã€‚asyncå‡½æ•°ä¹Ÿåˆ›å»ºä¸€ä¸ªåç¨‹è¿”å›Deferred-ç±»ä¼¼ Future åŒ…å«åç¨‹çš„æœªæ¥è®¡ç®—ç»“æœã€‚å¯ä»¥é€šè¿‡Deferredå¯¹è±¡çš„ await æ–¹æ³•è·å–ç»“æœå€¼ã€‚ æ‰€æœ‰çš„ coroutine builder éƒ½æ˜¯CoroutineScopeçš„æ‰©å±•å‡½æ•°ï¼Œå› ä¸ºä»»ä½•åç¨‹çš„ç”Ÿå‘½å‘¨æœŸéƒ½ç”±å¯¹åº”çš„CoroutineScopeå¯¹è±¡ç®¡ç†ã€‚åé¢ä¼šçœ‹åˆ°æœ‰äº›æ–¹æ³•ä¼šé»˜è®¤åˆ›å»ºCoroutineScopeå¯¹è±¡ã€‚ val time = measureTimeMillis { val one = async { doSomethingUsefulOne() } val two = async { doSomethingUsefulTwo() } println(\"The answer is ${one.await() + two.await()}\") } println(\"Completed in $time ms\") start = CoroutineStart.LAZYçš„ async åç¨‹åªæœ‰åœ¨è¢«è°ƒç”¨startæˆ–è€…awaitæ—¶æ‰ä¼šå¯åŠ¨ã€‚ val time = measureTimeMillis { val one = async(start = CoroutineStart.LAZY) { doSomethingUsefulOne() } val two = async(start = CoroutineStart.LAZY) { doSomethingUsefulTwo() } one.start() // ä¸ä¼šé˜»å¡ï¼Œç›´æ¥ä¸‹ä¸€è¡Œæ‰§è¡Œ two.start() println(\"The answer is ${one.await() + two.await()}\") //æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰ä¸Šé¢ä¸¤ä¸ª start çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ª await æ˜¯å…ˆåè°ƒç”¨ï¼Œå¯¼è‡´ä¸¤ä¸ªåç¨‹é¡ºåºæ‰§è¡Œè€Œä¸æ˜¯å¼‚æ­¥ } println(\"Completed in $time ms\") ç»“æ„åŒ–å¹¶å‘ è¿˜æ˜¯ä¸Šé¢æ–¹å¼ 3 çš„ä¸¤ä¸ª suspend å‡½æ•°ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ–¹æ³•å¼‚å¸¸ï¼Œå¦ä¸€ä¸ªæ–¹æ³•ä¹Ÿå°±æ²¡æœ‰å¿…è¦ç»§ç»­æ‰§è¡Œäº†ï¼Œåœ¨ Java å¤šçº¿ç¨‹ç›®å‰éš¾ä»¥åšåˆ°ï¼ˆJEP 428 å·²ç»å®ç°ï¼Œå‚è€ƒ jdk19 çš„ StructuredTaskScope ç±»ï¼‰, è€Œåœ¨ kotlin åç¨‹ä¸­ï¼Œåªéœ€è¦å°†ä¸¤ä¸ªçº¿ç¨‹æ”¾åœ¨åŒä¸€ä¸ªCoroutineScopeå³å¯å®ç°ï¼š fun main() = runBlocking { try { failedConcurrentSum() } catch(e: ArithmeticException) { println(\"Computation failed with ArithmeticException\") } } suspend fun failedConcurrentSum(): Int = coroutineScope { //coroutineScope å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ scope val one = async { try { delay(Long.MAX_VALUE) // Emulates very long computation 42 } finally { println(\"First child was cancelled\") } } val two = async { println(\"Second child throws an exception\") throw ArithmeticException() } one.await() + two.await() } ç»“æ„åŒ–å¹¶å‘æ˜¯ kotlin åç¨‹çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ï¼Œåªæœ‰åœ¨ä½ é‡åˆ°å¤æ‚çš„åœºæ™¯æ—¶æ‰èƒ½æ„Ÿå—åˆ°ç»“æ„åŒ–å¹¶å‘çš„å¨åŠ›ä¸ä¼˜é›…ã€‚ Dispatcher CoroutineDispatcher ç”¨æ¥å†³å®šå“ªä¸ªï¼ˆæˆ–å‡ ä¸ªï¼‰çº¿ç¨‹æ¥è¿è¡Œè¯¥åç¨‹ï¼Œå¯ä»¥å°†åç¨‹çš„æ‰§è¡Œé™åˆ¶åœ¨ä¸€ä¸ªçº¿ç¨‹æˆ–è€…æŸä¸ªçº¿ç¨‹æ± ï¼Œæˆ–è€…ä¸é™åˆ¶ã€‚è‡ªå¸¦çš„å‡ ä¸ª dispatcher: Dispatchers.Main: A coroutine dispatcher that is confined to the Main thread operating with UI objects. Usually such dispatcher is single-threaded. Dispatchers.Default: The default CoroutineDispatcher that is used by all standard builders like launch, async, etc. if no dispatcher nor any other ContinuationInterceptor is specified in their context. Dispatchers.IO: The CoroutineDispatcher that is designed for offloading blocking IO tasks to a shared pool of threads. Dispatchers.Unconfined: A coroutine dispatcher that is not confined to any specific thread. It executes initial continuation of the coroutine in the current call-frame and lets the coroutine resume in whatever thread that is used by the corresponding suspending function, without mandating any specific threading policy. æ³¨æ„ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªå‡½æ•°å†…çš„ä¸åŒè¡Œä»£ç ä¹Ÿä¸ä¸€å®šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šé¢æ‰§è¡Œã€‚ æ³¨æ„ï¼ŒDispatcher å®ç°äº† CoroutineContext æ¥å£ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°withContext(Dispatchers.IO) {}ç”¨æ³•ã€‚ CoroutineContext åç¨‹æ‰§è¡Œæ—¶æ€»æœ‰å¸¦æœ‰ä¸€ä¸ª CoroutineContextï¼Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªå…ƒä¿¡æ¯ Mapï¼Œä¿å­˜äº† Jobã€coroutine dispatcher ç­‰ä¿¡æ¯ï¼š Job: æ§åˆ¶åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ CoroutineDispatcher: å°†å·¥ä½œåˆ†æ´¾åˆ°é€‚å½“çš„çº¿ç¨‹ã€‚ CoroutineName: åç¨‹çš„åç§°ï¼Œå¯ç”¨äºè°ƒè¯•ã€‚ CoroutineExceptionHandler: å¤„ç†æœªæ•è·çš„å¼‚å¸¸ã€‚ coroutine builderï¼ˆasyncã€launchï¼‰æ¥æ”¶å¯é€‰çš„ CoroutineContext å¯¹è±¡å‚æ•°ã€‚CoroutineContext æœ€å¸¸è§çš„ç”¨é€”å°±æ˜¯æŒ‡å®šåç¨‹çš„ dispatcher. åœ¨ kotlin ä¸­ï¼ŒCoroutineContextè¡¨ç¤ºåç¨‹çš„ contextï¼ŒåŒ…å«äº†å¤šä¸ªå…ƒç´ ã€‚è€ŒCoroutineContext.Elementè¡¨ç¤º context çš„ä¸€ä¸ªå…ƒç´ ã€‚ç±»ä¼¼ map å’Œ kv çš„å…³ç³»ã€‚ ä½†æ˜¯CoroutineContext.Elementç»§æ‰¿äº†CoroutineContextï¼Œå³ä¸€ä¸ª element ä¹Ÿæ˜¯ä¸€ä¸ª context. è¿™ç§æŠ½è±¡å¯ä»¥ç®€åŒ–ä¸€äº› API è®¾è®¡ï¼Œä¾‹å¦‚ï¼ŒwithContext å‡½æ•°çš„å‚æ•°ç±»å‹æ˜¯ CoroutineContextï¼Œä½†æ˜¯æˆ‘ä»¬å¸¸å¸¸ä¼šä¼ å…¥ä¸€ä¸ª CoroutineContext.Element çš„å®ç°ç±»å¦‚ Dispatchers. ç”±äºåè€…ç»§æ‰¿äº†å‰è€…ï¼Œæ‰€ä»¥è¿™æ ·çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ˜¯è¢«å…è®¸çš„ã€‚ ç”±äºå®ç°äº† plus æ“ä½œç¬¦æ–¹æ³•ï¼ŒJob() + Dispatchers.Mainä¹Ÿè¡¨ç¤ºä¸€ä¸ªCoroutineContextã€‚ CoroutineScope CoroutineScope æ˜¯åç¨‹æœ€é‡è¦ä¹Ÿæ˜¯æœ€éš¾ç†è§£çš„ç‚¹ã€‚CoroutineScope ç»™æ¯ä¸ªåç¨‹éƒ½å®šä¹‰äº†ä¸€ä¸ª scopeï¼Œç”¨æ¥ç»„ç»‡å’Œç®¡ç†ä¸€ç»„åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ async å’Œ launch ä¹Ÿæ˜¯ CoroutineScope çš„æ‰©å±•å‡½æ•°ã€‚å¾ˆå¤šæ•™ç¨‹é‡Œé¢ç›´æ¥è°ƒç”¨ async å‡½æ•°å…¶å®æ˜¯ä½¿ç”¨äº† GlobalScope å¯¹è±¡ã€‚ è·å–ç‹¬ç«‹çš„ scope å¯¹è±¡æœ€ä½³å®è·µæ˜¯é€šè¿‡ CoroutineScope() å’Œ MainScope() å·¥å‚å‡½æ•°ã€‚ä¸€èˆ¬ä¸å»ºè®®è‡ªå·±å®ç°CoroutineScopeæ¥å£ã€‚ suspend withContextå’Œsuspend coroutineScopeå‡½æ•°ä¹Ÿå« scoping function. withContext: Calls the specified suspending block with a given coroutine context, suspends until it completes, and returns the result. coroutineScope: Creates a CoroutineScope and calls the specified suspend block with this scope. The provided scope inherits its coroutineContext from the outer scope, but overrides the contextâ€™s Job. withContextæ¯”coroutineScopeå¤šäº†ä¸€ä¸ª context:CoroutineContext å‚æ•°ã€‚ withContextå‡ ä¸ªä½¿ç”¨ç¤ºä¾‹ åˆ‡æ¢åˆ° IO ä¸Šä¸‹æ–‡æ‰§è¡Œ IO æ“ä½œ suspend fun doSomething() { withContext(Dispatchers.IO) { // åœ¨ IO ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ IO å¯†é›†å‹ä»£ç  doNetworkRequest() } } åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–° UI suspend fun doSomething() { val result = withContext(Dispatchers.Default) { // åœ¨é»˜è®¤ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œè®¡ç®— calculateResult() } withContext(Dispatchers.Main) { // åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–° UI updateUI(result) } } åŒæ—¶åœ¨ä¸¤ä¸ªä¸åŒä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»»åŠ¡ suspend fun doSomething() { val job1 = GlobalScope.launch(Dispatchers.IO) { // ... } val job2 = GlobalScope.launch(Dispatchers.Main) { // ... } withContext(Dispatchers.IO) { job1.join() // ç­‰å¾… IO ä¸Šä¸‹æ–‡çš„ä»»åŠ¡ç»“æŸ } withContext(Dispatchers.Main) { job2.join() // ç­‰å¾…ä¸»çº¿ç¨‹çš„ä»»åŠ¡ç»“æŸ } } å–æ¶ˆä¸Šä¸‹æ–‡åˆ‡æ¢ suspend fun doSomething() { withContext(NonCancellable) { // ä½¿ç”¨ NonCancellable ä¸Šä¸‹æ–‡ // è¿™é‡Œçš„ä»£ç å—ä¸ä¼šè¢«å–æ¶ˆ doSomething() } // ... } withContext vs async çœ‹ä¸Šå»é™¤äº†è¿”å›å€¼ä¸ä¸€æ ·ï¼Œä¸¤è€…çš„åŠŸèƒ½éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯æ¥æ”¶ context å’Œ block å‚æ•°ã€‚ // async fun asyncDemo() = runBlocking { println(\"I am working\") val opOne = async(IO) { operationOne() }.await() //æ³¨æ„ è¿™é‡Œä¼šé˜»å¡ç­‰åˆ° operationOne è¿”å›æ‰èƒ½ç»§ç»­ä¸‹ä¸€è¡Œæ‰§è¡Œ val opTwo = async(IO) { operationTwo() }.await() println(\"Done working.\") println(\"The multiplied result is ${opOne * opTwo}\") } // withContext fun withContextDemo() = runBlocking { println(\"I am working\") val opOne = withContext(IO) { operationOne() } val opTwo = withContext(IO) { operationTwo() } println(\"Done working.\") println(\"The multiplied result is ${opOne * opTwo}\") } å…¶å® async æ˜¯ç”¨äºå¹¶å‘å¼‚æ­¥ç¼–ç¨‹çš„ï¼Œä¸Šé¢çš„ async ä½¿ç”¨æ–¹å¼æ˜¯ä¸æ¨èçš„ï¼Œå› ä¸ºåœ¨åˆ›å»ºä¸€ä¸ªåç¨‹åç«‹å³è°ƒç”¨ await ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸Šé¢ opOne å’Œ opTwo æ˜¯é¡ºåºæ‰§è¡Œã€‚ withContext åªæ˜¯ç”¨äº Context åˆ‡æ¢ã€‚ä¸Šé¢çš„ä»£ç å…¶å®ä¹Ÿå¯ä»¥å†™æˆ val result = withContext(IO) { operationOne() + operationTwo() } Flow fun simple(): Flow = flow { // flow builder, no suspend keyword before fun for (i in 1..3) { delay(1000) // pretend we are doing something useful here emit(i) // emit next value } } // Collect the flow simple().collect { value -\u003e println(value) } // We can replace delay with Thread.sleep in the body of simple's flow { ... } and see that the main thread is blocked in this case. Flow åªæœ‰åœ¨ collect è°ƒç”¨æ—¶æ‰è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä¸­é€”å–æ¶ˆï¼š fun simple(): Flow = flow { for (i in 1..3) { delay(100) println(\"Emitting $i\") emit(i) } } fun main() = runBlocking { withTimeoutOrNull(250) { // Timeout after 250ms simple().collect { value -\u003e println(value) } } println(\"Done\") } // only collected 1 2 é™¤äº† flow è¿˜æœ‰ flowOf(1,2,3) ã€ coll.asFlow() ç­‰ flow builder å‡½æ•°ã€‚ operator: transform take collect toList/toSet first reduce fold - reduce with initial value flowOn change the context of a flow: fun simple(): Flow = flow { for (i in 1..3) { Thread.sleep(100) // pretend we are computing it in CPU-consuming way log(\"Emitting $i\") emit(i) // emit next value } }.flowOn(Dispatchers.Default) // RIGHT way to change context for CPU-consuming code in flow builder fun main() = runBlocking { simple().collect { value -\u003e log(\"Collected $value\") } } å¦‚æœ collect å‡½æ•°æ¯” flow çš„ emit è¿˜æ…¢çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨bufferå°† flow æå‰ç”Ÿæˆ val time = measureTimeMillis { simple() // 100ms for each element .buffer() // buffer emissions, don't wait .collect { value -\u003e delay(300) // pretend we are processing it for 300 ms println(value) } } println(\"Collected in $time ms\") Channel val channel = Channel() launch { for (x in 1..5) channel.send(x * x) channel.close() // we're done sending } // here we print received values using `for` loop (until the channel is closed) for (y in channel) println(y) println(\"Done!\") å…¶ä»–å¸¸ç”¨å‡½æ•° runBlockingçš„ç­¾åactual fun runBlocking(context: CoroutineContext = EmptyCoroutineContext, block: suspend CoroutineScope.() -\u003e T): T çœ‹ç€å’Œ withContext éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯ withContext æ˜¯ suspend å‡½æ•°ï¼ŒrunBlocking ä¸æ˜¯ã€‚ runBlocking è¿è¡Œä¸€ä¸ªæ–°çš„åç¨‹ï¼Œå¹¶å¯ä¸­æ–­åœ°é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°åç¨‹å®Œæˆã€‚æ­¤å‡½æ•°ä¸åº”åœ¨åç¨‹ä¸­ä½¿ç”¨ã€‚å®ƒæ—¨åœ¨å°†å¸¸è§„çš„é˜»å¡ä»£ç ä¸æŒ‚èµ·é£æ ¼ç¼–å†™çš„åº“è¿æ¥èµ·æ¥ï¼Œä»¥ä¾¿åœ¨ main å‡½æ•°å’Œæµ‹è¯•ä¸­ä½¿ç”¨ã€‚ å‰é¢è¯´è¿‡ï¼Œæ‰€æœ‰çš„åç¨‹éƒ½åº”è¯¥åœ¨ä¸€ä¸ª CoroutineScope ä¸‹é¢è¢«ç®¡ç†ã€‚åœ¨runBlocking {}å¤§æ‹¬å·å†…éƒ¨å†™ä»£ç æ—¶ IDE ä¼šæç¤ºä½ å½“å‰ this çš„ type æ˜¯ CoroutineScopeï¼Œè¿™ä¸ª scope å®é™…æ˜¯ runBlocking æ–¹æ³•å†…æ„å»ºçš„ BlockingCoroutine å¯¹è±¡ã€‚ ç”±äºAbstractCoroutineæ¥å£ç»§æ‰¿äº†CoroutineScopeï¼Œæ‰€ä»¥ BlockingCoroutine ä¹Ÿæ˜¯ä¸€ä¸ª CoroutineScope å®ä¾‹ã€‚ kotlin.system.measureTimeMillis Executes the given block and returns elapsed time in milliseconds. delay Delays coroutine for a given time without blocking a thread and resumes it after a specified time. suspend fun yield() Yields the thread (or thread pool) of the current coroutine dispatcher to other coroutines on the same dispatcher to run if possible. Coroutine.start å‡½æ•° public fun start(start: CoroutineStart, receiver: R, block: suspend R.() -\u003e T) { start(block, receiver, this) //è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯ CoroutineStart.invoke æ–¹æ³•ã€‚this æŒ‡çš„æ˜¯å½“å‰ coroutine } ","title":"Kotlin Coroutine","uri":"/post/kotlin-coroutine/"},{"content":"é…ç½® Windows å’Œ WSL2ï¼Œä½¿å¾—èƒ½é€šè¿‡å…¶ä»–ç”µè„‘è¿œç¨‹ SSH åˆ° WSL2 Ubuntuã€‚ èƒŒæ™¯ ä¹‹å‰çš„ç”µè„‘é…ç½®æ˜¯ LinuxMint å°å¼æœº + M1 macbook ç¬”è®°æœ¬ã€‚ä½¿ç”¨ Linux ä¸»è¦åŸå› æ˜¯å‘½ä»¤è¡Œå’Œ Docker. æœ€è¿‘ç”±äºäºŒåå¤§ï¼Œå·¥ä½œ VPN åœ¨ macOS ä¸è®©ç”¨ï¼Œåªèƒ½å°†å°å¼æœºå®‰è£…ä¸Š Win10ï¼Œå‘ç° docker åœ¨ WSL2 è¿è¡Œéå¸¸ä¸æ»‘ï¼Œè¿™æ ·æ­£å¥½å¯ä»¥å½“ä½œ macbook çš„ Docker æœåŠ¡å™¨ã€‚åˆ‡æ¢åˆ° Windows è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯ï¼ŒLinux çš„æ¡Œé¢çœŸçš„ä¸è¡Œï¼Œæœ€è¿‘ä¸‰å¹´å„ç§ç‰ˆæœ¬çš„æ¡Œé¢ä½¿ç”¨ä¸€åœˆï¼ŒBudgieï¼ŒGnomeï¼ŒCinnamonï¼ŒXfce è¿™äº›æ¡Œé¢æ€»æ˜¯å¶å°”ç•Œé¢å¤±å»å“åº”ï¼ŒKDE ç”¨çš„ä¸å¤šï¼Œå¡é¡¿æ²¡é‡åˆ°ä½†æ˜¯å¯åŠ¨æ€»æ˜¯æ…¢åŠç§’ã€‚Win10 é™¤äº†æ²¡æœ‰ Bash/Zshï¼Œä¸­æ–‡å­—ä½“åƒåœ¾ç‚¹ï¼Œå…¶ä»–çš„éƒ½å®Œèƒœ Linuxã€‚ ä¸‹é¢çš„æ•™ç¨‹ä¸»è¦å‚è€ƒï¼šConfiguring SSH access into WSL 1 and WSL 2 1 Win10 å®‰è£… WSL2 Ubuntu æ³¨æ„ï¼Œæ˜¯å®‰è£… WSL2ï¼Œæ–¹æ³•å‚è€ƒè¿™ä¸ªenable-virtual-machine-featureï¼š ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShellï¼ˆâ€œå¼€å§‹â€èœå• \u003eâ€œPowerShellâ€ \u003eå•å‡»å³é”® \u003eâ€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ï¼‰ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestartï¼› å®‰è£… â€œé€‚ç”¨äº x64 è®¡ç®—æœºçš„ WSL2 Linux å†…æ ¸æ›´æ–°åŒ…â€ï¼› å°† WSL è®¾ç½®é»˜è®¤ version 2ï¼Œin PowerShell: wsl --set-default-version 2ï¼› å®‰è£… Ubuntuï¼Œin PowerShell: wsl --install -d Ubuntu-22.04ã€‚ æ›´å¤šå‚è€ƒ 2 é…ç½® SSH serverï¼ˆåœ¨ Ubuntu æ‰§è¡Œï¼‰ è¿›å…¥ Ubuntu #ä¿®æ”¹è½¯ä»¶æº sudo sed -i \"s@http://.*archive.ubuntu.com@https://mirrors.tuna.tsinghua.edu.cn@g\" /etc/apt/sources.list sudo sed -i \"s@http://.*security.ubuntu.com@https://mirrors.tuna.tsinghua.edu.cn@g\" /etc/apt/sources.list sudo apt update \u0026\u0026 sudo apt upgrade -y å®‰è£…é…ç½® ssh æœåŠ¡ sudo apt install openssh-server sudo vim /etc/ssh/sshd_config # ä¿®æ”¹ä¸‹é¢å‡ ä¸ªé…ç½® # Port 2222 # AddressFamily any # ListenAddress 0.0.0.0 # PasswordAuthentication yes # å¦‚æœå¯åŠ¨é‡åˆ°è¿™ä¸ªé”™è¯¯ è¯·æ‰§è¡Œä¸‹é¢å‘½ä»¤: sshd: no hostkeys available -- exiting sudo ssh-keygen -A # å¯åŠ¨sshæœåŠ¡ sudo /usr/sbin/service ssh start 3 Win10 é˜²ç«å¢™è®¾ç½® æ‰“å¼€æ§åˆ¶é¢æ¿\\ç³»ç»Ÿå’Œå®‰å…¨\\Windows Defender é˜²ç«å¢™ã€‚ æœ€å·¦è¾¹æœ‰é«˜çº§è®¾ç½® å³é”®ç‚¹å‡»å…¥ç«™è§„åˆ™ æ–°å»ºå…¥ç«™è§„åˆ™ ç‚¹å‡»ç«¯å£ï¼Œç‰¹å®šç«¯å£è®¾ç½® 2222 ç„¶åå‘½åä¹‹åä¸€è·¯ä¸‹ä¸€æ­¥å°±è¡Œ æˆ–è€…é€šè¿‡ shell è®¾ç½®ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell: New-NetFirewallRule -Name sshd -DisplayName 'sshd for WSL' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 2222 4 æœ¬åœ°éªŒè¯ SSH è®¿é—® Ubuntu æ‰“å¼€ Windows Terminalï¼Œå°è¯• ssh è®¿é—® Ubuntu ssh -p 2222 wsluser@localhost å¦‚æœè¿æ¥ä¸Šè¯´æ˜ ssh é…ç½®å·²ç»å®Œæˆã€‚ 5 Ubuntu ssh æœåŠ¡å¼€æœºè‡ªåŠ¨å¯åŠ¨ WSL2 Ubuntu çš„ ssh æœåŠ¡ä¸æ˜¯è·Ÿç€ Win10 å¼€æœºè‡ªåŠ¨å¯åŠ¨çš„ã€‚åœ¨ Win10 çš„%USERPROFILE%ç›®å½•ä¸‹é¢æ–°å»ºæ–‡ä»¶sshd.bat rem sshd.bat @echo off setlocal C:\\Windows\\System32\\bash.exe -c \"sudo /usr/sbin/service ssh start\" rem C:\\Windows\\System32\\wsl.exe -e \"sudo /usr/sbin/service ssh start\" endlocal æ³¨æ„ä¸Šé¢ bash.exe -c å’Œ wsl.exe -e ä¸¤ä¸ªåŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚bash åé¢ä¸ç»´æŠ¤äº†ï¼Œwsl æ˜¯å®˜æ–¹æ¨èå‘½ä»¤ï¼Œä½†æ˜¯ bash æœ‰è¾“å‡ºã€‚ æ¥ä¸‹æ¥æŠŠä¸Šé¢çš„è„šæœ¬é…ç½®æˆå¼€æœºè‡ªåŠ¨æ‰§è¡Œï¼š æŒ‰ä¸‹ Win é”®ï¼Œæœç´¢â€œä»»åŠ¡è®¡åˆ’ç¨‹åºâ€ï¼Œå³è¾¹ç‚¹å‡»â€œåˆ›å»ºä»»åŠ¡â€ã€‚ å¸¸è§„ï¼šè®¾ç½®ä»»åŠ¡åå­—â€œStart WSL SSHâ€ï¼Œå‹¾é€‰ä¸Šâ€œä½¿ç”¨æœ€é«˜æƒé™è¿è¡Œâ€ï¼ˆè¿™æ˜¯ç»™åé¢ç½‘å¡æ˜ å°„å‘½ä»¤çš„æƒé™ï¼‰ è§¦å‘å™¨ï¼šæ–°å»ºï¼Œé€‰æ‹©â€œå¯åŠ¨æ—¶â€ æ“ä½œï¼šé€‰æ‹©ä¸Šé¢çš„ sshd.bat è„šæœ¬æ–‡ä»¶ã€‚ ä¿å­˜ï¼Œé‡å¯ç”µè„‘ï¼Œæ‰“å¼€ Terminalï¼Œé‡æ–°è¯•è¯•ssh -p 2222 wsluser@localhost 6 ç½‘å¡æ˜ å°„ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ Win10 æœ¬åœ°å·²ç»å¯ä»¥åœ¨å¼€æœºåç›´æ¥é€šè¿‡ SSH è®¿é—® Ubuntu äº†ï¼Œä½†æ˜¯ä½ å¦‚æœåœ¨å±€åŸŸç½‘å†…çš„å…¶ä»–ç”µè„‘è®¿é—®ï¼Œè¿˜æ˜¯è¿ä¸ä¸Šçš„ã€‚è¿™æ˜¯å› ä¸º WSL2 æ˜¯ä¸ªè™šæ‹Ÿæœºã€‚ WSL 2 is a well-hidden virtual machine, but it is still a virtual machineâ€”and the consequences of this design are leaky. The network interface we see within WSL is a virtual interface that does not match the physical interface that Windows manages. Windows does a good job at hiding this fact when operating directly on the local machine (e.g. you can SSH into WSL from localhost and it will work), but attempts to reach WSL from a separate machine will fail. è®¾ç½®å¼€æœºè‡ªåŠ¨æ‰§è¡Œç½‘å¡æ˜ å°„å‘½ä»¤ï¼Œå°†ä¸Šé¢çš„ sshd.bat æ–‡ä»¶æ”¹æˆå¦‚ä¸‹ï¼š rem sshd.bat @echo off setlocal C:\\Windows\\System32\\bash.exe -c \"sudo /usr/sbin/service ssh start\" rem C:\\Windows\\System32\\wsl.exe -e \"sudo /usr/sbin/service ssh start\" C:\\Windows\\System32\\netsh.exe interface portproxy delete v4tov4 listenport=2222 listenaddress=0.0.0.0 protocol=tcp for /f %%i in ('wsl hostname -I') do set IP=%%i C:\\Windows\\System32\\netsh.exe interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=2222 connectaddress=%IP% endlocal ä¿å­˜åå¯åŠ¨ï¼Œåœ¨ macbook è¯•è¯•ï¼ŒæˆåŠŸã€‚ ","title":"åœ¨ macOS é€šè¿‡ SSH è®¿é—® Windows çš„ WSL2 Ubuntu","uri":"/post/access-into-wsl2-ubuntu-from-macos/"},{"content":"ä»€ä¹ˆæ˜¯ MicroProfile MicroProfile æ˜¯ä¸€ä¸ªå¾®æœåŠ¡çš„å¹³å°å®šä¹‰ï¼Œç›®æ ‡æ˜¯é’ˆå¯¹å¾®æœåŠ¡æ¶æ„ä¼˜åŒ–ä¼ä¸š Java å¼€å‘ã€‚ç”±äº JavaEE çš„æ ‡å‡†æ›´æ–°è¶Šæ¥è¶Šæ…¢ï¼Œè·Ÿä¸ä¸Š Web æŠ€æœ¯ä¸ K8S çš„å‘å±•ï¼Œäºæ˜¯ä¸€ç»„ä¾›åº”å•†ï¼ˆåŒ…æ‹¬ Tomitribeï¼‰å†³å®šåˆ›å»º MicroProfile, è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–çš„å¾®æœåŠ¡æ¶æ„å¹³å°ï¼Œåœ¨ 2016 å¹´åŠ å…¥ Eclipse åŸºé‡‘ä¼šã€‚ MicroProfileæ˜¯ä¸€ç»„è§„èŒƒï¼ŒåŒ…å«å¦‚ OpenTracingã€OpenAPIã€RestClientã€Configã€FaultToleranceã€CDI ç­‰ä¸€ç»„æ ‡å‡†ã€‚å½“å‰æœ€æ–°æ ‡å‡†æ˜¯ 5.0. å„å¤§ Java å‚å•†æœ‰å¾ˆå¤šå®ç°ï¼Œæœ€æœ‰åçš„å°±æ˜¯çº¢å¸½çš„ Quarkus, å…¶ä»–å®ç°æœ‰ Open Liberty å’Œ Payara Enterprise. æ³¨æ„ SpringBoot ä¸æ˜¯ MicroProfile è§„èŒƒå®ç°ï¼ŒBoot æ˜¯ç‹¬ç«‹äº MicroProfile å’Œ JavaEE è§„èŒƒçš„ï¼Œä½†æ˜¯åŠŸèƒ½ä¸Šå¤§åŒå°å¼‚ï¼ŒQuarkus ä¹Ÿæä¾›äº† Spring æ³¨è§£çš„æ”¯æŒã€‚ Quarkus Quarkusæ˜¯ä¸€ä¸ª MicroProfile è§„èŒƒçš„å®ç°ï¼Œä¸“é—¨ä¸ºäº‘æ—¶ä»£æ‰“é€ ã€‚æœ‰ï¼šå¯åŠ¨æ—¶é—´çŸ­ï¼Œå†…å­˜å ç”¨å°ï¼Œæ”¯æŒ native ç¼–è¯‘ï¼ˆéƒ¨ç½²åœ¨ GraalVM), æ”¯æŒ K8S ç‰¹æ€§ (ä¸ä»…æ˜¯éƒ¨ç½²ï¼Œè¿˜åŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆ K8S èµ„æºæ–‡ä»¶ç­‰) ä¼˜åŠ¿ã€‚æœ¬è´¨ä¸Šæ˜¯ç²¾é€‰äº†ä¸€äº›ä¼˜è´¨ç»„ä»¶ï¼Œé€šè¿‡æ‰©å±• (extensions) æ¨¡å¼æä¾›å¿«é€Ÿä¸šåŠ¡å¼€å‘çš„èƒ½åŠ›ã€‚ åˆ›å»ºé¡¹ç›® Quarkus æä¾›äº†å¼ºå¤§ Cliã€Maven æ’ä»¶ã€Gradle æ’ä»¶æ”¯æŒã€‚ä»¥ä¸‹ä¸»è¦ä½¿ç”¨ maven. mvn io.quarkus.platform:quarkus-maven-plugin:2.10.2.Final:create \\ -DprojectGroupId=moe.zhi \\ -DprojectArtifactId=quarkus-demo \\ -Dextensions=\"resteasy-reactive-jackson\" cd quarkus-demo æ‰“å¼€ IDEï¼Œå¯ä»¥çœ‹åˆ°è‡ªåŠ¨åŒ…å« pom.xml å’Œ Dockerfile(åˆ†ä¸ºä¸åŒç›®æ ‡éƒ¨ç½²ç¯å¢ƒï¼Œæ¯ä¸ªæ–‡ä»¶æä¾›äº†è¯¦ç»†ä½¿ç”¨è¯´æ˜).é¡¹ç›®ç›´æ¥è¿è¡Œå°±æ˜¯ä¸€ä¸ª hello world api æœåŠ¡ã€‚å¦‚æœéœ€è¦å¢åŠ ä¸€ä¸ªæ‰©å±•ï¼Œé€šè¿‡ maven add-extension æ’ä»¶çš„ extensions å‚æ•°æ·»åŠ ï¼Œæ’ä»¶è‡ªåŠ¨ä¼šä¿®æ”¹ pom.xml æ–‡ä»¶ï¼Œæ·»åŠ å¯¹åº”çš„ maven lib. # add Caffeine cache support mvn quarkus:add-extension -Dextensions=\"cache\" quarkus ç›®å‰å·²ç»æœ‰ä¸Šç™¾ä¸ª extension, å¯ä»¥é€šè¿‡mvn quarkus:list-extensionsæŸ¥çœ‹æ‰€æœ‰ã€‚ä¹Ÿå¯ä»¥åœ¨quarkus docæŸ¥çœ‹ã€‚ æ³¨è§£ Quarkus çš„æ³¨è§£ç¬¦åˆ Java CDI è§„èŒƒã€‚DI éƒ¨åˆ†çš„æ³¨è§£åŸºæœ¬å¯ä»¥å’Œ Spring çš„åšä¸€ä¸€å¯¹ä¸Šã€‚ //Spring -\u003e CDI/MicroProfile @Autowired -\u003e @Inject @Qualifier -\u003e @Named @Value -\u003e @ConfigProperty(ConfigMap ç”¨äºåˆ†ç»„é…ç½® key çš„å…¬å…±å‰ç¼€ï¼ŒConfigProperties å·²ç»åºŸå¼ƒ) @Component -\u003e @Singleton @Configuration -\u003e @ApplicationScoped @Bean -\u003e @Produces é…ç½® å’Œ Spring ç±»ä¼¼ï¼ŒQuarkus ä½¿ç”¨ä¸€ä¸ª application.properties æ–‡ä»¶é…ç½®å±æ€§ã€‚ ä½¿ç”¨@ConfigProperty è¯»å–é…ç½®å±æ€§ã€‚å¦‚æœå±æ€§æ˜¯ list, ä½¿ç”¨é€—å·åˆ†éš”ã€‚ é…ç½®æ–‡ä»¶ä¸­éƒ½æ˜¯ String å’Œ Int, MicroProfile Configuration è‡ªå¸¦äº†ä¸€ç³»åˆ—çš„è½¬æ¢å™¨ï¼š boolean: trueã€1ã€YESã€Yã€ONä¸ºtrue, å…¶ä»–ä¸ºfalse Byte,Short,Integer,Long,Float,Double,Character,Class(Class.forName)è‡ªåŠ¨è½¬æ¢ ç›®æ ‡ç±»å‹æœ‰ public static T of(String) æˆ–è€…public static T valueOf(String) æ–¹æ³• ç›®æ ‡ç±»å‹æœ‰ public static T parse(CharSequence) æ–¹æ³• ç›®æ ‡ç±»å‹æœ‰ public constructor(String)æ„é€ å‡½æ•° è‡ªå®šä¹‰è½¬æ¢å™¨å‚è€ƒorg.eclipse.microprofile.config.spi.Converter é…ç½®å±æ€§çš„éªŒè¯ éœ€è¦quarkus-hibernate-validatoræ‰©å±•ï¼Œç„¶åä½¿ç”¨@Maxã€@Digitsã€@Emailã€@NotNull å’Œ@NotBlank ç­‰æ ¡éªŒæ³¨è§£ã€‚ è‡ªå®šä¹‰æ ¡éªŒå™¨éœ€è¦å®ç°javax.validation.ConstraintValidatoræ¥å£ã€‚ è‡ªå®šä¹‰é…ç½®æº å‚è€ƒorg.eclipse.microprofile.config.spi.ConfigSource è·å–ç¯å¢ƒå˜é‡ ä½¿ç”¨@Inject Config config çš„ getPropertyNames() è·å¾—æ‰€æœ‰å±æ€§ã€‚ å±æ€§æ¥æºä¼˜å…ˆçº§ Profile Quarkus è‡ªå¸¦ä¸‰ä¸ª profile ç¯å¢ƒ:dev, test, prod. è®¾ç½®ä¸åŒçš„ profile å±æ€§ä½¿ç”¨%{profile}.config.key=value.ä¾‹å¦‚ %dev.quarkus.http.port=8181 logging level Quarkus å†…éƒ¨ä½¿ç”¨ JBoss Logging, å¦‚æœéœ€è¦ä½¿ç”¨ Slf4jï¼Œæ·»åŠ ä¾èµ–ï¼š org.jboss.slf4j slf4j-jboss-logmanager quarkus.log.level=DEBUG quarkus.log.file.enable=true # è°ƒæ•´packageä¸‹é¢çš„log level, æ³¨æ„åŒå¼•å· quarkus.log.category.\"io.undertow.request.security\".level=TRACE æ”¯æŒé›†ä¸­ç®¡ç†æ—¥å¿—ï¼Œå‚è€ƒ logging-json æ‰©å±•ã€‚ quarkus ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ æ³¨å…¥io.quarkus.runtime.StartupEventå’Œio.quarkus.runtime.ShutdownEventäº‹ä»¶å³å¯å“åº”ã€‚ @ApplicationScoped @Slf4j public class AppEventListener { void onStart(@Observes StartupEvent event) { log.info(\"#### app started...\"); } void onShutdown(@Observes ShutdownEvent event) { log.info(\"### app shutdown...\"); } } æ‹¦æˆªå™¨ é¦–å…ˆé€šè¿‡@javax.interceptor.InterceptorBindingåˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨æ³¨è§£ã€‚ @Inherited @InterceptorBinding @Retention(RetentionPolicy.RUNTIME) @Target({ElementType.METHOD, ElementType.TYPE}) public @interface Logit { } ç„¶åé€šè¿‡@javax.init.AroundInvokeå’Œ@javax.init.AroundConstructä¸¤ä¸ªå…·æœ‰ç›¸åº”æ‹¦æˆªç»‘å®šåŠŸèƒ½çš„æ‹¦æˆªå™¨ã€‚ @Logit @Interceptor public class LogitInterceptor { @AroundInvoke public Object invoke(InvocationContext ctx) throws Exception { System.out.println(\"#### interceptor\" + ctx.getMethod().getName()); return ctx.proceed(); } } Restful æœåŠ¡ Quarkus å®ç°äº† JAX-RS è§„èŒƒï¼Œæ”¯æŒ@GET,@POST, @PUT ç­‰ http åŠ¨è¯æ³¨è§£ã€‚é»˜è®¤è®¾ç½®ä¸‹ï¼Œquarkus ä½¿ç”¨ RESTEasy å’Œ Vertx æ¡†æ¶ï¼Œè€Œä¸æ˜¯ Servlet è§„èŒƒã€‚å¦‚æœéœ€è¦ä½¿ç”¨ Servlet, åˆ™å¢åŠ quarkus-undertowæ‰©å±•ï¼Œè¿™æ˜¯ JBOSSï¼ˆwildfly) çš„ Servlet æœåŠ¡å™¨çš„å¼•æ“ã€‚ é€šè¿‡@Pathæ³¨è§£åŒ¹é… URI. é€šè¿‡@Context UriInfo uriInfoè·å– url å†…å®¹ã€‚ é€šè¿‡@QueryParam(\"p\")å‚æ•°æ³¨è§£è·å– QueryString ä¸­çš„å‚æ•°ã€‚ å…¶ä»–å‚æ•°ï¼šè¡¨å•å‚æ•° (@FormParam)ã€çŸ©é˜µå‚æ•° (@MatrixParam) æˆ– cookie å€¼ (@CookieParam). æ­¤å¤–ï¼Œä½¿ç”¨@Contextæ³¨è§£ï¼Œä½ è¿˜å¯ä»¥æ³¨å…¥å…¶ä»–ä¸ JAX-RS ç›¸å…³çš„å…ƒç´ ï¼Œå¦‚javax.ws.rs.core.SecurityContextã€ javax.ws.rs.sse.SseEventSinkæˆ–javax.ws.rs.sse.Sse. json-p(processing) å’Œ json-b(binding) æ˜¯ JavaEE è§„èŒƒã€‚å¦‚æœ API éœ€è¦è¿”å› jsonï¼Œéœ€è¦å¢åŠ quarkus-testeasy-jsonbæ‰©å±•ã€‚ å¦‚æœ data model çš„å­—æ®µä¸ json å­—æ®µä¸åŒåï¼Œéœ€è¦ä½¿ç”¨javax.json.bind.annotation.JsonbPropertyæ³¨è§£ç»‘å®šã€‚ class Stu { @Jsonbproperty(\"first-name\") String firstNm; } å¦‚æœä½¿ç”¨ jackson, åˆ™éœ€è¦quarkus-resteasy-jackonæ‰©å±•ï¼Œä½¿ç”¨com.fasterxml.jackson.databind.ObjectMapperåš json è½¬æ¢ã€‚ Rest å®¢æˆ·ç«¯ ä½¿ç”¨ rest å®¢æˆ·ç«¯è°ƒç”¨å¤–éƒ¨æœåŠ¡æ¥å£ï¼Œéœ€è¦å¢åŠ \"rest-client\"å’Œ\"resteasy-jsonb\"æ‰©å±•ã€‚ private Client rest=ClientBuilder.newClient(); public String getTime(){ Response resp=rest.target(\"http://worldclockapi.com\") .path(\"/api/json/{timezone}/now\") .resolveTemplate(\"timezone\",\"GMT\") .request(MediaType.APPLICATION_JSON) .get(Response.class); return resp.readEntity(String.class); } æŒä¹…åŒ– Agroal æ˜¯ Quarkus ä¸­é¦–é€‰çš„æ•°æ®æºå’Œè¿æ¥æ± å®ç°ï¼Œä¸å®‰å…¨ã€äº‹åŠ¡ç®¡ ç†å’Œå¥åº·æŒ‡æ ‡è¿›è¡Œäº†é›†æˆã€‚è™½ç„¶å®ƒæ˜¯ä¸€ä¸ªæ‰©å±•ç¨‹åºï¼Œä½†å¦‚æœä½ æ­£åœ¨ä½¿ ç”¨ Hibernate ORM æˆ– Panache,Agroal æ‰©å±•ä¼šè¢«é¡ºå¸¦åŠ è½½è¿›æ¥ã€‚ä¹‹åä½  è¿˜éœ€è¦ä¸€ä¸ªæ•°æ®åº“é©±åŠ¨æ‰©å±•ï¼Œç›®å‰ï¼ŒH2ã€PostgreSQLã€MariaDBã€MySQLã€Microsoft SQL Server å’Œ Derby éƒ½æœ‰æ”¯æŒçš„æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡ Maven add-extension æ·»åŠ æ­£ç¡®çš„æ•°æ®åº“é©±åŠ¨æ‰©å±• å¦‚æœä½ æƒ³è¦ä½¿ç”¨å“åº”å¼ç¼–ç¨‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Vert.x reactive drivers. # é…ç½®å¤šä¸ªæ•°æ®æºçš„è¯åœ¨ quarkus.datasourceåé¢è·Ÿç€ä¸€ä¸ªè‡ªå®šä¹‰çš„ds nameå³å¯.ä¾‹å¦‚ # configure your datasource quarkus.datasource.url = jdbc:postgresql://localhost:5432/library-database quarkus.datasource.driver = org.postgresql.Driver quarkus.datasource.username = melvil quarkus.datasource.password = dewey # é…ç½®ç¬¬äºŒä¸ªæ•°æ®æº æŒ‡å®šds name ä¸º orders quarkus.datasource.orders.url = jdbc:postgresql://localhost:5432/library-database quarkus.datasource.orders.driver = org.postgresql.Driver quarkus.datasource.orders.username = melvil quarkus.datasource.orders.password = dewey éé»˜è®¤æ•°æ®æºéœ€è¦ä½¿ç”¨@DataSource(â€œds nameâ€) æŒ‡å®šï¼š import javax.inject.Inject; @Inject DataSource(\"orders\") AgroalDatasource ordersDs; å®¹é”™ éœ€è¦æ·»åŠ quarkus-smallrye-fault-toleranceæ‰©å±•ã€‚ å›é€€ä¸é‡è¯•ï¼š@org.eclipse.microprofile.faulttolerance.Retry, @org.eclipse.microprofile.faulttolerance.Fallback. Fallback çš„ handler éœ€è¦å®ç°org.eclipse.micropro file.faulttolerance.FallbackHandleræ¥å£ è¶…æ—¶ï¼š @org.eclipse.microprofile.faultttoler ance.Timeout. è¿‡è½½ä¿æŠ¤ (å¹¶å‘è¯·æ±‚ä¸ªæ•°)ï¼š @org.eclipse.microprofile.faultttolerance.Bulkhead. å‹æµ‹ \u003esiege -r 1 -c 4 -v http:localhost:8080/hello/bulkhead æ–­è·¯å™¨ï¼š @CircuitBreaker @CircuitBreaker(requestVolumeThreshold = 4, // \u003c1\u003e æ»šåŠ¨çª—å£ failureRatio = 0.75, // \u003c2\u003eæ–­è·¯é˜ˆå€¼ delay = 2000) // \u003c3\u003e é‡æ–°æ‰“å¼€æ—¶é•¿ ms å¦‚æœä½¿ç”¨@Fallback, ä¸” CircuitBreakerOpenException è¢«æŠ›å‡ºï¼Œå› é€€é€»è¾‘å°†è¢«æ‰§è¡Œã€‚ å¦‚æœä½¿ç”¨@Retry, æ¯æ¬¡é‡è¯•éƒ½ç”±æ–­è·¯å™¨å¤„ç†ï¼Œå¹¶è®°å½•æˆåŠŸæˆ–å¤± è´¥ã€‚ å¦‚æœä½¿ç”¨@Bulkhead, åˆ™åœ¨è¯•å›¾è¿›å…¥ bulkhead ä¹‹å‰æ£€æŸ¥æ–­è·¯å™¨ã€‚ å¯è§‚å¯Ÿ health healthï¼šæ·»åŠ äº†quarkus-smallrye-healthè‡ªåŠ¨æ³¨å†Œ q/health/liveå’Œq/health/readyä¸¤ä¸ªæ¢é’ˆ è‡ªå®šä¹‰ï¼šå®ç°ä¸€ä¸ª org.eclipse.microprofile.health.HealthCheckæ¥å£ï¼Œå¹¶åŠ ä¸Š@org.eclipse.microprofile.health.Liveness æˆ–@org.eclipse.microprofile.health.Readinessæ³¨è§£ æŒ‡æ ‡ æ·»åŠ quarkus-smallrye-metricsæ‰©å±•ï¼Œè‡ªåŠ¨æš´éœ²q/metricsç«¯ç‚¹ã€‚ è‡ªå®šä¹‰æŒ‡æ ‡ï¼š @Counted @Gauge @Metered @Timed OpenTelemetry Quarkus Opentelemetry configuration Reactive ç¼–ç¨‹ Quarkus æ”¯æŒä¸¤ç§å“åº”å¼ç¼–ç¨‹æ–¹å¼ï¼š Reactive Programming with Mutiny Coroutines with Kotlin Quarkus æ”¯æŒæ··åˆå‘½ä»¤å¼ä¸å“åº”å¼ç¼–ç¨‹ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ»æ„å°†æ‰€æœ‰ä»£ç æ”¹é€ æˆå“åº”å¼å°±å¯ä»¥äº«å—åˆ°é«˜æ€§èƒ½ã€‚æ›´å¤šè§ï¼š unification-of-imperative-and-reactive class loading in quarkus production æ¨¡å¼å’Œ native image æ¨¡å¼ä¸‹ï¼Œquarkus çš„ç±»åŠ è½½å™¨éƒ½æ˜¯ system ClassLoader(native æ¨¡å¼ä¸æ”¯æŒå¤š ClassLoaders) æ‰€æœ‰ quarkus app éƒ½æ˜¯é€šè¿‡QuarkusBootstrap class åˆ›å»ºã€‚è¿™ä¸ªç±»è§£æ app æ‰€æœ‰çš„ç›¸å…³ä¾èµ– (ç¼–è¯‘æˆ–è¿è¡Œæ—¶çš„ä¾èµ–),æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªCuratedApplication class, è¿™ä¸ªç±»åŒ…å«è¿™ä¸ª app æ‰€æœ‰çš„ç±»åŠ è½½ä¿¡æ¯ã€‚ CuratedApplication å¯ä»¥ç”¨äºåˆ›å»ºä¸€ä¸ªAugmentAction å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ç”¨äºåˆ›å»º app å¹¶å¯åŠ¨/é‡å¯ã€‚ åœ¨ dev æ¨¡å¼ä¸‹ï¼Œquarkus é€šè¿‡ classloader æ”¯æŒçƒ­åŠ è½½ï¼Œåœ¨ prod æ¨¡å¼ä¸‹ï¼Œåªæœ‰ system ClassLoader. é™¤äº†çƒ­åŠ è½½ï¼Œåœ¨ dev æ¨¡å¼ä¸‹ï¼Œæä¾›äº†q/dev DEV UIï¼Œæ”¯æŒé…ç½®åº”ç”¨ï¼ŒæŸ¥çœ‹ç¼“å­˜ï¼ŒæŸ¥çœ‹ç±»ä¿¡æ¯ï¼ŒæŸ¥çœ‹/æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼ŒæŸ¥çœ‹å¥åº·çŠ¶æ€ï¼Œæ‰§è¡Œæ•°æ®è„šæœ¬è¿ç§»ç­‰ç­‰ã€‚ ","title":"äº‘åŸç”Ÿ Java å¼€å‘æ¡†æ¶ Quarkus å­¦ä¹ ç¬”è®°","uri":"/post/java-quarkus-notes/"},{"content":"æœ‰æ—¶å€™ commit å®Œä»£ç ågit pushä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ To push the history leading to the current (detached HEAD) é”™è¯¯æç¤ºè¯´å½“å‰ HEAD æ²¡æœ‰æŒ‡å‘ä»»ä½•åˆ†æ”¯ï¼Œä½†æ˜¯ä½ è®°å¾—æ˜æ˜æœ‰æŒ‡å‘ä¸€ä¸ªåˆ†æ”¯çš„ å¤ç°é—®é¢˜ 1ã€å‡è®¾ä½ å½“å‰åœ¨ master åˆ†æ”¯ï¼Œä¸”æœ‰ä¸¤æ¬¡æäº¤ Prj on î‚  master â¯ git log --oneline --graph --decorate * 314c9df (HEAD -\u003e master) 2nd commit * ae15845 initial commit 2ã€åˆ‡å›åˆ°ç¬¬ä¸€æ¬¡æäº¤ Prj on î‚  master â¯ git checkout ae15845 Note: switching to 'ae15845'. You are in 'detached HEAD' state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false HEAD is now at ae15845 initial commit git ç›´æ¥ä¼šæç¤ºä½ å½“å‰ HEAD å·²ç» detachedã€‚è¿™æ˜¯å› ä¸ºå½“ HEAD ç¦»å¼€å½“å‰åˆ†æ”¯ï¼ˆmasterï¼‰çš„æœ«ç«¯ commit æ—¶ï¼ŒGit ä¼šé»˜è®¤ä½ æƒ³è¦ç¦»å¼€å½“å‰åˆ†æ”¯ï¼Œä½†æ˜¯ Git ä¸ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼ˆå› ä¸ºæ²¡æœ‰æä¾›åˆ†æ”¯åç§°ï¼‰ã€‚ æ‰€ä»¥ HEAD å˜æˆæ²¡æœ‰æŒ‡å‘ä»»ä½•åˆ†æ”¯çš„çª˜å¢ƒï¼Œå³ä½¿ä½ å†æ¬¡å›åˆ°åˆšæ‰é‚£ä¸ªåˆ†æ”¯çš„æœ«ç«¯ commitï¼Œè¿˜æ˜¯å¤„äº detached çŠ¶æ€ã€‚ 3ã€åˆ‡å› master åˆ†æ”¯çš„æœ«ç«¯ commit å¹¶æäº¤æ–°å†…å®¹ Prj (ae15845) # æ³¨æ„ zshé…ç½®è¿™é‡Œå±•ç¤ºçš„æ˜¯å½“å‰HEADï¼Œä¸‹é¢ä¹Ÿç»™äº†æç¤º â¯ git checkout 314c9df Previous HEAD position was ae15845 initial commit HEAD is now at 314c9df 2nd commit # æäº¤ç‚¹æ–°ä¸œè¥¿ Prj (314c9df) â¯ echo \"3nd file \" \u003e 3.txt Prj (314c9df) [?] â¯ git add . \u0026\u0026 git commit -m \"3nd commit\" [detached HEAD 09fb4a5] 3nd commit 1 file changed, 1 insertion(+) create mode 100644 3.txt Prj (09fb4a5) â¯ git log --oneline --graph --decorate * 09fb4a5 (HEAD) 3nd commit * 314c9df (master) 2nd commit * ae15845 initial commit å¯ä»¥çœ‹åˆ°æ­¤æ—¶ HEAD å’Œ master åˆ†æ”¯è¿˜æ˜¯åˆ†ç¦»çš„ã€‚ çœŸå®åœºæ™¯å¤ç° ä¸Šé¢å¤ç°çš„æ–¹å¼å¾ˆåˆ»æ„ï¼Œæ¯•ç«Ÿæå°‘æƒ…å†µä½ ä¼š checkout ä¸€ä¸ªå…·ä½“çš„ commit è€Œä¸æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ã€‚æ—¥å¸¸å·¥ä½œä¸­æœ€å¯èƒ½é‡åˆ°è¿™ä¸ª detached HEAD çš„åœºæ™¯æ˜¯ä½ ä½¿ç”¨Git submoduleçš„æ—¶å€™ã€‚ æ•¢è¯´æ¯ä¸ªæ–°æ‰‹åœ¨ä½¿ç”¨ submodule éƒ½ä¼šç¢°åˆ° detached HEAD é—®é¢˜ã€‚ åŸå› æ˜¯ä½ çš„ submodule æ²¡æœ‰è®°å½•æ­£ç¡®çš„åˆ†æ”¯ï¼Œå³ä½ åœ¨ä½¿ç”¨git submodule addæ—¶æ²¡æœ‰æŒ‡å®š-b å‚æ•°ã€‚ git submodule add -b main https://github.com/zhimoe/hugo-theme-next.git themes/next æˆ–è€…ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.gitmodulesæ–‡ä»¶ä¸­åŠ ä¸Šä¸€è¡Œ branch = main # or branch = master è§£å†³æ–¹æ³• 1ã€é¢„é˜²çš„æ–¹æ³•å°±æ˜¯æ²¡æœ‰ commit çš„æ—¶å€™åŠæ—¶åˆ‡å›ä¸€ä¸ªå…·ä½“åˆ†æ”¯git checkout master 2ã€å¦‚æœå·²ç»æäº¤äº†çš„è¯ï¼Œç»™å½“å‰æ¸¸ç¦»çš„ commit åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ Prj (09fb4a5) â¯ git branch oops 09fb4a5 Prj (09fb4a5) â¯ git log --oneline --graph --decorate * 09fb4a5 (HEAD, oops) 3nd commit * 314c9df (master) 2nd commit * ae15845 initial commit Prj (09fb4a5) â¯ git checkout oops Switched to branch 'oops' æ¥ç€ä½¿ç”¨ rebase å°† oops åˆ†æ”¯æ¥åœ¨ master åˆ†æ”¯çš„æœ«å°¾ commit ä¹‹å Prj on î‚  oops â¯ git rebase master Current branch oops is up to date. Prj on î‚  oops â¯ git log --oneline --graph --decorate * 09fb4a5 (HEAD -\u003e oops) 3nd commit * 314c9df (master) 2nd commit * ae15845 initial commit Prj on î‚  oops â¯ git checkout master \u0026\u0026 git merge oops Switched to branch 'master' Updating 314c9df..09fb4a5 Fast-forward 3.txt | 1 + 1 file changed, 1 insertion(+) create mode 100644 3.txt Prj on î‚  master â¯ git log --oneline --graph --decorate * 09fb4a5 (HEAD -\u003e master, oops) 3nd commit * 314c9df 2nd commit * ae15845 initial commit æœ€ååˆ é™¤ oops åˆ†æ”¯ï¼šgit branch -d oops. å‚è€ƒä¸€ä¸ªå®Œç¾çš„ GitFlow æ¨¡å‹ ","title":"Git çš„ detatched Head æ¨¡å¼å’Œè§£å†³é—®é¢˜æ–¹æ³•","uri":"/post/git-detatched-head/"},{"content":"Scala 3 åœ¨è¯­æ³•ä¸Šé¢æ–°å¢äº†ä¸€ç§ Python çš„ç¼©è¿›æ ¼å¼ï¼Œä¸¤ç§æ ¼å¼éƒ½å¯ä»¥ä½¿ç”¨ã€‚ä½†æ˜¯ç›®å‰éƒ¨åˆ†æƒ…å†µè¿˜æ˜¯éœ€è¦ä½¿ç”¨æ‹¬å·ã€‚\nä¸ªäººå¯¹æ–°è¯­æ³•æ˜¯æ”¯æŒçš„ã€‚ç¼©è¿›å¯ä»¥æå¤§åœ°æä¾›ä»£ç çš„å¯è¯»æ€§å’Œæ•´æ´ï¼Œæœ€å¤§çš„ä½“ä¼šå°±æ˜¯ SparkStreaming çš„ rdd å¤„ç†ä»£ç ï¼Œæ–°æ‰‹å®¹æ˜“å†™å‡ºåå‡ ä¸ª}æ‹¬å·åµŒå¥—ä»£ç ã€‚\nå½“ç„¶ç¼ºç‚¹æ˜¯ç¼©è¿›ä¸åˆ©äºä»£ç å¤åˆ¶å’Œæ ¼å¼åŒ–ã€‚\nä¸‹é¢æ˜¯ä¹¦æœ¬ä¸Šå…³äº Scala3 çš„è¯­æ³•å¯¹æ¯”ã€‚æ³¨æ„ï¼Œä¸¤ä¸ªè¯­æ³•æ ¼å¼éƒ½æ˜¯æ”¯æŒçš„ã€‚for å’Œ if å»æ‰å°æ‹¬å·çœŸçš„æ˜¯å¤ªæ£’äº†ã€‚\n","title":"Scala3 ç¼©è¿›è¯­æ³•æ€»ç»“è¡¨","uri":"/post/scala3-indent-syntax/"},{"content":"Python tricks f-string çš„å¦™ç”¨ py3.6 å¼€å§‹ï¼Œæ¨èä½¿ç”¨ f-stringï¼Œä¸è¦ä½¿ç”¨ %sæˆ–è€… \"\".format().å¦‚æœæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨ Template åšå®‰å…¨æ ¡éªŒã€‚ åœ¨ python f-string ä¸­å¯ä»¥é€šè¿‡å˜é‡æˆ–è€…è¡¨è¾¾å¼åé¢åŠ =å®ç°æ‰“å°å˜é‡åæˆ–è€…è¡¨è¾¾å¼ï¼š print(f'{v=}') # ç­‰ä»· print(f'v={v}') print(f'{(len(arr),v)=}') å‚è€ƒï¼šè°ƒå¼æ—¶icecreamæ¯”print logæ›´å¥½ã€‚ python æ³¨è§£ Python å¯¹æ³¨è§£æ‰€åšçš„å”¯ä¸€çš„äº‹æƒ…ï¼Œå°±æ˜¯å°†å®ƒä»¬å­˜å‚¨åœ¨å‡½æ•°çš„ annotations å±æ€§ä¸­ \u003e\u003e\u003e def foo(a: 'x', b: 5 + 6, c: list) -\u003e max(2, 9): ... \u003e\u003e\u003e foo.__annotations__ {'a': 'x', 'b': 11, 'c': ","title":"Python Tips for Impatient Dev","uri":"/post/python-tips-for-impatient-dev/"},{"content":"é—®é¢˜ ä¸€ä¸ª ionic app æœ¬åœ°ç¼–è¯‘éœ€è¦ 8 åˆ†é’Ÿï¼Œæäº¤åˆ°æµæ°´çº¿ç¼–è¯‘è€—æ—¶éœ€è¦è¿‘ 40 åˆ†é’Ÿï¼Œä»æ—¥å¿—çœ‹åˆ° webpack æ‰“åŒ…æ­¥éª¤è€—æ—¶æœ€ä¸¥é‡ã€‚\næ’æŸ¥ä¸è§£å†³ åˆæ­¥åˆ¤æ–­æ˜¯æµæ°´çº¿ä½¿ç”¨çš„å®¹å™¨ CPU æ€§èƒ½è¾ƒå¼±æˆ–è€…å­˜å‚¨ mount æ€§èƒ½å¯¼è‡´çš„ã€‚æ‰¾æµæ°´çº¿åŒäº‹æ”¯æŒé…ç½®äº†ä¸€ä¸ªçº¯å†…å­˜ç¼–è¯‘æµæ°´çº¿ï¼Œå‘ç°è¿˜æ˜¯å¾ˆæ…¢ã€‚æ¥ä¸‹æ¥ä½¿ç”¨ webpack çš„æ’ä»¶speed-measure-webpack-pluginç›‘æ§æ€§èƒ½ã€‚\nåœ¨ webpack.config.js é…ç½®ï¼š\n// webpack.config.js // npm i --save-dev speed-measure-webpack-plugin const SpeedMeasurePlugin = require(\"speed-measure-webpack-plugin\"); const smp = new SpeedMeasurePlugin(); // ...the webpack configuration const prodConfig = {/*...*/} module.exports = { prod: smp.wrap(prodConfig) }; å¾—åˆ°ä¸‹å›¾å·¦ä¾§çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦è€—æ—¶éƒ½åœ¨ angular çš„ PurifyPlugin ä¸Šã€‚æœç´¢äº†ä¸€ç•ªåæ‰¾åˆ° HappPack è¿™ä¸ªå¤šæ ¸æ‰§è¡Œçš„æ’ä»¶ã€‚\né…ç½® happypackï¼Œç”±äºä¸»è¦è€—æ—¶éƒ½åœ¨const PurifyPlugin = require('@angular-devkit/build-optimizer').PurifyPlugin;æ’ä»¶ä¸Šï¼Œè¿™é‡Œåªéœ€è¦é’ˆå¯¹è¿™ä¸€ä¸ªæ’ä»¶é…ç½® happypack å³å¯ã€‚\n// webpack.config.js // const HappyPack = require('happypack'); const os = require('os');//è·å– cpu core æ•°é‡ //loaders é…ç½® { test: /\\.ts$/, use: [ { loader: 'happypack/loader?id=ts', // åœ¨æ‰€æœ‰ loader ä¹‹å‰åŠ ä¸Š happypack/loader,id æ˜¯ plugins ä¸­å®šä¹‰çš„ }, { loader: process.env.IONIC_CACHE_LOADER }, { loader: '@angular-devkit/build-optimizer/webpack-loader', options: { sourceMap: true } }, { loader: process.env.IONIC_WEBPACK_LOADER } ] } // åœ¨ plugins ä¸­é…ç½® happypack æ’ä»¶ plugins: [ ionicWebpackFactory.getIonicEnvironmentPlugin(), ionicWebpackFactory.getCommonChunksPlugin(), new ModuleConcatPlugin(), new PurifyPlugin(), new HappyPack({ id: 'js', threads: os.cpus().length, loaders: ['@angular-devkit/build-optimizer/webpack-loader'] }), new HappyPack({ id: 'ts', // åœ¨ loader ä¸­ä½¿ç”¨ threads: os.cpus().length, // å¼€å¯æ“ä½œç³»ç»Ÿ cpu çš„æœ€å¤§æ ¸å¿ƒæ•° loaders: ['@angular-devkit/build-optimizer/webpack-loader'] }) ] å†æ¬¡æœ¬åœ°æ‰§è¡Œï¼Œæ€§èƒ½æå‡å·¨å¤§ã€‚åœ¨æµæ°´çº¿ä¸Šæµ‹è¯•ï¼Œä¸¤æ¬¡ build éƒ½åœ¨ 15 åˆ†é’Ÿå·¦å³ã€‚\n","title":"ä½¿ç”¨ Happypack ä¼˜åŒ– webpack æ‰“åŒ…é€Ÿåº¦","uri":"/post/ts-speed-up-angular-build/"},{"content":"å¦‚ä½•åœ¨ git hook ä¸­è°ƒç”¨ nodejs è„šæœ¬ã€‚ä¸»è¦è¸©å‘åœ¨äºä¸çŸ¥é“å¦‚ä½•åœ¨ bash ä¸­è·å– node è„šæœ¬è¿”å›å€¼ï¼Œæœäº†å¥½å¤§ä¸€åœˆã€‚ èƒŒæ™¯ å¾®æœåŠ¡æ¨¡å¼å¼€å‘ä¸­ï¼Œæ¯ä¸ªå°ç»„ç»´æŠ¤è‡ªå·±çš„åº”ç”¨ï¼Œé€šè¿‡ä¸€ä¸ª nginx å…¥å£åå‘ä»£ç†æ‰€æœ‰çš„å­åº”ç”¨ï¼Œå‘ç”¨æˆ·å¼€æ”¾ä¸€ä¸ªç«™ç‚¹.nginx åº”ç”¨ä¸­éœ€è¦ç»´æŠ¤å„ä¸ªå­åº”ç”¨çš„ä»£ç†ï¼Œå³ ng.conf ä¸­çš„ location. æ­¤å¤–ï¼Œä¸€ä¸ªåº”ç”¨éœ€è¦é…ç½® DEV,ST,UAT,PRD å››ä¸ªç¯å¢ƒçš„ location.ç›®å‰çš„åšæ³•æ˜¯ www/ngconf/ç›®å½•ä¸‹é¢åˆ†ä¸º devã€stã€uatã€prd å››ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹å†…éƒ¨æ¯ä¸ªå°ç»„å„è‡ªç»´æŠ¤ä¸€ä¸ª conf æ–‡ä»¶ã€‚ æ¯å¢åŠ ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦åœ¨å››ä¸ªæ–‡ä»¶å¤¹ä¸­è‡ªå·±å°ç»„çš„é…ç½®æ–‡ä»¶æ·»åŠ é…ç½®ã€‚éšç€åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œä»¥åŠäººå‘˜æµåŠ¨ï¼Œä¼šå‘ç”Ÿä¸åŒæ–‡ä»¶é…ç½®ç›¸åŒçš„ location entry. ä¾‹å¦‚ A åº”ç”¨ä¸Šçº¿ä¸€ä¸ªåŠŸèƒ½éœ€è¦ä¾èµ– B åº”ç”¨ï¼Œä½†æ˜¯æ–°äººä¸çŸ¥é“ B å·²ç»é…ç½®è¿‡äº†ï¼Œæ‰€ä»¥åˆé‡å¤æ·»åŠ äº†ä¸€ä¸ªï¼Œå¯¼è‡´å¯åŠ¨æŠ¥é”™ã€‚ éœ€æ±‚ å…¥å£åº”ç”¨æ˜¯ä¸€ä¸ª nodejs åº”ç”¨ï¼Œè‡ªç„¶é€‰æ‹©äº† js è„šæœ¬æ£€æŸ¥ conf æ–‡ä»¶ location path é…ç½®æ˜¯å¦é‡å¤ã€‚ å®ç° åœ¨ git hook ç›®å½•ä¸‹ï¼Œæ–°å¢ä¸€ä¸ªpre-commitæ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š #!/usr/bin/sh # æ£€æŸ¥é¡¹ç›®ä¸­åŒä¸€ä¸ªç›®å½•ä¸‹é¢çš„nginx conf æ‰€æœ‰locationæ˜¯å¦é‡å¤ if [ -e ./ngconf_check.js ]; then node ngconf_check.js if [[ $? != 0 ]]; then echo \u003e\u00262 fix duplicate location entry in nginx conf exit 1 fi fi # å¦‚æœé¡¹ç›®æœ‰è‡ªå®šä¹‰pre-commit,æ‰§è¡Œ if [ -e ./.git/hooks/pre-commit ]; then ./.git/hooks/pre-commit \"$@\" fi exit 0 è¦ç‚¹ï¼šbash ä¸­$?è¡¨ç¤ºè·å–ä¸Šå‘½ä»¤çš„è¿”å›å€¼ã€‚è¿™é‡Œè·å¾—çš„æ˜¯ js è„šæœ¬çš„ process.exit(code) è¿”å›çš„ code. é»˜è®¤è¿”å›æ˜¯ 0. ngconf_check.js: // æ£€æŸ¥ ng conf æ˜¯å¦æœ‰é‡å¤çš„ location entry const fs = require('fs'); const path = require('path'); const ConfEnvDirs = new Set(); ConfEnvDirs.add('dev'); ConfEnvDirs.add('st'); ConfEnvDirs.add('uat'); ConfEnvDirs.add('prd'); const NgconfPath = 'www/ngconf'; let result = 'pass'; countLocationInDir(NgconfPath); if(result !== 'pass'){ process.exit(1);//å‘ bash è¿”å› 1 } /** * * @param rootPath */ function countLocationInDir(rootPath) { if (!fs.existsSync(rootPath)) return; let dirs = fs.readdirSync(rootPath); dirs.forEach(dir =\u003e { let envDir = path.join(rootPath, dir); //åªå¤„ç†å››ä¸ªç¯å¢ƒç›®å½•ä¸‹çš„ conf æ–‡ä»¶ï¼Œæ¯ä¸ªç›®å½•ç”¨ä¸€ä¸ª map è®°å½• const LocationEntryMap = new Map();//location entry -\u003e file,line if (!(fs.statSync(envDir).isDirectory() \u0026\u0026 ConfEnvDirs.has(dir))) { return; } let confFiles = fs.readdirSync(envDir); confFiles.forEach(filename =\u003e { let fullPath = path.join(envDir, filename); if (fs.lstatSync(fullPath).isFile() \u0026\u0026 /[\\w\\W.].conf$/.test(filename)) { countLocationsInFile(fullPath, LocationEntryMap); } }); }); } /** * * @param confFile * @param countMap */ function countLocationsInFile(confFile, countMap) { let lines = fs.readFileSync(confFile, \"utf-8\") .split(\"\\n\") .filter(Boolean); lines.forEach((line, lineNumber) =\u003e { if (line.trim().startsWith(\"location\")) { const arr = line.trim().split(' '); const locationEntry = arr[1]; const entryInfo = `${confFile}, at line:${lineNumber}`; if (countMap.has(locationEntry)) { console.log(`ERROR: duplicate location entry: ${locationEntry}`); console.log(`location 1:${countMap.get(locationEntry)}`); console.log(`location 2:${entryInfo}`); //ä¿®æ”¹ result å˜é‡ result='error'; } else { countMap.set(locationEntry, entryInfo); } } }); } ","title":"åœ¨ githook ä¸­è°ƒç”¨ nodejs è„šæœ¬","uri":"/post/nodejs-as-githook/"},{"content":"ä¸€ä»½è¯¦å°½çš„ ts è¯­æ³•ç¬”è®°ã€‚è¿™å‘¨åœ¨çœ‹ç»„é‡Œå‰ç«¯åŒäº‹çš„ä»£ç ï¼Œæ„Ÿè§‰å®Œå…¨è¿˜æ˜¯åœ¨å†™ JSï¼Œä»¥æˆ‘æœ‰é™çš„ JS/TS çŸ¥è¯†ï¼Œä¹ŸçŸ¥é“å¯ä»¥å†™å¾—æ›´åŠ è§„èŒƒä¸€ç‚¹ã€‚ä½†æ˜¯ä¸€ä¸Šæ‰‹å¼€å§‹æ”¹ï¼Œè¿˜çœŸæ˜¯æ‰‹ç”Ÿã€‚ åˆé‡æ–°è¿‡äº†ä¸€éæ–‡æ¡£ï¼Œåšäº†ä¸€ç‚¹ç¬”è®°ã€‚ install # Install npm install typescript # Run npx tsc # Run with a specific config npx tsc --project configs/my_tsconfig.json # Triple slash directives # Reference built-in types /// # Reference other types /// /// # AMD /// /// # Compiler comments # Donâ€™t check this file // @ts-nocheck # Check this file (JS) // @ts-check # Ignore the next line // @ts-ignore # Expect an error on the next line // @ts-expect-error # ignore ts type error tsc --noEmitOnError hello.ts # tsconfig.json \"strict\": true \"noImplicitAny\" \"strictNullChecks\" ts syntax cheatsheet //-------------------------------- Basic type any // untyped, use as js, disables all further type checking unknown // The unknown type represents any value. This is similar to the any type, but is safer because itâ€™s not legal to do anything with an unknown value: void // void is not the same as undefined. // a contextual function type with a void return type (type vf = () =\u003e void), when implemented, can return any other value, but it will be ignored. null // prefer use undefined undefined // check optional param? if undefined before use it never // unreachable see: https://www.typescriptlang.org/docs/handbook/2/narrowing.html#exhaustiveness-checking object // object is not Object. Always use object! object also diff from {} // In compile time {} doesn't have Object's members and Object has more strict behavior boolean number string // The type names String , Number , and Boolean (starting with capital letters) are legal, but refer to // some special built-in types that will very rarely appear in your code. Always use string , number , or // boolean for types. bigint //ES2020 // Creating a bigint via the BigInt function const oneHundred: bigint = BigInt(100); // Creating a BigInt via the literal syntax const anotherHundred: bigint = 100n; string[] // or Array // ReadonlyArray // error: new ReadonlyArray(\"red\", \"green\", \"blue\"); // use: const roArray: ReadonlyArray = [\"red\", \"green\", \"blue\"]; // Just as TypeScript provides a shorthand syntax for Array with Type[], // it also provides a shorthand syntax for ReadonlyArray with readonly Type[] let x: readonly string[] = []; let y: string[] = []; [string, number] // tuple string | null | undefined // union type // use isArray function narrowing the array type function welcomePeople(x: string[] | string) { if (Array.isArray(x)) { console.log(\"Hello, \" + x.join(\" and \")); } else { console.log(\"Welcome lone traveler \" + x); } } // use in operator narrowing method structual type // instanceof narrowing type direction= 'left' | 'right'; // Literal types type roll= 1 | 2 | 3 | 4 | 5 | 6; // ?? (nullish coalescing) function getValue(val?: number): number | 'nil' { // Will only return 'nil' if `val` is null or undefined return val ?? 'nil'; } // ?. (optional chaining) function countCaps(value?: string) { // The `value` expression be undefined if `value` is null or // undefined, or if the `match` call doesn't find anything. return value?.match(/[A-Z]/g)?.length ?? 0; } // ! (null assertion) skip the null/undefined check let value: string | undefined; // ... Code that we're sure will initialize `value` ... // Assert that `value` is defined console.log(`value is ${value!.length} characters long`); // \u0026\u0026= assign a value only if current value is truthy let a; let b = 1; a \u0026\u0026= 'default'; // a is still undefined b \u0026\u0026= 5; // b is now 5 // ||= assign a value only if current value is falsy let a; let b = 1; a ||= 'default'; // a is 'default' now b ||= 5; // b is still 1 // ??= assign a value only if current value is null or undefined let a; let b = 0; a ??= 'default'; // a is now 'default' b ??= 5; // b is still 0 // Object { requiredStringVal: string; optionalNum?: number; readonly readOnlyBool: bool; } // Index signature: object with arbitrary string properties (like a hashmap or dictionary) { [key: string]: Type; } { [key: number]: Type; } { [key: symbol]: Type; } { [key: `data-${string}`]: Type; } // Array of functions that return strings (() =\u003e string)[] // or { (): string; }[] // or Array\u003c() =\u003e string\u003e // Basic tuples let myTuple: [ string, number, boolean? ]; myTuple = [ 'test', 42 ]; // Variadic tuples type Numbers = [number, number]; type Strings = [string, string]; type NumbersAndStrings = [...Numbers, ...Strings]; // [number, number, string, string] type NumberAndRest = [number, ...string[]]; // [number, varying number of string] type RestAndBoolean = [...any[], boolean]; // [varying number of any, boolean] // Named tuples type Vector2D = [x: number, y: number]; function createVector2d(...args: Vector2D) {} // function createVector2d(x: number, y: number): void // !!!cation, you can not use v2d.x the name is just for hint, not for compiler // Interface interface Child extends Parent, SomeClass { property: Type; optionalProp?: Type; optionalMethod?(arg1: Type): ReturnType; } // Class class Child extends Parent implements Child, OtherChild { property: Type; defaultProperty = 'default value'; private _privateProperty: Type; private readonly _privateReadonlyProperty: Type; static staticProperty: Type; static { try { Child.staticProperty = calcStaticProp(); } catch { Child.staticProperty = defaultValue; } } constructor(arg1: Type) { super(arg1); } private _privateMethod(): Type {} methodProperty: (arg1: Type) =\u003e ReturnType; overloadedMethod(arg1: Type): ReturnType; overloadedMethod(arg1: OtherType): ReturnType; overloadedMethod(arg1: CommonT): CommonReturnT {} static staticMethod(): ReturnType {} subclassedMethod(arg1: Type): ReturnType { super.subclassedMethod(arg1); } } //-------------------------------- Function // Function type (arg1: Type, argN: Type) =\u003e Type; // or { (arg1: Type, argN: Type): Type; } // Function type with optional param (arg1: Type, optional?: Type) =\u003e ReturnType // Function type with rest param (arg1: Type, ...allOtherArgs: Type[]) =\u003e ReturnType // Function type with static property { (): Type; staticProp: Type; } // Default argument function fn(arg1 = 'default'): ReturnType {} // Arrow function (arg1: Type): ReturnType =\u003e { ...; return value; } // or (arg1: Type): ReturnType =\u003e value; // this typing function fn(this: Foo, arg1: string) {} // Overloads function conv(a: string): number; function conv(a: number): string; function conv(a: string | number): string | number { ... } // Call Signatures type DescribableFunction = { description: string; (someArg: number): boolean; }; function doSomething(fn: DescribableFunction) { console.log(fn.description + \" returned \" + fn(6)); } // Construct Signatures type SomeConstructor = { new (s: string): SomeObject; }; function fn(ctor: SomeConstructor) { return new ctor(\"hello\"); } // Generic Functions function firstElement(arr: Type[]): Type | undefined { return arr[0]; } // Constraints function longest(a: Type, b: Type) { if (a.length \u003e= b.length) { return a; } else { return b; } } // longerArray is of type 'number[]' const longerArray = longest([1, 2], [1, 2, 3]); // longerString is of type 'alice' | 'bob' const longerString = longest(\"alice\", \"bob\"); // Error! Numbers don't have a 'length' property const notOK = longest(10, 100); // Working with Constrained Values // æœŸæœ›è¿”å› Typeï¼Œè€Œä¸æ˜¯å…·æœ‰{ length: number }çº¦æŸçš„ç±»å‹ã€‚å³æœŸæœ›å­ç±»ï¼Œè¿”å›äº†çˆ¶ç±»ï¼Œä¼šå¯¼è‡´å±æ€§å˜å°‘ function minimumLength( obj: Type, minimum: number ): Type { if (obj.length \u003e= minimum) { return obj; } else { return { length: minimum }; // Type '{ length: number; }' is not assignable to type 'Type'. // '{ length: number; }' is assignable to the constraint of type 'Type', but 'Type' could be instantiated with a different subtype of constraint '{ length: number; }' } } // Rule: If a type parameter only appears in one location, strongly reconsider if you actually need it // Rule: Always use as few type parameters as possible // Rule: When possible, use the type parameter itself rather than constraining it // å‡½æ•°é‡è½½ function makeDate(timestamp: number): Date; function makeDate(m: number, d: number, y: number): Date; // ä¸Šé¢ä¸¤ä¸ªä¸ºå‡½æ•°é‡è½½ç­¾å function makeDate(mOrTimestamp: number, d?: number, y?: number): Date { if (d !== undefined \u0026\u0026 y !== undefined) { return new Date(y, mOrTimestamp, d); } else { return new Date(mOrTimestamp); } } const d1 = makeDate(12345678); const d2 = makeDate(5, 5, 5); const d3 = makeDate(1, 3); // Always prefer parameters with union types instead of overloads when possible //-------------------------------- Enum // Unlike most TypeScript features, this is not a type-level addition to JavaScript but something added to the language and runtime. // Because of this, itâ€™s a feature which you should know exists, but maybe hold off on using unless you are sure enum Color {Red, Green, Blue = 4} // default get Red=0, all of the following members are auto-incremented Green=1, except you give. let c: Color = Color.Green // enum æœ‰ä¸¤ç§ï¼Œvalue æ˜¯ numberï¼ˆé»˜è®¤ï¼‰æˆ– string çš„ã€‚ // !!!numeric enums members also get a reverse mapping from enum values to enum names, for example: // !!! careful with numeric enum iteration enum LogLevel { ERROR, WARN, INFO } for (let element in LogLevel) { // å…ˆéå† indexï¼Œå†éå† value console.log(element +\" - \"+ LogLevel[element]);// output // [LOG]: \"0 - ERROR\" // [LOG]: \"1 - WARN\" // [LOG]: \"2 - INFO\" // [LOG]: \"ERROR - 0\" // [LOG]: \"WARN - 1\" // [LOG]: \"INFO - 2\" } // string value enum æ²¡æœ‰ä¸Šé¢è¿™ä¸ªé—®é¢˜ã€‚ // åœ¨ç¼–è¯‘å†…éƒ¨ï¼Œts ç¼–è¯‘å¾—åˆ°ä¸€ä¸ª name-\u003evalue value-\u003ename çš„åŒå‘ map enum Enum { VAL, } // tsc output \"use strict\"; var Enum; (function (Enum) { Enum[Enum[\"VAL\"] = 0] = \"VAL\"; })(Enum || (Enum = {})); // for in æ˜¯ ES5 æ ‡å‡†ï¼Œéå† key. in ä¼šéå†åŸå‹é“¾ prototype ä¸Šé¢çš„å±æ€§ã€‚éåº•å±‚ä»£ç ï¼Œç¦æ­¢ä½¿ç”¨ for..in. // for of æ˜¯ ES6 æ ‡å‡†ï¼Œéå† value. // è¯­æ³•ä¸Š enum å…è®¸ string value å’Œ numeric value å¹¶å­˜ï¼Œä½†æ˜¯ä»£ç ä¸šåŠ¡å«ä¹‰ enum BooleanLikeHeterogeneousEnum { No = 0, Yes = \"YES\", } // Try to use ts.forEach, ts.map, and ts.filter instead of loops when it is not strongly inconvenient. //-------------------------------- Type alias type Name = string; type Direction = 'left' | 'right'; type ElementCreator = (type: string) =\u003e Element; type Point = { x: number, y: number }; type Point3D = Point \u0026 { z: number }; type PointProp = keyof Point; // 'x' | 'y' const point: Point = { x: 1, y: 2 }; type PtValProp = keyof typeof point; // 'x' | 'y' // Extending a type via intersections type Animal = { name: string } type Bear = Animal \u0026 { honey: boolean } // type alias , interface åŒºåˆ« //-------------------------------- Generics // Function using type parameters (items: T[], callback: (item: T) =\u003e T): T[] // Interface with multiple types interface Pair { first: T1; second: T2; } // Constrained type parameter (): T // Default type parameter ","title":"Typescript Comprehensive Cheatsheet","uri":"/post/ts-comprehensive-notes/"},{"content":"æˆ‘ä¸€ä½äº²çˆ±çš„æœ‹å‹ï¼Œä¹Ÿæ˜¯é«˜äº§çš„ Redox OS è´¡çŒ®è€… jD91mZM2 åœ¨ 2021 å¹´ 3 æœˆå»ä¸–äº†ï¼Œå¹´ä»… 18 å²ã€‚ä»–å‚ä¸äº† 2018ã€2019 å’Œ 2020 å¹´çš„ Redox OS å¤å­£ä»£ç æ´»åŠ¨ã€‚ä»–åœ¨å¼€å‘ Redox OS çš„å„ä¸ªæ–¹é¢éƒ½åšå‡ºäº†è´¡çŒ®ï¼Œä»å†…æ ¸ï¼Œåˆ° relibcï¼Œåˆ°ç§»æ¤ç¨‹åºã€‚ä»–çš„å·¥ä½œè¯¦ç»†ä»‹ç»å¯ä»¥åœ¨Redox OS æ–°é—»ä¸­ç½²åä¸º jD91mZM2 çš„å¸–å­çœ‹åˆ°ã€‚\nè¿™ä¸ªå¸–å­å¯èƒ½æ˜¯é»‘æš—çš„ã€æ·±æ²‰çš„ã€æ²‰é‡çš„ã€åŸå§‹çš„ã€æœªç»ç¼–è¾‘çš„ã€‚å¦‚æœä½ å’Œæˆ‘ä»¬ä¸­çš„è®¸å¤šäººä¸€æ ·æœ‰è‡ªå·±çš„é—®é¢˜ï¼Œè¯·éšæ—¶ä¸æˆ‘è”ç³»ï¼šhttps://twitter.com/jeremy_soller.åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä¸å»ºè®®é˜…è¯»è¿™ç¯‡æ–‡ç« çš„å…¶ä»–å†…å®¹ã€‚æˆ‘çš„ç»“è®ºæ˜¯ï¼Œå¼€æºè¦æˆä¸ºå¯æŒç»­å‘å±•ï¼Œè¿˜æœ‰å¤§é‡çš„å·¥ä½œè¦åšï¼Œè€Œå…¶ä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯å¯¹ç¤¾åŒºåŠå…¶æˆå‘˜çš„å¥åº·çš„å…³æ€€ã€‚\nåæ€ æ˜¨å¤©ï¼Œå¦ä¸€ä¸ªè´¡çŒ®è€…ç»™æˆ‘å‘äº†æ¶ˆæ¯ï¼Œè¯´ jD91mZM2 å·²ç»é•¿æ—¶é—´ç¦»çº¿ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å›å¤é‚®ä»¶ã€‚æˆ‘é€šè¿‡æˆ‘æ‰€æŒæ¡çš„ä¿¡æ¯è¿›è¡Œäº†è”ç³»ï¼Œä½†æ— æµäºäº‹ã€‚æˆ‘æŠŠä»–çš„çœŸå®å§“åå‘Šè¯‰äº†å¦ä¸€ä½è´¡çŒ®è€…ï¼Œåè€…æ‰¾åˆ°äº†ä»–çš„è®£å‘Šã€‚æˆ‘ä»¬éªŒè¯äº†ä»–çš„åå­—ã€åœ°ç‚¹å’Œå‡ºç”Ÿæ—¥æœŸæ˜¯å¦ç›¸ç¬¦ã€‚è™½ç„¶æ²¡æœ‰åˆ—å‡ºæ­»å› ï¼Œä½†æˆ‘ç›¸ä¿¡æˆ‘ä»¬æ‰¾åˆ°çš„è¯æ®è¡¨æ˜ä»–æ˜¯åœ¨ç²¾ç¥ç–¾ç—…å‘ä½œåè‡ªæ€ã€‚\nåœ¨å¾—çŸ¥è¿™ä¸€åˆ‡åï¼Œæˆ‘æ„Ÿåˆ°å¾ˆéœ‡æƒŠã€‚è¿™æ ·ä¸€ä¸ªå¤šäº§çš„è´¡çŒ®è€…ï¼Œä¸ä»…å¯¹ Redoxï¼Œè€Œä¸”å¯¹è®¸å¤šé¡¹ç›®éƒ½æœ‰è´¡çŒ®ï¼Œæ€ä¹ˆä¼šè§‰å¾—æ­»äº¡æ¯”ç”Ÿå‘½æ›´é‡è¦ï¼Ÿè¿™æ˜¯ä¸€ä¸ªèƒ½åŠ›æ— ç©·çš„äººï¼Œè€Œä¸”ç›´åˆ°æœ€è¿‘ï¼Œä»–ä¼¼ä¹è¿˜èƒ½å¾ˆå¥½åœ°æŠŠæ¡è‡ªå·±çš„ç”Ÿæ´»ã€‚ä½†æˆ‘æ´»å¾—è¶Šä¹…ï¼Œå°±è¶Šæ„è¯†åˆ°è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæå¤§çš„å¹»è§‰ï¼Œäº‹æƒ…ä¼šè¿…é€Ÿæ¶åŒ–ã€‚\næˆ‘æœ€åä¸€æ¬¡ä¸ jD91mZM2 äº¤æµæ˜¯åœ¨äºŒæœˆï¼Œåœ¨ä»–å»ä¸–å‰ä¸€ä¸ªæœˆã€‚è¿™æ¬¡äº¤æµçº¯ç²¹æ˜¯æŠ€æœ¯æ€§çš„ï¼Œå…³äº Redox å†…æ ¸çš„ arch64 ç«¯å£ã€‚æˆ‘ä¸ç¦æƒ³åˆ°ï¼Œè¿™ä¹Ÿè®¸æ˜¯ä»–å†³å®šé€‰æ‹©æ­»äº¡çš„ä¸€ä¸ªå› ç´ ã€‚\nåœ¨å¼€æºå·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¼ºè°ƒå¥½ä»£ç çš„é‡è¦æ€§ã€‚æ¯•ç«Ÿï¼Œæ¯ä¸ªå¼€æºé¡¹ç›®çš„äº¤ä»˜ç‰©ï¼Œéƒ½æ˜¯æºä»£ç ï¼Œå¯¹å§ï¼Ÿä½†æˆ‘ä»¬å¸¸å¸¸å¿˜è®°ï¼Œå¥½çš„ä»£ç æ˜¯ç”±ä¼˜ç§€çš„äººç¼–å†™çš„ï¼Œè€Œç•™ä½è¿™äº›äººå¹¶è®©ä»–ä»¬ä¿æŒå¿«ä¹ï¼Œåº”è¯¥æ˜¯ä»»ä½•é¡¹ç›®ç»´æŠ¤è€…çš„é¦–è¦è€ƒè™‘ã€‚\nå¿ƒç†å¥åº·é—®é¢˜çš„å‘ä½œæœ‰å¾ˆå¤šæ–¹é¢ã€‚ä¸€æ–¹é¢ï¼Œç²¾ç¥ç–¾ç—…é€šå¸¸æœ‰é—ä¼ å› ç´ ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™äº›é—ä¼ çš„å‰å…†é€šå¸¸éœ€è¦æ…¢æ€§å’Œæ€¥æ€§çš„ç¯å¢ƒè§¦å‘å› ç´ ã€‚è¿™äº›æ…¢æ€§è¯±å› å¯ä»¥æ˜¯é•¿æœŸçš„ä¸è‰¯å®¶åº­æˆ–å·¥ä½œç¯å¢ƒï¼Œå¹¶å¯¼è‡´ç²¾ç¥ç–¾ç—…æœ¬èº«çš„è¡¨ç°ã€‚æ€¥æ€§è¯±å› å¯èƒ½æ˜¯ï¼Œä¾‹å¦‚ï¼Œä¸æŸäººå‘ç”Ÿäº‰æ‰§ï¼Œå¯¼è‡´ç²¾ç¥ç–¾ç—…å‘ä½œã€‚è¿™äº›å‘ä½œå¯èƒ½ä¸¥é‡åˆ°è¶³ä»¥å…‹æœç”Ÿå­˜çš„æç«¯æœ¬èƒ½ï¼Œå¯¼è‡´è‡ªæ€ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªæ€å¹¶ä¸æ˜¯ä¸€ç§è½¯å¼±çš„è¡¨ç°ã€‚äº‹å®ä¸Šï¼Œå®ƒæ˜¯ä¸€ç§æç«¯ä¿¡å¿µå’ŒåŠ›é‡çš„å±•ç¤ºã€‚å³ä½¿åœ¨ç²¾ç¥ç–¾ç—…çš„èƒŒæ™¯ä¸‹ï¼Œå¤§è„‘çš„æŸäº›éƒ¨åˆ†é€šå¸¸ä¸å—å½±å“ã€‚è¿™äº›éƒ¨åˆ†åœ¨è¿›åŒ–è¿‡ç¨‹ä¸­éå¸¸åŸå§‹ï¼Œæˆ‘ä»¬å‡ ä¹æ²¡æœ‰æ„è¯†åˆ°å¯¹å®ƒä»¬çš„æ§åˆ¶ã€‚ä¼å›¾è‡ªæ€éœ€è¦å…‹æœæœ‰æ„è¯†çš„æ±‚ç”Ÿæ¬²æœ›ã€‚è¦æˆåŠŸï¼Œå°±æ˜¯è¦å…‹æœæç«¯çš„æ½œæ„è¯†æ¬²æœ›ã€‚è¿™æ„å‘³ç€ï¼Œå¯¹äºè‡ªæ€ï¼Œå¾€å¾€æ˜¯æœ€èªæ˜ã€æœ€æœ‰èƒ½åŠ›çš„äººæ‰èƒ½å¤Ÿåšåˆ°ã€‚\nè¿™ç§å¯¹æœ‰èƒ½åŠ›çš„äººçš„åé€‰æ‹©æ˜¯ä¸€ç§å¯æ€•çš„æµè¡Œç—…ã€‚äººç±»æ€»ä½“ä¸Šè¿«åˆ‡éœ€è¦äººä¸ºåœ°è§£å†³é•¿æœŸå­˜åœ¨çš„é—®é¢˜ã€‚ä»¥æ°”å€™å˜åŒ–ä¸ºä¾‹ã€‚åœ¨æ¯å¹´ 80 ä¸‡è‡ªæ€çš„äººä¸­ï¼Œå¹³å‡æ¥è¯´ä¹Ÿè®¸æ¯”æˆ‘ä»¬å…¶ä»–äººæ›´æœ‰èƒ½åŠ›ï¼Œå¦‚æœæœ‰å‡ ä¸ªäººåœ¨å¼€å‘æ ¸èšå˜å‘ç”µæ–¹é¢èµ·åˆ°äº†ä½œç”¨ï¼Œé‚£ä¼šæ€ä¹ˆæ ·ï¼Ÿ\nç„¶è€Œï¼Œæˆ‘ä»¬ä½œä¸ºä¸€ä¸ªç¤¾ä¼šå·²ç»é‡‡å–äº†è¿™æ ·çš„ç«‹åœºï¼šè¿™äº›äº‹ä»¶æ˜¯ä¸€ç§ä¸å¯é˜»æŒ¡çš„åŠ›é‡ã€‚å¯¼è‡´è‡ªæ€çš„å› ç´ æ˜¯å†…éƒ¨çš„ï¼Œè€Œä¸æ˜¯å¤–éƒ¨çš„ã€‚åŸåˆ™ä¸Šï¼Œæˆ‘æ‹’ç»ç›¸ä¿¡è¿™ä¸€ç‚¹ã€‚å¯¹äºæ¯ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å¯»æ‰¾åŸå› å¹¶åŠ ä»¥ç¼“è§£ï¼Œå³ä½¿æœ€åä¸å¯èƒ½åšåˆ°ã€‚\nå› æ­¤ï¼Œæˆ‘ä¸å¾—ä¸å®¡è§†è‡ªå·±çš„è¡Œä¸ºï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥åšå¾—ä¸åŒã€‚çœ‹çœ‹æˆ‘æ˜¯å¦å¯ä»¥æŒ½æ•‘ä¸€ä¸ªäººçš„ç”Ÿå‘½ï¼Œä»¥åŠçœ‹çœ‹æˆ‘åœ¨æœªæ¥å¯ä»¥æŒ½æ•‘å“ªäº›ç”Ÿå‘½ã€‚\nå¼€æºä¸å¿ƒç†å¥åº· å¼€æºçš„æŸäº›æ–¹é¢ä¼¼ä¹å¸å¼•äº†æœ€å¥‡æ€ªçš„äººç±»ï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ã€‚è¿™ç¾¤äººåšæŒæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯æ£€æŸ¥çš„ï¼Œè¿™ä¹Ÿè®¸æ˜¯ç”±å¼ºè¿«ç—‡è¡Œä¸ºæ‰€é©±åŠ¨çš„ã€‚è€Œé‚£äº›å®¹æ˜“å‡ºç°è¿™ç§è¡Œä¸ºçš„äººï¼Œå¾€å¾€ä¼šä»å…¶ä»–ç–¾ç—…ä¸­ç»§æ‰¿ä¸‹æ¥ã€‚å¤šåŠ¨ç—‡ã€è‡ªé—­ç—‡ã€åŒç›¸æƒ…æ„Ÿéšœç¢ã€æŠ‘éƒç—‡å’Œå…¶ä»–ç–¾ç—…åœ¨å¼€æ”¾æºç è´¡çŒ®è€…ä¸­éå¸¸æ™®éã€‚\nå› æ­¤ï¼Œå¼€æºç¤¾åŒºä¸­ä¹Ÿæ˜æ˜¾ç¼ºä¹è½¯æŠ€èƒ½ã€‚è¿™æ˜¾ç„¶æœ‰åˆ†è£‚ç¤¾åŒºå’Œå°†å¼€æºæœ¬èº«ä¸ â€œæ­£å¸¸ â€œä¸–ç•Œéš”ç¦»çš„æ•ˆæœã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œå¹¸è¿çš„æ˜¯ï¼Œå¼€æ”¾æºä»£ç æœ€ç»ˆæˆä¸ºä¸€ä¸ªæœ‰åˆ©å¯å›¾çš„è¡Œä¸šã€‚è¿™ç§èµ„æœ¬çš„æ³¨å…¥å¯¼è‡´äº†å¼€æºé¢†åŸŸäººæ‰çš„æ˜¾è‘—å¤šæ ·åŒ–ã€‚\nç„¶è€Œï¼Œè¿™ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ã€‚é‚£äº›ä¸ç¬¦åˆå¼€æºé¡¹ç›®æ–°çš„å•†ä¸šåˆ©ç›Šçš„äººå¾€å¾€è¢«æŠ›åœ¨ä¸€è¾¹ã€‚ç”±äºä¸åŸå§‹ç»´æŠ¤è€…çš„åˆ†æ­§å¯¼è‡´é¡¹ç›®æœ¬èº«å‡ºç°éš¾ä»¥å…‹æœçš„å˜åŒ–ï¼Œé¡¹ç›®è¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºåˆ†å‰ä¸Šçš„åˆ†å‰ã€‚æˆ‘è‡ªå·±ä¹Ÿå‚ä¸äº†æ‰€æœ‰è¿™äº›æ–¹é¢çš„å·¥ä½œã€‚\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½ç¼ºä¹å¯¹äººç±»æˆæœ¬çš„è°ƒæŸ¥ã€‚è°ƒæŸ¥å¼€æºè´¡çŒ®è€…ä¸­ä¼—å¤šçš„å¿ƒç†å¥åº·äº‹ä»¶ï¼Œå¹¶è¯•å›¾æ‰¾å‡ºä¸€äº›å…±åŒçš„å› ç´ ã€‚æœ‰æ—¶è¿™äº›äº‹ä»¶ä¼šå¯¼è‡´æ–°çš„é¡¹ç›®ï¼Œæœ‰æ—¶ä¼šå¯¼è‡´è´¡çŒ®è€…ç²¾ç–²åŠ›å°½ï¼Œç„¶åç¦»å¼€å¼€æ”¾æºç ï¼Œæœ‰æ—¶ä¼šå¯¼è‡´è‡ªæ€ã€‚\næˆ‘ä»¬å¿…é¡»è®¤è¯†åˆ°æˆ‘ä»¬åœ¨åˆ›é€ å¯¼è‡´ç²¾ç¥ç–¾ç—…çš„æ…¢æ€§å‹åŠ›ä»¥åŠå¯¼è‡´å±é™©å‘ä½œçš„æ€¥æ€§å‹åŠ›æ–¹é¢çš„ä½œç”¨ã€‚\næˆ‘è‡ªå·±çš„æ—…ç¨‹ æˆ‘å¯¹ç²¾ç¥ç–¾ç—…æ²¡æœ‰å…ç–«åŠ›ã€‚æˆ‘ç»å¸¸æ”¶åˆ°è¿™æ ·çš„ä¿¡æ¯ï¼šâ€œä½ ä¼¼ä¹æŠŠä½ çš„äº‹æƒ…éƒ½æ§åˆ¶ä½äº†ï¼Œä½ æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿâ€ æ®‹é…·çš„äº‹å®æ˜¯ï¼Œæˆ‘æ€€ç–‘æˆ‘ä»¬ä¸­æ˜¯å¦æœ‰äººçœŸçš„åšåˆ°äº†ã€‚è€Œæˆ‘ä»¬å¯¹ â€œæ§åˆ¶ â€œçš„å®šä¹‰å¯èƒ½æ˜¯éå¸¸ä¸åŒçš„ã€‚æ‹¥æœ‰æˆåŠŸçš„é¡¹ç›®å¹¶ä¸ç­‰åŒäºæ‹¥æœ‰æ™®éçš„å¹¸ç¦ã€‚\næˆ‘ä¸å¾—ä¸æ‰¿è®¤ï¼Œæˆ‘ç°åœ¨æ¯”ä»¥å‰å¹¸ç¦å¤šäº†ã€‚å› æ­¤ï¼Œä¹Ÿè®¸ä¸ä¸€èˆ¬äººç›¸æ¯”ï¼Œæˆ‘ç¡®å®æœ‰äº‹æƒ…åœ¨æ§åˆ¶ä¹‹ä¸­ã€‚æˆ‘çš„ç”Ÿæ´»ä¸€ç›´æ˜¯æ²»ç–—å¸ˆã€ç²¾ç¥ç—…åŒ»ç”Ÿã€è¯ç‰©å’Œéš”ç¦»çš„å¥¥å¾·èµ›ã€‚å®ƒæœ¬æ¥å¾ˆå®¹æ˜“åƒå…¶ä»–äººä¸€æ ·ç»“æŸã€‚æˆ‘å¾ˆå¹¸è¿åœ°æ‰¾åˆ°äº†æˆ‘çš„æ…¢æ€§å‹åŠ›æºï¼Œå¹¶å°½èŒå°½è´£åœ°æ¶ˆé™¤å®ƒä»¬ã€‚\næˆ‘çš„å¤§å­¦ä¸€å¹´â€“ä¸ jD91mZM2 å†³å®šç»“æŸè‡ªå·±ç”Ÿå‘½çš„æ—¶é—´å·®ä¸â€“ç‰¹åˆ«è‰°éš¾ã€‚æˆ‘çš„ä½“é‡å¢åŠ äº†è¿‘ 50 ç£…ã€‚æˆ‘å’Œå¦å¤–ä¸‰ä¸ªå®¤å‹ä½åœ¨ä¸€èµ·ï¼Œå…¶ä¸­ä¸¤ä¸ªä¹Ÿæ—©é€äº†ã€‚æˆ‘äº¤æ›¿ä½¿ç”¨å¤šåŠ¨ç—‡è¯ç‰©ã€æŠ—æŠ‘éƒè¯ï¼Œç”šè‡³å¸çƒŸâ€“ä»¥å¯»æ‰¾èƒ½ â€œä¿®å¤ â€œæˆ‘çš„æ–¹æ³•ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸€ç›´åœ¨ç¼–ç¨‹ï¼Œä¸ºæ­¤å¸¸å¸¸å¿½ç•¥äº†æˆ‘çš„å­¦æ ¡å·¥ä½œã€‚\nåœ¨ä¸Šå¤§å­¦ä¹‹å‰ï¼Œæˆ‘æ›¾åœ¨å“å°”åŒ»ç–—å…¬å¸æ‹…ä»»å®ä¹ ç”Ÿï¼Œç¼–å†™é™¤é¢¤å™¨è½¯ä»¶ã€‚æˆ‘åœ¨è¿™é¡¹å·¥ä½œä¸­æ‹¥æœ‰ä¸¤é¡¹ä¸“åˆ©ã€‚è€å®è¯´ï¼Œåœ¨å¯¹è®¡ç®—æœºçš„ç†è§£ä¸Šï¼Œæˆ‘æ¯”åˆ«äººé«˜å‡ºä¸€æˆªã€‚æˆ‘ä¹Ÿå¯¹è‡ªå·±è¯´å®è¯ï¼Œåœ¨å¯¹äººçš„ç†è§£æ–¹é¢ï¼Œæˆ‘æ¯”åˆ«äººå·®äº†ä¸€å¤§æˆªï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ã€‚\nåœ¨é‚£æ®µæ—¶é—´é‡Œï¼Œæˆ‘ä¸ç ”å‘éƒ¨çš„å‰¯æ€»è£å»ºç«‹äº†å…³ç³»ï¼Œä»–æˆäº†æˆ‘äº‹å®ä¸Šçš„è€æ¿ã€‚å¤§ä¸€å¿«ç»“æŸæ—¶ï¼Œä»–è”ç³»æˆ‘ï¼Œé—®æˆ‘æ˜¯å¦æƒ³ç»§ç»­å·¥ä½œã€‚æˆ‘ç­”åº”äº†ã€‚\nå¤§äºŒçš„æ—¶å€™ï¼Œæˆ‘çš„æƒ…å†µéå¸¸ä¸åŒã€‚æˆ‘æŠŠå¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨å†™è½¯ä»¶ä¸Šï¼Œå¹¶ä¸”èµšäº†ä¸å°‘é’±ã€‚æˆ‘å¯¹å­¦æ ¡æ²¡æœ‰å…´è¶£ã€‚æˆ‘æœ‰å‡ é—¨è¯¾ä¸åŠæ ¼ï¼Œä½†é«˜åˆ†é€šè¿‡äº†è®¸å¤šé«˜æ°´å¹³çš„ CS è¯¾ç¨‹ã€‚æˆ‘å¾ˆå¿«å°±ä»å¤§å­¦é€€å­¦ï¼Œå…¨èŒä»äº‹è½¯ä»¶å·¥ç¨‹ã€‚\nè¿™å¯¹æˆ‘çš„å¿ƒç†å¥åº·äº§ç”Ÿäº†å·¨å¤§çš„ç§¯æå½±å“ã€‚æˆ‘é™äº†ä½“é‡ã€‚ä¸æˆ‘å¤§å­¦çš„å…¶ä»–æ ¡å‹ä¿æŒè”ç³»ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ä»–ä»¬è®¤è¯†äº†æˆ‘çš„å¦»å­ã€‚æˆ‘ä»¬ä¸€èµ·ä¹°äº†ä¸€å¥—æˆ¿å­ã€‚æˆ‘å¼€å§‹äº† Redox æ“ä½œç³»ç»Ÿã€‚æˆ‘çš„å¦»å­å’Œæˆ‘ç»“å©šäº†ã€‚æˆ‘å¼€å§‹åœ¨ System76 å·¥ä½œã€‚æˆ‘çš„å¦»å­å’Œæˆ‘æœ‰ä¸€ä¸ªæ¼‚äº®çš„å¥³å„¿ã€‚ä»å¤§äºŒå¼€å§‹ï¼Œæˆ‘ä»æ¥æ²¡æœ‰æƒ³è¿‡è‡ªå·±çš„å¿ƒç†å¥åº·é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦å»æ²»ç–—æˆ–ç”¨è¯ã€‚æˆ‘æ‰€æœ‰çš„å‹åŠ›éƒ½æ¶ˆå¤±äº†ã€‚\nä¸€ä¸ªäººçš„å¿ƒç†å¥åº·æˆåŠŸå¹¶ä¸æ€»æ˜¯èƒ½å¤åˆ»æˆå…¶ä»–äººçš„æˆåŠŸã€‚åœ¨è¿™ä¸€å†ç¨‹ä¸­ï¼Œæˆ‘åˆ›é€ å’Œç ´åäº†ï¼ˆé€šè¿‡å¿½è§†ï¼‰æ•°ç™¾ç§å…³ç³»ã€‚æˆ‘ä¸å¾—ä¸æ‰¿è®¤ï¼Œè™½ç„¶æˆ‘å¾ˆå¿«ä¹ï¼Œä½†æˆ‘æœ‰ä¸€ç§å€¾å‘ï¼Œä¼šåœ¨åˆ«äººèº«ä¸Šé€ æˆç›¸å½“å¤§çš„åå·®ã€‚æˆ‘ä¿ç•™äº†ç»™æˆ‘å¸¦æ¥å¿«ä¹çš„å…³ç³»ï¼Œè€Œå¿½ç•¥äº†é‚£äº›éœ€è¦åŠªåŠ›çš„å…³ç³»ã€‚è€Œåœ¨æŸäº›æ—¶å€™ï¼Œä¹Ÿè®¸æˆ‘å¿˜è®°äº†ä¸ jD91mZM2 ä¿æŒè”ç³»ï¼Œç¡®ä¿ä»–æ‰¾åˆ°ä¸æˆ‘ä¸€æ ·çš„å¹¸ç¦ã€‚\nä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Ÿ æ²¡æœ‰è§£å†³æ–¹æ¡ˆï¼Œæ¯ä¸ªæ¡ˆä¾‹éƒ½æ˜¯ä¸åŒçš„ã€‚ä½†æˆ‘è§‰å¾—æœ‰å¿…è¦æ£€æŸ¥ä¸€ä¸‹è¿™äº›å¹´æ¥æˆ‘å¤±å»çš„è®¸å¤šäººï¼Œæˆ‘å¸Œæœ›ä½ ä¹Ÿè¿™æ ·åšã€‚æˆ‘ä»¬ä»ç„¶å¤„äºäº†è§£äººç±»æ€æƒ³çš„é»‘æš—æ—¶ä»£ï¼Œæˆ‘ä»¬è¶Šæ˜¯äº’ç›¸æ£€æŸ¥ï¼Œæˆ‘ä»¬å°±ä¼šåšå¾—è¶Šå¥½ã€‚æˆ‘çŸ¥é“æˆ‘æœ¬å¯ä»¥æœ‰æ‰€ä½œä¸ºï¼Œå¦‚æœæˆ‘å¤šåšä¸€ç‚¹çš„è¯ã€‚ä¹Ÿè®¸ä¸æ˜¯ä¸ºäº† jD91mZM2ï¼Œè€Œæ˜¯ä¸ºäº†æœ‰åŒæ ·æ„Ÿè§‰çš„äººã€‚æˆ‘ä¸ä¼šå†ä»¥ä»–ä»¬æ‰€å†™çš„ä»£ç æ¥è¯„ä»·è´¡çŒ®è€…ã€‚ä»£ç ä¸ä¼šè‡ªå·±å†™ï¼Œè€Œå†™ä»£ç çš„äººç”šè‡³æ¯” â€œå¼€æº â€œæœ¬èº«æ›´éœ€è¦ç»´æŠ¤ã€‚\nåŸæ–‡-Open Source and Mental Health\n","title":"å¼€æºä¸å¿ƒç†å¥åº·[ç¿»è¯‘]","uri":"/post/open-source-mental-health/"},{"content":"ç®€å•è®°å½•ä¸€ä¸‹è‡ªå·±ä¹°æˆ¿å’Œè£…ä¿®çš„ä¸€ç‚¹ç»éªŒã€‚\nä¹°æˆ¿ è‡ªå·±ä¹°æˆ¿æ¯”è¾ƒç¦»å¥‡ï¼Œæ­å·å¼€å§‹å®è¡Œæ‘‡å·çš„åŠå¹´åï¼Œç«¯åˆèŠ‚åœ¨è€å®¶åˆ·å¾®ä¿¡ï¼Œçœ‹åˆ°æœ‰ä¸ªçº¢ç›˜æœ‰ 6000 å¤šäººæŠ¥åï¼Œæ„Ÿè§‰ä¹°æˆ¿éƒ½è¦å¼€å§‹ç¢°è¿æ°”äº†æƒ³åˆ°äº†è½¦ç‰Œçš„æ‚²å‰§ï¼Œäºæ˜¯è¿”æ­åä¸‹è½¦å°±å»é‚£ä¸ªæ¥¼ç›˜çœ‹äº†ä¸€ä¸‹ï¼Œå°åŒºæ—è¾¹åœ¨ä¿®åœ°é“ï¼Œçœ‹äº†å‡ çœ¼æ²™ç›˜ï¼Œç¬¬äºŒå¤©å°±å€Ÿé’±ç™»è®°æ‘‡å·äº†ï¼Œæ²¡æƒ³åˆ°ç¬¬ä¸€æ¬¡å°±ä¸­äº†ã€‚ç°åœ¨å›æƒ³èµ·å°±åšæ¢¦ä¸€æ ·ã€‚ç½‘ä¸Šå…³äºå¦‚ä½•ä¹°æˆ¿çš„ç»éªŒç‰¹åˆ«å¤šï¼Œä¾‹å¦‚æ­å·æˆ¿äº§çŸ¥è¯†æ‰«ç›²,ä¸Šæµ·ä¹°æˆ¿ç­‰ç­‰ã€‚è¿™äº›æˆ‘éƒ½æ²¡ç”¨ä¸Šã€‚è¿™é‡Œè¯´è¯´è‡ªå·±çš„ä¸€äº›ç»éªŒå’Œè¸©å‘ã€‚\næˆ·å‹æ–¹æ­£é€šé€å¹²æ¹¿åˆ†ç¦»è¿™äº›ç½‘ä¸Šéƒ½ä¼šè¯´ã€‚æé†’çš„æ˜¯è®¤çœŸçœ‹æ²™ç›˜æ—è¾¹æ¯æ ‹æ¥¼çš„è¯´æ˜æŒ‚å¹…ã€‚æŒ‚å¹…ä¸‹é¢ä¼šæœ‰å°å­—ï¼Œè¯´æ˜æ¯æ ‹æ¥¼çš„ä¸€äº›å‘ï¼Œä¾‹å¦‚ä¸€äº›è®¾å¤‡å¹³å°åœ¨å“ªæ ‹æ¥¼ï¼ˆå™ªéŸ³ï¼‰ï¼Œæ¥¼çš„è…°çº¿åœ¨å‡ æ¥¼ï¼ˆè…°çº¿åªæ˜¯ä¸ºäº†æ¥¼å¤–è§‚å¥½çœ‹ï¼Œä½†æ˜¯éå¸¸å½±å“è¯¥å±‚çš„é‡‡å…‰ï¼‰ï¼Œé€‰çš„æ—¶å€™è¦é¿å¼€é‚£äº›æ¥¼å±‚ã€‚è‡³äºæ¥¼æ ‹ä½ç½®ï¼Œä¸€èˆ¬éƒ½ä½“ç°åœ¨ä»·æ ¼ä¸Šäº†ï¼Œç½®ä¸šç»ç†éƒ½ä¼šä»‹ç»ã€‚ å¦‚æœé€‰æ‹©ä½å±‚çš„è¯ï¼Œæˆ–è€…ä½ çš„å·ç é ååªèƒ½ä¹°ä½å±‚ï¼Œçœ‹ä¸‹å…‰ç…§æ—¶é—´æµ‹è¯„ï¼ŒåŒä¸€æ ‹æ¥¼çš„ä¸åŒå•å…ƒçš„å…‰ç…§æ—¶é—´éƒ½ä¼šæœ‰æ‰€ä¸åŒçš„ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å‡¹å‡¸é€ å‹çš„æ¥¼é¢ã€‚æˆ‘è‡ªå·±çš„æˆ¿å­å°±æ˜¯å®¢å…é‡‡å…‰ä¸å¥½ï¼Œå§å®¤å¾ˆå¥½ã€‚ä¼˜å…ˆåº”è¯¥è€ƒè™‘å®¢å…é‡‡å…‰å¥½çš„æˆ·å‹ã€‚ ä¹°æˆ¿çš„æ—¶å€™å¦‚æœé¢„ç®—è¶³å¤Ÿï¼Œä¸€å®šä¹°è¾¹å¥—ï¼Œå› ä¸ºä¸­é—´å¥—çš„å°æˆ·å‹å®¢å…é‡‡å…‰å’Œéš”éŸ³ï¼ˆæ¥¼ä¸Šæ¥¼ä¸‹ç”µæ¢¯è¿‡é“çš„èµ°è·¯è¯´è¯å£°éƒ½ä¼šä»å¨æˆ¿æˆ–è€…å•æ‰€çª—æˆ·é—¯è¿›æ¥ï¼Œéå¸¸æ¸…æ™°ï¼‰ï¼Œå•æ‰€éšç§æ€§ç­‰éƒ½æœ‰å¾ˆå¤§é—®é¢˜ã€‚è¿™ç‚¹æ˜¯æˆ‘æœ€åæ‚”çš„ï¼Œå½“æ—¶ä¸çŸ¥é“ä¸­é—´å¥—å™ªéŸ³è¿™ä¹ˆå¤§è€Œä¸”é¦–ä»˜å€Ÿçš„å¤šæ€»æƒ³ç€æ€»ä»·ä½ä¸€äº›ã€‚å…¶å®éš”å£å¤¹è¾¹å¥—ï¼ˆä¸¤æ ‹æ¥¼è¿åœ¨ä¸€èµ·çš„è¾¹å¥—ï¼Œå—åŒ—é€šé€ä½†æ˜¯æ²¡æœ‰ä¾§é¢çª—ï¼‰æ‰å¤š 10 å¹³ï¼Œæ€»ä»·å¤š 25 ä¸‡è€Œå·²ï¼Œå®¢å…é‡‡å…‰ï¼Œç§å¯†æ€§éƒ½å¥½å¾ˆå¤šã€‚ å½“ç„¶è¾¹å¥—å¾ˆå¤šæ˜¯ 90 æ–¹ä»¥ä¸Šçš„ï¼Œé™¤äº†æ€»ä»·ï¼Œå¥‘ç¨å’Œå–å‡ºæ—¶å„ç§è´¹ç”¨ä¼šé«˜ 0.5% ä¸ªç‚¹ï¼Œè‡ªå·±é‡åŠ›è€Œè¡Œï¼Œå¦‚æœè¾¹å¥—/å¤¹è¾¹å¥—æ˜¯ 89 æ–¹çš„ï¼Œä¸è¦çŠ¹è±«ï¼Œæ€»ä»·å¤šä¸ªä¸‰äº”åä¸‡çš„æ¢æ¥çš„æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ä½“éªŒã€‚ å¦‚æœå°åŒºé è¿‘åœ°é“æˆ–è€…äº¤é€šæ¯”è¾ƒä¾¿åˆ©ï¼ŒæŠ•èµ„å®¢åˆæ¯”è¾ƒå¤šï¼Œå»ºè®®å¼€ç›˜ä¸è¦ä¹°è½¦ä½ï¼Œäº¤æˆ¿åä¼šæœ‰æŠ•èµ„å®¢æˆ–è€…å¼€å‘å•†æ‰“æŠ˜å–è½¦ä½ã€‚ è£…ä¿® å› ä¸ºé™ä»·ï¼Œæ­å·çš„æ–°æˆ¿ç²¾è£…ä¿®ç­‰äºæ¯›å¯ï¼Œæˆ‘è¿™ä¸ªäº¤ä»˜çš„æ—¶å€™æ²¡æœ‰ç©ºè°ƒï¼Œç¯è¿˜æ˜¯ç™½ç‚½ç¯ã€‚\nç¬¬ä¸€æ¬¡ä¹°æˆ¿åŠ¡å¿…è¯·ä¸€ä¸ªéªŒæˆ¿å¸ˆï¼Œæœ¯ä¸šæœ‰ä¸“æ”»ï¼Œåƒä¸‡ä¸è¦ç½‘ä¸Šçœ‹äº†ç‚¹æ”¶æˆ¿éªŒæˆ¿æ”»ç•¥å°±è‡ªä¿¡æ»¡æ»¡è‡ªå·±å»æ”¶æˆ¿ï¼Œç­‰åˆ°è£…ä¿®ä¸€åŠåˆå‘ç°ä¸€å †é—®é¢˜ã€‚ è£…ä¿®é¡ºåºå¾ˆé‡è¦ï¼Œä¼˜å…ˆè€ƒè™‘æ‰“å­”ï¼Œå¾ˆå¤šä¸šä¸»éƒ½æ˜¯è£…ä¿®å°¾å£°å»ä¹°ç©ºè°ƒï¼Œå®‰è£…æ—¶å‘ç°éœ€è¦é‡æ–°æ‰“å­”ï¼Œå¢™å¸ƒå·²ç»è´´å¥½äº†ï¼Œå¼„ç ´å¾ˆå¿ƒç–¼ã€‚è¿˜æœ‰ä¸šä¸»ç»™é˜³å°è´´äº†ç“·ç –ï¼ˆäº¤ä»˜æ˜¯ä¹³èƒ¶æ¼†ï¼‰ï¼Œä¹°äº†å¸¦æ–°é£çš„å®¢å…ç©ºè°ƒç®¡é“å¤ªå¤§éœ€è¦é‡æ–°æ‰“å­”ï¼Œä¸å°å¿ƒæ‰“ç ´æ°´ç®¡ï¼Œéœ€è¦é‡æ–°æ•²æ‰ 2 å—ç“·ç –ã€‚éå¸¸è´¹äº‹ã€‚ æ‹¿åˆ°æ°´ç”µå›¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰“å­”å’Œç‰©ä¸š (æˆ–è€…æˆ¿ä¿®) è¯´ä¸€å£°ï¼Œè®©ä»–ä»¬å‘Šè¯‰å“ªé‡Œæ‰“å­”ï¼Œè¿™æ ·æ‰“ç ´æ°´ç®¡è®©ä»–ä»¬ä¿®ã€‚ ç½‘ä¸Šä¹°å®¶ç”µä¸ä¸€å®šæ¯”å®ä½“åº—ä¾¿å®œï¼Œæˆ‘åœ¨å›½ç¾ä¹°äº†ç¾çš„ colmo çš„ç©ºè°ƒï¼Œæ¯”æ·˜å®æœ€ä¾¿å®œçš„è¿˜ä¾¿å®œä¸‰åƒã€‚ å¦‚æœä¸æ‡‚è®¾è®¡ï¼Œåƒä¸‡ä¸è¦ä¹±é€‰å¢™çš„é¢œè‰²ï¼Œè‡ªå·±å½“æ—¶æ™šä¸Šåœ¨ç¯å…‰ä¸‹é¢é€‰äº†ä¸€ä¸ªç°è“å¢™å¸ƒåšä¸»è‰²ï¼Œç»“æœæ–½å·¥å½“å¤©å‘ç°åœ¨æ—¥å…‰ä¸‹æ˜¯æ°´è“ï¼Œåªèƒ½æ–½å·¥å½“å¤©ä¸´æ—¶åŠ é’±æ¢é¢œè‰²ï¼Œè¿˜è€½è¯¯äº†è¿›åº¦ã€‚å¢™å¸ƒæ ·å“å› ä¸ºé¢ç§¯å°ï¼Œé¢œè‰²å’Œå®é™…ä¸Šå¢™æ•ˆæœç›¸å·®ç”šè¿œï¼Œæ—¥å…‰å’Œç¯å…‰ä¸‹ä¹Ÿä¸ä¸€æ ·ã€‚è€Œä¸”ï¼Œå¢™é¢çš„é¢œè‰²å¯¹äºåæœŸä¹°å®¶å…·ï¼Œæ²™å‘å’Œçª—å¸˜çš„å½±å“éå¸¸å¤§ã€‚æ²¡æœ‰åè¶³æŠŠæ¡çš„ç›´æ¥é€‰ç™½è‰²æˆ–è€…ææµ…ç°ã€‚é‡‡å…‰ç‰¹åˆ«å¥½çš„æ‰å»ºè®®é€‰æµ…ç°ï¼Œå› ä¸ºä¸Šå¢™åç°è‰²ä¼šå˜é‡ï¼ ä¼˜å…ˆè€ƒè™‘ä¹³èƒ¶æ¼†ï¼Œè‡ªå·±é€‰äº†ç¡…è—»æ³¥è´¨æ„Ÿçš„å¢™å¸ƒï¼Œç¡®å®è´¨æ„Ÿå¾ˆå¥½ï¼Œä¹Ÿå¥½çœ‹ã€‚ä½†æ˜¯æ„Ÿè§‰å®¹æ˜“ç§¯ç°ï¼Œè™½ç„¶é˜²æ°´ï¼Œä½†æ˜¯å¸ƒé¢ä¸å¹³å‡¹å¤„æ ¹æœ¬æ“¦ä¸æ‰ã€‚è€Œä¸”æ²¹æ¼†çš„ä¼˜åŠ¿è¿˜å¯ä»¥å•é¢å¢™ä¿®å¤ã€‚ ç°åœ¨éƒ½æ˜¯æ™ºèƒ½å®¶å…·ï¼Œé—¨é”å†°ç®±ç©ºè°ƒéƒ½æœ‰ appï¼Œæ‰‹æœºé¥æ§èŠèƒœäºæ— ï¼Œæ‰€ä»¥å®¶é‡Œå®½å¸¦å¯ä»¥æå‰å¼€é€šã€‚ å¦‚æœæ˜¯è‡ªå·±å¸ƒç½®å®¶å…·ï¼Œå»ºè®®ä¸è¦ç€æ€¥å®‰è£…é˜²å€’è£…ç½®ï¼Œç­‰å®¶å…·å…¨éƒ¨æ‘†æ”¾å®Œé€‚åº”å‡ å¤©å†å†³å®šï¼Œæå¤§å¯èƒ½ä¼šè°ƒæ•´å®¶å…·ä½ç½®ã€‚ 2021.11.11 è’¸æ±½æ‹–æŠŠæ¯«æ— ç”¨å¤„ï¼Œè’¸æ±½æ˜¯å‘ä¸Šçš„ï¼Œåœ°æ¿å¾ˆéš¾åŠ çƒ­ã€‚ä¹°ä¸€ä¸ªå¥½ç‚¹çš„æ‹–æŠŠï¼Œå¸¦æ°´æ¡¶çš„é‚£ç§å¯ä»¥æ–¹ä¾¿æ´—æŠ¹å¸ƒå’ŒæŒ¤å¹²çš„ã€‚ ä¹°ä¸œè¥¿è¦æœ‰é¢„ç®—ï¼Œä¹° colmo å’Œå¢™å¸ƒéƒ½æ˜¯ä¸¥é‡è¶…é¢„ç®—çš„ã€‚å–å®¶å¾ˆå¿ƒæœºåœ°ä»‹ç»è´µçš„ï¼Œä¸€ä¸Šæ‰‹è´¨æ„Ÿç¡®å®ä¸ä¸€æ ·ã€‚é¢„ç®—å°±æ˜¯è¿™ä¹ˆè¶…çš„ã€‚ ä¹°ä¸€äº›ç±³ç®±ï¼Œä¿é²œç›’ï¼Œç½®ç‰©æ¶ã€‚å¨æˆ¿æ˜¯æœ€éš¾æ”¶æ‹¾çš„ï¼Œç¬¬ä¸€æ­¥å°½é‡ä¿è¯ä¸è¦æŠŠè¶…å¸‚çš„ä¸œè¥¿è¿ç€å¡‘æ–™è¢‹æ”¾è¿›å†°ç®±/æŸœå­ã€‚åªæœ‰è¿™æ ·åç»­æ‰èƒ½ä¸ä¹±ã€‚ æå‰è§„åˆ’ä¸€ä¸ªå·¥å…·é—´ï¼Œç›®å‰å®¶é‡Œæœ‰æˆ´æ£®ï¼Œæ‹–æŠŠï¼Œæ‰«æŠŠç•šæ–—ï¼Œå°±å·²ç»ä¹±æ”¾äº†ï¼Œæˆ´æ£®æ²¡åœ°æ–¹æŒ‚ç€å……ç”µæ¯æ¬¡æ‰£ç”µæ± å……ç”µã€‚è¿˜æœ‰èºä¸åˆ€ï¼Œé”¤å­ï¼Œæ‰³æ‰‹ç­‰åˆ°å¤„ä¹±æ‰”ã€‚ å¾ˆå¤šäººå®‰è£…ç”µåŠ¨å‡é™æ™¾è¡£æ¶ï¼Œé‚£ç©æ„å¾ˆå®¹æ˜“åï¼Œè€Œä¸”é˜³å°æŒ‚æ»¡è¡£æœéå¸¸ä¸å¥½çœ‹ã€‚æˆ‘æ˜¯ä¹°äº†ä¸€ä¸ªä¼¸ç¼©æ†å¡åœ¨é˜³å°ä¾§é¢ï¼ŒåŒæ—¶ä¹°äº†çƒ˜å¹²æœºã€‚ç°åœ¨ä¸¤ä¸ªäººä½åŸºæœ¬ä¸ç”¨çƒ˜å¹²æœºï¼Œæ•´ä½“é˜³å°ä¼šå¥½çœ‹å¾ˆå¤šã€‚ é¤æ¡Œé…å¥—çš„æ¤…å­ä¸è¦ä¹°ç‰›è§’æ¤…ã€‚ç‰›è§’æ¤…æ˜¯çœ‹å¥½ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿ä¾§åï¼Œæ—¥å¸¸ä½¿ç”¨åè€Œé—¹å¿ƒï¼Œç›´æ¬¾é èƒŒå°±æŒºå¥½çš„ã€‚ æ— è®ºé ä¸é å¢™ï¼Œä¹°é èƒŒè¾ƒä½çš„é‚£ç§æ²™å‘ï¼Œåƒç¾å‰§é‚£ç§ä¸é å¢™çš„ä½æ²™å‘æœ‰åˆ©äºå¢å¤§ç©ºé—´ï¼Œæ–¹ä¾¿äº¤æµï¼Œå¶å°”è¿˜èƒ½ç§»åŠ¨æ²™å‘æ¢ä¸ªå¸ƒå±€ã€‚ æ™®é€šå®¶åº­ä¸è¦å®‰è£…ç»ç’ƒé—¨çš„é¤è¾¹æŸœï¼Œæ¯«æ— ç¾æ„Ÿã€‚å°åŒºé‡Œé¢è§è¿‡å¤ªå¤šçš„å¤±è´¥çš„è®¾è®¡ã€‚ä¹Ÿä¸è¦è£…åŠç¯ï¼Œå ç”¨ç©ºé—´ï¼Œå¸é¡¶ç¯å°±å¾ˆå¥½ã€‚å¦‚æœç¡®å®æœ‰ç¯å…‰éœ€æ±‚ï¼Œå»ºè®®è‡ªå·±ç ”ç©¶ç¯å¸¦ï¼Œè€Œä¸æ˜¯ä¹°åŠç¯ã€‚ è¿˜æ˜¯å†è¯´ä¸‹é¢œè‰²æ­é…ï¼Œå¦‚æœä¸æ˜¯å…¨å±‹å®šåˆ¶ï¼Œé¢œè‰²çœŸçš„å¾ˆéš¾æ­é…çš„ã€‚é¦–å…ˆå¢™å¸ƒå’Œé¤è¾¹æŸœé—¨å°½é‡é€‰ç™¾æ­ç™½è‰²ï¼ˆå—åŒ—é€šé€æœ‰å¤§é£˜çª—é‡‡å…‰æå¥½çš„å¯ä»¥é€‰æ·¡ç°ï¼‰ï¼Œè¿™æ ·èƒ½ç»™æ²™å‘é¤æ¡Œä¹¦æŸœç”µè§†æŸœçª—å¸˜ç­‰ç•™ä¸‹é¢œè‰²é€‰æ‹©ä½™åœ°ã€‚å®¢å…é¢œè‰²å°½é‡å°‘ä¸€ç‚¹ï¼Œæˆ‘è‡ªå·±æ˜¯é¤æ¡Œä¹¦æŸœæ²™å‘æ˜¯æ·±è‰²ï¼ˆæ·±æ£•å’Œæ·±è“ç°ï¼‰ï¼Œçª—å¸˜æ˜¯ä¸»ç° + é»„è‰²ï¼Œé¤å…åŠç¯ç½©æ˜¯ç‰›æ²¹æœç»¿å’Œé»‘è‰²ã€é»„è‰²ã€‚ ","title":"ä¹°æˆ¿è£…ä¿®æ€»ç»“","uri":"/post/hangzhou-house-tip/"},{"content":"å…³äº rust trait éå¸¸å¥½çš„ä»‹ç»ï¼Œæ¯” rust book è¯¦ç»†ï¼Œç³»ç»Ÿã€‚ Tour of Rustâ€™s Standard Library Traits Table of Contents Tour of Rustâ€™s Standard Library Traits Intro Trait Basics Trait Items Self Functions Methods Associated Types Generic Parameters Generic Types vs Associated Types Scope Derive Macros Default Impls Generic Blanket Impls Subtraits \u0026 Supertraits Trait Objects Marker Traits Auto Traits Unsafe Traits Auto Traits Send \u0026 Sync Sized General traits Default Clone Copy Any Formatting Traits Display \u0026 ToString Debug Operator Traits Comparison Traits PartialEq \u0026 Eq Hash PartialOrd \u0026 Ord Arithmetic Traits Add \u0026 AddAssign Closure Traits FnOnce, FnMut, \u0026 Fn Other Traits Deref \u0026 DerefMut Index \u0026 IndexMut Drop Conversion Traits From \u0026 Into Error Handling Error Conversion Traits Continued TryFrom \u0026 TryInto FromStr AsRef \u0026 AsMut Borrow \u0026 BorrowMut ToOwned Iteration Traits Iterator IntoIterator FromIterator I/O Traits Read \u0026 Write Conclusion Discuss Notifications Further Reading Intro Have you ever wondered whatâ€™s the difference between: Deref","title":"Tour of Rusts Standard Library Traits[ç¿»è¯‘]","uri":"/post/rust-standard-library-traits-tour/"},{"content":"è°·æ­Œ AI è´Ÿè´£äºº norvig åœ¨ 07 å¹´å†™çš„å¦‚ä½•å®ç°ä¸€ä¸ªæ‹¼å†™çº æ­£å™¨çš„ç»å…¸åšæ–‡How to Write a Spelling Corrector.\nä¸Šé¢çš„é“¾æ¥å·²ç»æ˜¯ 16 å¹´æ›´æ–°è¿‡äº†ï¼Œç¨‹åºä¹Ÿæ›´æ–°åˆ°äº† python3.\nä¸­æ–‡ç‰ˆçš„ç¿»è¯‘ å¦‚ä½•å®ç°ä¸€ä¸ªæ‹¼å†™çº æ­£å™¨ è¿˜æ˜¯åŸºäº 07 å¹´ç‰ˆæœ¬çš„ã€‚\nåšæ–‡æœ€æœ‰æ„æ€çš„åœ°æ–¹æ˜¯å¤§ç‰›è®°å½•äº†å¦‚ä½•åœ¨é£æœºä¸Šé¢æ²¡æœ‰ç½‘ç»œçš„æ¡ä»¶ä¸‹å¾’æ‰‹å†™ä¸€ä¸ªå‡†ç¡®ç‡è¶…è¿‡ 70% çš„æ‹¼å†™çº æ­£å™¨ã€‚\n","title":"Python å¦‚ä½•å®ç°ä¸€ä¸ªæ‹¼å†™æ£€æŸ¥å™¨[ç¿»è¯‘]","uri":"/post/python-spell-correct/"},{"content":"Associated Type and generic diff in rust type outside impl a type Foo = Bar outside is just type alias. most used in generic type. like: type Thunk = Box","title":"Associated Type in Rust","uri":"/post/rust-associated-types/"},{"content":"ä¸ªäººå¯¹äºç¼–ç¨‹å­—ä½“æœ‰ä¸€ç‚¹ç‚¹æ´ç™–ï¼Œåœ¨å°è¯•åå‡ ä¸ªå­—ä½“åï¼Œç»ˆäºä½¿ç”¨ FontForge å’Œ fontline.py åŠ¨æ‰‹ä¿®æ”¹åˆ¶ä½œè‡ªå·±çš„ç¼–ç¨‹å­—ä½“:Aurulent å’Œ Fira Codeã€‚ Aurulent å­—ä½“ä¸‹è½½ å°å†™å­—æ¯æ¥è‡ª Aurulent Sans Monoï¼Œå…¶ä»–åŸºäº Fira Code.Aurulent Sans Mono é£æ ¼å’Œ SourceCodePro éå¸¸åƒï¼Œèƒ–å®½å‹ï¼Œå¤§å¼€å¤§åˆï¼Œç®€å•å´æœ‰å…·æœ‰è®¾è®¡ï¼Œç‰¹åˆ«æ˜¯å­—ç¬¦ gï¼Œaï¼Œpï¼Œyï¼Œsã€‚ å­—æ¯ r çš„æ€è·¯æ¥è‡ªgintronic. ä¼˜ç‚¹æ˜¯åœ¨ä½åˆ†è¾¨ç‡å±ï¼Œr çš„æœ«å°¾ä¸ä¼šè¢« hint åªå‰©ä¸‹å°–å°–ã€‚ é—®å·ï¼Ÿä¹Ÿæ¥è‡ª gintronic å­—ä½“ï¼Œéå¸¸æ¼‚äº®ã€‚ Aurulent æ•ˆæœ Fira Code Fira Code æ˜¯å…¨ç½‘æœ€å—æ¬¢è¿çš„å­—ä½“ï¼Œä½†æ˜¯è¿™ä¸ª r å®åœ¨è¿‡äº fancyï¼Œæ‰€ä»¥é‡æ–°æ„å»ºäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œåªæä¾› regular å’Œ bold ä¸¤ä¸ªå­—é‡ MonoLisa ç›®å‰åœ¨ç”¨ä¹Ÿæ˜¯æœ€å–œæ¬¢çš„æ”¶è´¹å­—ä½“ï¼Œ MonoLisaå®Œç¾ä½“ç°äº†å®˜ç½‘ä¸Šé¢çš„\"font follows function\"å®£è¨€ï¼Œæ•´ä¸ªå­—ä½“åœ¨ä»£ç é˜…è¯»ä¸­æœ‰ä¸€ç§ä»å·¦åˆ°å³çš„æµåŠ¨æ„Ÿã€‚ä¹Ÿæ˜¯è‡ªå·±ç¬¬äºŒæ¬¡ä»˜è´¹å­—ä½“ (ç¬¬ä¸€æ¬¡æ˜¯æ–¹æ­£) å”¯ä¸€ä¸è¶³çš„æ˜¯å’Œ fira code ç›¸æ¯”ï¼Œå¼€å‘è€…åœ¨ hint æ–¹é¢ä¸å¤ªè¡Œï¼Œæ¯ä¸ªç‰ˆæœ¬æ€»æ˜¯ä¼šæœ‰ä¸€äº› hint é—®é¢˜ï¼Œåœ¨é 4K æ˜¾ç¤ºå™¨ä¸Šé¢æ•ˆæœä¼šå¾ˆç³Ÿç³•ï¼Œä¾‹å¦‚\"=\u003eâ€œçš„ç­‰å·ä¼šæ˜æ˜¾ä¸Šä¸‹ç²—ç»†ä¸ä¸€è‡´ã€‚å› ä¸ºè‡ªå·±éƒ½æ˜¯ 4K æ˜¾ç¤ºå™¨ï¼Œå¹²è„†å°±ä½¿ç”¨ fontforge è¿›è¡Œ dehint å¤„ç†ã€‚ å…¶ä»–ç¼–ç¨‹å­—ä½“ ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„å­—ä½“æœ‰ SourceCodeProï¼Œåªæ˜¯è¿™ä¸ª r åœ¨ä½åˆ†è¾¨ç‡ä¸‹ä¸€å¡Œç³Šæ¶‚ï¼Œç»“åˆ office code pro åšäº†ä¸€ä¸ªæ›´é€‚åˆæ­£æ–‡çš„SourceCodePro ç‰ˆæœ¬ Adobe LetterGothicï¼šè¿™æ˜¯ä¸€ä¸ªç»å…¸çš„ IBM æ‰“å­—æœºå­—ä½“ã€‚è¿™ä¸ªå­—ä½“ç»å…¸åœ¨äºå­—ç¬¦ r æ˜¯æˆ‘è®¤ä¸ºæ‰€æœ‰å­—ä½“é‡Œé¢è®¾è®¡çš„æœ€æ¼‚äº®çš„ï¼Œåœ¨å­—ä½“è®¾è®¡ä¸­ï¼Œæ„Ÿè§‰ r æ˜¯æœ€éš¾è®¾è®¡çš„ï¼Œåƒ fira code è¿™ç§ rï¼Œæœ‰ç‚¹è¿‡äº fancyï¼Œå¾ˆå®¹æ˜“å¸å¼•ä½ çš„ç›®å…‰; åƒ source code pro é‚£ç§è¶…çº§ç®€æ´ï¼Œåœ¨ win ä¸‹é¢æ¸²æŸ“é™¤éæ˜¯é«˜åˆ†å±ï¼Œå¦åˆ™ä¸€å¡Œç³Šæ¶‚ã€‚é™¤äº†å­—ç¬¦ rï¼Œletter gothic ä½œä¸º 1960 æ—¶ä»£æ‰“å­—æœºé»˜è®¤å­—ä½“ä¹‹ä¸€ï¼Œåœ¨å­—ç¬¦ nï¼Œu çš„è§’ä¸Šï¼Œéƒ½ä¿ç•™äº†éå¸¸æ¼‚äº®è€Œå«è“„çš„ç»†èŠ‚ï¼Œè¿™ä¸€ç‚¹ï¼Œæˆ‘éå¸¸åæ§½ jetbrains mono å­—ä½“ï¼Œå±…ç„¶æŠŠå°å†™ u çš„å°¾å·´å»æ‰ï¼Œå£°ç§°å¯ä»¥åŠ å¿«é˜…è¯»ï¼Œæˆ–è®¸èƒ½æé€Ÿï¼Œä½†æ˜¯ä¸¢äº†ç¾æ„Ÿã€‚LetterGothic å…·ä½“çš„æ•ˆæœçœ‹æˆ‘ä¹‹å‰çš„æ¨æ–‡ Thread. TheSansMono: ç»å…¸ç­‰å®½å­—ä½“ã€‚ä½ å¯ä»¥åœ¨å¾ˆå¤šä¹¦ä¸Šé¢çœ‹åˆ°è¿™ä¸ªå­—ä½“ã€‚æ–œä½“æ˜¯æ‰€æœ‰å­—ä½“æœ€å¥½çœ‹çš„ï¼Œæ”¶è´¹ï¼Œä½œè€…ä¹Ÿæ˜¯ windows ç»å…¸çš„ä»£ç å­—ä½“ Consolas ä½œè€…ã€‚ Letter Gothic æ•ˆæœ éç¼–ç¨‹è‹±æ–‡å­—ä½“æ¨è Sans ç±» ä¸€èˆ¬é»‘ä½“ä¸­æ–‡é€‚åˆæ­é… Sans è‹±æ–‡å­—ä½“ï¼Œæ¨èç»å…¸çš„ Open Sansï¼ŒInterï¼ŒLatoï¼ŒFira Sansã€‚Inter é£å¤´æ­£ç››ï¼Œå¾ˆå¤šç½‘ç«™åŒ…æ‹¬ 2023 çš„ jetbrains IDE UI å­—ä½“éƒ½æ¢æˆè¿™ä¸ªäº†ï¼Œç‰¹ç‚¹å°±æ˜¯æ²¡æœ‰ä»»ä½•ç‰¹è‰²ã€‚ä¸ªäººè®¤ä¸º Lato è®¾è®¡ç»†èŠ‚æœ€ä½³ï¼Œä½†ç¡®å®ä¸é€‚åˆç”¨äº UIï¼Œä½†æ˜¯åœ¨ç½‘ç«™æ­£æ–‡ä¸­ä½¿ç”¨éå¸¸ä¸é”™ã€‚ æ”¶è´¹å­—ä½“ä¸­Sana Sansåœ¨æ­£æ–‡ä¸­æ•ˆæœä¹Ÿä¸é”™ï¼Œæ’­å®¢ç½‘ç«™ changelog ç”¨çš„å°±æ˜¯è¿™ä¸ªå­—ä½“ã€‚ Serif ç±» ä¸€èˆ¬å®‹ä½“ä¸­æ–‡é€‚åˆæ­é…è¡¬çº¿è‹±æ–‡å­—ä½“ï¼Œæ¨è Palatino å’Œ Merriweatherï¼Œåè€…æ˜¯ google font ä¸Šé¢æ’åç¬¬ä¸€çš„ serif å­—ä½“ï¼Œç¼ºç‚¹æ˜¯å­—ä½“åç²—ã€‚ æ‰‹å†™ä½“ å¤§éƒ¨åˆ†æ‰‹å†™ä½“éƒ½ä¸é€‚åˆé˜…è¯»ï¼Œä½†æ˜¯Alegreya Sansæ–œä½“æ¯”è¾ƒåˆé€‚ï¼Œåœ¨æ‰‹å†™é£æ ¼å’Œå¯è¯»æ€§è¾¾åˆ°è¾ƒå¥½å¹³è¡¡ã€‚ ","title":"ä¸€äº›è‹±æ–‡å­—ä½“æ¨è","uri":"/post/programming-fonts/"},{"content":"Ian å®‰å…¨ç»“æ˜¯ç™»å±±ç³»é‹å¸¦çš„é¦–é€‰ï¼Œå®ƒè¶Šç©¿è¶Šç´§ï¼Œä¸ä¼šæ¾å¼€ã€‚è§£é‹å¸¦è½»è½»ä¸€æ‹‰å³å¼€ã€‚è€Œä¸”å¯¹ç§°ç¾è§‚ï¼Œä¸Šæ‰‹ç®€å•ã€‚å€¼å¾—æ¯ä¸ªäººèŠ±ååˆ†é’Ÿå­¦ä¹ ã€‚\næœ¬ç¯‡ä¸ä»…ç»™å‡º Ian å®‰å…¨ç»“ç¤ºæ„å›¾ï¼Œè¿˜å‘Šè¯‰å¤§å®¶å¦‚ä½•è®©å®‰å…¨ç»“å’Œè´è¶ç»“æ°´å¹³å¯¹ç§°ï¼Œå°½å¯èƒ½ç¾è§‚çš„ç§˜è¯€ã€‚\nä»¥ä¸Šæ˜¯ Ian ç»“çš„æ­¥éª¤ã€‚ä¸‹é¢æ˜¯é‡ç‚¹ï¼š\næ— è®ºæ˜¯ Ian è´è¶ç»“è¿˜æ˜¯å®‰å…¨ç»“ï¼Œå¦‚æœä½ å‘ç°è‡ªå·±çš„é‹å¸¦ç³»å®Œæ˜¯æ–œçš„è€Œéæ°´å¹³ï¼ŒåŸå› æ˜¯ç¬¬ä¸€ä¸ªè¾…åŠ©ç»“å’Œç¬¬äºŒä¸ªç»“ä¸Šä¸‹å…³ç³»åäº†ã€‚å³å›¾ 1 çš„é‚£ä¸ªç»“æ˜¯è¾…åŠ©ç»“ï¼Œé»„è‰²åœ¨ä¸Šï¼Œè“è‰²åœ¨ä¸‹ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªç»“å¿…é¡»å’Œå›¾ 2 ä¸­ä¸€æ ·ï¼Œé»„è‰²åœ¨ä¸Šï¼Œè“è‰²åœ¨ä¸‹ï¼Œå¦‚æœä½ åœ¨ç¬¬äºŒæ­¥é»„è“åäº†ï¼Œæœ€åæˆç»“å°±æ˜¯æ–œçš„!!! è¿™æ˜¯æˆ‘æ¯•ç”Ÿç»å­¦äº†ã€‚\nIan å®‰å…¨ç»“æƒ³è¦å¥½çœ‹çš„è¯€çªåœ¨äºï¼Œåœ¨å¿«è¦æ‹‰ç´§ç»³ç»“ä¹‹å‰ï¼Œå…ˆæ‹‰ä½é‹å¸¦ä¸¤ç«¯æ¾ä¸€ä¸‹ç»“ï¼Œå‡è£…è¦æ‰¯å¼€é‹å¸¦ï¼Œè¿™æ ·å®‰å…¨ç»“å†…éƒ¨ä¼šå˜æ•´é½ï¼Œç„¶åæŠ“ä½ 8 å­—ç¯ä¸¤ç«¯æ‹‰ç´§é‹å¸¦ã€‚æ³¨æ„ï¼Œæ˜¯å¿«è¦æ‹‰ç´§ä¹‹å‰æ‰¯æ¾ä¸€ä¸‹ï¼Œæ‰¯çš„æ—¶å€™ç»³ç»“åº”è¯¥å·²ç»æœ‰ç‚¹æ‘©æ“¦äº†ï¼Œå¤ªæ¾äº†å¤–æ‰¯æ•´ç†ä¸åˆ°ç»“çš„å†…éƒ¨ï¼Œå¤ªç´§äº†å¤–æ‰¯ç»“ä¹Ÿä¸ä¼šæ”¹å˜å½¢çŠ¶äº†ï¼Œå°±æ˜¯æ‹‰ç´§ä¹‹å‰åå¤æ•´ç†ä¸€ä¸‹ï¼Œæ³¨æ„ï¼Œå¦‚æœè¿™é‡Œä½ è¾…åŠ©ç»“ä¸Šä¸‹å…³ç³»é”™äº†ï¼Œæœ€åå¾ˆéš¾æ•´ç†å‡ºæ¥æ»¡æ„çš„æ•ˆæœã€‚æœ€åçš„æ•ˆæœåº”è¯¥æ˜¯æœ€åä¸€å¹…å›¾çš„æ•ˆæœï¼Œè€Œä¸æ˜¯ç¬¬ä¸€å¹…çš„å›¾ 6 é‚£ä¹ˆä¸‘çš„ã€‚\nä½œè€…ï¼šzhimoe\né“¾æ¥ï¼šhttps://www.zhihu.com/question/19728687/answer/501699533\nè¡¥å……ï¼š\nå®é™…ä¸Š Ian ç»“å°±æ˜¯æ™®é€šçš„è´è¶ç»“ï¼Œä¹Ÿæ˜¯ç›®å‰æœ€å¿«çš„ç³»é‹å¸¦æ–¹æ³•ï¼Œç¼ºç‚¹å°±æ˜¯ä¼šæ¾åŠ¨ã€‚è€Œ Ian å®‰å…¨ç»“å­¦åæ˜¯åŒæ‰“ç»“ï¼ˆDouble Slip Knotï¼‰ã€‚\nè¿™é‡Œæœ‰Ian ç»“å‘æ˜è€…çš„å®˜æ–¹ç½‘ç«™ï¼Œé‡Œé¢æœ‰è¶…çº§å¤šç³»é‹å¸¦æ–¹æ³•ï¼Œæˆ‘åœ¨ 25 å²ä¹‹å‰éƒ½æ˜¯ç”¨çš„è´è¶ç»“ï¼Œå­¦ä¼šå®‰å…¨ç»“ä¹‹åå°±å†ä¹Ÿæ²¡æœ‰æ¾é‹å¸¦çš„çƒ¦æ¼äº†ã€‚\n","title":"å¦‚ä½•æ­£ç¡®åœ°ç³»é‹å¸¦","uri":"/post/how-to-tie-shoelace/"},{"content":"é—®é¢˜ Java æ˜¯ OOP è¯­è¨€ï¼Œä½¿ç”¨å¯¹è±¡å°è£…ã€‚ç”±äºå‡½æ•°ä¸æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ— æ³•åœ¨æ–¹æ³•ä¸­ä¼ é€’å‡½æ•°/æ–¹æ³•ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œä½¿ç”¨åŒ¿åç±»è¡¨ç¤ºè¡Œä¸ºï¼š // ç›‘å¬å™¨æ¥å£ public interface ActionListener { void actionPerformed(ActionEvent e); } // ä½¿ç”¨åŒ¿åç±»ä¼ é€’ä¸€ä¸ªè¡Œä¸º button.addActionListener(new ActionListener(){ public void actionPerformed(Event e){ System.out.println(\"button clicked\"); } }); ä¸Šé¢çš„ä»£ç ä¸»è¦çš„é—®é¢˜åœ¨äºaddActionListeneræ–¹æ³•æœŸæœ›çš„æ˜¯ä¸€ä¸ªè¡Œä¸ºï¼Œä¸ºäº†æè¿°è¿™ä¸ªè¡Œä¸ºï¼ˆä»£ç å³æ•°æ®çš„æ¦‚å¿µï¼‰,åœ¨ Java ä¸­ä¸å¾—ä¸ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ã€‚é™¤äº†ä»£ç å†—ä½™ï¼Œè¿˜å­˜åœ¨ä¸‹é¢é—®é¢˜ ä¸šåŠ¡é€»è¾‘æ·¹æ²¡åœ¨åŒ¿åç±»è¯­æ³•ä¸­ï¼Œå°±åƒ Go è¯­è¨€çš„if err != nilä¸€æ · åŒ¿åç±»ä¸­çš„ this å’Œå˜é‡åå®¹æ˜“ä½¿äººäº§ç”Ÿè¯¯è§£ ç±»å‹è½½å…¥å’Œå®ä¾‹åˆ›å»ºè¯­ä¹‰ä¸å¤Ÿçµæ´» æ— æ³•æ•è·é final çš„å±€éƒ¨å˜é‡ lambda è¡¨è¾¾å¼ ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼ŒJava8 æ¨å‡ºäº† lambda è¡¨è¾¾å¼â€”â€”å½“æ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•æ—¶ï¼Œç§°ä¸ºå‡½æ•°å¼æ¥å£ï¼ˆä¹Ÿå«å•æŠ½è±¡æ–¹æ³•ç±»å‹ï¼ŒSAM ç±»å‹ï¼‰,å¯ä»¥ä½¿ç”¨ lambda è¡¨è¾¾å¼è¡¨ç¤ºè¿™ä¸ªæ¥å£çš„å®ç°æ–¹æ³•ã€‚ button.addActionListener(e -\u003e System.out.println(\"button clicked\")); å…¶ä¸­çš„eæ˜¯actionPerformed(Event e)æ–¹æ³•çš„å‚æ•°ï¼Œ-\u003e åé¢çš„æ˜¯æ–¹æ³•ä½“ã€‚æ³¨æ„è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æä¾› e çš„ç±»å‹ï¼Œè¿™æ˜¯ç”±ç±»å‹æ¨å¯¼æŠ€æœ¯å®ç°çš„â€”â€”javac æ ¹æ®addActionListeneræ–¹æ³•ç­¾åå’ŒactionPerformedæ–¹æ³•ç­¾åæ¨å¯¼å‡ºå‚æ•°ç±»å‹åªèƒ½æ˜¯Event. ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½å¯ä»¥çœç•¥ç±»å‹ï¼Œä½†æ˜¯è¯·ç»™ IDE è¡¨ç°æœºä¼šï¼Œåªæœ‰åœ¨ IDE æé†’ä½ æœ‰é”™è¯¯æ—¶å†è¡¥å……ä¸Šç±»å‹ä¿¡æ¯ã€‚ ä¸‹é¢éƒ½æ˜¯åˆæ³•çš„ lambda è¡¨è¾¾å¼ï¼š Runnable tsk = () -\u003e println(\"\"); Runnable tsk = name -\u003e { println(name);} BinaryOperator add = (Long x, Long y) -\u003e x + y; BinaryOperator add = (x, y) -\u003e {return x + y;} //ç±»å‹æ¨æ–­ï¼Œreturn å’Œ{}æ˜¯å†—ä½™çš„ // // 1. å‚æ•° ()ï¼šæ— å‚æ•°ä½¿ç”¨ (),1 ä¸ªå‚æ•°å¯ä»¥çœç•¥æ‹¬å·ï¼Œå…¶ä»–ä½¿ç”¨ (). // 2. å‡½æ•°ä½“{}ï¼šå•è¯­å¥çš„å¯ä»¥çœç•¥{},å¤šæ¡è¯­å¥å¿…é¡»æœ‰{} åœ¨ Java ä¸­ï¼Œå·²ç»æœ‰å¤§é‡çš„å‡½æ•°å¼æ¥å£ï¼š java.lang.Runnable java.util.concurrent.Callable java.security.PrivilegedAction java.util.Comparator java.io.FileFilter java.beans.PropertyChangeListener this æŒ‡å‘è°ƒç”¨è€…ï¼Œä¹Ÿå³æ˜¯ button lambda çš„ç±»å‹æ˜¯æ ¹æ®ä¸Šä¸‹æ–‡æ¥å†³å®šçš„ï¼Œæ‰€ä»¥ç›¸åŒå…¥å‚å’Œè¿”å›å€¼æƒ…å†µä¸‹ï¼Œç›®æ ‡ç±»å‹å¯èƒ½ä¸åŒï¼Œåœ¨æ— æ³•åˆ¤æ–­æ—¶ï¼Œéœ€è¦è¡¥å……ç›®æ ‡ç±»å‹ä¿¡æ¯ï¼š Callable c = () -\u003e \"done\"; PrivilegedAction a = () -\u003e \"done\"; // error var add = (Long x, Long y) -\u003e x + y; // è¿™é‡Œ add ä¼šæŠ¥é”™ï¼š // java: cannot infer type for local variable add // (lambda expression needs an explicit target-type) // å› ä¸ºæ»¡è¶³ (Long, Long) -\u003e Long çš„å‡½æ•°å¼æ¥å£å¾ˆå¤šï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“ add ç›®æ ‡ç±»å‹åº”è¯¥æ˜¯ä»€ä¹ˆã€‚ å½“æ¶‰åŠåˆ°æ³›å‹æ—¶ï¼Œç±»å‹æ¨å¯¼æ€»æ˜¯æœ‰ç‚¹åŠ›ä¸ä»å¿ƒï¼Œéœ€è¦æ·»åŠ å¿…è¦çš„ç±»å‹ä¿¡æ¯ï¼š å‡½æ•°å¼æ¥å£ä¸@FunctionalInterface æœ‰äº† lambda å’Œå‡½æ•°å¼æ¥å£ï¼Œæ¡†æ¶æ–¹æ³•åœ¨å½¢å‚ç±»å‹ä¸Šé¢å¯ä»¥æ›´åŠ æ³›åŒ–äº†ã€‚ä¾‹å¦‚ä½ å¸Œæœ›ä½ çš„æ¡†æ¶æ–¹æ³•æ”¯æŒä¸€ä¸ª T-\u003eR çš„æ“ä½œï¼Œä½ å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ª @FunctionalInterface public interface Transfer { R apply(T t); } è¿™é‡Œ T,R æ˜¯æ³›å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ³›åŒ–çš„å‡½æ•°å¼æ¥å£ã€‚æ‰€ä»¥ Java8 åœ¨ util.function åŒ…ä¸­æ–°å¢äº† 43 ä¸ªå‡½æ•°å¼æ¥å£ï¼Œç›®çš„å°±æ˜¯æ–¹ä¾¿æ¡†æ¶å¼€å‘è€…èƒ½å¤Ÿå‡å°‘æ–°å»ºè‡ªå·±çš„ FunctionalInterface. åŸºç¡€çš„æ¥å£åªæœ‰ 6 ä¸ªï¼š æ¥å£ å‡½æ•°ç­¾å ä¸¾ä¾‹ UnaryOperator R apply(T t); String::toLocaerCase BinaryOperator R apply(T t, U u); BigInterger::add Predicate boolean test(T t); Collection::isEmpty Function R apply(T t); Arrays::asList Supplier T get(); Instant::now Consumer void accept(T t); System.out::println ä¸Šé¢çš„æ˜¯åŸºç¡€æ¥å£ï¼Œæ­¤å¤–è¿˜æœ‰ï¼š Consumer, Function, Predicate å„è‡ªæœ‰ä¸€ä¸ª 2 ä¸ªå…¥å‚çš„ç‰ˆæœ¬ï¼Œå…± 3 ä¸ª:BiConsumer,BiFunction,BiPredicate. 6 ä¸ªåŸºç¡€æ¥å£å¯¹åº”å…¥å‚ä¸ºåŸºæœ¬ç±»å‹ int,long,double çš„æ¥å£ï¼Œå…± 18 ä¸ª:IntSupplier,LongFunctionâ€¦ 6 ä¸ªåŸºç¡€æ¥å£å¯¹åº”è¿”å›å€¼ä¸ºåŸºæœ¬ç±»å‹ int,long,double çš„ Function å’Œ BiFunctionï¼Œå…± 6 ä¸ªï¼šToIntBiFunction,ToIntFunctionâ€¦ int,long,double åŸºæœ¬ç±»å‹äº’è½¬çš„ Function å…± 6 ä¸ªï¼šDoubleToIntFunction,DoubleToLongFunction,IntToDoubleFunction,IntToLongFuncion,LongToDoubleFunction,LongToIntFunction. Consumer æœ‰åŒæ—¶æ¥å—ä¸€ä¸ª Object å’Œä¸€ä¸ªåŸºæœ¬ç±»å‹çš„ç‰ˆæœ¬ï¼Œå…± 3 ä¸ªï¼šObjDoubleConsumer{void accept(T t, int value);} æœ€åè¿˜æœ‰ä¸€ä¸ª BooleanSupplier{boolean getAsBoolean();} ç¬¬ä¸€æ¬¡è§åˆ° BooleanSupplier å¯èƒ½å®Œå…¨ä¸çŸ¥é“ä½¿ç”¨åœºæ™¯ï¼Œæ¯•ç«Ÿæœ‰ Supplierä¸å°±å¯ä»¥äº†ä¹ˆï¼Ÿ ä¸Šé¢çš„åŸºç¡€æ¥å£è™½ç„¶éå¸¸é€šç”¨ï¼Œä½†æ˜¯å¦‚æœæœ‰æ›´å¥½çš„æ¥å£åç§°æ—¶ï¼Œåº”è¯¥ä½¿ç”¨æ›´åˆé€‚çš„é‚£ä¸ªã€‚ä¾‹å¦‚ Comparator{int compare(T o1, T o2);}å’Œ ToIntBiFunction {int applyAsInt(T t, U u);}ç­¾åå®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯è¿˜æ˜¯åœ¨æ¯”è¾ƒçš„æ—¶å€™ä½¿ç”¨ Comparator. åœ¨æ„å»ºè‡ªå·±çš„å‡½æ•°å¼æ¥å£æ—¶ï¼ŒåŠ¡å¿…ä½¿ç”¨æ³¨è§£@FunctionalInterfaceæ ‡æ³¨ä½ çš„æ¥å£ï¼Œè¿™æ ·å¯ä»¥ç»™ IDE lint å’Œä½¿ç”¨è€…æä¾›æ›´åŠ å……åˆ†ä¿¡æ¯ã€‚ æ–¹æ³•å¼•ç”¨ å¦‚æœ lambda è¡¨è¾¾å¼çš„æ–¹æ³•ä½“è¿‡é•¿ï¼Œé‚£ä¹ˆéœ€è¦æŠ½å–æ–¹æ³•ï¼ŒJava8 æä¾›äº†æ›´è¿‘ä¸€æ­¥çš„è¯­æ³•â€”â€”æ–¹æ³•å¼•ç”¨ã€‚æ–¹æ³•å¼•ç”¨è¡¨ç¤ºä¸€ä¸ª lambda è¡¨è¾¾å¼ã€‚åªéœ€è¦å¼•ç”¨çš„æ–¹æ³•ç­¾åå’Œ lambda ç›®æ ‡ç±»å‹çš„æŠ½è±¡æ–¹æ³•ç­¾åä¸€è‡´å³å¯ã€‚ æ–¹æ³•å¼•ç”¨ä¸€å…±æœ‰ 5 ç§ç±»å‹ï¼Œå…¶ä¸­ï¼Œé™æ€æ–¹æ³•æ˜¯æœ€å¸¸ç”¨çš„ç±»å‹ã€‚ æ–¹æ³•å¼•ç”¨ç±»å‹ æ–¹æ³•å¼•ç”¨ å¯¹åº” lambda è¡¨è¾¾å¼ é™æ€æ–¹æ³• Integer::parseInt str-\u003e Integer.parseInt(str) æœ‰é™åˆ¶ (Bound receiver) å®ä¾‹å¼•ç”¨ Instant.now()::isAfter Instant then = Instant.now(); then.isAfter(t) æ— é™åˆ¶ (Unbound receiver) å®ä¾‹å¼•ç”¨ String::toLowerCase str -\u003e str.toLowerCase ç±»æ„é€ å™¨ TreeMap::new ()-\u003e new TreeMap() æ•°ç»„æ„é€ å™¨ int[]::new len-\u003enew int[len] Bound receiver å…¶å®å¾ˆå¥½ç†è§£ï¼Œæ–¹æ³•çš„ receiver(ä¸Šé¢çš„ then = Instant.now()) æ˜¯å›ºå®šçš„ã€‚ Unbound receiver çš„å«ä¹‰æ˜¯æ–¹æ³•çš„æ¥æ”¶è€… (ä¸Šé¢çš„ str) æ˜¯ä¸ç¡®å®šçš„ï¼Œé€šè¿‡å…¥å‚çš„å½¢å¼ä¼ å…¥ã€‚è€Œåœ¨æ–¹æ³•å¼•ç”¨çš„å½¢å¼ä¸Šé¢åè€Œåƒé™æ€æ–¹æ³•å¼•ç”¨ (String::toLowerCase, toLowerCase ä¸æ˜¯é™æ€æ–¹æ³•ï¼Œæ‰€ä»¥ä¸æ˜¯é™æ€æ–¹æ³•å¼•ç”¨). æ›´ç²—æš´çš„ç†è§£å°±æ˜¯å…¥å‚æ˜¯æ–¹æ³•çš„å¼•ç”¨å¯¹è±¡ï¼Œæ‰€ä»¥æ–¹æ³•å¼•ç”¨å¯¹è±¡å–å†³äºå…¥å‚ï¼ˆä¸ç¡®å®šï¼‰. æ•°ç»„æ„é€ å™¨çš„æ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œå¯ä»¥çœ‹æˆå¦‚ä¸‹ä»£ç ï¼š IntFunction arrayMaker = int[]::new; int[] array = arrayMaker.apply(len) // åˆ›å»ºæ•°ç»„ int[len] ","title":"Java 8 Lambda ç¬”è®°","uri":"/post/java-lambda/"},{"content":"Mdict é¡¹ç›®æ˜¯ä¸€ä¸ªç³…åˆäº† MDX è¯å…¸ã€ES ä¾‹å¥æœç´¢å’Œ AI æ¨¡å‹ç¿»è¯‘çš„å¤šæºæœç´¢åŠŸèƒ½ Web è¯å…¸ã€‚ç‰¹åˆ«é€‚åˆéƒ¨ç½²åœ¨å†…ç½‘ä¸­å­¦ä¹ ä½¿ç”¨æˆ–è€…ç»™å­©å­å­¦ä¹ ä½¿ç”¨ã€‚\npython ç‰ˆæœ¬å¢åŠ äº†ä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹ç¿»è¯‘.rust ç‰ˆæœ¬ä¹Ÿæœ‰æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠåŠ ã€‚\nmdict-py mdict-py æºç \nMdict é¡¹ç›®æ˜¯ä¸€ä¸ªç³…åˆäº† MDX è¯å…¸ã€ES ä¾‹å¥æœç´¢å’Œ AI æ¨¡å‹ç¿»è¯‘çš„å¤šæºæœç´¢åŠŸèƒ½ Web è¯å…¸ã€‚ç‰¹åˆ«é€‚åˆéƒ¨ç½²åœ¨å†…ç½‘ä¸­å­¦ä¹ ä½¿ç”¨æˆ–è€…ç»™å­©å­å­¦ä¹ ä½¿ç”¨ã€‚\nç‰¹ç‚¹ï¼š\nè‡ªåŠ¨è¯†åˆ«ä¸­è‹±æ–‡é€‰æ‹©å¯¹åº” mdx è¯å…¸ï¼Œç›®å‰è‹±æ–‡è¯å…¸åŒ…å«ç‰›æ´¥ 8 å’Œæœ—æ–‡ 4ï¼Œä¸­æ–‡è¯å…¸åŒ…å«æ±‰è¯­è¯å…¸ 3 è‹±æ–‡å°è¯•æ‹¼å†™çº é”™åŠŸèƒ½ï¼ŒåŠ¨è¯æ—¶æ€çº é”™ å¦‚æœé…ç½®äº†ä¸­æ–‡ä¼šå°è¯•æœç´¢æœ—æ–‡çš„ä¾‹å¥ï¼Œæ¨¡ç³Šæœç´¢ï¼Œå¯¹äºæœ‰è‹±è¯­åŸºç¡€çš„åŒå­¦å¾ˆæœ‰ç”¨ å¦‚æœé…ç½®äº† AI æ¨¡å‹ï¼Œä¼šä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ç¿»è¯‘ï¼Œç¿»è¯‘ç»“æœæ¯”è¾ƒç²—ç³™ï¼Œä½†æ˜¯å¯ä»¥å‚è€ƒ mdict-rs mdict-rs æºç \nå’Œ python ç‰ˆæœ¬ç›¸æ¯”ç›®å‰åªæœ‰åŸºæœ¬åŠŸèƒ½ï¼šmdx æ–‡ä»¶è§£æï¼ŒæŸ¥è¯¢ã€‚\n","title":"åŸºäº MDX çš„ web è¯å…¸","uri":"/post/python-mdict-web/"},{"content":"4 é“å¸¸è§çš„ python é¢è¯•é¢˜å’Œè§£ç­”ï¼Œä»¥åŠä¸€äº› python é™·é˜±çš„é“¾æ¥ã€‚ é—®é¢˜ é¢˜ç›® 1 def change(v): v[1] = 4 return v a = [1, 2, 3] print(change(a)) print(a) é¢˜ç›® 2 def append1(x=[]): x.append(1) return x def now(n=time.time()): time.sleep(1) return n print(append1(), append1()) #? print(now(), now()) #? é¢˜ç›® 3 def arr_multi(): x = [[0] * 3] * 3 x[0][0] = 42 return x print(arr_multi()) é¢˜ç›® 4 def fn_for(): f = [lambda x: x * i for i in range(3)] print(f[0](1), f[1](1), f[2](1)) print(fn_for()) é¢˜ç›® 5 \u003e\u003e\u003e t = (1, 2, [30, 40]) \u003e\u003e\u003e t[2] += [50, 60] run, what happen next? A. `t` becomes `(1, 2, [30, 40, 50, 60])`. B. `TypeError` is raised with the message `'tuple' object does not support item assignment`. C. Neither. D. Both *A* and *B*. è§£ç­” [1, 4, 3] [1, 4, 3] # å°±æ˜¯ç®€å•çš„å¼•ç”¨ä¼ é€’ï¼Œä½†æ˜¯å¾ˆå¤šäººä¸è‡ªä¿¡ï¼Œåœ¨é€‰æ‹©é¢˜é‡Œé¢é¢‘é¢‘å‡ºé”™ã€‚ # python ä¸­æ‰€æœ‰çš„éƒ½æ˜¯å¯¹è±¡ï¼Œid(obj) ä¼šè¿”å›åœ°å€ã€‚ # ä½†æ˜¯å¦‚æœæ–°å»ºå¯¹è±¡æ˜¯ short string,int [-5,256],ä¸å¯å˜çš„ç©ºé›†åˆ (empty tuples) ç­‰æƒ…å†µä¸ä¼šçœŸçš„åˆ›å»ºæ–°å¯¹è±¡ã€‚ from copy import copy, deepcopy arr1 = [1,2,3,[4,5,6]] arr2 = copy(arr1) # shallow copy, new id, but elements in array is same id id(arr1[0]) == id(arr2[0]) #deepcopy arr3 = deepcopy(arr1) # elements id is new # ç»“æœï¼š [1, 1] [1, 1] 1590544209.9695618 1590544209.9695618 # ä¸å°‘äººè®¤ä¸ºæ˜¯ï¼š[1] [1, 1].å…¶å®è¿˜æ˜¯æ²¡æœ‰æ·±å…¥ç†è§£å¼•ç”¨çš„åŸç†ï¼Œ # ç¿»è¯‘ä¸€ä¸‹å°±å¾ˆå¥½ç†è§£äº†ï¼š y = append1() # id(y) == id(x), y=[1] y = append1() # id(y) == id(x), y=[1,1] print(y,y) # æœ€å¥½ä¸è¦ä½¿ç”¨ [] ä½œä¸ºé»˜è®¤å‚æ•°ï¼Œä½¿ç”¨ä¸‹é¢çš„å½¢å¼ï¼š def my_func(working_list=None): if working_list is None: working_list = [] working_list.append(\"a\") print(working_list) # æˆ–è€… def fun(count=[]): count.append(2) #è¿™é‡Œ count ä¸¤æ¬¡è°ƒç”¨å¦‚æœéƒ½ä½¿ç”¨é»˜è®¤å‚æ•°çš„è¯ï¼Œåˆ™æ˜¯åŒä¸€ä¸ªæ•°ç»„ï¼Œéå¸¸å±é™©ï¼ return count fun() #[2] fun() #[2,2] [[42, 0, 0], [42, 0, 0], [42, 0, 0]] # list æ˜¯ mutable, []*3 è¡¨ç¤ºæ˜¯å¼•ç”¨å¤åˆ¶ä¸‰æ¬¡ã€‚ # èµ‹å€¼åä¸ºä»€ä¹ˆåªæ”¹å˜åˆ—çš„å€¼ï¼Ÿ 2 2 2 None æœ¬æ„å…¶å®æ˜¯æƒ³å¾—åˆ°ä¸€ä¸ªå‡½æ•°åˆ—è¡¨[0x,1x,2*x], ä½†æ˜¯ Pythonâ€™s closures are late binding. This means that the values of variables used in closures are looked up at the time the inner function is called. è§£å†³æ–¹æ¡ˆæ˜¯åå‡½æ•° partial from functools import partial def fix_fn_for(): f = [partial(lambda y, x: y * x, x=i) for i in range(3)] print(f[0](1), f[1](1), f[2](1)) æˆ–ï¼š fl=[lambda x, i=i: x*i for i in range(3)] ç­”æ¡ˆæ˜¯D å¯ä»¥ä½¿ç”¨dis.dis('s[a] += b')æŸ¥çœ‹æ‰§è¡Œç  å¤§æ¦‚å¾—æµç¨‹æ˜¯å°†s[a]åŠ è½½åˆ°stack(tos: top of stack)ï¼Œ æ‰§è¡Œtos + bï¼Œæœ€åæ˜¯èµ‹å€¼ s[a] = tosï¼Œ ä½†æ˜¯å› ä¸ºsæ˜¯tupleï¼Œå±äºä¸å¯å˜ç±»å‹ï¼ŒæŠ›é”™ã€‚ 1. æ°¸è¿œä¸åœ¨é»˜è®¤å‚æ•°ï¼Œtupleå†…ç­‰ä½¿ç”¨å¯å˜å‚æ•°ï¼ŒåŒé¢˜ç›®2ã€‚ å¯å˜ç±»å‹åŒ…æ‹¬ï¼šlist set dict bytesarrayå››ç§ 2. += ä¸­èµ‹å€¼ä¸æ˜¯åŸå­æ“ä½œ 3. disæ¨¡å—å…¶å®æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå°è¯•ä½¿ç”¨å‘ç°é—®é¢˜ å¸¸è§ python é™·é˜± The 10 Most Common Mistakes in Python Some Common Gotchas in Python ","title":"Python 4 é“ç¬”è¯•é¢˜","uri":"/post/python-interview-questions/"},{"content":"åœ¨æ–‡ä»¶è¯»å–çš„æ—¶å€™ï¼Œä¼šé‡åˆ°éæ³•è½¬ä¹‰å­—ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æŒ‰è¡Œè¯»å–å¤±è´¥ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡å¿½ç•¥è½¬ä¹‰å­—ç¬¦æ¥è§£å†³ã€‚æœ¬æ–‡è®°å½•äº† scala å’Œ python çš„æ–¹æ³•ã€‚ èƒŒæ™¯ æœ‰ 50G çš„æœåŠ¡å™¨æ—¥å¿—ï¼Œæ‹†åˆ†ä¸ºå‡ åƒä¸ª txt æ–‡ä»¶ï¼Œç¼–ç æ˜¯ utf8ï¼Œä½¿ç”¨ scala å’Œ python æŒ‰è¡Œå¤„ç†ï¼š scala def main(args: Array[String]): Unit = { for (line \u003c- Source.fromFile(\"./txt1.log\",\"UTF8\").getLines()) { if (line.contains(\"ABC\")) { //do something } } } python with open('./txt1.log','r',encoding='utf-8') as f: for line in f: pass #do something ä½†æ˜¯æ–‡æœ¬ä¸­æœ‰ä¸€äº›è¡ŒåŒ…å«éæ³•çš„è½¬ä¹‰å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š http://bbc.com/search.html \\xa3\\xa9 404 \\r\\n ææ™“æ˜ å¯¼è‡´ç¨‹åºå¼‚å¸¸ï¼š #scala java.nio.charset.MalformedInputException: Input length = 1 #python 'utf-8' codec can't decode byte 0xa3 in position 168: invalid start byte æ–¹æ¡ˆ ä¸€èˆ¬é‡åˆ°è¿™ç§éæ³•è½¬ä¹‰å­—ç¬¦ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸ªé”™è¯¯ï¼Œçœ‹æˆ raw string æ¥å¤„ç†ã€‚ scala import java.nio.charset.CodingErrorAction import scala.io.{Codec, Source} implicit val codec = Codec(\"UTF-8\") codec.onMalformedInput(CodingErrorAction.REPLACE) codec.onUnmappableCharacter(CodingErrorAction.REPLACE) // æ³¨æ„ï¼ŒfromFile æ–¹æ³•æ²¡æœ‰æä¾›\"UTF8\"å‚æ•° def main(args: Array[String]): Unit = { for (line \u003c- Source.fromFile(\"./test.file\").getLines()) { if (line.contains(\"ABC\")) { //do something } } } python with open('./txt1.log','r',encoding='utf-8',errors='ignore') as f: for line in f: pass #do something å¦‚æœç¡®è®¤æ–‡æœ¬ä¸­æ²¡æœ‰ä¸­æ–‡çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ç›´æ¥å°†å…¶è½¬ä¹‰æ‰ with open('./txt1.log','r',encoding='unicode_escape') as f: ","title":"Scala Python æ–‡ä»¶è¯»å–è·³è¿‡è½¬ä¹‰å­—ç¬¦","uri":"/post/scala-python-file-encoding-escape/"},{"content":"å¾ˆä¹…ä»¥å‰å†™çš„ä¸€ä¸ªç­”æ¡ˆï¼Œå››å¹´æ¥ä¸€ç›´æœ‰äººè¯„è®ºæ„Ÿè°¢ï¼Œè¯´åªæœ‰æˆ‘çš„æ–¹æ³•æ˜¯æœ‰æ•ˆçš„ã€‚éå¸¸æ„å¤–ä¹Ÿå¾ˆé«˜å…´ã€‚ä¹Ÿæ”¾åˆ°åšå®¢ä¸­é‡Œå¤‡ä»½å§ã€‚ zhihu.com # https://www.zhihu.com/question/25404709/answer/67672003 import matplotlib.font_manager as fm # å¾®è½¯é›…é»‘ï¼Œå¦‚æœéœ€è¦å®‹ä½“ï¼Œå¯ä»¥ç”¨ simsun.ttc myfont = fm.FontProperties(fname='C:/Windows/Fonts/msyh.ttc') # Linux å­—ä½“åœ¨\"/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc\", # éœ€è¦å…ˆå®‰è£…å­—ä½“\"\u003esudo apt install fonts-noto-cjk -y\" # MacOS ä¸­æ–‡å­—ä½“æ–‡ä»¶åœ¨\"/System/Library/Fonts/PingFang.ttc\" # Win10,Linux å·²æµ‹è¯•ï¼ŒMacOS æœªéªŒè¯ import matplotlib.pyplot as plt plt.clf() # æ¸…ç©ºç”»å¸ƒ plt.plot([1, 2, 3], [4, 5, 6]) plt.xlabel(\"æ¨ªè½´\",fontproperties=myfont) plt.ylabel(\"çºµè½´\",fontproperties=myfont) plt.title(\"pythoner.com\",fontproperties=myfont) plt.legend(['å›¾ä¾‹'],prop=myfont) plt.show() ","title":"Matplotlib å›¾ä¾‹ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ","uri":"/post/python-matplotlib-chinese-garbled-solution/"},{"content":"some notes on rust ownership,reference,string and \u0026str, and lifetimes rust ownership //heap and stack: stack is store data that known,fixed size. //memory manager keeping track of what parts of code are using what data on the heap, //minimizing the amount of duplicate data on the heap, and cleaning up unused data on the heap //so you donâ€™t run out of space are all problems that ownership addresses. //ownership rules: // Each value in Rust has a variable thatâ€™s called its owner. // There can only be one owner at a time. // When the owner goes out of scope, the value will be dropped. // stack only data(æ ˆå†…æ•°æ®) assignment will make a copy operation, since it is fixed size, the copy is fast // rust use h.clone() make a heap data deeply copy. // impl the Copy trait can make the original variable still usable after assignment. // Copy trait can not use with Drop trait, Drop å¯ä»¥ç†è§£ä¸º destructorï¼Œå½“æ•°æ®è¶…è¿‡è‡ªå·±çš„ scope æ—¶ï¼Œdrop() æ–¹æ³•è¢«è°ƒç”¨; fn copy() { let x = 5; let y = x; //copy the value(5) in the stack,since it is fixed-size, the copy operation is fast let s1 = String::from(\"hello\"); //String å’Œ \u0026str åŒºåˆ«è§åæ–‡ let s2 = s1; //now s1 is invalid // println!(\"{}, world!\", s1); //error, the \"hello\" ownership move to s2 let s3 = s2.clone(); //copy the heap value(\"hello\"), String impl the Clone trait println!(\"{}, world!\", s2); //s2 still usable } // passing function arguments or return value by function is same as // assigning a value to a variable, you need take care the ownership of heap value, fn ownership() { let x = 5; let x10 = plus10(x);//x still usable since the x is stack data println!(\"{}\", x); println!(\"{}\", x10); let s = String::from(\"hello\"); takes_ownership(s); //s's value moves into the function and so is no longer valid here //println!(s) ;//error! } fn plus10(i: i32) -\u003e i32 { // since the i is primitive in stack, so the function return a new value i + 10 } fn takes_ownership(some_string: String) { // some_string comes into scope println!(\"{}\", some_string); } // Here, some_string goes out of scope and `drop()` is called. The backing memory is freed. æ¨èé˜…è¯»A closer look at Ownership in Rust References and Borrowing: // since the ownership is too hard to track by coder's eye, rust introduce the ref and borrowing // a function that accept a ref will not takeover a value's ownership when the function is called // also will not drop the value's backend memory when function is return. // a variable can only have one mut ref or many immutable ref in a same scope; //dangling reference fn dangle() -\u003e \u0026String { let s = String::from(\"dangle ref\"); \u0026s //error }// the s is dropped, but the function try to return s reference ### String vs str vs \u0026String vs \u0026str //1. String is heap string buffer //2. \u0026String is a ref of String //3. str is unknown immutable sequence of utf8 bytes stored somewhere in memory. the memory may be: // 3a. in binary: a string literal \"foo\" is a \u0026'static str. The data is hardcoded into the executable and loaded into memory when the program runs. // 3b. in heap: String implement Deref","title":"Rust Ownerships Lifetimes æ•™ç¨‹","uri":"/post/rust-ownership-lifetimes/"},{"content":"è®°å½• spring boot å’Œ rust é¡¹ç›®çš„ Dockerfile çš„æœ€ä½³å®è·µã€‚\nspring boot åº”ç”¨ Dockerfile spring.io æä¾›äº†ä¸€ä¸ª boot åº”ç”¨çš„DockerfileæŒ‡å¯¼ã€‚\nä¸è¿‡æœ‰ä¸ªé—®é¢˜ï¼Œè¿™ä¸ª Dockerfile ä½¿ç”¨çš„ maven æ˜¯é¡¹ç›®æºç é‡Œé¢ copy è¿‡å»çš„ã€‚åœ¨ä¸€èˆ¬ä¼ä¸šé¡¹ç›®ä¸­è¿™ä¹ˆåšæ˜¾ç„¶ä¸è§„èŒƒï¼Œç›´æ¥ä½¿ç”¨ maven åŸºç¡€é•œåƒæ›´åˆç†ã€‚\nDockerfile çš„æœ€ç»ˆç‰ˆï¼š\n# syntax=docker/Dockerfile:experimental FROM maven:3-jdk-8-alpine as build WORKDIR /workspace/app COPY pom.xml . COPY src src RUN --mount=type=cache,target=/root/.m2 mvn package -DskipTests # app base image FROM openjdk:8-jdk-alpine VOLUME /tmp ARG BUILD=/workspace/app/target WORKDIR /app COPY --from=build ${BUILD}/*.jar . RUN jar -xf ./*.jar RUN rm ./*.jar ENTRYPOINT [\"java\",\"-cp\",\"/app\",\"org.springframework.boot.loader.JarLauncher\"] è¦ç‚¹ï¼š\n# syntax=docker/Dockerfile:experimentalè¡¨ç¤ºå¯ç”¨ docker å®éªŒç‰¹æ€§ BuildKit çš„ mount cache åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨ maven lib çš„ cache æé«˜é•œåƒæ„å»ºé€Ÿåº¦ã€‚å¯ä»¥æœç´¢ docker BuildKit äº†è§£ã€‚\nå¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œï¼Œé‚£ä¹ˆä¸‹é¢çš„--mount=type=cache,target=/root/.m2å°±æ˜¯éæ³•çš„ã€‚ç”±äºæ˜¯å®éªŒç‰¹æ€§ï¼Œæ„å»ºé•œåƒçš„æ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡DOCKER_BUILDKIT=1æ‰èƒ½è¿è¡Œï¼š DOCKER_BUILDKIT=1 docker build -t zhimoe/boot-app . spring.io çš„æ•™ç¨‹é‡Œé¢ä½¿ç”¨çš„ build é•œåƒæ˜¯openjdk:8-jdk-alpineï¼Œè¿™ä¸ªé•œåƒæ˜¯æ²¡æœ‰ maven çš„ï¼Œå› ä¸ºæ•™ç¨‹ä¸­çš„ Dockerfile ä»æºç å¤åˆ¶äº†mvnwå’Œ.mvn/åˆ°é•œåƒå»ã€‚æ‰€ä»¥è¿™é‡Œæ›¿æ¢ä¸ºmaven:3-jdk-8-alpine ä½¿ç”¨äº† docker çš„multi-stage buildåŠŸèƒ½ï¼Œopenjdk:8-jdk-alpineç”±äºæ²¡æœ‰ mavenï¼Œæ‰€ä»¥ä¼šæ¯”mavené•œåƒå°‘ 20M. spring.io çš„æ•™ç¨‹é‡Œé¢åœ¨ ENTRYPOINT é‡Œé¢æ˜¯ç›´æ¥è®¾ç½® main class å¯åŠ¨åº”ç”¨çš„ã€‚è¿™ç§ç¡¬ç¼–ç æ–¹å¼ä¸é€šç”¨ä¹Ÿä¸åˆ©äºç»´æŠ¤ (ä¿®æ”¹ main class name å Dockerfile ä¹Ÿè¦ä¿®æ”¹).åªè¦å°†åº”ç”¨çš„ jar åŒ…è§£å‹å‡ºæ¥çš„ org ç›®å½• (å³ org.springframework.boot.loader.jar è§£å‹å†…å®¹ï¼Œä¸åˆ° 1M) ä¿ç•™ï¼Œå³å¯é€šè¿‡org.springframework.boot.loader.JarLauncherå¯åŠ¨åº”ç”¨ã€‚ æ³¨æ„java -cp /appä¸­çš„ classpath:/app ä¸€å®šæ˜¯ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™ java æ‰¾ä¸åˆ° main classï¼ŒæŠ¥é”™ï¼šError: Could not find or load main class org.springframework.boot.loader.JarLauncher rust åº”ç”¨ Dockerfile # pull the latest version of Rust FROM rust:latest AS builder # create a new empty shell project RUN USER=root cargo new --bin prj WORKDIR /prj # copy the manifests to WORKDIR/src COPY ./Cargo.lock ./Cargo.toml ./ # change the crate.io source url if in China mainland COPY ./config $CARGO_HOME/ # build without project source code # this build step will cache your dependencies RUN cargo build --release # remove the WORKDIR/src RUN rm -r src/* # copy your source files to WORKDIR/src COPY ./src ./src COPY ./static ./static # build for release, # note! the Cargo.toml package name in deps is _, not - RUN rm ./target/release/deps/rs_notes* RUN cargo build --release RUN mv ./target/release/rs-notes . ## 2 stage build # our final base FROM debian:stretch-slim AS app # for connecting to postgres and TLS hosts # RUN apt update -y \u0026\u0026 apt install -y libpq-dev openssl libssl1.0-dev ca-certificates # copy the build artifact and static resources from the build stage COPY --from=builder /prj/rs-notes ./ COPY --from=builder /prj/static ./static # set the startup command to run your binary CMD [\"./rs-notes\"] è¦ç‚¹ï¼š\nå¦‚æœä½¿ç”¨ scratch æˆ–è€… alpine é•œåƒï¼Œé‚£ä¹ˆéœ€è¦å°†ç¼–è¯‘ç›®æ ‡è®¾ç½®ä¸ºMUSLï¼Œç½‘ç»œä¸Šæœ‰æ•™ç¨‹ï¼Œæ„Ÿè§‰ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªä½“ç§¯é—®é¢˜ã€‚rust åº”ç”¨ä½¿ç”¨ debian-slim åŸºæœ¬åœ¨ 60M å·¦å³ï¼Œåªæœ‰ spring boot åº”ç”¨é•œåƒçš„ä¸€åŠå¤§å°ã€‚ åœ¨å›½å†…ç”±äºç½‘ç»œé—®é¢˜ï¼Œæ‰€ä»¥ä¿®æ”¹äº† cargo çš„ crate.io mirror åœ°å€ï¼šCOPY ./config $CARGO_HOME/. config å†…å®¹å¦‚ä¸‹ï¼š [source.crates-io] registry = \"https://github.com/rust-lang/crates.io-index\" replace-with = 'ustc' [source.ustc] registry = \"git://mirrors.ustc.edu.cn/crates.io-index\" build ä¸­ä½¿ç”¨äº† cargo ç¼“å­˜ï¼Œå³å…ˆå°†é¡¹ç›® Cargo.toml å’Œ Cargo.lock å¤åˆ¶åˆ°ä¸€ä¸ªç©ºé¡¹ç›®ä¸­ç¼–è¯‘ï¼Œç„¶åå†å°†æºç å¤åˆ¶è¿›å»ç¼–è¯‘ã€‚ RUN rm ./target/release/deps/rs_notes*ï¼Œæ³¨æ„è¿™é‡Œçš„rs_notesæ˜¯ä¸‹åˆ’çº¿ï¼Œæ˜¯ cargo ä¸­ package name è½¬æ¢ä¸º crate name çš„é»˜è®¤è§„åˆ™ã€‚ ","title":"SpringBoot åº”ç”¨å’Œ Rust åº”ç”¨çš„ Dockerfile æœ€ä½³å®è·µ","uri":"/post/dockerfile-best-practices/"},{"content":"è®°å½• docker ä¸­ exec form å’Œ shell form çš„åŒºåˆ«ï¼ŒCMD å’Œ ENTRYPOINT åŒºåˆ«ï¼Œä»¥åŠæœ€ä½³å®è·µã€‚ exec form VS shell form # exec form [\"executable\", \"param1\", \"param2\", ...] # shell form exec form ä»¥ JSON æ ¼å¼è§£æï¼Œæ‰€ä»¥å‘½ä»¤å‚æ•°å¿…é¡»ä½¿ç”¨\"\"åŒå¼•å·åŒ…è£¹ã€‚ exec form ä¸ä¼š invoke shell. æ‰€ä»¥CMD [ \"echo\", \"$HOME\" ]ä¸­$HOMEå˜é‡ä¸ä¼šè¢«æ›¿æ¢ã€‚ shell form å®é™…æ˜¯æ‰§è¡Œ/bin/sh -c \"\"ã€‚ ä¼˜å…ˆä½¿ç”¨ exec formï¼Œå› ä¸ºåœ¨ shell form ä¸­spawns your application in a new process and you wonâ€™t receive signals from Docker,åœ¨ k8s ä¸­ä¼šé‡åˆ°é—®é¢˜ã€‚ åœ¨ shell form ä¹Ÿå¯ä»¥ä½¿ç”¨exec å½¢å¼ã€‚ CMD VS ENTRYPOINT ç›´æ¥ç¿»è¯‘ SO ä¸Šé¢çš„å›ç­”ï¼Œæ¯”è¾ƒæ¸…æ¥š ENTRYPOINT æ˜¯å®¹å™¨æ‰§è¡Œå…¥å£ï¼ŒCMD æ˜¯å‚æ•°è®¾ç½®ã€‚ Docker æœ‰é»˜è®¤çš„ ENTRYPOINT:/bin/sh -c,ä½†æ˜¯æ²¡æœ‰é»˜è®¤çš„ CMD.ä½†æ˜¯ä¸€èˆ¬é•œåƒéƒ½ä¼šè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ CMD.(æ³¨æ„æ˜¯dockerçš„é»˜è®¤ ENTRYPOINTï¼Œå’Œé•œåƒçš„é»˜è®¤CMD,åŸºç¡€é•œåƒä¸€èˆ¬ä¸è®¾ç½® ENTRYPOINT) docker run -i -t ubuntu bash the ENTRYPOINT is the default /bin/sh -c, the image is ubuntu and the command is bash. æ‰€ä»¥ä¸Šé¢çš„å‘½ä»¤å®é™…ä¸Šåœ¨å¯åŠ¨å®¹å™¨ä¸­æ‰§è¡Œäº†/bin/sh -c bash. ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦\"/bin/sh\"çš„ï¼Œæ‰€ä»¥å¼•å…¥äº† ENTRYPOINT and --entrypoint. docker run -i -t ubuntuä¸­ ubuntu(é•œåƒå) åé¢è·Ÿçš„æ‰€æœ‰å†…å®¹éƒ½ä½œä¸ºå‚æ•°ä¼ é€’ç»™ entrypoint. è¿™å’Œä½¿ç”¨CMDæŒ‡ä»¤æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œä¹Ÿå³æ˜¯CMDæŒ‡ä»¤å¯ä»¥åœ¨docker runä¸­è¦†ç›–ã€‚ ç”±äº ubuntu é•œåƒè®¾ç½®äº†é»˜è®¤ CMD: CMD [\"bash\"],æ‰€ä»¥docker run -i -t ubuntuå’Œdocker run -i -t ubuntu bashæ˜¯å®Œå…¨ä¸€æ ·çš„æ•ˆæœã€‚ æ‰€ä»¥åˆ°æ­¤ï¼Œå¯ä»¥æ€»ç»“ï¼šENTRYPOINT æ˜¯å®¹å™¨çš„æ‰§è¡Œå…¥å£ï¼ŒCMD æ˜¯å‚æ•°è®¾ç½®ï¼Œä¸è¿‡å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ bash ä¸­çš„å¯æ‰§è¡Œå‘½ä»¤ (ä¾‹å¦‚ï¼ŒCMD [\"echo\",\"hello\"],å®é™…æ‰§è¡Œ /bin/sh -c \"echo hello\"). ENTRYPOINT å’Œ CMD çš„æ­é…å¯ä»¥å®ç°å°†å®¹å™¨ä½œä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯åŠ¨ï¼Œè¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ docker çš„ä¸»è¦ç›®çš„ã€‚ä¾‹å¦‚åœ¨ Dockerfile ä¸­è®¾ç½®ï¼š ENTRYPOINT [\"/bin/cat\"] è¿è¡Œdocker run cat-img /etc/passwd,/etc/passwd æ˜¯ cmd, å®é™…æ‰§è¡Œçš„æ˜¯/bin/cat /etc/passwd. æ­å–œä½ ï¼Œå¾—åˆ°ä¸€ä¸ª cat ç¨‹åºï¼Œå‡è®¾ä½ å®‰è£…äº†ä¸€ä¸ª linux ç³»ç»Ÿï¼Œé‡Œé¢æ²¡æœ‰ cat å‘½ä»¤ï¼Œcat-img é•œåƒå°±å¯ä»¥å®ç°ä½ æƒ³è¦çš„åŠŸèƒ½ã€‚ å†ä¾‹å¦‚ä½ æœ‰ä¸ª redis é•œåƒï¼Œä¸å…¶è¿è¡Œ docker run redis-img redis -H srv-host -u toto get key, ä¸å¦‚è®¾ç½®ENTRYPOINT [\"redis\", \"-H\", \"srv-host\", \"-u\", \"toto\"] ç„¶åè¿è¡Œdocker run redis-img get key. Dockerfile åªæœ‰æœ€åä¸€ä¸ª CMD ä¼šç”Ÿæ•ˆ; å¯ä»¥ä½¿ç”¨docker inspect æŸ¥çœ‹é»˜è®¤çš„CMDå‚æ•°; å–æ¶ˆé»˜è®¤ ENTRYPOINTï¼Œå¯ä»¥åœ¨ Dockerfile ä¸­è®¾ç½®ï¼šENTRYPOINT [] ","title":"Docker CMD ENTRYPOINT åŒºåˆ«","uri":"/post/docker-cmd-entrypoint-diff/"},{"content":"è™½ç„¶ä»£ç å†™çš„å¾ˆæ°´ï¼Œä½†æ˜¯æˆ‘å¯¹å„ç§ç¼–ç¨‹è¯­è¨€ä¸€ç›´æ¯”è¾ƒæ„Ÿå…´è¶£ã€‚é™¤äº†å·¥ä½œä¸­ä½¿ç”¨çš„ Java ä¹‹å¤–ï¼Œè‡ªå·±ä¹Ÿäº†è§£ Python,Groovy,Scala,Kotlin,Clojure,Go,Rust.å…¶ä¸­ Python å’Œ Scala åœ¨å·¥ä½œä¸­ä¹Ÿå¶å°”ä½¿ç”¨ã€‚äº†è§£ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è¯­æ³•å¯¹äºç¼–ç¨‹æ€ç»´çš„å½±å“è¿˜æ˜¯è›®æœ‰æ„æ€çš„ã€‚\nä¾‹å¦‚ï¼Œåªä¼š Java çš„å¼€å‘è€…å¯èƒ½æ²¡æœ‰å¬è¿‡æ¨¡å¼åŒ¹é… (pattern match).åœ¨æˆ‘å­¦ä¹ äº† Scala ä¹‹åï¼Œæˆ‘å¯¹æ¨¡å¼åŒ¹é…çš„ç†è§£å°±æ˜¯æ›´å¼ºæ›´ä¼˜é›…çš„ switch+if. è€Œåœ¨æˆ‘çœ‹è¿‡ rust å’Œ elixir è¯­è¨€ä¸­å…³äºæ¨¡å¼åŒ¹é…ä¹‹åï¼Œæˆ‘å¯¹æ¨¡å¼åŒ¹é…çš„ç†è§£å°±å®Œå…¨ä¸ä¸€æ ·äº†ã€‚\nè¿™äº›è¯­è¨€ä¸­ï¼Œè®ºè¯´å¯¹ç¼–ç¨‹æ€ç»´æ”¹å˜æœ€å¤§çš„å½“å± Clojure è«å±ã€‚Lisp è¯­è¨€æ˜¯ä¸€ç§éå¸¸ä¼˜é›…çš„è¯­è¨€ã€‚è¿™ç§ä¼˜é›…çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ Lisp(Clojure) ä»è¯­æ³•ä¸Šé¢åšåˆ°äº†ä»£ç å³æ•°æ®ã€‚å³ Clojure çš„ä»£ç å½¢å¼å’Œå…¶æ•°æ®ç»“æ„ list çš„å½¢å¼æ˜¯ä¸€æ ·çš„ (è¿™ä¹Ÿæ˜¯ lisp åå­—ç”±æ¥ï¼ŒLISt Processor).\nè¿™ä¸ªç‰¹ç‚¹çš„å¥½å¤„å°±æ˜¯ Clojure èµ‹äºˆäº† list è¿™ç§æ•°æ®ç»“æ„å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¯ä»¥åœ¨ä½¿ç”¨æå…¶ç®€ç»ƒçš„è¯­æ³•åœ¨ list æ•°æ®ç»“æ„å®ç°å¤æ‚çš„é€»è¾‘ã€‚\nâ€œIt is better to have 100 functions operate on one data structure than 10 functions on 10 data structures.â€ â€”Alan Perlis\nå°½å¯èƒ½çš„å‡å°‘è¯­æ³•çš„è§„åˆ™ï¼Œè¿™ç§è¯­æ³•ç‰¹ç‚¹åœ¨ Scala ä¸Šé¢ä¹Ÿæœ‰ä½“ç°ã€‚\nuniform access principle scala ä¸­ç»Ÿä¸€è®¿é—®åŸåˆ™å°† class çš„æ–¹æ³•å’Œå±æ€§è®¿é—®ç»Ÿä¸€ï¼Œéƒ½æ˜¯é€šè¿‡obj.mbrè®¿é—®ã€‚\nè¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ä»£ç æ›´åŠ ç»Ÿä¸€ï¼Œè€Œä¸”é‡æ„æ›´åŠ æ–¹ä¾¿ã€‚\nA function that takes no parameters, which is defined without any empty parentheses.\nInvocations of parameter less functions may not supply parentheses.\nThis supports the uniform access principle, which enables the def to be changed into a val without\nrequiring a change to client code.\nclass Person { private var privateName = \"\" def name = privateName def name_=(value: String) = privateName = value } val john = new Person john.name = \"John Doe\" println(john.name) ç»Ÿä¸€ä¹Ÿä½“ç°åœ¨é›†åˆè®¿é—®å½¢å¼ä¸Šï¼Œåœ¨ Scala ä¸­ï¼ŒMap,List,Array çš„å…ƒç´ è®¿é—®éƒ½æ˜¯é€šè¿‡coll(ki)å½¢å¼ã€‚kiè¡¨ç¤º key æˆ–è€… index.ä¸ªäººéå¸¸å–œæ¬¢è¿™ç§ç»Ÿä¸€ã€‚\n","title":"scala uniform access principle","uri":"/post/scala-uniform-access-principle/"},{"content":"key points in scala-for-impatient 2nd book, best book for java developer to use scala in a rush. scala-for-impatient ç« èŠ‚æ‘˜è¦ï¼Œè¿™æœ¬ä¹¦å¯¹äº Java å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ Scala å¸®åŠ©å¾ˆå¤§ã€‚ Functions â€¢ if expression has a value. â€¢ A block has a value â€” the value of its last expression. â€¢ The Scala for loop is like an â€œenhancedâ€ Java for loop. â€¢ Semicolons are (mostly) optional. â€¢ The void type is Unit. â€¢ Avoid using `return` in a function. â€¢ Beware of missing = in a function definition. â€¢ Exceptions work just like in Java or C++, but you use a â€œpattern matchingâ€ syntax for catch. â€¢ Scala has no checked exceptions. Arrays â€¢ Use an Array if the length is fixed, and an ArrayBuffer if the length can vary. â€¢ Donâ€™t use new when supplying initial values. â€¢ Use () to access elements. â€¢ Use for (elem \u003c- arr) to traverse the elements. â€¢ Use for (elem \u003c- arr if . . . ) . . . yield . . . to transform into a new array. â€¢ Scala and Java arrays are interoperable; with ArrayBuffer, use scala.collection.JavaConverters._ don't use scala.collection.JavaConversions. import scala.collection.mutable.ArrayBuffer val b = ArrayBuffer[Int]() // Or new ArrayBuffer[Int] // An empty array buffer, ready to hold integers b += 1 // ArrayBuffer(1) // Add an element at the end with += b += (1, 2, 3, 5) // ArrayBuffer(1, 1, 2, 3, 5) // Add multiple elements at the end by enclosing them in parentheses b ++= Array(8, 13, 21) // ArrayBuffer(1, 1, 2, 3, 5, 8, 13, 21) // You can append any collection with the ++= operator b.trimEnd(5) // ArrayBuffer(1, 1, 2) // Removes the last five elements b.insert(2, 6) // ArrayBuffer(1, 1, 6, 2) // Insert before index 2 // iterate array with index // use view or use index(it's faster) for (i\u003c-b.indices){val v = b(i)} Maps \u0026 Tuples var scores = Map(\"Alice\" -\u003e 10, \"Bob\" -\u003e 3, \"Cindy\" -\u003e 8) val scores2 = Map((\"Alice\", 10), (\"Bob\", 3), (\"Cindy\", 8)) val bobsScore = scores(\"Bob\") // Like scores.get(\"Bob\") in Java val scores1 = scala.collection.mutable.Map(\"Alice\" -\u003e 10, \"Bob\" -\u003e 3, \"Cindy\" -\u003e 8) val scores3 = scala.collection.mutable.Map[String, Int]() scores1(\"Bob\") = 10 val v = scores1(\"Bob\") // NPE if key is not exists scores1.get(\"Bob\") // None if key is not exists scores1.getOrElse(\"Bob\",10)// 10 if key is not exists scores1 += (\"Bob\" -\u003e 10, \"Fred\" -\u003e 7) scores1 -= \"Alice\" // for immutable val newScores = scores + (\"Bob\" -\u003e 10, \"Fred\" -\u003e 7) // New map with update val scores4 = scores - \"Alice\" scores -= \"Alice\" for ((k, v) \u003c- scores){} for ((k, v) \u003c- scores) yield (v, k) // sorted map val sortedScores = scala.collection.mutable.SortedMap(\"Alice\" -\u003e 10,\"Fred\" -\u003e 7, \"Bob\" -\u003e 3, \"Cindy\" -\u003e 8) // insert order val months = scala.collection.mutable.LinkedHashMap(\"January\" -\u003e 1,\"February\" -\u003e 2, \"March\" -\u003e 3, \"April\" -\u003e 4, \"May\" -\u003e 5) import scala.collection.JavaConverters._ // tuple val t = (1, 3.14, \"Fred\") val second = t._2 // Sets second to 3.14 val keys = Array() val values = Array() val kv = keys.zip(values).toMap() Object â€¢ Use objects for singletons and utility methods. â€¢ A class can have a companion object with the same name. â€¢ Objects can extend classes or traits. â€¢ The apply method of an object is usually used for constructing new instances of the companion class. â€¢ To avoid the main method, use an object that extends the App trait. â€¢ You can implement enumerations by extending the Enumeration object. Package The key points of this chapter are: â€¢ Packages nest just like inner classes. â€¢ Package paths are not absolute. â€¢ A chain x.y.z in a package clause leaves the intermediate packages x and x.y invisible. â€¢ Package statements without braces at the top of the file extend to the entire file. â€¢ A package object can hold functions and variables. â€¢ Import statements can import packages, classes, and objects. â€¢ Import statements can be anywhere. â€¢ Import statements can rename and hide members. â€¢ java.lang, scala, and Predef are always imported Inheritance â€¢ The `extends` and `final` keywords are as in Java. â€¢ You must use `override` when you override a method. â€¢ Only the primary constructor can call the primary superclass constructor. â€¢ You can `override` fields. Files â€¢ Source.fromFile(...).getLines.toArray yields all lines of a file. â€¢ Source.fromFile(...).mkString yields the file contents as a string. â€¢ To convert a string into a number, use the toInt or toDouble method. â€¢ Use the Java PrintWriter to write text files. â€¢ \"regex\".r is a Regex object. â€¢ Use \"\"\"...\"\"\" if your regular expression contains backslashes or quotes. â€¢ If a regex pattern has groups, you can extract their contents using the syntax for (regex(var1, ...,varn) \u003c- string). Traits Key points of this chapter: â€¢ A class can implement any number of traits. â€¢ Traits can require implementing classes to have certain fields, methods, or superclasses. â€¢ Unlike Java interfaces, a Scala trait can provide implementations of methods and fields. â€¢ When you layer multiple traits, the order mattersâ€”the trait whose methods execute first goes to the back. Operators val a = 10 //a: Int = 10 -a // res0: Int = -10 //means the same as a.unary_-. a.unary_- //res1: Int = -10 High Order Functions Array(3.14, 1.42, 2.0).map{ (x: Double) =\u003e 3 * x } //== Array(3.14, 1.42, 2.0) map { (x: Double) =\u003e 3 * x } // diff method and function Collections The key points of this chapter are: â€¢ All collections extend the Iterable trait. â€¢ The three major categories of collections are sequences, sets, and maps. â€¢ Scala has mutable and immutable versions of most collections. â€¢ A Scala list is either empty, or it has a head and a tail which is again a list. â€¢ Sets are unordered collections. â€¢ Use a LinkedHashSet to retain the insertion order or a SortedSet to iterate in sorted order. â€¢ + adds an element to an unordered collection; +: and :+ prepend or append to a sequence; ++ concatenates two collections; - and -- remove elements. â€¢ The Iterable and Seq traits have dozens of useful methods for common operations. Check them out before writing tedious loops. â€¢ Mapping, folding, and zipping are useful techniques for applying a function or operation to the elements of a collection Iterable trait methods: head, last, headOption, lastOption tail, init length, isEmpty map(f), flatMap(f), foreach(f), transform(f), collect(pf) reduceLeft(op), reduceRight(op),foldLeft(init)(op), foldRight(init)(op) reduce(op), fold(init)(op),aggregate(init)(op, combineOp) sum, product, max, min count(pred), forall(pred), exists(pred) filter(pred), filterNot(pred), partition(pred) takeWhile(pred), dropWhile(pred), span(pred) take(n), drop(n), splitAt(n) takeRight(n), dropRight(n) slice(from, to), view(from, to) zip(coll2), zipAll(coll2, fill, fill2), zipWithIndex(cation! the 2nd value in tuple is index) grouped(n), sliding(n) groupBy(k) // mkString(before, between, after), addString(sb, before, between, after) toIterable, toSeq, toIndexedSeq, toArray, toBuffer, toList, toStream, toSet, toVector, toMap, to[C] Important Methods of the Seq Trait: contains(elem), containsSlice(seq), startsWith(seq), endsWith(seq) indexOf(elem), lastIndexOf(elem), indexOfSlice(seq), lastIndexOfSlice(seq), indexWhere(pred) prefixLength(pred), segmentLength(pred, n) padTo(n, fill) intersect(seq), diff(seq) reverse sorted, sortWith(less), sortBy(f) permutations, combinations(n) //The map and flatMap methods are important because they are used //for translating for expressions. For example, the expression: for (i \u003c- 1 to 10) yield i * i //is translated to (1 to 10).map(i =\u003e i * i) //and for (i \u003c- 1 to 10; j \u003c- 1 to i) yield i * j //becomes (1 to 10).flatMap(i =\u003e (1 to i).map(j =\u003e i * j)) val coll = List() coll.par.sum coll.par.count(_ % 2 == 0) for (i \u003c- (0 until 100000).par) print(s\" $i\") (for (i \u003c- (0 until 100000).par) yield i) == (0 until 100000) Pattern Matching The key points of this chapter are: â€¢ The match expression is a better switch, without fall-through. â€¢ If no pattern matches, a MatchError is thrown. Use the case _ pattern to avoid that. â€¢ A pattern can include an arbitrary condition, called a guard. â€¢ You can match on the type of an expression; prefer this over isInstanceOf/asInstanceOf. â€¢ You can match patterns of arrays, tuples, and case classes, and bind parts of the pattern to variables. â€¢ In a for expression, nonmatches are silently skipped. â€¢ A case class is a class for which the compiler automatically produces the methods that are needed for pattern matching. â€¢ The common superclass in a case class hierarchy should be sealed. â€¢ Use the Option type for values that may or may not be presentâ€”it is safer than using null. Annotations The key points of this chapter are: â€¢ You can annotate classes, methods, fields, local variables, parameters,expressions, type parameters, and types. â€¢ With expressions and types, the annotation follows the annotated item. â€¢ Annotations have the form @Annotation, @Annotation(value), or @Annotation(name1 =value1, ...). â€¢ @volatile, @transient, @strictfp, and @native generate the equivalent Java modifiers. â€¢ Use @throws to generate Java-compatible throws specifications. â€¢ The @tailrec annotation lets you verify that a recursive function uses tail call optimization. â€¢ The assert function takes advantage of the @elidable annotation. You can optionally remove assertions from your Scala programs. â€¢ Use the @deprecated annotation to mark deprecated features. Future The key points of this chapter are: â€¢ A block of code wrapped in a Future { ... } executes concurrently. â€¢ A future succeeds with a result or fails with an exception. â€¢ You can wait for a future to complete, but you donâ€™t usually want to. â€¢ You can use callbacks to get notified when a future completes, but that gets tedious when chaining callbacks. â€¢ Use methods such as map/flatMap, or the equivalent for expressions, to compose futures. â€¢ A promise has a future whose value can be set (once), which gives added flexibility for implementing tasks that produce results. â€¢ Pick an execution context that is suitable for the concurrent workload of your computation. Implicits The key points of this chapter are: â€¢ Implicit conversions are used to convert between types. â€¢ You must import implicit conversions so that they are in scope. â€¢ An implicit parameter list requests objects of a given type. They can be obtained from implicit objects that are in scope, or from the companion object of the desired type. â€¢ If an implicit parameter is a single-argument function, it is also used as an implicit conversion. â€¢ A context bound of a type parameter requires the existence of an implicit object of the given type. â€¢ If it is possible to locate an implicit object, this can serve as evidence that a type conversion is valid. Type Class CanBuildFrom","title":"Highlights in Scala for Impatient 2nd","uri":"/post/scala-for-impatient-2nd-highlights/"},{"content":"åˆå­¦ rust å¯¹äºé¡¹ç›®çš„ package å’Œ crate çš„å…³ç³»ï¼Œmodule å’Œæ–‡ä»¶çš„å…³ç³»æœ‰ç‚¹ç†ä¸æ¸…ã€‚åšäº†ä¸€ç‚¹ç¬”è®°ã€‚\npackages and crates A Cargo.toml is a package. and must have a package name, defined in [package] table:\n[package] name = \"actix-web\" A package contains one or more crates.\na package can only have 0 or 1 library crate, no more; the entry file is lib.rs\nA package can contain as many binary crates as youâ€™d like. the entry file is main.rs or src/bin/b1.rs etc.\nby convention, package-name is use - (dash), but lib_name must use _ (underscores, can not be dash -);\ncargo will auto replace the - with _ in package-name to name the default library crate(lib.rs in src root). you can name it in [lib]:\n# rename the lib crate [lib] name = \"actix_web\" path = \"src/lib.rs\" # also you can rename the binary crate: # it use [[]], array of table in toml, # cuz a package can have many binary crate. [[bin]] name = \"my-cool-binary\" path = \"src/my-cool-binary.rs\" one package(project) can only have one library crate, when the lib continues to get bigger, you want to split up the lib into multiple packages.\ncargo introduce you with workspace.\nA workspace is a set of packages that share the same Cargo.lock and output directory.\nhere is the actix-web package Cargo.toml file:\n[workspace] members = [ \".\", \"awc\", \"actix-http\", \"actix-cors\", \"actix-files\", \"actix-framed\", \"actix-session\", \"actix-identity\", \"actix-multipart\", \"actix-web-actors\", \"actix-web-codegen\", \"test-server\", ] # awc,actix-http... all are packages that contains their own Cargo.toml and src/lib.rs; crate and mod A crate is a compilation unit in Rust.\nWhenever rustc some_file.rs is called, some_file.rs is treated as the crate file.\nIf some_file.rs has mod declarations in it, then the contents of the module files would be inserted\nin places where mod declarations in the crate file are found, before running the compiler it.\nIn other words, modules do not get compiled individually, only crates get compiled.\nmod mod_name {} defines a mod.\nmod mod_name; import a mod. cargo will look for mod_name.rs or mod_name/mod.rs and insert the content to current file.\nby default the mod is private; but nested mod is allowed to use any code in super mod;\nself and super is to ref the current mod and parent mod;\nfn main(){ // absolute root path crate::music::popular::play(); // relative path music::popular::play(); } use keyword the use keyword brings path into scope;\næ³¨æ„ï¼Œrust ä¸­modæ‰æ˜¯ importï¼Œuseåªæ˜¯ç®€åŒ– path é•¿åº¦ã€‚åœ¨åŒä¸€ä¸ª package å†…éƒ¨ï¼Œå¿…é¡»è¦mod module_name;ä¹‹åæ‰èƒ½ä½¿ç”¨use module_name::func.\nå¦‚æœæ˜¯Cargo.tomlä¸­çš„ä¾èµ– crateï¼Œæ— éœ€modä¹Ÿæ— éœ€useï¼ˆä½¿ç”¨ full pathï¼‰å°±å¯ä»¥ä½¿ç”¨ crate çš„ itemã€‚\nå¯¹äº functionï¼Œä¸€èˆ¬çº¦å®šæ˜¯ use å‡½æ•°åä¸Šä¸€çº§ï¼šuse mods::foo::bar;ï¼Œè€Œä¸æ˜¯ç›´æ¥ use å‡½æ•°use mods::foo::bar::func_name;\n//Providing New Names with the as Keyword use std::io::Result as IoResult; //Re-exporting Names with pub use pub use crate::music::popular; //Use nested paths or the glob operator use std::{cmp::Ordering, io}; use std::collections::*; //by default, use is absolute. use crate::music::popular; use std::{self,Write}; // std and Write //bring a module into scope with `use` and a relative path need start `self`: use self::music::popular; in most cases you wonâ€™t need to use extern crate anymore because Cargo informs the compiler about what crates are present. (There are one or two exceptions):sysroot mod\nuse foo::bar vs use crate::foo::bar use in mod my_mod { pub mod foo { pub mod bar { pub fn greet() { println!(\"hello rust\"); } } pub fn greet_twice() { // use super::foo::bar::greet; // ok ç›¸å¯¹è·¯å¾„ // use self::bar::greet; // ok ç›¸å¯¹è·¯å¾„ // use my_mod::foo::bar::greet; // error in 2018+ but ok in 2015 edition. use crate::my_mod::foo::bar::greet; // ok ç»å¯¹è·¯å¾„ï¼Œå»ºè®®ä½¿ç”¨ greet(); greet(); } } } fn main() { // use crate::my_mod::foo::bar; // ok ç»å¯¹è·¯å¾„ preferred // use self::my_mod::foo::bar; // ok ç›¸å¯¹è·¯å¾„ use my_mod::foo::bar; // ok ç›¸å¯¹è·¯å¾„ï¼Œçœç•¥äº† self, error in 2015 edition: relative paths are not allowed without `self`; bar::greet(); use crate::my_mod::foo; foo::greet_twice(); } split up mod into files the mod can be defined in mod_name.rs or mod_name/mod.rs. and nested mod can be in mod_name/nested_mod.rs. you can ref the nested_mod by use mod nested_mod; in mod_name.rs; pub in struct and enum the Struct members is all private by default even struct name is pub; the Enum members is all public by default if the name is pub; ","title":"Rust Packages Crates Mod Notes","uri":"/post/rust-packages-crates-mod/"},{"content":"è®°å½•æ—¥å¸¸å¼€å‘ä¸­å¶å°”ä¼šé‡åˆ°çš„ä½†æ˜¯æ€»æ˜¯è®°ä¸ä½çš„ git å‘½ä»¤ã€‚ ä»¥ä¸‹æŠ€å·§éƒ½æ¥è‡ªäºoh shit git å’Œ stackoverflowï¼Œç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ã€‚ delete all history commit and commit current content git checkout --orphan tmp_branch \u0026\u0026 git add -A \u0026\u0026 git commit -am \"first commit\" \u0026\u0026 git branch -D master \u0026\u0026 git branch -m master \u0026\u0026 git push -f origin master store password in local git config credential.helper store git reflog git reflog # you will see a list of every thing you've # done in git, across all branches! # each one has an index HEAD@{index} # find the one before you broke everything git reset HEAD@{index} # magic time machine git commit â€“amend # make your change git add . # or add individual files git commit --amend --no-edit # now your last commit contains that change! # WARNING: never amend public(remote) commits!!! # I need to change the message on my last commit! git commit --amend # follow prompts to change the commit message undo a commit # Oh shit, I need to undo a commit from like 5 commits ago! # find the commit you need to undo git log # use the arrow keys to scroll up and down in history # once you've found your commit, save the hash git revert [saved hash] # git will create a new commit that undoes that commit # follow prompts to edit the commit message # or just save and commit undo a fileâ€™s changes # find a hash for a commit before the file was changed git log # use the arrow keys to scroll up and down in history # once you've found your commit, save the hash git checkout [saved hash] -- path/to/file # the old version of the file will be in your index git commit -m \"Wow, you don't have to copy-paste to undo\" git stash # å¦‚æœä¸´æ—¶æƒ³è¦å°†ä»£ç æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡commit å¸®åŠ©åŒäº‹å¤ç°ä»–çš„é—®é¢˜ # ä½¿ç”¨git stash æš‚å­˜å½“å‰ä¿®æ”¹ï¼Œè¿™ä¸ªä¸æ˜¯stageï¼Œä¹Ÿä¸æ˜¯commit git stash # æ˜¾ç¤ºå½“å‰æš‚å­˜å†å² git stash list # æ‰¾å›æš‚å­˜ git stash apply # or spec which stash git stash apply stash@{1} git rebase git pull --rebase git pull request git cherry-pick # switch to main branch git chekcout main # pick on commit from other branch git cherry-pick f commit change in submodule # submodule is a independent repo, # so you need commit/push change in submodule first and then # update(commit) the main project to refer the new commit of submodule # step 1 cd path/to/submodule git add git commit -m \"comment\" git push # step 2 cd /main/project git add path/to/submodule git commit -m \"updated my submodule\" git push ","title":"git å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•","uri":"/post/git-useful-tips/"},{"content":"ä¹‹å‰å¬è¯´è¿‡ AWS çš„è½¯ä»¶å·¥ç¨‹å¸ˆæ˜¯éœ€è¦è‡ªå·±å†™éœ€æ±‚è¯´æ˜ä¹¦ï¼Œå‰åç«¯ä»£ç ï¼Œæµ‹è¯•å’Œä¸Šçº¿ã€‚è¿˜æœ‰ instagram çš„å·¥ç¨‹å¸ˆå¯ä»¥åšåˆ° python çš„ä»£ç æäº¤å¦‚æœåˆå¹¶åˆ°ä¸»åˆ†æ”¯åå¯ä»¥åœ¨ä¸€ä¸ªå°æ—¶å†…è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§è¢«ç”¨æˆ·ä½¿ç”¨åˆ°ï¼Œæ„Ÿè§‰è¿™ä¸ªéå¸¸ç¥å¥‡ã€‚å¦‚æœéœ€è¦åšåˆ°è¿™ä¸ªï¼Œå¯¹ç»„ç»‡çº§ä¸ä¸ªäººéƒ½æœ‰æé«˜çš„ devops èƒ½åŠ›æˆç†Ÿåº¦è¦æ±‚ã€‚\nä¸Šå‘¨ä»£è¡¨ CRM é¡¹ç›®é€šè¿‡äº†ä¿¡é€šé™¢çš„ DevOps ä¸‰çº§è®¤è¯ã€‚æ„Ÿè§‰æå‡çš„ç©ºé—´å¾ˆå¤§ã€‚ä¸“é—¨çœ‹äº†ä¸€ä¸‹ä¿¡é€šé™¢å‘å¸ƒçš„æˆç†Ÿåº¦æ¨¡å‹æ ‡å‡†ã€‚\næ ¸å¿ƒè¦ç‚¹æ˜¯è¦æœ‰ç»Ÿä¸€çš„ç®¡ç†ç³»ç»Ÿï¼Œç³»ç»Ÿä¹‹é—´éœ€è¦è”åŠ¨ï¼Œ\nä¾‹å¦‚è®°å½•æ•…äº‹çš„ç³»ç»Ÿï¼Œå¦‚ä½•å’Œä½ æäº¤è®°å½•å…³è”ï¼Ÿ\næµ‹è¯•çš„ç¼ºé™·é—®é¢˜å¦‚ä½•å’Œä½ çš„æ•…äº‹å…³è”ï¼Ÿ\nç”Ÿäº§æ­£åœ¨è¿è¡Œçš„ä»£ç ï¼Œå¦‚ä½•å’Œä»£ç åº“çš„æŸä¸ªåŸºçº¿å¯¹åº”ä¸Šï¼Ÿ\næµ‹è¯•æŠ¥å‘Š/éœ€æ±‚è¯´æ˜ä¹¦æ˜¯å¦ç»Ÿä¸€ç®¡ç†å¹¶å’Œä½ çš„è¿­ä»£æœ‰å…³è”ï¼Ÿ\næ˜¯å¦å¯ä»¥åšåˆ°äº‹æ•…ä¹‹åå¿«é€Ÿå®ç°å›æ»šéƒ¨ç½²ï¼Ÿ\nç ”å‘è¿è¥ä¸€ä½“åŒ–ï¼ˆDevOpsï¼‰èƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹ ç¬¬ 1 éƒ¨åˆ†ï¼šæ€»ä½“æ¶æ„\n","title":"DevOps èƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹","uri":"/post/devops-maturity-model-checklist/"},{"content":"scala collection æä¾›äº†ä¸€æ•´å¥—ç‹¬ç«‹äº Java çš„é«˜æ€§èƒ½é›†åˆï¼Œä½¿ç”¨ä¸Šéå¸¸çµæ´»ï¼Œæ‰€ä»¥éœ€è¦æ¸…æ¥šä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š reduce fold scan é›†åˆçš„ç¬¦å·æ–¹æ³• æ•°ç»„ï¼Œtuple 2.13 çš„é›†åˆæ¶æ„ reduce fold scan //reduce æ˜¯ä¸€ä¸ªäºŒå…ƒå‡½æ•°ï¼Œéå†æ•´ä¸ªé›†åˆ List(1, 3, 5).reduceLeft(_ + _) // == ((1+3)+5) //reduceRight start from end of the collection //also you can given initial argument List(1, 3, 5).foldLeft(\"\")(_ + _) // == 135 //foldLeft ç­‰ä»·äº \\: æ“ä½œç¬¦ (0 /: List(1, 3, 5)) (_ - _) //folding å¸¸ç”¨äºæ›¿ä»£ for-loop val wf1 = scala.collection.mutable.Map[Char, Int]() for (c \u003c- \"Mississippi\") wf1(c) = wf1.getOrElse(c, 0) + 1 // Now freq is Map('i' -\u003e 4, 'M' -\u003e 1, 's' -\u003e 4, 'p' -\u003e 2) //æ³¨æ„ä½¿ç”¨äº†ä¸å¯å˜ map val wf = (Map[Char, Int]() /: \"Mississippi\") { (m, c) =\u003e m + (c -\u003e (m.getOrElse(c, 0) + 1)) } //scan æ–¹æ³•å¯ä»¥è·å¾—æ¯ä¸€æ­¥ä¸­é—´ç»“æœé›† (1 to 10).scanLeft(0)(_ + _) //Vector(0, 1, 3, 6, 10, 15, 21, 28, 36, 45, 55) é›†åˆçš„ç¬¦å·æ–¹æ³• //+ è¡¨ç¤ºæ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°æ— åºé›†åˆ // :+ +:è¡¨ç¤ºæ·»åŠ åˆ°æœ‰åºé›†åˆçš„é¦–/å°¾ //elem append or prepend to coll (Seq) coll :+ elem elem +: coll //add elem to set/map coll + elem coll + (e1,e2,...) coll ++ coll2 coll2 ++: coll // prepend to lst elem :: lst lst2 ::: lst // ç­‰ä»· list ++: list2 list ::: list2 // å«æœ‰=çš„è¡¨ç¤ºä¿®æ”¹ï¼Œå¿…é¡»æ˜¯ mutable çš„é›†åˆ // TIP: As you can see, Scala provides many operators for adding and removing // elements. Here is a summary: // 1. Append (:+) or prepend (+:) to a sequence. // 2. Add (+) to an unordered collection. // 3. Remove with the - operator. // 4. Use ++ and -- for bulk add and remove. // 5. Mutations are += ++= -= --=. // 6. For lists, many Scala programmers prefer the :: and ::: operators. // 7. Stay away from ++: +=: ++=:. NOTE: For lists, you can use +: instead of :: for consistency, with one exception: Pattern matching (case h::t) does not work with the +: operator. å…¶ä»– //æ•°ç»„çš„ç¬”è®° val ints = new Array[Int](30) // empty array val ints2 = Array[Int](1, 2, 3, 4) // array with init values val matrix4x9 = Array.ofDim[Double](4, 9) //update ints2(3) = 1000 // or ints2.update(3, 1000) //æ±‚å’Œ val ints2Sum = ints2.sum val days = Array(\"Monday\", \"Tuesday\", \"Wednesday\", \"Thrusday\", \"Friday\", \"Saturday\", \"Sunday\") //éå† for (i \u003c- 0 until days.length) println(days(i)) for (day \u003c- days) println(day) days foreach println //éå†ä¸­ä½¿ç”¨ index days.zipWithIndex.map { case (e, i) =\u003e (i, e) } //faster for (i \u003c- days.indices) yield (i, days(i)) //Possibly fastest Array.tabulate(days.length) { i =\u003e (i, days(i)) } //è‚¯å®šæœ€å¿« val b = new Array[(Int, String)](days.length) var i = 0 while (i \u003c days.length) { b(i) = (i, days(i)) i += 1 } //filter days.filter(day =\u003e day.length \u003e 4) //map Array(1, 2, 3, 4, 5).map(x =\u003e x * x) //sort Array(3, 6, 2, 0, 8, 5).sortWith((e1, e2) =\u003e e1 \u003c e2) //å°çš„åœ¨å‰ //reduceï¼Œä¸‹é¢çš„ä¼šæç¤ºä½¿ç”¨ sum, Array(1, 2, 3, 4, 5).reduce((e1, e2) =\u003e e1 + e2) //ä¸å®šé•¿æ•°ç»„ import scala.collection.mutable.ArrayBuffer val arr = ArrayBuffer[Int]() //tuple val oneAndTwo = (1, 2) val oneAndTwo1 = Tuple2(1, 2) //Pair is alias of Tuple2 val oneAndTwo2 = Pair(1, \"two\") val oneAndTwo3 = 1 -\u003e 2 //è®¿é—®å…ƒç´ ä¸‹æ ‡æ˜¯ä» 1 å¼€å§‹ï¼Œè¿™æ˜¯å› ä¸º tuple é‡Œé¢æ¯ä¸ªå…ƒç´ ç±»å‹ä¸ä¸€æ ·ï¼Œä¸ºäº†èƒ½å¤Ÿå’Œ list ç­‰åŒºåˆ†å¼€ //ä½¿ç”¨äº†ç±»ä¼¼ Haskell/ML çš„ä¹ æƒ¯ val two = oneAndTwo._2 //option val emptyOpt: Option[Int] = None val fullOpt: Option[Int] = Some(42) emptyOpt match { case Some(value) =\u003e println(value) case None =\u003e println(\"Empty\") } fullOpt.get //42 emptyOpt.isEmpty //true //either def divide(a: Double, b: Double): Either[String, Double] = { if (b == 0.0) Left(\"Division by zero\") else Right(a / b) } divide(4, 0) def either(flag: Boolean): Either[String, List[Int]] = { if (flag) Right(List(1, 2, 3)) else Left(\"Wrong\") } val content = either(true).right.map(_.filter(_ \u003e 0)) //cast Seq(1).toArray Seq(1).toBuffer Seq(1).toList Seq((1, 2)).toMap Seq(1).toStream Seq(1).toString Seq(1).toVector Seq(1).toTraversable Seq(1).toIndexedSeq Seq(1).toIterable Set(1).toSeq Seq(1).toSet //zip, zipAll, zipWithIndex, unzip \"abcde\" zip 1.to(5) //zipAll:ç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨è€…å…ƒç´ ç¼ºå¤±ä½¿ç”¨çš„é»˜è®¤å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç¬¬ä¸€ä¸ªå®å‚ä¸å¤Ÿé•¿çš„é»˜è®¤å€¼ \"abcde\".zipAll(1.to(2), \"caller\", \"arg\") //å°è¯•è‡ªå·±å®ç°ä¸€ä¸ª zipAll? // \"abcde\" zipWithIndex Seq((1, 2), (3, 4), (5, 6)) unzip // val s = Seq(\"a\", \"b\") scala 2.13 collection åŸºæœ¬é‡å†™äº†ã€‚å‚è€ƒè¿™ä¸¤ä¸ªæ–‡æ¡£ï¼š collections migration 2.13 the architecture of scala 2.13â€™s collections ","title":"Scala Collection Tips","uri":"/post/scala-collection-tips/"},{"content":"GTmetrix æ˜¯ä¸€ä¸ªå‰ç«¯é¡µé¢æµ‹è¯•çš„ç½‘ç«™ï¼Œå¯ä»¥å‘ç°ä½ çš„ç«™ç‚¹å“ªäº›èµ„æºåŠ è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œå¹¶é’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚æœ¬æ–‡åŒ…å«å¦‚ä½•ä½¿ç”¨ GTmetrix ä¼˜åŒ–ç½‘ç«™å›¾ç‰‡æ€§èƒ½ã€‚\nsource:How to Optimize Images: A Practical Guide\n","title":"ä½¿ç”¨ GTmetrix å¯¹å‰ç«¯é™æ€èµ„æºå›¾ç‰‡ä¼˜åŒ–[ç¿»è¯‘]","uri":"/post/frontend-assets-optimize-gtmetrix/"},{"content":"ç†è§£ Spring çš„ FactoryBean å’Œ ContextAware æ¥å£ã€‚ FactoryBean ä¸€å¥è¯å°±æ˜¯ FactoryBean ç”¨äºè¿”å›å…¶ä»–å¯¹è±¡å®ä¾‹çš„ï¼Œè€Œä¸æ˜¯è‡ªèº«ç±»å‹çš„å®ä¾‹ã€‚ public class Tool { private int id; // standard constructors, getters and setters } public class ToolFactory implements FactoryBean { private int factoryId; private int toolId; @Override public Tool getObject() throws Exception { return new Tool(toolId); } @Override public Class\u003c?\u003e getObjectType() { return Tool.class; } @Override public boolean isSingleton() { return false; } // standard setters and getters } æ³¨å†Œ Tool: ä½¿ç”¨æ³¨è§£æ³¨å†Œï¼š @Bean(name = \"tool\") ToolFactory toolFactory() { ToolFactory factory = new ToolFactory(); factory.setFactoryId(7070); factory.setToolId(2); return factory; } ä½¿ç”¨ Tool: @RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(locations = { \"classpath:factorybean-spring-ctx.xml\" }) public class FactoryBeanXmlConfigTest { @Autowired private Tool tool; @Test public void testConstructWorkerByXml() { assertThat(tool.getId(), equalTo(1)); } } è®¿é—® ToolFactoryï¼Œåœ¨ bean id å‰é¢æ·»åŠ  \u0026: @RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(locations = { \"classpath:factorybean-spring-ctx.xml\" }) public class FactoryBeanXmlConfigTest { @Resource(name = \"\u0026tool\") private ToolFactory toolFactory; @Test public void testConstructWorkerByXml() { assertThat(toolFactory.getFactoryId(), equalTo(9090)); } } å’Œ BeanFactory çš„åŒºåˆ« é™¤äº† FactoryBeanï¼Œè¿˜æœ‰ä¸€ä¸ª BeanFactory çš„æ¥å£åŠå…¶å®ç°ã€‚ ","title":"Spring FactoryBean and ContextAware","uri":"/post/spring-factorybean-contextaware/"},{"content":"è¿™ä»½ç¬”è®°è¯•å›¾æ‰“é€ æœ€å¼ºçš„ clojure å°æŠ„ï¼Œkeep refactoring itâ€¦ clojure å…¥é—¨ (ns clj-notes.core (:gen-class)) ;:gen-class generate java class file ;Parameter is variable in the declaration of function. ;Argument is the actual value of this variable that gets passed to function. ; ;install leiningen: ;put lein.bat in your PATH ;open cmder,run: lein repl ;start repl,use exit,(exit),(quit) or ctrl+d to quit repl (println \"hello clojure\") ;Symbols are used to bind names to values ;' will prevent a form from being evaluated ;'() same as (quote ()) ;def global variable ;let local variable binding (def object \"light\") (println object) (let [x 10 y 20 z 30] (+ x y z)) ;=\u003e 60 ;data collection ;seq is abstract for list vector array ;map (def dict {:k1 \"v1\" :k2 \"v2\"}) ;keyword as function (:k1 dict) ;return v1 ;map as function (dict :k1) ;return v1 (let [v (dict :k1)] (println v)) ;also you can use get on seq or map (get {:a 1 :b 2} :b) ;=\u003e 2 ;clojure.core/seq is a function that produces a sequence over the given argument. ;Data types that clojure.core/seq can produce a sequence over are called seqable: ; ;Clojure collections ;Java maps ;All iterable types (types that implement java.util.Iterable) ;Java collections (java.util.Set, java.util.List, etc) ;Java arrays ;All types that implement java.lang.CharSequence interface, including Java strings ;All types that implement clojure.lang.Seqable interface ;nil ;function for seq or collection ;= ;count ;conj ;empty ;seq ;first ;rest ;next ;count ;counted? ;conj ;get ;assoc ;defn å®šä¹‰å‡½æ•° ;defn- å®šä¹‰nså†…ç§æœ‰å‡½æ•° (defn f \"the second line is doc-string\" {:added \"1.2\" ;this is attr-map :static true} [param] (print \"hello \" param)) (meta (var f)) ;#' is the reader macro for var and works the exactly same (meta #'f) ;fn create a function (def f (fn [] (println \"this is from fn function\"))) ;#() is the shortcut for fn (def plus-one #(+ 1 %)) ;% will be replaced with arguments passed to the function ;%1 is for the first argument, %2 is for the second and so on (defn des [{k1 :k1}] ;get :k1 value from argument (map) and binding it to k1(parameter) (println \"destructing in map\" k1)) (des dict) ;destructing in map v1 ;key don't have to be keyword (defn currency-of [{currency \"currency\"}] currency) (defn currency-of [{currency 'currency}] currency) ;if want to destructing multi key,use :keys, in this case,parameter name(currency amount) ;must same as arguments's keys(:currency :amount),can not use string as key (defn currency-of [{:keys [currency amount]}] (* currency amount)) (currency-of {:currency \"RMB\" :amount 100000}) ;ok (currency-of {\"currency\" \"RMB\" \"amount\" 100000}) ;currency will be nil,you will need use :strs or syms (defn currency-strs [{:strs [currency amount]}] currency) (currency-strs {\"currency\" \"RMB\" \"amount\" 100000}) ;ok (defn currency-syms [{:syms [currency amount]}] currency) (currency-syms {'currency \"CNY\" 'amount 100000}) ;ok ;use :or to give a default value for parameter (defn currency-or [{:keys [currency amount] :or {currency \"USD\"}}] currency) (currency-or {:amount 100000}) ;=\u003e \"USD\" ;use \u0026 for Variadic Functions parameters (defn log [message \u0026 args] (println \"args: \" args)) ;named params , achieved by Variadic Functions destructing (defn job-info [\u0026 {:keys [name job income] :or {job \"unemployed\" income \"$0.00\"}}] (if name [name job income] (println \"No name specified\"))) ;cation! arguments to job-info is not a map (job-info :name \"Robert\" :job \"Engineer\") ;[\"Robert\" \"Engineer\" \"$0.00\"] ;Without the use of a variadic argument list, ;you would have to call the function with a single map argument such as (job-info {:name \"Robert\" :job \"Engineer\"}) ;destructuring example ;https://gist.github.com/john2x/e1dca953548bfdfb9844 (def my-vec [1 2 3]) (let [[a b c d] my-vec] (println a b c d)) ;1 2 3 nil (let [[a b \u0026 the-rest] my-vec] (println \"a=\" a \"b=\" b \"the-rest=\" the-rest)) ;a= 1 b= 2 the-rest= (3) (let [[:as all] my-vec] (println all)) ;[1 2 3] (let [[a :as all] my-vec] (println a all)) ;1 [1 2 3] (let [[a b \u0026 the-rest :as all] my-vec] (println a b the-rest all)) ;1 2 (3) [1 2 3] ;note: \u0026 the-rest convert vector to list, ;but :as preserves them (as a list, or as a vector) (def my-vec [\"first\" \"second\"]) (let [{a 0 b 1} my-vec] (println a b)) ;=\u003e \"first second\" ;optional arguments to functions (defn foo [a b \u0026 more-args] (println a b more-args)) (foo :a :b) ;; =\u003e :a :b nil (foo :a :b :x) ;; =\u003e :a :b (:x) (foo :a :b :x :y :z) ;; =\u003e :a :b (:x :y :z) ;map destructuring (def my-hashmap {:a \"A\" :b \"B\" :c \"C\" :d \"D\"}) (def my-nested-hashmap {:a \"A\" :b \"B\" :c \"C\" :d \"D\" :q {:x \"X\" :y \"Y\" :z \"Z\"}}) (let [{a :a d :d} my-hashmap] (println a d)) ;; =\u003e A D (let [{a :a, b :b, {x :x, y :y} :q} my-nested-hashmap] (println a b x y)) ;; =\u003e A B X Y (let [{a :a, b :b, not-found :not-found, :or {not-found \":)\"}, :as all} my-hashmap] (println a b not-found all)) ;; =\u003e A B :) {:a A :b B :c C :d D} ;!!! There is no \u0026 rest for maps. ;everything but false and nil evaluates to true in Clojure. ;:as bind entire map to param ;See https://github.com/ring-clojure/ring/wiki/File-Uploads for explanation (defn file-handler ;è¡¨ç¤ºå…¥å‚æ˜¯ä¸€ä¸ªmap,é‡Œé¢æœ‰:paramsè¿™ä¸ªkey,å°†:params ;[{{{tempfile :tempfile filename :filename} \"file\"} :params :as request}] [{{{tempfile :tempfile filename :filename} \"file\"} :params :as request}] (println request) (let [n (num-lines tempfile)] (response (str \"File \" filename \" has \" n \" lines \")))) ;a simple example (defn first-first [[[i _] _]] i) (first-first [[1 2] [3 4]]) ;return 1 ;(defn name doc-string? attr-map? [params*] prepost-map? body) ;(defn name doc-string? attr-map? ([params*] prepost-map? body) + attr-map?) ;function can have params type hint (defn round \"^double here is type hint\" [^double d ^long precision] (let [factor (Math/pow 10 precision)] (/ (Math/floor (* d factor)) factor))) ;ä¸å®šé•¿å‚æ•° ;é‡è½½å‡½æ•° (defn bar ([a b] (bar a b 100)) ([a b c] (* a b c))) (bar 5 6) (bar 5 6 3) (defn keyworded-map [\u0026 {:keys [function sequence]}] (map function sequence)) (keyworded-map :sequence [1 2 3] :function #(+ % 2)) ;trampoline ;trampoline ;namespace ;create-ns create a namespace (create-ns 'zhi.moe.clj) ;in-ns move to a namespace ;require loads a namespace and ;refer refers the namespace. ;To do these at once, you can use use (require 'clojure.by.example) (clojure.by.example/favorite-language) (use 'clojure.by.example) ;you can rename namespace (require '[clojure.by.example :as temp-ns]) ;ns macro creates a new namespace and gives you an opportunity to load other namespaces at the creation time ;import java class (import java.util.Date) (println (str (new Date))) ;Wed Jul 24 22:55:24 CST 2019 ;boolean ;In Clojure, everything except false and nil are true. (if 1 (println \"it is true\") (println \"will never print\")) ;if (if true (println \"executed when true\") (println \"executed when false\")) ;use do to execute multi expressions (if true (do (println \"one\") (println \"two\"))) ;if-let: (defn positive-number [numbers] (if-let [pos-nums (not-empty (filter pos? numbers))] pos-nums \"no positive numbers\")) ;when when-let case cond condp ; (defn cond-test [n] (cond (= n 1) \"n is 1\" (and (\u003e n 3) (\u003c n 10)) \"n is over 3 and under 10\" :else \"n is other\")) (cond-test 1000) ;string (let [first \"Hirokuni\" last \"Kim\"] (str \"My name is \" first \" \" last)) ;format (format \"My name is %s %s\" \"Hirokuni\" \"Kim\") ;power function (defn power [x n] (reduce * (repeat n x))) ;bigint,N is a literal for bigint (+ 9223372036854775807 10N) ;list conj nth count '(1 2 3) ;vector conj nth count .indexOf [1 2 3] (.indexOf [1 2 3] 4) (count [1 2]) ;set conj nth count disj sort contains? subset? superset? #{1 2 3} ;map assoc merge keys vals (let [os {:Apple \"Mac\" :Microsoft \"Windows\"}] (get os :Apple)) (assoc {:Apple \"Mac\" :Microsoft \"Windows\"} :Commodore \"Amiga\") ;Sequences are data types that abstract all more concrete data types with unified functions. ;These functions are called the Seq library in Clojure. ;seq first rest cons concat map reduce into ;To add an element to the head of sequence, use cons. (cons 4 [1 2 3]) (into [] `(1 2 3)) (reverse [1 2 3]) ;get a sequence of infinite integers with iterate. Be careful, ;though. Running this example will freeze your terminal since the evaluation of this expression never returns. (doc iterate) (doc range) (repeatedly 5 (fn [] (println \"hi!\"))) ;for each (doseq [animal [\"cat\" \"dog\" \"horse\"]] (println animal)) (take 5 (range 0 100)) (take-while neg? [-3 -2 -1 0 1 2 3]) ;drop will remove the first n elements (drop 5 (range 0 10)) (drop-while neg? [-3 -2 -1 0 1 2 3]) ;(0 1 2 3) (remove pos? [-1 -2 3 4]) ;(-1 -2) (filter pos? [-1 2 3]) (partition-by #(\u003c 3 %) [1 2 3 4 5 6]) (group-by #(\u003c 3 %) [1 2 3 4 5 6 1 2 3]) (println (take 5 (iterate inc 0))) ;for compression (for [x '(1 2 3)] (+ 10 x)) (doc for) ;åŒé‡for å¾ªç¯ (for [x (range 10) y (range 20) :while (\u003c y x)] [x y]) ;\u003c==\u003e {x | x \u003e0} (for [x '(-1 1 2) :when (\u003e x 0)] x) (for [x [0 1 2 3 4 5] :let [y (* x 3)] :when (even? y)] y) ;meta data for function parameters (defn round [^double d ^long precision] (let [factor (Math/pow 10 precision)] (/ (Math/floor (* d factor)) factor))) ;# is Dispatch character that tells the Clojure reader how to interpret the next character using a read table ;set #{1 2 3} ;discard {:a 1, #_#_:b 2, :c 3} ;regular expression (re-matches #\"^test$\" \"test\") ;anonymous function #(println %) ;var quote (read-string \"#'foo\") ;symbolic values (/ 1.0 0.0) ;##Inf ;tagged literals (type #inst \"2014-05-19T19:12:37.925-00:00\") ;java.util.Date ;meta (meta #'fn-name) ;reader conditionals #?(:clj (Clojure expression) :cljs (ClojureScript expression) :cljr (Clojure CLR expression) :default (fallthrough expression)) ;#?@ splicing reader conditional (defn build-list [] (list #?@(:clj [5 6 7 8] :cljs [1 2 3 4]))) ;return [5 6 7 8] when run on clojure ;#= allows the reader to evaluate an arbitrary form during read time (read-string \"#=(+ 3 4)\") ;7 ;Recursion ;simple recursion (defn fibo \"this is recursion function\" [n] (if (or (= n 0) (= n 1)) n (+ (fibo (- n 1)) (fibo (- n 2))))) ;do not do this!!! take a long time to finish (fibo 1000) ;use recur (defn fibo-recur [iteration] (let [fibo (fn [one two n] (if (= iteration n) one (recur two (+ one two) (inc n))))] ;recur re-binds it's arguments to new values and call the function with the new values ;fibo is an inner function (fibo 0N 1N 0))) (fibo-recur 1000) ;it is really fast ;notes ;with simple recursion, each recursive call creates a stack frame which is ;a data to store the information of the called function on memory. ;Doing deep recursion requires large memory for stack frames, but since it cannot, ;we get StackOverflowError ;å°¾é€’å½’ ;A function is tail recursive when the recursion is happening at the end of it's definition ;In other words, a tail recursive function must return itself as it's returned value. ;When you use recur, it makes sure you are doing tail recursion (doc loop) ;loop/recur is merely a friendly way to write recursion code. ;All imperative loops can be converted to recursions and all recursions can be converted to loops, ;so Clojure chose recursions. ;Although you can write code that looks like an imperative loop with loop/recur, ;Clojure is doing recursion under the hood. ; (defmacro unless [test then] \"Evaluates then when test evaluates to be falsey\" (list 'if (list 'not test) then)) (macroexpand '(unless false (println \"hi\"))) ;' quoting ;` syntax-quoting returns the fully qualified namespace. ;Using fully qualified namespace is very important in order to avoid name conflicts when defining macro. ;~ unquote `(+ ~(list 1 2 3)) ;(clojure.core/+ (1 2 3)) `(+ ~@(list 1 2 3)) ;(clojure.core/+ 1 2 3) ;The ~@ unquote splice works just like ~ unquote, ;except it expands a sequence and splice the contents of ;the sequence into the enclosing syntax-quoted data structure ;thread first macro (-\u003e [] (conj 1) (conj 2) (conj 3)) ;[1 2 3] (first (.split (.replace (.toUpperCase \"a b c d\") \"A\" \"X\") \" \")) ;\"X\" ;;Perhaps easier to read: ;-\u003e åé¢æ˜¯åˆå§‹å‚æ•°,ç¬¬2è¡Œå¼€å§‹æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨, ;ä¸”ä¸Šä¸€è¡Œçš„è¿”å›å€¼ä¼šä½œä¸ºè¿™ä¸€è¡Œç¬¬ä¸€ä¸ªå‚æ•°(è¿™å°±æ˜¯thread first)çš„firstå«ä¹‰ ;è¿™é‡Œçš„threadæ˜¯ç®¡é“çš„æ„æ€,è€Œä¸æ˜¯å¹¶å‘ç¼–ç¨‹çš„çº¿ç¨‹ ;å¦‚æœçœç•¥(),é‚£ä¹ˆé‡ç”Ÿç¬¦å·(bare symbol)å’Œkeywordéƒ½ä¼šå½“ä½œä¸€ä¸ªå‡½æ•°è°ƒç”¨, ;ä¾‹å¦‚,è¿™é‡Œçš„.toUpperCaseæ˜¯bare symbol,ç­‰æ•ˆäº(.toUpperCase ,,,) ;clojureä¸­ é€—å·ç­‰äºç©ºç™½ç¬¦,æ‰€ä»¥ä¸Šé¢ç”¨,,,è¡¨ç¤ºå°†ä¼šæ’å…¥çš„å‚æ•°(å³\"a b c d\") (-\u003e \"a b c d\" .toUpperCase (.replace \"A\" \"X\") (.split \" \") first) ;same as follow, ,,, is equals whitespace (-\u003e \"a b c d\" (.toUpperCase,,,) (.replace \"A\" \"X\") (.split \" \") first) ;suppose a function (defn calculate [] (reduce + (map #(* % %) (filter odd? (range 10))))) ;same as ;ä¸Šä¸€è¡Œçš„ç»“æœä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°æ’å…¥,è¿™å«thread last (defn calculate* [] (-\u003e\u003e (range 10) (filter odd?,,,) (map #(* % %),,,) (reduce +,,,))) ;å¦‚æœæƒ³è¦æŒ‡å®šæ¯æ¬¡æ’å…¥çš„ä½ç½®é‚£ä¹ˆéœ€è¦ç”¨ as-\u003e ;væ˜¯æ¯ä¸€è¡Œçš„è¿”å›å€¼çš„åç§°,è¿™æ ·ä½ å¯ä»¥åœ¨ä¸‹ä¸€è¡Œä»»æ„å‚æ•°ä½ç½®æŒ‡å®š (as-\u003e [:foo :bar] v (map name v) (first v) (.substring v 1)) ; ;destructing ({:keys [firstname lastname] :as person} {:firstname \"John\" :lastname \"Smith\"}) ;future and deref (let [future-val (future (inc 1))] (println (deref future-val))) ;deref == @ (let [future-val (future (inc 1))] (println @future-val)) (def my-future (future (Thread/sleep 5000))) (repeatedly 6 (fn [] (println (realized? my-future)) (Thread/sleep 1000))) (doc future) ;promise (def my-promise (promise)) ;you define a promise (def listen-and-callback (fn [] (println \"Start listening...\") (future (println \"Callback fired: \" @my-promise)))) (defn do-time-consuming-job [] (Thread/sleep 5000) (deliver my-promise \"delivered value\")) (listen-and-callback) (do-time-consuming-job) ;atom is like mutable var in other languages but atom is thread safe ;ref dosync ref-set alter (def my-ref (ref 0)) (dosync (alter my-ref (fn [current_ref] (inc current_ref)))) (print @my-ref) (def user (ref {})) (dosync (alter user merge {:name \"Kim\"}) (throw (Exception. \"something wrong happens!\")) (alter user merge {:age 32})) (def user-record (atom {})) (do (swap! user-record merge {:name \"Kim\"}) (throw (Exception. \"something wrong happens!\")) (swap! user-record merge {:age 32})) ;Java (new java.util.Date \"2016/2/19\") (java.util.Date.) (java.util.Date. \"2016/2/19\") (Math/pow 2 3) ;static method (def rnd (new java.util.Random)) (. rnd nextInt 10) (let [date1 (new java.util.Date) date2 (new java.util.Date)] (.equals date1 date2)) ;(.instanceMember instance args*) ;(.instanceMember Classname args*) ;(.-instanceField instance) ;(Classname/staticMethod args*) ;Classname/staticField ;;; (defn geohash [lat lng] (println \"geohash:\" lat lng) ;;this function take two separate values as params. ;;and it return a geohash for that position ) (let [{:strs [lat lng] :as coord} {\"lat\" 51.503331, \"lng\" -0.119500}] (println \"calculating geohash for coordinates: \" coord) (geohash lat lng)) ;assoc-in associateä½¿åŠ å…¥ ","title":"é€šè¿‡ä¾‹å­å­¦ä¹  Clojure","uri":"/post/learn-clojure-by-example/"},{"content":"ç†è§£ ES æœç´¢ä¸­ JSON DSL æœ‰åŠ©äºè‡ªå·±å†™ JSON æŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯æ‰‹å†™å¤æ‚åµŒå¥— jsonã€‚ diffs in es 2.x and es 5.x query dsl aggr query diffs in es 2.x and es 5.x æ²¡æœ‰ string ç±»å‹ï¼Œæ”¹ä¸º text å’Œ keyword 2 ä¸ªç±»å‹ã€‚text å­—æ®µå¯ä»¥æŒ‡å®š fields æ¥ä¸åˆ†è¯ã€‚å¦‚ä¸‹ï¼šcity å­—æ®µè¢« ingest ä¸º city å’Œ city.raw 2 ä¸ªå­—æ®µã€‚ { \"mappings\": { \"_doc\": { \"properties\": { \"city\": { \"type\": \"text\", \"fields\": { \"raw\": { \"type\": \"keyword\", \"ignore_above\": 256 } } } } } } } default double -\u003e float geo_point //2.x \"location\": { \"type\": \"geo_point\", \"lat_lon\": true, \"geohash\": true, \"geohash_prefix\": true, \"geohash_precision\": \"1m\" } //5.x \"location\": { \"type\": \"geo_point\" } query dsl basic query å°±åƒç Œæˆ¿å­çš„ç –å¤´ï¼ŒåŸºæœ¬æŸ¥è¯¢å°±æ˜¯ ES æŸ¥è¯¢çš„ç –å¤´ã€‚åŸºæœ¬æŸ¥è¯¢æ˜¯ç»„åˆæŸ¥è¯¢ (bool æŸ¥è¯¢ç­‰) çš„å•å…ƒã€‚åŸºæœ¬æŸ¥è¯¢æœ‰ï¼š //basic query element match, multi_match, common, geoshape, ids, match_all, query_string, simple_query_string, range, prefix, regexp, span_term, term, terms, wildcard å…¶ä¸­common, ids, prefix, span_term, term, terms, wildcard æ˜¯ä¸åˆ†ææœç´¢ (å³ä¸èƒ½ç”¨äº text å­—æ®µ) ï¼Œmatch,\tmulti_match,\tquery_string,\tsimple_query_stringæ˜¯å…¨æ–‡æ£€ç´¢ï¼Œå‡ ä¹å¯ä»¥ç¡®ä¿å¯ä»¥è¿”å›ç»“æœã€‚è€Œprefix,regexp,wildcardæ˜¯æ¨¡å¼æ£€ç´¢ã€‚è¿™é‡Œåˆ†åˆ«ç»™ä¸€äº›ä¾‹å­ï¼š multi_match multi_match æŸ¥è¯¢ä¸ºèƒ½åœ¨å¤šä¸ªå­—æ®µä¸Šåå¤æ‰§è¡Œç›¸åŒæŸ¥è¯¢æä¾›äº†ä¸€ç§ä¾¿æ·æ–¹å¼ æ—¢ç„¶æ˜¯å¤šå­—æ®µæŸ¥è¯¢ï¼Œåˆ™æœ‰ 3 ä¸­åœºæ™¯:best_fieldsã€most_fields å’Œ cross_fieldsï¼ˆæœ€ä½³å­—æ®µã€å¤šæ•°å­—æ®µã€è·¨å­—æ®µï¼‰ { \"multi_match\": { \"query\": \"Quick brown fox\", \"type\": \"best_fields\", //é»˜è®¤çš„ï¼Œå¯ä¸å¡« \"fields\": [ \"title\", \"body\" ], \"tie_breaker\": 0.3, \"minimum_should_match\": \"30%\" } } ç­‰ä»·äºä¸‹é¢çš„å½¢å¼ï¼š { \"dis_max\": { \"queries\": [ { \"match\": { \"title\": { \"query\": \"Quick brown fox\", \"minimum_should_match\": \"30%\" } } }, { \"match\": { \"body\": { \"query\": \"Quick brown fox\", \"minimum_should_match\": \"30%\" } } }, ], \"tie_breaker\": 0.3 } } è¿˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æŒ‡å®šå­—æ®µï¼Œä»¥åŠç»™æŸäº›å­—æ®µæ·»åŠ æƒé‡ã€‚ { \"multi_match\": { \"query\": \"Quick brown fox\", \"fields\": [ \"*_title\", \"chapter_title^2\" ] } } query_string å’Œ simple_query_string éå¸¸çµæ´»çš„ä¸€ä¸ªæŸ¥è¯¢æ–¹å¼ï¼š // GET index_name/_search { \"query\": { \"query_string\" : { \"default_field\" : \"content\", \"query\" : \"(new york city) OR (big apple)\" } } } ä¸Šé¢çš„ query å­—æ®µè¯­æ³•å¯ä»¥å‚è€ƒï¼šquery_string_syntax simple_query_stringä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯ç›´æ¥å¿½ç•¥æ— æ•ˆè¯­å¥ã€‚ termã€terms å®Œå…¨åŒ¹é… // ä¸è¦ç”¨äº text å­—æ®µ // GET /_search { \"query\": { \"term\": { \"user\": { \"value\": \"Kimchy\", \"boost\": 1.0 } } } } //terms å’Œ term ä¸€æ ·ï¼Œä¸è¿‡å¯ä»¥æŒ‡å®šå¤šä¸ªå€¼ï¼Œ\"user\" : [\"kimchy\", \"elasticsearch\"]// è¿”å› user ä¸º kimchy æˆ– elasticsearch çš„æ–‡æ¡£ prefix // user å­—æ®µ (ä¸åˆ†è¯å­—æ®µ) ä¸­ä»¥\"ki\"å¼€å¤´çš„æ–‡æ¡£ ç±»ä¼¼ SQL ä¸­çš„ like 'ki%' { \"query\": { \"prefix\" : { \"user\" : \"ki\" } } } ç»„åˆæŸ¥è¯¢ bool, boosting, constant_score, dis_max, function_score, has_child, has_parent, indices, nested, span_first, span_multi,span_first, span_multi, span_near, span_not, span_or, span_term, top_children, filtered(åºŸå¼ƒï¼Œä½¿ç”¨ bool åŒ…å«ä¸€ä¸ª must å’Œä¸€ä¸ª filter æ›¿ä»£) bool bool æŸ¥è¯¢çš„å¤–æ¡†æ¶ç»“æ„ä¸ºï¼š { \"query\": { \"bool\": { \"must\": [ {} ], \"should\": [ {} ], \"must_not\": [ {} ], \"filter\": [ {} ] } } } //some other parameter for bool: //boost,minimum_should_match,disable_coord ","title":"ç†è§£ Elasticsearch Query DSL ä¸­çš„ JSON ç»“æ„","uri":"/post/elasticsearch-query-dsl/"},{"content":"merge two map and sum its values å¤šä¸ª map åˆå¹¶ï¼Œkey ç›¸åŒæ—¶åˆ™ value ç›¸åŠ  val map1 = Map(1 -\u003e 1, 2 -\u003e 2) val map2 = Map(1 -\u003e 11, 3 -\u003e 3) val map3 = Map(1 -\u003e 111, 3 -\u003e 3) val mapList = List(map1, map2, map3) val merged = mapList.reduce((m1, m2) =\u003e m1 ++ m2.map { case (k, v) =\u003e k -\u003e (v + m1.getOrElse(k, 0)) } ) æ–‡ä»¶è¯» // \"\"\"\"\"\"å¯ä»¥é¿å…\\\\ç¬¦å· val file = \"\"\"d:\\data\\file.txt\"\"\" for (line \u003c- Source.fromFile(file, encoding).getLines()) { print(line) } æ–‡ä»¶å†™ //èµ„æºç®¡ç† def using[A \u003c: {def close() : Unit}, R](resource: A)(fun: A =\u003e R): R = { import scala.language.reflectiveCalls try { fun(resource) } finally { resource.close() } } using(new OutputStreamWriter(new FileOutputStream(outputFile), StandardCharsets.UTF_8)) { writer =\u003e writer.write(s\"\"\"${line}\\n\"\"\") } ç»Ÿè®¡è¯é¢‘ val nanoUnit = 1000000 //åˆ†è¯å¹¶ç»Ÿè®¡è¯é¢‘ def main(args: Array[String]): Unit = { val path = \"\"\"D:\\code\\ideaProjects\\scala-notes\\data\\src\\out\"\"\" val files: List[File] = new File(path).listFiles.filter(_.isFile).toList val start = System.nanoTime() val wfList = ListBuffer[mutable.Map[String, Long]]() val futures = for (file \u003c- files) yield Future { countWrodsInFile(file, \"UTF-8\") } for (f \u003c- futures) { val words: mutable.Map[String, Long] = Await.result(f, Duration.Inf) wfList += words } //merge the word frequency map val finalWf = wfList.reduce((m1, m2) =\u003e m1 ++ m2.map { case (k, v) =\u003e k -\u003e (v + m1.getOrElse(k, 0L)) } ) val end = System.nanoTime() println(s\"container size=${finalWf.size}\") // sort map val wordsFreq = finalWf.toList.sortWith(_._2 \u003e _._2) write2file(wordsFreq, Paths.get(path, \"final.txt\").toFile) println(s\"total used time = ${(end - start) / nanoUnit} ms\") println(s\"cups = ${Runtime.getRuntime.availableProcessors()}\") } def countWrodsInFile(file: File, encoding: String): mutable.Map[String, Long] = { val wf = mutable.Map[String, Long]().withDefaultValue(0) for (line \u003c- Source.fromFile(file, encoding).getLines()) { val l = line.trim wf.update(l, wf(l) + 1) } println(s\"${file.getName} has words:${wf.size}\") wf } def write2file(wf: Seq[(String, Long)], out: File): Unit = { using(new OutputStreamWriter(new FileOutputStream(out), StandardCharsets.UTF_8)) { writer =\u003e for (it \u003c- wf) { writer.write(s\"\"\"${it._1} ${it._2}\\n\"\"\") } } } ","title":"Useful Scala Code Snippets","uri":"/post/scala-useful-snippets/"},{"content":"some notes on scala future, includes: future executor context await future result callback recover future import java.time._ import scala.concurrent._ import ExecutionContext.Implicits.global Future { Thread.sleep(10000) println(s\"This is the future at ${LocalTime.now}\") } println(s\"This is the present at ${LocalTime.now}\") executor context future need a new thread to execute it task. import ExecutionContext.Implicits.global is a implicit threadpool. await for future result // for 10.seconds conversion import scala.concurrent.duration._ val f = Future { Thread.sleep(10000); 42 } val result = Await.result(f, Duration.Inf) // if f throw exception, it will rethrow to Await.result // use ready() solve this val f = Future { ... } Await.ready(f, 10.seconds) val Some(t) = f.value // The f.value method returns an Option[Try[T]], // which is None when the future is not completed // and Some(t) when it is is // t is Try type instance // A Try[T] instance is either a Success(v), where v is a value of type T or a Failure(ex) val t = Some(t).get t match { case Success(v) =\u003e println(s\"The answer is $v\") case Failure(ex) =\u003e println(ex.getMessage) } // or if (t.isSuccess) println(s\"The answer is ${t.get}\") callback val f = Future { Thread.sleep(10000) if (random() \u003c 0.5) throw new Exception 42 } f.onComplete { case Success(v) =\u003e println(s\"The answer is $v\") case Failure(ex) =\u003e println(ex.getMessage) } callback hell val future1 = Future { getData1() } val future2 = Future { getData2() } future1 onComplete { case Success(n1) =\u003e future2 onComplete { case Success(n2) =\u003e { val n = n1 + n2 println(s\"Result: $n\") } case Failure(ex) =\u003e ... } case Failure(ex) =\u003e ... } // improve val future1 = Future { getData1() } val combined = future1.map(n1 =\u003e n1 + getData2()) // val future1 = Future { getData1() } val future2 = Future { getData2() } val combined = future1.map(n1 =\u003e future2.map(n2 =\u003e n1 + n2)) // use for-yield for ( n1 \u003c- future1 n2 \u003c- future2 ) yield n1+n2 ","title":"Scala Future","uri":"/post/scala-future/"},{"content":"spring çš„ç¼“å­˜ä¸€äº›æŠ€å·§å’Œé™·é˜±\nspring çš„ç¼“å­˜\nç›¸åŒæ–¹æ³•çš„ç¼ºé™· ç¼“å­˜ä¸€ä¸ª list å‚æ•°æ–¹æ³• sync put evict ehcache çš„ä½¿ç”¨ redis ç¼“å­˜çš„ä½¿ç”¨é™·é˜± ","title":"Spring Cache Notes","uri":"/post/draft/spring-cache-notes/"},{"content":"ä¸€äº›å®¹æ˜“å¿˜è®°çš„ spring boot çŸ¥è¯†è¦ç‚¹ã€‚ æ³¨æ„ï¼Œ.yaml å’Œ.yml æ–‡ä»¶æ²¡ä»»ä½•åŒºåˆ«ã€‚ é…ç½® SpringBootApplication æ³¨è§£ @SpringBootApplication // \u003c=ç­‰ä»·=\u003e @Configuration @ComponentScan @EnableAutoConfiguration è‡ªåŠ¨é…ç½® spring çš„è‡ªåŠ¨é…ç½®ä¾èµ–ä»¥ä¸‹æ³¨è§£ï¼š é…ç½®æ–‡ä»¶ ä»»ä½•æ—¶å€™ç¡¬ç¼–ç çš„é…ç½®æ€»æ˜¯ä¸å¥½çš„ï¼Œspring æ”¯æŒä»å¾ˆå¤šç¯å¢ƒä¸­è¯»å–é…ç½®ï¼šé…ç½®æ–‡ä»¶ï¼Œyaml æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡ï¼Œå‘½ä»¤å‚æ•°ã€‚ é…ç½®å¯ä»¥åœ¨@Valueæ³¨è§£ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯Environmentè®¿é—®ï¼Œæˆ–è€…é€šè¿‡@ConfigurationPropertieså°†é…ç½®å±æ€§ç»‘å®šåˆ°ç‰¹å®šçš„ bean(ä¾‹å­). spring boot çš„é…ç½®å±æ€§è¯»å–é¡ºåºä¸ºï¼š Devtools global settings properties on your home directory (~/.spring-boot-devtools.properties when devtools is active). @TestPropertySource annotations on your tests. @SpringBootTest#properties annotation attribute on your tests. Command line arguments. Properties from SPRING_APPLICATION_JSON (inline JSON embedded in an environment variable or system property) ServletConfig init parameters. ServletContext init parameters. JNDI attributes from java:comp/env. Java System properties (System.getProperties()). OS environment variables. A RandomValuePropertySource that only has properties in random.*. Profile-specific application properties outside of your packaged jar (application-{profile}.properties and YAML variants) Profile-specific application properties packaged inside your jar (application-{profile}.properties and YAML variants) Application properties outside of your packaged jar (application.properties and YAML variants). Application properties packaged inside your jar (application.properties and YAML variants). @PropertySource annotations on your @Configuration classes. Default properties (specified using SpringApplication.setDefaultProperties). å› ä¸º spring-boot ä¸»è¦ä½¿ç”¨çš„application.properties/yamlæ–‡ä»¶ï¼Œæ‰€ä»¥åé¢ä¸»è¦å…³æ³¨è¿™ä¸ªæ–‡ä»¶ã€‚ æ­¤å¤–ï¼Œspring ä»£ç ä¸­ä½¿ç”¨äº†å¤§çº¦è¿‘åƒä¸ª (300 å¤šç±») é»˜è®¤å€¼ï¼Œè¿™äº›é»˜è®¤å€¼éƒ½æ˜¯å¯ä»¥è¦†ç›–çš„ã€‚åªéœ€ä½ åœ¨ä½ çš„ propeties/yaml æ–‡ä»¶ä¸­ç”¨ç›¸åŒçš„ key å³å¯ã€‚ æ‰€æœ‰çš„å‚è€ƒå€¼è§ï¼šexample application.properties application.properties SpringApplication loads properties from application.properties files in the following locations and adds them to the Spring Environment: A /config subdirectory of the current directory The current directory A classpath /config package The classpath root application.yml yaml æ˜¯ json çš„è¶…é›†ï¼Œç›¸æ¯” properties æ–‡ä»¶ï¼Œæœ‰ç€ç®€æ´çµæ´»çš„ä¼˜åŠ¿ ä¾‹å¦‚å¯ä»¥è®¾ç½®æ•°ç»„ï¼Œè®¾ç½® group æ¦‚å¿µç­‰ã€‚ yaml æ–‡ä»¶å¯ä»¥é…ç½®æ•°ç»„ï¼š # æ•°ç»„åŠŸèƒ½ï¼Œç­‰ä»· # my.servers[0]=dev.bar.com # my.servers[1]=foo.bar.com my: servers: - dev.bar.com - foo.bar.com #ä¸Šé¢çš„é…ç½®å¯ä»¥é€šè¿‡æ³¨è§£ç»‘å®šåˆ°ä»¥ä¸‹ bean ä¸­ï¼Œéå¸¸å¼ºå¤§ã€‚ @ConfigurationProperties(prefix=\"my\") public class Config { private List servers = new ArrayList(); } # åœ¨ä¸€ä¸ª yaml æ–‡ä»¶è®¾ç½®ä¸åŒçš„ profile é…ç½®ï¼Œproperties æ–‡ä»¶åªèƒ½é€šè¿‡æ‹†åˆ†æ–‡ä»¶`application-profiles.properties`å®ç°ã€‚ server: address: 192.168.1.100 --- spring: profiles: DEV server: address: 127.0.0.1 --- spring: profiles: PRD server: address: 192.168.1.120 yaml ç¼ºç‚¹ï¼š YAML files cannot be loaded by using the @PropertySource annotation. So, in the case that you need to load values that way, you need to use a properties file. å½“ç„¶ä½¿ç”¨ properties æ–‡ä»¶ç¼ºç‚¹ä¹Ÿæ˜æ˜¾ï¼Œä¸èƒ½åˆ†ç»„ (yaml çš„â€”åŠŸèƒ½);åŒæ—¶ä¸­æ–‡æ˜¾ç¤ºå®¹æ˜“ unicode ç ã€‚ è¯»å–é…ç½®æ–‡ä»¶ é™¤äº† application.properties æ–‡ä»¶ï¼Œå…¶ä»–çš„é…ç½®å±æ€§æ–‡ä»¶éœ€è¦æˆ‘ä»¬è‡ªå·±åŠ è½½è¯»å–ã€‚æ³¨æ„ï¼Œä¸‹é¢çš„PropertySourceæ— æ³•åŠ è½½ yaml æ–‡ä»¶ã€‚ ä½¿ç”¨ PropertySource cron=0/3 * * * * ? @Configuration @PropertySource(\"classpath:foo.properties\") public class PropertiesWithJavaConfig { @Value(${cron}) private String cron; } //or @PropertySource({ \"classpath:persistence-${envTarget:mysql}.properties\" }) //multi files //java 8+ @PropertySource(\"classpath:foo.properties\") @PropertySource(\"classpath:bar.properties\") public class PropertiesWithJavaConfig { //... } //java 6+ @PropertySources({ @PropertySource(\"classpath:foo.properties\"), @PropertySource(\"classpath:bar.properties\") }) public class PropertiesWithJavaConfig { //... } //é€šè¿‡ xml åŠ è½½ //register file in xml //foo.properties in src/main/resources å¦‚ä½•åŠ è½½è‡ªå®šä¹‰çš„ yaml æ–‡ä»¶ ä¸Šé¢æåˆ° spring ä¼šé»˜è®¤åŠ è½½application.ymlæ–‡ä»¶çš„é…ç½®ã€‚ä½†æ˜¯å…¶ä»–æ–‡ä»¶åçš„ yml æ–‡ä»¶æ— æ³•é€šè¿‡@PropertySourceåŠ è½½ã€‚å¯ä»¥æœ‰ä»¥ä¸‹æ–¹æ³•ã€‚ ä½¿ç”¨ xmlï¼Œç„¶ååœ¨ Java Config ç±»åŠ è½½ xml. ä¸ªäººä¸æ¨èä½¿ç”¨ xml æ–‡ä»¶ï¼Œè„±ç¦» spring boot çš„åˆè¡·äº†ã€‚ ä½¿ç”¨ yml åŠ è½½å™¨ï¼šThe YamlPropertiesFactoryBean will load YAML as Properties and the YamlMapFactoryBean will load YAML as a Map. é¿å…ä½¿ç”¨ï¼Œå°½é‡å°†ä½ çš„æ‰€ä»¥é…ç½®æ”¾åœ¨ application.yml é‡Œé¢ï¼Œå› ä¸º yml å¯ä»¥æœ‰åˆ†ç»„åŠŸèƒ½ã€‚ å°†ä½ æ–‡ä»¶å‘½åä¸ºapplication-redis.yml,ç„¶ååœ¨ application.yml ä½¿ç”¨spring.profiles.include: 'redis' åŠ è½½ã€‚ ä½¿ç”¨ yaml æ–‡ä»¶çš„åŠ è½½å¯ä»¥é€šè¿‡ConfigurationPropertiesç»‘å®šåˆ°é…ç½® bean ä¸­ã€‚è¿˜è¦æ·»åŠ  2 ä¸ªæ³¨è§£æ³¨å†Œåˆ° spring: @Configuration @EnableConfigurationProperties @ConfigurationProperties public class YAMLConfig { private String name; private String environment; private List servers = new ArrayList\u003c\u003e(); // standard getters and setters } spring: profiles: prod name: prod-YAML environment: production servers: - www.abc.com - www.xyz.com profiles å¾ˆå¤šé…ç½®å¸Œæœ›åŸºäºç¯å¢ƒï¼Œspring boot æ”¯æŒapplication-profile.propertiesæ ¼å¼çš„é…ç½®ï¼Œprofile å¯ä»¥æ˜¯ DEV,ST,UAT,PRD,TEST ç­‰ã€‚ ä¾‹å¦‚æŸä¸ª class å¸Œæœ›åªæœ‰åœ¨PRDç¯å¢ƒæ‰æœ‰ï¼š @Profile(\"PRD\") @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter {} ç„¶ååœ¨application.yml/propertiesè®¾ç½® profile: spring: profiles: active: PRD properties æ–‡ä»¶è®¾ç½® profile application.propertiesæ–‡ä»¶åªèƒ½ä½¿ç”¨application-DEV.properties,application-ST.propertiesè®¾ç½® profile. yml æ–‡ä»¶è®¾ç½® profile application.ymlæ—¢å¯ä»¥åƒ properties æ–‡ä»¶ä½¿ç”¨application-DEV.ymlæ¥è®¾ç½® profileï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨---åˆ†ç»„ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼Œlogging.level=INFOåœ¨æ‰€æœ‰ profile ä¸­ç”Ÿæ•ˆï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¢åŠ æ—¥å¿—æ–‡ä»¶è®¾ç½®ï¼ŒDEV ç¯å¢ƒåˆ™ä½¿ç”¨DEBUGçº§åˆ«æ—¥å¿—ã€‚ # application.yml logging: level: root: INFO --- spring: profiles: DEV logging: level: root: DEBUG --- spring: profiles: PRD logging: path: /tmp/ file: BookWorm.log level: root: WARN æ¿€æ´» profiles åœ¨application.yml/propertiesæ–‡ä»¶ä¸­æ¿€æ´»æŸä¸ª profile: spring: profiles: active: DEV å¦‚æœä½ è®¾ç½®äº†SPRING_PROFILES_ACTIVEç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä¼šè¦†ç›–ä¸Šé¢çš„ profile è®¾ç½®ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç¯å¢ƒå˜é‡å’Œé»˜è®¤å€¼ï¼š spring: profiles: active: ${ENV_TYP:PRD} # è¯»å– ENV_TYP ç¯å¢ƒå˜é‡çš„å€¼ä½œä¸ºæ¿€æ´» profileï¼Œå¦‚æœæ²¡ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆè®¾ç½®ä¸º PRD. æµ‹è¯•","title":"Spring Boot Notes","uri":"/post/spring-boot-notes/"},{"content":"Scala ä¸­å¾ˆå¤šä½¿ç”¨ if çš„åœ°æ–¹éƒ½å¯ä»¥ç”¨ match case æ¥æ›¿æ¢ã€‚å¸¸è§çš„å°±æ˜¯ä¸‹é¢çš„è¿™ç§å†™æ³•ï¼š val res = msg match { case it if it.contains(\"H\") =\u003e \"Hello\" case _ =\u003e \"Other\" } //æ›´å¸¸è§çš„ç”¨æ³•æ˜¯å»åŒ¹é…å‚æ•°çš„æ¨¡å¼ï¼š case class Player(name: String, score: Int) def message(player: Player) = player match { case Player(_, score) if score \u003e 100000 =\u003e \"Get a job, dude!\" case Player(name, _) =\u003e \"Hey, $name, nice to see you again!\" } def printMessage(player: Player) = println(message(player)) å…¶å® case è¿˜æœ‰ä¸€ç§åœ¨åŒ¿åå‡½æ•°ä¸­çš„ç”¨æ³•ï¼Œçœ‹å¦‚ä¸‹çš„ä»£ç ï¼Œåœ¨è¯é¢‘ç»Ÿè®¡æˆ–è€…è¿‡æ»¤ä¸­å¾ˆå¸¸è§ï¼š val wordFrequencies = (\"habitual\", 6) :: (\"and\", 56) :: (\"consuetudinary\", 2) :: Nil def wordsWithoutOutliers(wordFrequencies: Seq[(String, Int)]): Seq[String] = wordFrequencies.filter(wf =\u003e wf._2 \u003e 3 \u0026\u0026 wf._2 \u003c 25).map(_._1) ä¸Šé¢çš„ä»£ç æœ‰æ¯”è¾ƒå¤§çš„é—®é¢˜æ˜¯è®¿é—® tuple å…ƒç´ çš„æ–¹å¼æ¯”è¾ƒéš¾çœ‹ï¼ŒScala æä¾›äº†ä¸€ç§ pattern matching anonymous function è§£å†³è¿™ä¸ªé—®é¢˜ï¼š def wordsWithoutOutliers(wordFrequencies: Seq[(String, Int)]): Seq[String] = wordFrequencies.filter { case (_, f) =\u003e f \u003e 3 \u0026\u0026 f \u003c 25 } map { case (w, _) =\u003e w } æ³¨æ„åˆ°çœç•¥äº†æœ€æ—©ç‰ˆæœ¬çš„ wf =\u003e,IDEA å…¶å®ä¼šæç¤ºä½ çœç•¥è¿™ä¸ªå†—ä½™éƒ¨åˆ†ã€‚ å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸Šé¢çš„æ“ä½œä¸­æˆ‘ä»¬å…ˆè¿‡æ»¤æƒ³è¦çš„åºåˆ—ï¼Œç„¶åå¯¹åºåˆ—è¿›è¡Œäº† map æ˜ å°„æ“ä½œ.Scala é›†åˆçš„ API æœ‰ä¸€ä¸ªå«åš collect çš„æ–¹æ³•ï¼Œå¯¹äº Seq[A] ,å®ƒæœ‰å¦‚ä¸‹æ–¹æ³•ç­¾åï¼š def collect[B](pf: PartialFunction[A, B]): Seq[B] è¿™ä¸ªæ–¹æ³•å°†ç»™å®šçš„_åå‡½æ•° (partial function)_ åº”ç”¨åˆ°åºåˆ—çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œæœ€åè¿”å›ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å¹¶å¤„ç†åæ–°çš„åºåˆ— ,è¿™é‡Œåå‡½æ•°åšäº† filter å’Œ map è¦åšçš„äº‹æƒ…ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æ¥é‡æ„ wordsWithoutOutliers ,é¦–å…ˆå®šä¹‰éœ€è¦çš„åå‡½æ•°ï¼š val pf: PartialFunction[(String, Int), String] = { case (word, freq) if freq \u003e 3 \u0026\u0026 freq \u003c 25 =\u003e word } wordFrequencies.collect(pf) æˆ‘ä»¬ä¸ºè¿™ä¸ªæ¡ˆä¾‹åŠ å…¥äº† å®ˆå«è¯­å¥ï¼Œä¸åœ¨åŒºé—´é‡Œçš„å…ƒç´ å°±æ²¡æœ‰å®šä¹‰ã€‚ ä»¥ä¸Šæ¥è‡ªScala åˆå­¦è€…æŒ‡å— å½“ç„¶æœ‰ä¸­æ–‡ç‰ˆï¼šScala åˆå­¦è€…æŒ‡å—-gitbook ","title":"Pattern Matching Anonymous Function","uri":"/post/scala-pattern-matching-anonymous-function/"},{"content":"scala type class notes: å…³äº scala type class éå¸¸å¥½çš„æ–‡ç«  æ ¸å¿ƒçŸ¥è¯†ç‚¹ //scala æ²¡æœ‰ä¸“é—¨çš„ type class è¯­æ³•ï¼Œè€Œæ˜¯å€ŸåŠ© trait + implicit + context bound æ¥å®ç°çš„ï¼Œ //æ‰€ä»¥å¾ˆå¤šæ—¶å€™è¯†åˆ« type class æ¯”è¾ƒå›°éš¾ã€‚ //type class ç”±ä¸‰éƒ¨åˆ†æ„æˆ //1. type class: å³ä¸‹é¢çš„ Showï¼Œå®šä¹‰ä¸€ä¸ªè¡Œä¸º toHtml. //2. type class instancesï¼šå¸Œæœ›å®ç° toHtml æ–¹æ³•çš„ç±»å‹å®ä¾‹ //3. user interface: type class ä¸­ä¼´ç”Ÿå¯¹è±¡çš„åŒåæ–¹æ³•æˆ–è€…éšå¼è½¬æ¢æ–¹æ³•ã€‚ // type class trait Show[A] { def toHtml(a: A): String } // å®šä¹‰åœ¨ä¼´ç”Ÿå¯¹è±¡çš„å¥½å¤„å°±æ˜¯ implicit å˜é‡è‡ªåŠ¨å¤„äº scope å†… object Show { //åˆ©ç”¨ä¼´ç”Ÿå¯¹è±¡ apply ç‰¹ç‚¹å®ç°ä¸‹é¢ Show[A].toHtml è°ƒç”¨æ–¹å¼ï¼Œå³éšè— implicit sh def apply[A](implicit sh: Show[A]): Show[A] = sh //å¦‚æœæ²¡æœ‰ applyï¼Œé‚£ä¹ˆä¸‹é¢çš„ toHtml éœ€è¦ä¸€ä¸ªéšå¼å‚æ•°ï¼š //def toHtml[A](a: A)(implicit sh: Show[A]): String = sh.toHtml(a) //æˆ–è€…ï¼š //def toHtml[A: Show](a: A): String = implicitly[Show[A]].toHtml(a) //å¯¹å¤–æ¥å£ï¼Œæä¾› toHtml(\"type\") çš„è°ƒç”¨å½¢å¼ def toHtml[A: Show](a: A) = Show[A].toHtml(a) //å¯¹å¤–æ¥å£ï¼Œé€šè¿‡éšå¼è½¬æ¢æä¾› 10 toHtml çš„è°ƒç”¨å½¢å¼ implicit class ShowOps[A: Show](a: A) { // æƒ¯ä¾‹ä½¿ç”¨ TypeCls+Ops def toHtml = Show[A].toHtml(a) } //ä¸ºäº†é¿å…è¿è¡Œå¼€é”€ï¼Œå¯ä»¥å°† Ops ç±»å®šä¹‰ä¸º value classï¼š // implicit class ShowOps[A](val a: A) extends AnyVal { // def toHtml(implicit sh: Show[A]) = sh.toHtml(a) // } //ä¸Šé¢ä¸¤ä¸ªå¯¹å¤–æ¥å£éƒ½åˆ©ç”¨äº†ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³•å’Œ context bound //type class instance int implicit val intCanShow: Show[Int] = int =\u003e s\"$int\" //type class instance string implicit val stringCanShow: Show[String] = str =\u003e s\"$str\" } //use type class import Show._ print(10 toHtml) print(toHtml(\"type\")) è‹¥ä½¿ç”¨import Show._ å¯¼å…¥å…¨éƒ¨å†…å®¹ï¼Œåˆ™ç”¨æˆ·æ— æ³•è‡ªå·±å®ç°ä¸€äº› type class instance åˆ™ä¼šè¦†ç›–é»˜è®¤å®ä¾‹å¯¼è‡´æ­§ä¹‰ã€‚ å¯ä»¥å°†å¯¹å¤–æ¥å£ç§»åŠ¨åˆ°å•ç‹¬çš„ ops å¯¹è±¡ä¸­ï¼š trait Show[A] { def toHtml(a: A): String } object Show { def apply[A](implicit sh: Show[A]): Show[A] = sh object ops { def toHtml[A: Show](a: A) = Show[A].toHtml(a) implicit class ShowOps[A: Show](a: A) { // æƒ¯ä¾‹ä½¿ç”¨ TypeCls+Ops def toHtml = Show[A].toHtml(a) } } implicit val intCanShow: Show[Int] = int =\u003e s\"$int\" implicit val stringCanShow: Show[String] = str =\u003e s\"$str\" } ä½¿ç”¨ï¼š import xxx.Show //å¦‚æœéœ€è¦å®ç°è‡ªå®šä¹‰çš„ type class instance åˆ™éœ€è¦ import xxx.Show.ops._ è‡ªå®šä¹‰ case class Person(name: String, age: Int) implicit val personOps: Show[Person] = p =\u003e s\"name=${p.name},age=${p.age}\" print(Person(\"lee\", 19) toHtml)//name=lee,age=19 Simulacrum Simulacrumé€šè¿‡å®ä¸º type class æ·»åŠ ä¾¿æ·è¯­æ³•ï¼Œæ˜¯å¦ä½¿ç”¨å–å†³äºä¸ªäººåˆ¤æ–­ã€‚ è‹¥ä½¿ç”¨ Simulacrumï¼Œåˆ™å¯ä»¥ä¸€çœ¼æ‰¾å‡ºä»£ç ä¸­æ‰€æœ‰çš„ type classï¼Œå¹¶ä¸”å¯çœå»å¾ˆå¤šæ ·æ¿ä»£ç ã€‚ å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ @typeclassï¼ˆSimulacrum ä¸»è¦æ³¨è§£ï¼‰åˆ™æ„å‘³ç€éœ€è¦ä¾èµ– macro paradise ç¼–è¯‘å™¨æ’ä»¶ã€‚ ä½¿ç”¨ Simulacrum é‡å†™æˆ‘ä»¬çš„ Show type classï¼š import simulacrum._ @typeclass trait Show[A] { def toHtml(a: A): String } æœ‰äº† Simulacrum,type class å®šä¹‰å˜å¾—éå¸¸ç®€æ´ï¼Œæˆ‘ä»¬åœ¨å…¶ä¼´ç”Ÿå¯¹è±¡ä¸­æ·»åŠ  Show[String] å®ä¾‹ï¼š //Simulacrum ä¼šä¸º Show è‡ªåŠ¨ç”Ÿæˆ ops å¯¹è±¡ï¼Œä¸å‰é¢è‡ªå®šä¹‰çš„åŸºæœ¬ä¸€è‡´ã€‚ object Show { implicit val stringShow: Show[String] = s â‡’ s\"String: $s\" } ","title":"Scala Type Class","uri":"/post/scala-type-class/"},{"content":"some notes on scala, includes: setup with maven import == and eq case class forâ€¦yield companion object and class method and function(def val) _ in scala =\u003e in scala () {} in scala implicit string setup with maven ç›®å‰ç”¨ sbt çš„é¡¹ç›®æ¯”è¾ƒå°‘ï¼Œmaven çš„æ›´å¤šã€‚è€Œä¸” sbt çƒ§ cpu. maven é¡¹ç›®ä½¿ç”¨ scala å‚è€ƒæˆ‘çš„ gist:scala_maven_pom.xml å­¦ä¹  scala å¯ä»¥ä½¿ç”¨ scala æ’ä»¶çš„ worksheetï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºè„šæœ¬äº’åŠ¨çš„ REPL. æœ¬æ–‡åé¢çš„ä»£ç å…¨éƒ¨åœ¨ worksheet ä¸­æµ‹è¯•ã€‚ import scala çš„ import è¯­å¥å¾ˆçµæ´»ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å¯¼å…¥ class å†…éƒ¨å¤–éƒ¨ï¼Œæ–¹æ³•å†…éƒ¨ï¼Œä»£ç å—å†…éƒ¨ï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œé™åˆ¶å¯¼å…¥æ–¹æ³•å’Œå¯¹è±¡çš„ scopeï¼Œé˜²æ­¢æ±¡æŸ“å˜é‡ã€‚åœ¨åé¢å­¦äº† implicit éšå¼è½¬æ¢åï¼Œå°±çŸ¥é“ import scope æœ‰å¤šé‡è¦äº†ã€‚ import scala.math._ // import everything in math package import java.util.{ ArrayList =\u003e _, _} //ç¬¬ä¸€ä¸ªä¸‹åˆ’çº¿è¡¨ç¤ºéšè— ArrayListï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºé€šé…ç¬¦ï¼Œå¯¼å…¥æ‰€æœ‰ //é»˜è®¤ï¼Œscala å¯¼å…¥ï¼š java.lang._ scala._ scala.Predef._ //æ¨èçœ‹ä¸€ä¸‹ Predef çš„æºä»£ç åŒ…æ‹¬ï¼š //Predef ä¸­å®šä¹‰çš„æ–¹æ³•å’Œå±æ€§ //å¸¸ç”¨æ–¹æ³•å’Œç±» //æ‰“å°æ–¹æ³• println ç­‰ //ä¸€äº›è°ƒè¯•å’Œé”™è¯¯æ–¹æ³• //ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•è¡¨ç¤ºæ–¹æ³•æœªå®ç° def ??? : Nothing = throw new NotImplementedError //Predef è¿˜æœ‰å¤§é‡çš„éšå¼è½¬æ¢å’Œéšå¼å‚æ•° == and eq scala é‡Œé¢==ç­‰ä»·äº java çš„equalsæ–¹æ³•å³å†…å®¹æ¯”è¾ƒï¼Œå¹¶ä¸”å¯ä»¥æ­£ç¡®å¤„ç†null(è¿˜è®°å¾— java è§„èŒƒé‡Œé¢çƒ¦äººçš„ \"A\".equals(m)è§„èŒƒä¹ˆï¼Ÿ). è€Œåœ°å€ (å¼•ç”¨) æ¯”è¾ƒä½¿ç”¨eq æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…¶å®å¾ˆå°‘ç”¨åˆ°ï¼Œåº”ç”¨ä»£ç ä¸€èˆ¬æ— éœ€æ¯”è¾ƒ 2 ä¸ªå˜é‡çš„åœ°å€ã€‚ case class case class ç±»ä¼¼ data classï¼Œå³ java çš„ pojo beanï¼Œä½†æ˜¯æä¾›äº†æ›´å¤šçš„æ–¹æ³•ã€‚ // 5 ä¸ªç‰¹æ€§ // 1.æ·»åŠ  companion object,apply æ–¹æ³•ï¼Œunapply æ–¹æ³• // 2.toString, hashCode and equals and copy methods case class Student(name: String, marks: Int) val s1 = Student(\"Rams\", 550) val s2 = s1.copy() val s3 = s1.copy(marks = 590) s2 == s1 //true s3 == s1 //false // 3. æ„é€ å‡½æ•°å‚æ•°è‡ªåŠ¨æˆä¸ºæˆå‘˜å˜é‡ï¼Œå³è‡ªåŠ¨ç»™æ„é€ å‚æ•°æ·»åŠ  val å‰ç¼€ // 4. å¯ä»¥ç”¨äºæ¨¡å¼åŒ¹é… // 5. é»˜è®¤çš„ï¼Œcase class å’Œ case object æ˜¯å¯åºåˆ—åŒ–çš„ (å®ç° Serializable),ä¹Ÿå³æ˜¯å¯ä»¥ç½‘ç»œä¼ è¾“çš„ forâ€¦yield Scalaâ€™s â€œfor comprehensionsâ€ are syntactic sugar for composition of multiple operations with foreach, map, flatMap, filter or withFilter scala çš„ for æ¨å¯¼å…¶å®å°±æ˜¯ç»„åˆå¤šä¸ªforeach, map, flatMap, filter or withFilterçš„è¯­æ³•ç³–ã€‚ ä»¥ä¸‹ä»£ç ç»“æœ r1,r2 å®Œå…¨ä¸€è‡´ï¼š val c1 = List(1, 2, 3) val c2 = List(\"a\", \"b\", \"c\") val c3 = List(\"!\", \"@\", \"#\") val r1 = for (x \u003c- c1; y \u003c- c2; z \u003c- c3) yield { x + y + z } //\u003c==\u003e val r2 = c1.flatMap(x =\u003e c2.flatMap(y =\u003e c3.map(z =\u003e { x + y + z }))) assert(r1 == r2)//true companion object Scala ä¸­ï¼Œé™¤äº†æ–¹æ³•ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ ¹æ®å‚æ•°çš„ä¸ªæ•°ï¼Œå‡½æ•°çš„ç±»å‹ä¸º FunctionN.N ä¸ºå‡½æ•°å‚æ•°ä¸ªæ•°ã€‚ ä¼´ç”Ÿå¯¹è±¡ç”¨äºå®šä¹‰ä¸€äº›é™æ€æ–¹æ³• (å·¥å‚æ–¹æ³•),å…¶ä¸­ apply å’Œ unapply æ–¹æ³•å¸¸ç”¨ã€‚apply æ–¹æ³•ç”¨äºä»£æ›¿ new çš„å·¥å‚æ–¹æ³•ã€‚ åŒæ—¶ï¼Œcompanion objects can access private fields and methods of their companion trait/class. class Person(name: String, age: Int) { private var skill: String = \"no skill\" def introduce() = println(s\"my name is $name, I am $age years old\") } // companion object name should be identical to the class name. object Person { def apply(name: String, age: Int): Person = { new Person(name, age) } //apply method override def apply(name: String, age: Int, skill: String): Person = { val p = new Person(name, age) p.skill = skill p } } val dahu = Person(\"dahu\", 30) dahu.introduce ä¼´ç”Ÿå¯¹è±¡åœ¨æ¨¡å¼åŒ¹é…å’ŒæŠ½å–å™¨çš„åº”ç”¨ //å…³äºæŠ½å–å™¨å’Œ unapply æ–¹æ³•çš„è¿›ä¸€æ­¥ç¤ºä¾‹ï¼š trait User class FreeUser( val name: String, val score: Int, val upgradeProbability: Double) extends User class PremiumUser( val name: String, val score: Int) extends User object FreeUser { def unapply(user: FreeUser): Option[(String, Int, Double)] = Some((user.name, user.score, user.upgradeProbability)) } object PremiumUser { def unapply(user: PremiumUser): Option[(String, Int)] = Some((user.name, user.score)) } val freeUsr = new FreeUser(\"john\", 70, 0.5) freeUsr match { case FreeUser(name, _, p) =\u003e if (p \u003e 0.75) println(s\"what can I do for you,$name\") else println(s\"hello,$name\") case _ =\u003e println(\"who are you\") } //bool æŠ½å–å™¨ object premiumCandidate { def unapply(user: FreeUser): Boolean = user.upgradeProbability \u003e 0.4 } // bool æŠ½å–å™¨çš„ç”¨æ³• freeUsr match { case freeUser@premiumCandidate() =\u003e println(s\"æ­å–œæˆä¸ºé»„é‡‘ä¼šå‘˜å€™é€‰äºº\") case _ =\u003e println(\"æ¬¢è¿å›æ¥\") } //æ¥æºï¼š[Scala åˆå­¦è€…æŒ‡å—](http://danielwestheide.com/scala/neophytes.html) method and function(def val) å…ˆçœ‹å‡½æ•°å®šä¹‰ A function can be invoked with a list of arguments to produce a result. A function has a parameter list, a body, and a result type. Functions that are members of a class, trait, or singleton object are called methods. Functions defined inside other functions are called local functions. Functions with the result type of Unit are called procedures. Anonymous functions in source code are called function literals. At run time, function literals are instantiated into objects called function values. quote fromï¼š Martin Odersky - Lex Spoon - Bill Venners å‡½æ•°ç”±ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œä¸€ä¸ªå‡½æ•°ä½“ï¼Œä¸€ä¸ªç»“æœç±»å‹æ„æˆã€‚å‡½æ•°å¦‚æœä½œä¸º class,trait æˆ–è€… objectï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„ object æ˜¯ scala ç‰¹æœ‰çš„å•ä¾‹å¯¹è±¡ï¼Œä¸æ˜¯ Java ä¸­çš„ instanceï¼‰çš„æˆå‘˜ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å«æ–¹æ³•ã€‚å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«å°±æ˜¯å‡½æ•°æ—¶ FunctionN çš„ä¸€ä¸ªå®ä¾‹ï¼Œç¼–è¯‘åæ˜¯ä¸€ä¸ªå•ç‹¬çš„ class æ–‡ä»¶ï¼Œè€Œæ–¹æ³•æ˜¯ä¾é™„å¯¹è±¡çš„ï¼Œè°ƒç”¨æ–¹æ³•çš„æ ¼å¼æ˜¯ obj.method(param),è€Œè°ƒç”¨å‡½æ•°çš„æ ¼å¼æœ¬è´¨æ˜¯å°†è°ƒç”¨å‡½æ•°å¯¹è±¡çš„ apply æ–¹æ³•ã€‚ å‡½æ•°å®šä¹‰åœ¨åˆ«çš„å‡½æ•°å†…éƒ¨å«å±€éƒ¨å‡½æ•°ã€‚å‡½æ•°è¿”å›å€¼æ˜¯ Unit ç§°ä¸ºè¿‡ç¨‹ï¼ˆproceduresï¼‰. åŒ¿åå‡½æ•°æ˜¯é€šè¿‡å‡½æ•°å­—é¢é‡ï¼ˆ ()=\u003e{å‡½æ•°ä½“} ï¼‰å®šä¹‰çš„å‡½æ•°ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå‡½æ•°å­—é¢é‡è¢«å®ä¾‹åŒ–å¯¹è±¡ï¼Œå«å‡½æ•°å€¼ã€‚ å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸ç”¨åœ¨æ„åŒºåˆ«ï¼š å‡½æ•°æ˜¯æœ‰ç±»å‹çš„ï¼š (T1, â€¦, Tn) =\u003e Uï¼Œæ˜¯ trait FunctionN çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå‡½æ•°æœ‰ä¸€ä¸ª apply æ–¹æ³•ï¼Œç”¨æ¥å®é™…æ‰§è¡Œ function çš„å‡½æ•°ä½“ã€‚å‡½æ•°è¿˜æœ‰ toString, andThen ,conpose ç­‰æ–¹æ³•ã€‚ val fn: Int =\u003e String = i =\u003e i+\"123\" //å£°æ˜ä¸€ä¸ªå‡½æ•° fn(3) //å®é™…èƒŒåæ˜¯ fn.apply(3); scala ä¸­é™¤äº† methodï¼Œä¸€åˆ‡éƒ½æ˜¯ instance method åªèƒ½ç”¨ def å£°æ˜ï¼Œfunction å¯ä»¥æ˜¯ val å’Œ def å£°æ˜ method å¯ä»¥æœ‰ç±»å‹å‚æ•°[] ,function ä¸èƒ½æœ‰ï¼Œå‡½æ•°åœ¨å£°æ˜æ—¶å°±éœ€è¦çŸ¥é“å…·ä½“ç±»å‹ã€‚ def fn(p: List[String]): Map[T] = {...} //is function def m[T](t: List[T]): Map[T] = {...} //is methodï¼Œå¯ä»¥æœ‰æ³›å‹å‚æ•°ã€‚ å°†methodè½¬æ¢æˆfunctionæœ‰ä¸¤ç§æ–¹æ³•ï¼š val f1 = m1 _ //ä¸‹åˆ’çº¿è¡¨ç¤ºå‚æ•°åˆ—è¡¨ eta-expansion val f2: (Int) =\u003e Int = m1 //m1 çš„å…¥å‚å’Œè¿”å›å€¼è¦å’Œ f2 çš„ä¸€æ · //scala å¯ä»¥è‡ªåŠ¨å°† method è½¬æ¢ä¸º functionï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œ //é‚£ä¹ˆå¯ä»¥ç›´æ¥å°† m1 ä¼ é€’ç»™ä»–ï¼Œä¸éœ€è¦ ä¸‹åˆ’çº¿ã€‚ //æ¯ä¸€æ¬¡å°†æ–¹æ³•è½¬æ¢æˆ function éƒ½æ˜¯å¾—åˆ°ä¸€ä¸ªæ–°çš„ function object. //function æ—¢ç„¶æ˜¯ä¸€ä¸ª instanceï¼Œé‚£ä¹ˆç¼–è¯‘æˆ class æ–‡ä»¶ä¼šæœ‰ä¸€ä¸ª class æ–‡ä»¶ã€‚ _ in scala /** * class Reference[T] { * private var contents: T = _ * //ä½¿ç”¨ç±»å‹é»˜è®¤å€¼åˆå§‹åŒ–å˜é‡ï¼Œå¦‚æœ T æ˜¯ Intï¼Œåˆ™ contents æ˜¯ 0,T æ˜¯ booleanï¼Œåˆ™æ˜¯ falseï¼›Unit åˆ™æ˜¯ () * } * * * List(1, 2, 3) foreach (print _ ) //output 123ï¼Œè¡¨ç¤ºå®å‚ * * //åœ¨åŒ¿åå‡½æ•°ä¸­ä½œä¸ºå‚æ•°å ä½ç¬¦ï¼š * List(1, 2, 3) map ( _ + 2 ) * // _ + 2 æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•° * * //æ¨¡å¼åŒ¹é…ä¸­çš„æœ€åä¸€è¡Œä½œä¸ºé€šé…ç¬¦ * case _ =\u003e \"this is match anything other than before cases \" * * expr match { * * case List(1,_,_) =\u003e \" a list with three element and the first element is 1\" * case List(_*) =\u003e \" a list with zero or more elements \" * case Map[_,_] =\u003e \" matches a map with any key type and any value type \" * case _ =\u003e * } * * * //import ä¸­ä½œä¸ºé€šé…ç¬¦å’Œéšè—ç¬¦ * import java.util.{ ArrayList =\u003e _, _} * //ç¬¬ä¸€ä¸ªä¸‹åˆ’çº¿è¡¨ç¤ºéšè— ArrayListï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºé€šé…ç¬¦ï¼Œå¯¼å…¥æ‰€æœ‰ * * //å°†æ–¹æ³•å˜ä¸º value * method _ // Eta expansion of method into method value * * //tuple çš„è®¿é—® * tpl._2 //è¿”å› tpl ç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ³¨æ„ï¼Œtuple æ˜¯ä» 1 å¼€å§‹çš„ * * * //è¿˜æœ‰å¾ˆå¤šé«˜çº§çš„æ¦‚å¿µï¼Œç›®å‰è¿˜ä¸ç†è§£ï¼Œso ä¸Šç»™å‡ºçš„ç­”æ¡ˆ * def f[M[_]] // Higher kinded type parameter * def f(m: M[_]) // Existential type * _ + _ // Anonymous function placeholder parameter * m _ // Eta expansion of method into method value * m(_) // Partial function application * _ =\u003e 5 // Discarded parameter * case _ =\u003e // Wild card pattern -- matches anything * val (a, _) = (1, 2) // same thing * for (_ \u003c- 1 to 10) // same thing * f(xs: _*) // Sequence xs is passed as multiple parameters to f(ys: T*) * case Seq(xs @ _*) // Identifier xs is bound to the whole matched sequence * var i: Int = _ // Initialization to the default value * def abc_\u003c\u003e! // An underscore must separate alphanumerics from symbols on identifiers * t._2 */ =\u003e in scala å‡½æ•°å­—é¢é‡åˆ†éš”å‚æ•°å’Œå‡½æ•°ä½“ åœ¨å‡½æ•°å­—é¢é‡ä¸­ =\u003eåˆ†éš”å‚æ•°å’Œå‡½æ•°ä½“ã€‚ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ç±»å‹ã€‚ (x: Int) =\u003e x * 2è¡¨ç¤ºä¸€ä¸ªåŒ¿åå‡½æ•°,æ¥æ”¶ä¸€ä¸ªæ•´æ•°,è¿”å›å‚æ•°ä¹˜ä»¥2çš„ç»“æœ. scala\u003e val f: Function1[Int,String] = argInt =\u003e \"my int: \"+argInt.toString f: Int =\u003e String = // Int =\u003e String ç­‰ä»· Function1[Int,String] scala\u003e val f2: Int =\u003e String = myInt =\u003e \"my int v2: \"+myInt.toString f2: Int =\u003e String = //æ³¨æ„ï¼ŒåŒ¿åå‡½æ•°æ²¡æœ‰å‚æ•°ä¹Ÿè¦æ‹¬å· ()=\u003e{}ï¼› //() =\u003e Unit è¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•° call-by-name parameter åœ¨å‡½æ•°çš„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨=\u003e(e.g. def f(arg: =\u003e T)) è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯\"by-name parameter\",è¡¨ç¤ºè¿™ä¸ªå‚æ•°åªæœ‰åœ¨å‡½æ•°ä½“ä¸­åŒ…å«è¿™ä¸ªå‚æ•°çš„è¯­å¥è¢«æ‰§è¡Œæ‰ä¼šè¢« evaluate. è¿™ä¸ªç‰¹ç‚¹å« call-by-name,arg å¯ä»¥æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œç”šè‡³å‡½æ•°ï¼Œåœ¨ä¼ é€’ç»™ f æ—¶ä¸ä¼š evaluateï¼Œåªæœ‰ f å‡½æ•°ä½“å†…éƒ¨è°ƒç”¨ arg æ—¶ï¼Œarg æ‰ä¼šè¢«æ‰§è¡Œã€‚ scala\u003e def now()={println(\"nano time:\");System.nanoTime} scala\u003e def callByName(p: =\u003e Long):Long = {println(\"call-by-name:\"+p);p;} callByName: (p: =\u003e Long)Long scala\u003e def justCall(p : Long) :Long = {println(\"just-call:\"+p);p;} justCall: (p: Long)Long scala\u003e callByName(now()) nano time: call-by-name:5664511571389 nano time: res2: Long = 5664511727048 //now() åœ¨ callByName çš„å‡½æ•°ä½“çš„æ¯ä¸ªå‡ºç°çš„åœ°æ–¹éƒ½æ‰§è¡Œäº† scala\u003e justCall(now()) nano time: just-call:5667489483159 res3: Long = 5667489483159 //now() åªåœ¨ä¼ é€’å‚æ•°çš„æ—¶å€™è¢«æ‰§è¡Œäº†ã€‚ æ¨¡å¼åŒ¹é…ä¸­åˆ†éš” case æ¨¡å¼å’Œè¿”å›å€¼ åœ¨ case è¯­å¥ä¸­ï¼Œ=\u003e åˆ†éš”æ¨¡å¼å’Œè¿”å›è¡¨è¾¾å¼ã€‚ var a = 1 a match{ case 1 =\u003e println(\"One\") case 2 =\u003e println(\"Two\") case _ =\u003e println(\"No\") } () {} in method call // è§„åˆ™ 1:{}è¡¨ç¤º code blockï¼Œä½ å¯ä»¥åœ¨é‡Œé¢æ”¾å‡ ä¹ä»»ä½•è¯­å¥ï¼Œblock çš„è¿”å›å€¼æ˜¯ç”±æœ€åä¸€å¥å†³å®š // è§„åˆ™ 2:block å†…å®¹å¦‚æœåªæœ‰ä¸€å¥å¯ä»¥çœç•¥{},ä½†æ˜¯ case clause é™¤å¤–:{case ...} // è§„åˆ™ 3: å•å‚æ•°æ–¹æ³•å¦‚æœå®å‚æ˜¯ code blockï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥ () { import util.Try println{\"hello\"} 5 } val tupleList = List[(String, String)]() //è§„åˆ™ 2 tupleList takeWhile( { case(t1,t2) =\u003e t1==t2 } ) // è§„åˆ™ 2 List(1, 2, 3).reduceLeft(_+_) // ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œæç¤ºï¼šéšå¼è½¬æ¢ val r = List(1, 2, 3).foldLeft(0) {_+_} //val l = r{\"hello\"} //ä¸è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³• def loopf(x: Int): Int = loopf {x} //ä½¿ç”¨{}çš„ç‰¹æ®Šæƒ…å†µ:for æ¨å¯¼å¯ä»¥å’Œ () äº’æ¢ï¼Œä¸€èˆ¬å»ºè®®æ˜¯é™¤äº† yield çš„å…¶ä»–æƒ…å†µéƒ½ç”¨ () for{tpl \u003c-tupleList} yield tpl._2 //ä¸å»ºè®® for{tpl \u003c-tupleList} { println(tpl) } //æ¨è for(tpl \u003c-tupleList) { println(tpl) } //è¡¥å……ï¼Œæ–¹æ³•å®šä¹‰æ—¶å¦‚æœæ²¡æœ‰è¿”å›å€¼å¯ä»¥çœç•¥=,ç§°ä¸º procedure,scala 2.13 å·²ç»åºŸå¼ƒï¼Œä¸è¦è¿™ä¹ˆå†™ //don't def p(in:String ){ println(s\"hello $in\") } implicit implicit åˆ†ä¸ºéšå¼å‚æ•°å’Œéšå¼è½¬æ¢æ–¹æ³•ã€‚ éšå¼å‚æ•° //1.éšå¼å‚æ•° class Prefixer(val prefix: String) def addPrefix(s: String)(implicit p: Prefixer) = p.prefix + s // addPrefix éœ€è¦æä¾›ä¸€ä¸ªéšå¼å®é™…å‚æ•°ï¼Œå¦åˆ™æŠ¥é”™ã€‚å½“ç„¶å¯ä»¥åœ¨è°ƒç”¨æ—¶æ˜¾å¼ä¼ é€’ä¸€ä¸ªå‚æ•° implicit val myImplicitPrefixer = new Prefixer(\"***\") addPrefix(\"abc\") // returns \"***abc\" éšå¼è½¬æ¢ //1. å®šä¹‰ä¸€ä¸ªå«æœ‰ç›®æ ‡æ–¹æ³•çš„ class class BlingString(s:String) { def bling = \"*\"+s+\"*\" } //2. å®šä¹‰éšå¼è½¬æ¢æ–¹æ³• implicit def str2BlingString(s:String) = new BlingString(s) //3. ä½¿ç”¨ç›®æ ‡æ–¹æ³• val s = \"hello\" s.bling // *hello* //åœ¨ scala.Predef ä¸­å®šä¹‰äº†å¤§é‡çš„éšå¼è½¬æ¢ï¼Œä¾‹å¦‚ RichInt,StringOps è¿™äº›ï¼Œæä¾›ç±»ä¼¼ mkString è¿™äº›æ–¹æ³• //å¤ªé˜³åº•ä¸‹æ— æ–°äº‹ï¼Œscala å¸¸ç”¨å¯¹è±¡çš„çµæ´»ä¸°å¯Œçš„è¯­æ³•éƒ½æ˜¯é€šè¿‡éšå¼è½¬æ¢æ·»åŠ çš„ã€‚ implicit class å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¬¬ 1,2 æ­¥éå¸¸çš„ç¹çï¼Œäºæ˜¯SIP-13æå‡ºä¸€ä¸ªimplicit class,å°†ä¸Šé¢çš„ 2 æ­¥åˆå¹¶ï¼š implicit class BlingString(s:String) { def bling = \"*\"+s+\"*\" } //implicit def str2BlingString(s:String) = new BlingString(s) val hi = \"hello\" hi.bling // *hello* æ³¨æ„ï¼Œè¿™ä¸ªåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚å»ç³–åå°±æ˜¯ä¸Šé¢çš„é‚£ä¸ªå½¢å¼ã€‚implicit class æœ‰ 3 ä¸ªçº¦æŸå’Œä¸€ä¸ªæ³¨è§£é—®é¢˜ï¼š å¿…é¡»è¦æœ‰ä¸»ä¸€ä¸ªæ„é€ å‡½æ•°ä¸”åªèƒ½ä¸€ä¸ªæ„é€ å‚æ•°ï¼ˆimplicit å‚æ•°é™¤å¤–ï¼‰.æ„é€ å‚æ•°å°±æ˜¯æºç±»å‹ã€‚è¿™ä¸ªæ„é€ å‡½æ•°å³ç­‰ä»·ä¸Šé¢ç¬¬ 2 æ­¥çš„éšå¼è½¬æ¢æ–¹æ³•ï¼š implicit class RichDate(date: java.util.Date) // OK! implicit class Indexer[T](collecton: Seq[T], index: Int) // BAD! implicit class Indexer[T](collecton: Seq[T])(implicit index: Index) // OK! åªèƒ½å®šä¹‰åœ¨å…¶ä»– trait/class/object ä¸­ï¼š object Helpers { implicit class RichInt(x: Int) // OK! } implicit class RichDouble(x: Double) // BAD! åœ¨å½“å‰ scope å†…ï¼Œä¸å…è®¸æœ‰å’Œ implicit class åŒåçš„æ–¹æ³•ï¼Œå¯¹è±¡ï¼Œå˜é‡ã€‚å› ä¸º case class ä¼šè‡ªåŠ¨ç”ŸæˆåŒå object å¯¹è±¡ï¼Œæ‰€ä»¥ implicit class ä¸èƒ½æ˜¯ case class. object Bar implicit class Bar(x: Int) // BAD! val x = 5 implicit class x(y: Int) // BAD! //cuz case class has companion object by default implicit case class Baz(x: Int) // BAD! conflict with the companion object è¿˜æœ‰å°±æ˜¯ implicit class çš„æ³¨è§£åœ¨å»è¯­æ³•ç³–åä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç±»å’Œæ–¹æ³•ï¼Œé™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜èŒƒå›´ï¼š @bar implicit class Foo(n: Int) //desugar @bar implicit def Foo(n: Int): Foo = new Foo(n) @bar class Foo(n:Int) //é™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜ï¼šgenClass / method @(bar @genClass) implicit class Foo(n: Int) //desugar å¾—åˆ° @bar class Foo(n: Int) implicit def Foo(n: Int): Foo = new Foo(n) value class scala è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼švalue class class Wrapper(val underlying: Int) extends AnyVal //1. ä¸€ä¸ª public val å‚æ•°è¡¨ç¤º runtime ç±»å‹ï¼Œè¿™é‡Œæ˜¯ Int. ç¼–è¯‘æ—¶æ˜¯ Wrapper ç±»å‹ï¼Œæ‰€ä»¥ value class ç›®çš„æ˜¯é™ä½åˆ†é…å¼€é”€ã€‚ //2. value class éœ€è¦ extends AnyVal //3. value class åªèƒ½æœ‰ defs, ä¸èƒ½æœ‰ vals, vars, or nested traits, classes or objects, // å› ä¸º def æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼Œè€Œ val,var è¿™äº›åˆ™å¿…é¡»åˆ›å»ºç›¸åº”ç±»å‹äº†ã€‚ //4. value class åªèƒ½æ‰©å±•é€šç”¨ traitï¼ˆuniversal traitsï¼‰, // universal traits æ˜¯ A universal trait is a trait that extends Any, only has defs as members, and does no initialization. // extension method å½“ implicit class ç±»å‹å‚æ•°æ˜¯ AnyVal å­ç±»æ—¶ï¼Œvalue class å’Œä¸Šé¢çš„ implicit class å½¢å¼ç›¸è¿‘ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ value class é™ä½ implicit class çš„åˆ†é…å¼€é”€ã€‚ä¾‹å¦‚ RichtInt implicit class RichInt(val self: Int) extends AnyVal { def toHexString: String = java.lang.Integer.toHexString(self) } å› ä¸º RichInt æ˜¯ value classï¼Œåœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä¸ä¼šæœ‰ RichInt è¿™ä¸ªç±»ï¼Œè€Œæ˜¯ Intï¼Œè€Œ3.toHexStringå®é™…æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼š RichInt$.MODULE$.extension$toHexString(3),è¿™ä¹ˆåšå¥½å¤„æ˜¯å‡å°‘å¯¹è±¡åˆ†é…å¼€é”€ (avoid the overhead of allocation).å¦‚æœ implicit class çš„ç±»å‹å‚æ•°ä¸æ˜¯ AnyVal å­ç±»ï¼Œé‚£ä¹ˆåœ¨ runtime æ—¶ä¼šæœ‰ç›¸åº”ç±»å‹å¯¹è±¡è¢«åˆ›å»ºï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°åŒºåˆ«ã€‚ value class è¿˜æœ‰å…¶ä»–ä½œç”¨å’Œå±€é™æ€§ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢é“¾æ¥ã€‚å¦‚æœå‘ç°é”™è¯¯ï¼Œè¯·æŒ‡å‡ºï¼Œå…ˆè°¢è¿‡ã€‚ Implicit Design Patterns in Scalaâ€‹www.lihaoyi.com The Neophyteâ€™s Guide to Scalaâ€‹ é›†åˆç±»çš„ implicit è½¬æ¢ //scala é›†åˆå’Œ java é›†åˆçš„è½¬æ¢æ˜¯ scala ç¼–ç¨‹æœ€å¸¸ç”¨çš„ï¼Œæ¯•ç«Ÿ java æœ‰å¤§é‡ç¬¬ä¸‰æ–¹åº“ã€‚ //scala æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯éšå¼è½¬æ¢ collection.JavaConversions(scala 2.8) //å¾ˆå¿«æ„è¯†åˆ°éšå¼è½¬æ¢å¯¹äºä½¿ç”¨è€…çš„ä»£ç é˜…è¯»æ¯”è¾ƒå¤æ‚ï¼Œåœ¨ 2.8.1 æä¾›äº†æ˜¾ç¤ºè½¬æ¢ collection.JavaConverters, //å…ˆçœ‹ JavaConversions éšå¼è½¬æ¢ï¼š object JavaConversions extends WrapAsScala with WrapAsJava //åœ¨ WrapAsJava implicit def mapAsJavaMap[A, B](m: Map[A, B]): ju.Map[A, B] = m match { case null =\u003e null case JMapWrapper(wrapped) =\u003e wrapped.asInstanceOf[ju.Map[A, B]] case _ =\u003e new MapWrapper(m) } //ç„¶åçœ‹ä¸‹ collection.JavaConverters._ï¼Œç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯æ¢æ±¤ä¸æ¢è¯ï¼Œåº•å±‚è¿˜æ˜¯éšå¼è½¬æ¢ï¼Œ object JavaConverters extends DecorateAsJava with DecorateAsScala //åœ¨ DecorateAsJava ä¸­æœ‰å¾ˆå¤šéšå¼è½¬æ¢æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°† scala é›†åˆè½¬æ¢ä¸º AsJava å¯¹è±¡ //(æ³¨æ„ä¸‹é¢çš„ juï¼Œæ˜¯ java.util ç¼©å†™ï¼Œè¯¦æƒ…è§ [å¾æœ scala_1](https://zhuanlan.zhihu.com/p/22670426)) implicit def seqAsJavaListConverter[A](b : Seq[A]): AsJava[ju.List[A]] = new AsJava(seqAsJavaList(b)) // è€Œ AsJava ä¸­å®šä¹‰äº† asJava æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ scala é›†åˆä¸Šé¢è°ƒç”¨ asJava class AsJava[A](op: =\u003e A) { /** Converts a Scala collection to the corresponding Java collection */ def asJava: A = op } //å¹¶ä¸” asJava æ–¹æ³•çš„å®ç°æ˜¯ä½œä¸ºæ„é€ å‚æ•°ä¼ å…¥ AsJava çš„ //ä¸Šé¢çš„ seqAsJavaList å°±æ˜¯å°† scala.Seq è½¬æ¢ä¸º ju.List çš„å…·ä½“å®ç° def seqAsJavaList[A](s: Seq[A]): ju.List[A] = s match { case null =\u003e null case JListWrapper(wrapped) =\u003e wrapped.asInstanceOf[ju.List[A]] case _ =\u003e new SeqWrapper(s) } //ç»¼ä¸Šï¼ŒJavaConverters ç”¨çš„è¿˜æ˜¯éšå¼è½¬æ¢ï¼Œåªä¸è¿‡å¢åŠ äº†ä¸€ä¸ªä¸­é—´ç±» AsJava/AsScala. éšå¼è½¬æ¢çš„ scope //æ— è®ºæ˜¯éšå¼å‚æ•°è¿˜æ˜¯éšå¼è½¬æ¢ï¼Œç¼–è¯‘å™¨éƒ½è¦çŸ¥é“å»å“ªé‡ŒæŸ¥æ‰¾è¿™äº› implicit å‚æ•°æˆ–è€…æ–¹æ³•ï¼Œ //ä¾‹å¦‚ import collection.JavaConverters._ //ç”±äº scala import å¯ä»¥å‡ºç°åœ¨ä»»ä½•åœ°æ–¹ï¼Œè¿™ä¸ºæ§åˆ¶ implicit çš„ scope æä¾›äº†çµæ´»æ€§ //è¿™ä¸€å—æˆ‘ä¸æ˜¯å®Œå…¨æ¸…æ¥šï¼Œåªæä¾›ä¸€ä¸ªè‡ªå·±çš„ç†è§£ // 1.é¦–å…ˆæ˜¯å½“å‰ scope çš„ Implicits å®šä¹‰ï¼Œä¾‹å¦‚ï¼Œå½“å‰æ–¹æ³•å†…ï¼Œclass å†… // 2.æ˜¾å¼å¯¼å…¥ import collection.JavaConversions.asScalaIterator // 3.é€šé…ç¬¦å¯¼å…¥ import collection.JavaConverters._ // 4.ç±»å‹çš„ä¼´ç”Ÿå¯¹è±¡å†… (è¿™ä¸ªå¸¸ç”¨) // 5.å‚æ•°ç±»å‹çš„éšå¼ scope (2.9.1 æ·»åŠ ):class æ„é€ å‚æ•°çš„éšå¼è½¬æ¢æœç´¢è¿”å›ä¼šè¢«åº”ç”¨åˆ° class A(val n: Int) { def +(other: A) = new A(n + other.n) } object A { implicit def fromInt(n: Int) = new A(n) } new A(1) + 2 // new A(1) + A.fromInt(2) //6.ç±»å‹å‚æ•°çš„éšå¼è½¬æ¢ï¼Œä¸‹é¢çš„ sorted æ–¹æ³•æœŸæœ›æœ‰ä¸€ä¸ª Ordering[A], //åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­æä¾›äº†ä¸€ä¸ª A -\u003e Ordering[A] , class A(val n: Int) object A { implicit val ord = new Ordering[A] { def compare(x: A, y: A) = implicitly[Ordering[Int]].compare(x.n, y.n) } } List(new A(5), new A(2)).sorted // æ³¨æ„ implicitly[Ordering[Int]] è¡¨ç¤ºåœ¨å½“å‰ scope å†…æœç´¢ä¸€ä¸ªéšå¼å‚æ•°å€¼ def implicitly[T](implicit e: T): T = e string // The s String Interpolator: val name = \"James\" println(s\"Hello, $name\") // Hello, James // The f Interpolator val height = 1.9d val name = \"James\" println(f\"$name%s is $height%2.2f meters tall\") // James is 1.90 meters tall // The raw Interpolator // The raw interpolator is similar to the s interpolator except that // it performs no escaping of literals within the string. // Hereâ€™s an example processed string // å³ä¸ç¿»è¯‘è½¬ä¹‰å­—ç¬¦ scala\u003eraw\"a\\nb\" res1: String = a\\nb // \"\"\" triple quotes string // triple quotes \"\"\" to escape characters val donutJson4: String = \"\"\" |{ |\"donut_name\":\"Glazed Donut\", |\"taste_level\":\"Very Tasty\", |\"price\":2.50 |} \"\"\" .stripMargin // |ä¼šè¢«å¿½ç•¥ // \"\"\"è¿˜æœ‰ä¸ªå¾ˆå¥½çš„ç”¨å¤„ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼š // åœ¨ java ä¸­è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ï¼Œ\"\\\\s+\" // åœ¨ scala ä¸­åªè¦ \"\"\"\\s+\"\"\",å¯¹äºå¤æ‚æ­£åˆ™è¡¨è¾¾å¼éå¸¸æœ‰ç”¨ã€‚ links https://www.btbytes.com/scala.html https://booksites.artima.com/programming_in_scala_2ed/examples/index.html http://blog.higher-order.com/assets/fpiscompanion.pdf https://courses.cs.washington.edu/courses/cse341/09au/notes/scala.html https://github.com/dnvriend/my-scala-notes https://gist.github.com/jamesyang124/d65b067327452792287a ","title":"Scala å­¦ä¹ ç¬”è®°","uri":"/post/scala2-notes/"},{"content":"ä½¿ç”¨ redis çš„ hash ä¼˜åŒ–å†…å­˜ä½¿ç”¨ é—®é¢˜å’Œæ–¹æ¡ˆ åœºæ™¯ï¼šæœ‰ 3 äº¿å¼ å›¾ç‰‡æ”¾åœ¨å¯¹è±¡å­˜å‚¨ (DELL ECS/AMAZON EC2) ä¸Šé¢ï¼Œç°åœ¨éœ€è¦ä¿å­˜å›¾ç‰‡çš„ id-\u003eç”¨æˆ· id çš„æ˜ å°„ã€‚æœ€ç›´æ¥çš„æ€è·¯æ˜¯ï¼š set \"media:1155220\" \"user1\" set \"media:1155221\" \"user2\" è¿™æ ·è®¾è®¡ key ä¹‹å 3 äº¿å¼ å›¾ç‰‡éœ€è¦ 21GB çš„å†…å­˜ï¼Œå› ä¸º redis çš„ string æ˜¯çº¿æ€§å¢é•¿çš„ã€‚ æ­¤æ—¶å¯ä»¥ä½¿ç”¨ hash ä¼˜åŒ–å†…å­˜ä½¿ç”¨.hash æ˜¯ç±»ä¼¼ java hashmap çš„æ•°æ®ç»“æ„ï¼škey field1 value1 field2 value2 â€¦ hash çš„å¼ºå¤§åœ¨äºå®ƒå¯ä»¥åªè·å–ä¸€ä¸ª field çš„ valueï¼Œè€Œæ— éœ€è¿”å›æ•´ä¸ª key. å†ä»”ç»†æƒ³æƒ³ï¼Œhash çš„ key å¯ä»¥ç±»æ¯”äºåˆ†åº“åˆ†è¡¨çš„ bucket æ¦‚å¿µã€‚ å›åˆ°ä¸Šé¢çš„é—®é¢˜ï¼ŒMike Krieger,Instagram çš„åˆ›å§‹äººæå‡ºå°†å›¾ç‰‡çš„ id é™¤ä»¥ 1000 åˆ†ç‰‡ (sharding) åˆ° 1000 ä¸ª hash key ä¸Šï¼š HSET \"mda-bkt:1155\" \"1155220\" \"user1\" \"1155221\" \"user2\" # mda-bkt:1155 æ˜¯1155220/1000ä¹‹åå¾—åˆ°çš„bucket. HGET \"mda-bkt:1155\" \"1155220\" # è¿™é‡Œkeyçš„å‰ç¼€*mda-bkt:)åªé‡å¤äº†1000æ¬¡,è€Œä¸Šé¢çš„stringæ–¹å¼é‡å¤äº†3äº¿æ¬¡. å› ä¸º redis é’ˆå¯¹hash list zsetä¸‰ç§ç»“æ„ä½¿ç”¨äº†ziplisté«˜æ•ˆå­˜å‚¨æ–¹æ¡ˆã€‚ æ–°çš„é—®é¢˜åˆæ¥äº†ï¼Œredis å¯¹äºziplistç»“æ„çš„ key æ•°é‡æœ‰é™åˆ¶çš„ï¼Œå³hash-max-ziplist-entriesçš„å«ä¹‰æ˜¯ï¼šå¯ä½¿ç”¨å†…éƒ¨ç©ºé—´ä¼˜åŒ–å­˜å‚¨çš„æœ€å¤š hash key ä½¿ç”¨ziplistçš„æ•°æ®ç»“æ„æœ‰ä¸‰ä¸ªlist hash zset: list-max-ziplist-entries 512 list-max-ziplist-value 64 #Limits for ziplist use with LISTs. hash-max-ziplist-entries 512 hash-max-ziplist-value 64 #Limits for ziplist use with HASHes (previous versions of Redis used a different name and encoding for this) #hash-max-zipmap-entries 512 (for Redis \u003c 2.6). zset-max-ziplist-entries 128 zset-max-ziplist-value 64 #Limits for ziplist use with ZSETs. ä½ å¯ä»¥ä½¿ç”¨debug_object(key)æŸ¥çœ‹ä½ çš„ key æ˜¯å¦ä½¿ç”¨äº†ziplistç»“æ„ã€‚ å»ºè®®hash-max-ziplist-entriesæœ€å¤§è®¾ç½®ä¸º 1000ï¼Œè¿‡å¤§ä¼šå½±å“ redis æ€§èƒ½ã€‚ å‚è€ƒèµ„æ–™ redis moemory optimize 9.1.1 The ziplist representation-EBOOK â€“ REDIS IN ACTION source:Understanding Redis hash-max-ziplist-entries ","title":"ä½¿ç”¨ redis çš„ hash ä¼˜åŒ–å†…å­˜ä½¿ç”¨[ç¿»è¯‘]","uri":"/post/redis-hash-optimize-memory-usage/"},{"content":"éšå¼å‚æ•° //éšå¼å‚æ•°æ˜¯åœ¨è°ƒç”¨æ—¶å¯ä»¥è‡ªåŠ¨å¡«å……çš„å‚æ•°ï¼Œéœ€è¦åœ¨è°ƒç”¨èŒƒå›´å†…ï¼ˆscope) æœ‰ä¸€ä¸ªéšå¼å˜é‡å¯ä¾›å¡«å……ã€‚ def addInt(i:Int)(implicit n: Int) = i + n //éœ€è¦æä¾›ä¸€ä¸ªéšå¼å˜é‡ n implicit val sn = 1 addInt(2) // 3 //å¦‚æœæœ‰ä¸¤ä¸ªæ»¡è¶³ç±»å‹çš„éšå¼å˜é‡ï¼Œåˆ™åœ¨ç¼–è¯‘ addInt(2) æ—¶æŠ¥é”™ //scala çš„æ–¹æ³•ä¸­ ExecutionContext ä¸€èˆ¬ä½œä¸º implicit å‚æ•°ã€‚ éšå¼è½¬æ¢æ–¹æ³• å¦‚æœæƒ³è¦ç»™ String å®ç°ä¸€ä¸ª mkStr æ–¹æ³•ï¼Œç®€å•çš„ç»™ String æ·»åŠ ä¸€ä¸ª Ops! å‰ç¼€å†è¿”å›ã€‚\n//1. é¦–å…ˆå®ç°ä¸€ä¸ªåŒ…å«ç›®æ ‡æ–¹æ³•çš„ç±»å‹ï¼Œå®ç°è¯¥æ–¹æ³• class StrOps(s:String) { def mkStr(): String = { return \"Ops! \" + s } } //2. å‘Šè¯‰ scala ç¼–è¯‘å™¨ String å¯ä»¥é€šè¿‡ç±»å‹è½¬æ¢è·å¾— mkStr è¿™ä¸ªæ–¹æ³•ï¼š implicit final def string2StrOps(s: String) = new StrOps(s) //3. ç°åœ¨ç”¨æˆ·å¯ä»¥ç›´æ¥è®¤ä¸º String æœ‰ mkStr æ–¹æ³• val s = \"who changed my string\" s.mkStr() //res2: String = Ops! who changed my string //åœ¨ scala.Predef ä¸­å®šä¹‰äº†å¤§é‡çš„éšå¼è½¬æ¢ï¼Œä¾‹å¦‚ RichInt,RichDouble,StringOps è¿™äº› implicit class å¯ä»¥çœ‹åˆ°ç¬¬ 2 æ­¥éå¸¸çš„å†—ä½™ï¼Œäºæ˜¯SIP-13æå‡ºä¸€ä¸ª implicit classï¼Œå°†ä¸Šé¢çš„ 1,2 æ­¥åˆå¹¶ï¼š\nimplicit class StrOps(s:String) { def mkStr(): String = { return \"Ops! \" + s } } æ³¨æ„ï¼Œè¿™ä¸ªåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚å»ç³–åå°±æ˜¯ä¸Šé¢çš„é‚£ä¸ªå½¢å¼ã€‚implicit class æœ‰ 3 ä¸ªçº¦æŸå’Œä¸€ä¸ªæ³¨è§£é—®é¢˜ï¼š\nå¿…é¡»è¦æœ‰ä¸»ä¸€ä¸ªæ„é€ å‡½æ•°ä¸”åªèƒ½ä¸€ä¸ªæ„é€ å‚æ•°ï¼ˆimplicit å‚æ•°é™¤å¤–ï¼‰.æ„é€ å‚æ•°å°±æ˜¯æºç±»å‹ã€‚è¿™ä¸ªæ„é€ å‡½æ•°å³ç­‰ä»·ä¸Šé¢ç¬¬ 2 æ­¥çš„éšå¼è½¬æ¢æ–¹æ³•ï¼š\nimplicit class RichDate(date: java.util.Date) // OK! implicit class Indexer[T](collecton: Seq[T], index: Int) // BAD! implicit class Indexer[T](collecton: Seq[T])(implicit index: Index) // OK! åªèƒ½å®šä¹‰åœ¨å…¶ä»– trait/class/object ä¸­ï¼š\nobject Helpers { implicit class RichInt(x: Int) // OK! } implicit class RichDouble(x: Double) // BAD! åœ¨å½“å‰ scope å†…ï¼Œä¸å…è®¸æœ‰å’Œ implicit class åŒåçš„æ–¹æ³•ï¼Œå¯¹è±¡ï¼Œå˜é‡ã€‚å› ä¸º case class ä¼šè‡ªåŠ¨ç”ŸæˆåŒå object å¯¹è±¡ï¼Œæ‰€ä»¥ implicit class ä¸èƒ½æ˜¯ case class.\nobject Bar implicit class Bar(x: Int) // BAD! val x = 5 implicit class x(y: Int) // BAD! //cuz case class has companion object by default implicit case class Baz(x: Int) // BAD! conflict with the companion object è¿˜æœ‰å°±æ˜¯ implicit class çš„æ³¨è§£åœ¨å»è¯­æ³•ç³–åä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç±»å’Œæ–¹æ³•ï¼Œé™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜èŒƒå›´ï¼š\n@bar implicit class Foo(n: Int) //desugar @bar implicit def Foo(n: Int): Foo = new Foo(n) @bar class Foo(n:Int) //é™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜ï¼šgenClass / method @(bar @genClass) implicit class Foo(n: Int) //desugar å¾—åˆ° @bar class Foo(n: Int) implicit def Foo(n: Int): Foo = new Foo(n) implicitly æ–¹æ³• scala çš„ PreDef ä¸­æœ‰æœ‰ä¸€ä¸ª implicitly æ–¹æ³•ï¼Œè¡¨ç¤ºåœ¨å½“å‰ scope å¾å¬ä¸€ä¸ªéšå¼å˜é‡å¹¶è¿”å›è¯¥å˜é‡ã€‚\n//PreDef @inline def implicitly[T](implicit e: T) = e implitly[T] means return implicit value of type T in the context\nimplicit class Foo(val i: Int) { def addValue(v: Int): Int = i + v } implicit val foo:Foo = Foo(1) val fooImplicitly = implicitly[Foo] // Foo(1) value class scala è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼švalue class\nclass Wrapper(val underlying: Int) extends AnyVal //1. ä¸€ä¸ª public val å‚æ•°è¡¨ç¤º runtime ç±»å‹ï¼Œè¿™é‡Œæ˜¯ Int. ç¼–è¯‘æ—¶æ˜¯ Wrapper ç±»å‹ï¼Œæ‰€ä»¥ value class ç›®çš„æ˜¯é™ä½åˆ†é…å¼€é”€ã€‚ //2. value class éœ€è¦ extends AnyVal //3. value class åªèƒ½æœ‰ defs, ä¸èƒ½æœ‰ vals, vars, or nested traits, classes or objects, // å› ä¸º def æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼Œè€Œ val,var è¿™äº›åˆ™å¿…é¡»åˆ›å»ºç›¸åº”ç±»å‹äº†ã€‚ //4. value class åªèƒ½æ‰©å±• é€šç”¨ traitï¼ˆuniversal traitsï¼‰, // universal traits æ˜¯ A universal trait is a trait that extends Any, only has defs as members, and does no initialization. extension method å½“ implicit class ç±»å‹å‚æ•°æ˜¯AnyValå­ç±»æ—¶ï¼Œvalue class å’Œä¸Šé¢çš„ implicit class å½¢å¼ç›¸è¿‘ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ value class é™ä½ implicit class çš„åˆ†é…å¼€é”€ã€‚ä¾‹å¦‚ RichtInt\nimplicit class RichInt(val self: Int) extends AnyVal { def toHexString: String = java.lang.Integer.toHexString(self) } å› ä¸º RichInt æ˜¯ value classï¼Œåœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä¸ä¼šæœ‰ RichInt è¿™ä¸ªç±»ï¼Œè€Œæ˜¯ Intï¼Œè€Œ 3.toHexString å®é™…æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼š RichInt$.MODULE$.extension$toHexString(3),è¿™ä¹ˆåšå¥½å¤„æ˜¯å‡å°‘å¯¹è±¡åˆ†é…å¼€é”€ï¼ˆavoid the overhead of allocationï¼‰.å¦‚æœ implicit class çš„ç±»å‹å‚æ•°ä¸æ˜¯ AnyVal å­ç±»ï¼Œé‚£ä¹ˆåœ¨ runtime æ—¶ä¼šæœ‰ç›¸åº”ç±»å‹å¯¹è±¡è¢«åˆ›å»ºï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°åŒºåˆ«ã€‚\nvalue class è¿˜æœ‰å…¶ä»–ä½œç”¨å’Œå±€é™æ€§ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢é“¾æ¥ã€‚\n","title":"Scala 2 Implicit","uri":"/post/scala-implicit/"},{"content":"å¦‚ä½•ä½¿ç”¨ github pages å’Œ github actions æ„å»ºé™æ€ä¸ªäººåšå®¢ç«™ç‚¹ update at 2021 æ›´æ–°ï¼šgithub å¼€æ”¾ action åŠŸèƒ½åï¼Œtravis-ci å·²ç»æ²¡æœ‰å¿…è¦äº†ï¼Œç›®å‰åšå®¢ä½¿ç”¨ zhimoe ä»“åº“ç®¡ç†æºç ï¼Œä½¿ç”¨ action ç¼–è¯‘åå°† public ç›®å½•åŒæ­¥åˆ° zhimoe.github.io ä»“åº“çš„ gh-pages åˆ†æ”¯ã€‚ æ³¨æ„ï¼Œç”±äºä½¿ç”¨äº† jsdelivr çš„ cdn åŠŸèƒ½ï¼Œåˆ‡æ¢åˆ†æ”¯å theme çš„ç›¸å…³é™æ€æ–‡ä»¶çš„ path ä¹Ÿè¦ä¿®æ”¹ã€‚ github ç»™ä¸ªäººå’Œç»„ç»‡å…è´¹æä¾› github pages åŠŸèƒ½ã€‚å°±æ˜¯è¯´å¦‚æœæœ‰ä¸ª repo çš„åå­—ä¸º zhimoe.github.io (zhimoe ä¸ºä½ çš„ github username), é‚£ä¹ˆè¿™ä¸ª repo é‡Œé¢çš„ master æˆ–è€… gh-pages åˆ†æ”¯çš„å†…å®¹å¦‚æœå­˜åœ¨ index.html, é‚£ä¹ˆå…¶ä»–äººå¯ä»¥é€šè¿‡ https://zhimoe.github.io è®¿é—®è¿™ä¸ªç«™ç‚¹ã€‚ å€ŸåŠ©äºä¸€äº› static gen å·¥å…·ï¼Œä½ å¯ä»¥å°†ä½ çš„ markdown è½¬æ¢ä¸ºä¸€ä¸ªé™æ€ç½‘ç«™ (html,js,css). ç„¶åæŠŠé™æ€ç½‘ç«™çš„å†…å®¹ä¸Šä¼ åˆ°åˆšè¯´çš„ repo ä¸­ï¼Œå°±æœ‰ä¸€ä¸ªè‡ªå·±çš„åšå®¢ç«™ç‚¹äº†ã€‚static gen å·¥å…·éå¸¸å¤šï¼Œgithub æ¨èçš„æ˜¯Jekyll(ruby), ä¸»æµçš„è¿˜æœ‰ hexo(js) å’Œ hugo(go)ã€‚hexo å› ä¸ºæ˜¯åŸºäº js çš„ï¼Œæ‰€ä»¥é«˜è´¨é‡çš„ä¸»é¢˜å¤š (å› ä¸ºåšä¸»é¢˜æ˜¯éœ€è¦ js,css æŠ€èƒ½), hugo çš„ç¼–è¯‘å¿«äº›ï¼Œä½†æ˜¯å¥½çœ‹çš„ä¸»é¢˜ä¸å¤šã€‚é«˜è´¨é‡çš„ä¸»é¢˜é™¤äº†ç¾è§‚å¯èƒ½è¿˜éœ€è¦è€ƒè™‘ç§»åŠ¨ç«¯ (responsive),è¯„è®ºï¼Œè®¿é—®ç»Ÿè®¡ç­‰å„ç§åŠŸèƒ½ã€‚æ¯ä¸ª gen å·¥å…·éƒ½æœ‰è‡ªå·±çš„ä¸»é¢˜ç«™ç‚¹ã€‚hugo çš„ä¸»é¢˜åœ¨è¿™é‡Œæ‰¾ï¼šhugo themes. åˆ¶ä½œ github pages ç«™ç‚¹çš„ä¸€èˆ¬åšæ³•æ˜¯æŠŠä»£ç  (æ”¾å›¾ç‰‡å’Œ markdown) æ”¾åœ¨ master åˆ†æ”¯ï¼Œstatic gen ç¼–è¯‘åçš„ (html,js,css,image) å†…å®¹æ”¾åœ¨ gh-pages åˆ†æ”¯ã€‚ç„¶ååœ¨ settings é‡Œé¢è®¾ç½®ã€‚è¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªç«™ç‚¹äº†ã€‚è¿™ä¹ˆåšæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ markdown æ–‡ä»¶ä¼šè¢«åˆ«äººæ•´ä¸ªä¸‹è½½è¿‡å»ï¼Œä¹‹å‰å°±é‡åˆ°è¿‡ä¸€æ¬¡ã€‚æ­£å¥½ github ç°åœ¨æœ‰ 3 ä¸ªå…è´¹ç§æœ‰ä»“åº“ã€‚æ‰€ä»¥æˆ‘æŠŠæºç æ”¾åœ¨ç§æœ‰ä»“åº“ zhimoe.github.io.src é‡Œé¢ï¼Œè€Œç¼–è¯‘åçš„å†…å®¹å‘å¸ƒçš„ https://zhimoe.github.ioä¸Šé¢å». è‡ªåŠ¨ç¼–è¯‘å‘å¸ƒè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æŒç»­é›†æˆ (continue integration,CI) äº†ï¼Œå³æˆ‘æäº¤ä¸€ä¸ª markdown æ–‡ä»¶ï¼Œæˆ‘çš„ä¸»é¡µä¼šè‡ªåŠ¨çœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œä¸éœ€è¦æˆ‘åœ¨æœ¬åœ°ç¼–è¯‘å†æäº¤ç¼–è¯‘ç»“æœæ–‡ä»¶ã€‚travis-ci æä¾›äº†å…è´¹çš„ github CI æœåŠ¡ã€‚ä½¿ç”¨ github è´¦å·ç™»å½•å°±ä¼šæœ‰æç¤ºæ“ä½œã€‚è¿™é‡Œå‹¾é€‰ç§æœ‰ä»“åº“ zhimoe.github.io.src, ç„¶ååœ¨é¡¹ç›®é‡Œé¢æ·»åŠ .travis.yml æ–‡ä»¶å‘Šè¯‰ travis å¦‚ä½•ç¼–è¯‘å’Œå‘å¸ƒå†…å®¹åˆ°ä¸ªäººç«™ç‚¹ã€‚ markdown æ¸²æŸ“è®¾ç½® hugo ä½¿ç”¨ BlackFriday æ¸²æŸ“ markdown æ–‡ä»¶ï¼Œé»˜è®¤çš„è®¾ç½®æœ‰å‡ ä¸ªè¿‡äºä¸¥æ ¼ï¼š æ²¡æœ‰ç¡¬æ¢è¡Œï¼Œéœ€è¦ä½¿ç”¨\\æ¥è¡¨ç¤ºæ¢è¡Œ æ ‡é¢˜å’Œ#ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ ä»£ç å—å‰é¢å¿…é¡»æœ‰ç©ºè¡Œ åœ¨ config.toml å¯ä»¥ä¿®æ”¹è¿™äº›é…ç½®ï¼š # markdown è§£æå¼•æ“ blackfriday é…ç½®ï¼Œ # extensions : noEmptyLineBeforeBlock-ä»£ç å—å‰é¢æ— éœ€ç©ºè¡Œï¼ŒhardLineBreak-æ¢è¡Œæ— éœ€ä½¿ç”¨ backslash # extensionsmask spaceHeaders-æ ‡é¢˜ä¹‹é—´æ— éœ€ç©ºæ ¼ [blackfriday] angledQuotes = true extensions = [\"hardLineBreak\",\"noEmptyLineBeforeBlock\"] extensionsmask = [\"spaceHeaders\"] fractions = false plainIDAnchors = true travis-ci é…ç½® å°±æ˜¯ä»ä¸€ä¸ªç§æœ‰çš„æºç ä»“åº“ç¼–è¯‘ï¼Œç„¶åå°†ç¼–è¯‘åçš„æ–‡ä»¶å¼ºåˆ¶è¦†ç›–åˆ°ä¸ªäººä¸»é¡µ (å³ username.github.io è¿™ä¸ªä»“åº“) çš„ä»“åº“ä¸­ã€‚å…·ä½“çš„é…ç½®å°±ä¸è¯´äº†ï¼Œæ³¨æ„æ˜¯éœ€è¦ä¸€ä¸ª github çš„ personal-access-key. ä¸‹é¢æ˜¯.travis.yml å†…å®¹ï¼š dist: xenial language: python python: 3.7 # Handle git submodules yourself git: submodules: false # Use sed to replace the SSH URL with the public URL, then initialize submodules before_install: - sudo apt update -qq - sudo apt -yq install apt-transport-https - echo -e \"Host github.com\\n\\tStrictHostKeyChecking no\\n\" \u003e\u003e ~/.ssh/config - git config --global user.email ${GITHUB_EMAIL} - git config --global user.name ${GITHUB_USERNAME} - sed -i 's/git@github.com:/https:\\/\\/github.com\\//' .gitmodules - git submodule update --init --recursive install: # install latest hugo release version # - wget -qO- https://api.github.com/repos/gohugoio/hugo/releases/latest | sed -r -n '/browser_download_url/{/Linux-64bit.deb/{s@[^:]*:[[:space:]]*\"([^\"]*)\".*@\\1@g;p;q}}' | xargs wget # use local hugo pkg for speed - sudo dpkg -i hugo*.deb - rm -rf public 2\u003e /dev/null # compile src to dist script: - hugo -d ./dist/ after_success: - git clone https://zhimoe:${GITHUB_TOKEN}@github.com/zhimoe/zhimoe.github.io.git - cd zhimoe.github.io - git rm -rf . \u0026\u0026 git clean -fxd - mv -v ../dist/* . - git add . - git commit -m \"update site\" - git remote set-url origin https://zhimoe:${GITHUB_TOKEN}@github.com/zhimoe/zhimoe.github.io.git - git remote -v - git push -q -f è¦ç‚¹ï¼š åœ¨é¡¹ç›®çš„æºç ä¸­æ”¾äº† hugo çš„ deb å®‰è£…åŒ…ï¼Œçœå»ä¸‹è½½çš„è¿‡ç¨‹ ä¸»é¢˜ä»¥ submodules æ”¾åœ¨ themes ç›®å½•ä¸­ï¼Œæ‰€ä»¥ç¼–è¯‘å‰ä¸€å®šè¦git submodule update --init --recursiveæ›´æ–°ä¸»é¢˜åˆ°æœ¬åœ°ã€‚ ç›®æ ‡ repo çš„è¿œç¨‹ä»“åº“ä¸€å®šè¦åœ¨ push å‰é‡æ–°è®¾ç½®ï¼šgit remote set-url origin xxx ","title":"ä½¿ç”¨ travis è‡ªåŠ¨å‘å¸ƒ markdown åˆ°åšå®¢","uri":"/post/publish-markdown-blog-by-travis/"},{"content":"ä½¿ç”¨ wsl,MobaXterm,cmder,docker æ‰“é€ å¯è§†åŒ–çš„ linux å¼€å‘ç¯å¢ƒ ç¦»ä¸å¼€ Windows çš„ç†ç”±å¾ˆå¤šï¼Œä½œä¸ºåç«¯å¼€å‘éœ€è¦ä½¿ç”¨ linux çš„æƒ…å†µä¹Ÿå¾ˆå¤šï¼ŒåŒç³»ç»Ÿæ€»å½’æ˜¯ä¸æ–¹ä¾¿ï¼Œè€Œä¸” linux ä¸‹çš„ GUI ä½“éªŒä¹Ÿæ²¡ç”¨ Win 10 å¥½ã€‚ å¦‚æœä½¿ç”¨è™šæ‹Ÿæœºï¼Œé‚£ä¹ˆæ–‡ä»¶äº¤æ¢å’Œç½‘ç»œç­‰å„ç§é—®é¢˜ä¹Ÿéœ€è¦è§£å†³ï¼Œå¯¹ç³»ç»Ÿçš„å†…å­˜è¦æ±‚ä¹Ÿæ›´é«˜ä¸€äº›ã€‚å¾®è½¯ä¸ºäº†è®©æ›´å¤šçš„å¼€å‘äººå‘˜ç•™åœ¨ Win10 ä¸Šé¢ï¼Œå¼€å‘äº† WSLï¼Œç›®å‰çš„å®é™…ä½“éªŒå·²ç»å¾ˆæ£’ï¼Œ ä»Šå¤©ä»‹ç»ä¸€ä¸‹å¦‚ä½•æ‰“é€ ä¸€ä¸ªå¯è§†åŒ–çš„ linux å¼€å‘ç¯å¢ƒâ€“å³åœ¨ Win10 å¯åŠ¨ linux çš„ GUI è½¯ä»¶ï¼Œä¾‹å¦‚ vs code ç­‰ã€‚åœ¨ wsl å¯åŠ¨ vs code å†™ä»£ç å¯ä»¥æœ‰æ•ˆé¿å…ä¸€äº› Windows å’Œ linux çš„ç¼–ç å’Œæ¢è¡Œé—®é¢˜ã€‚ æœ¬æ•™ç¨‹åˆ†ä¸º 2 éƒ¨åˆ†ï¼š é…ç½® wsl å¯è§†åŒ– åœ¨ wsl ä½¿ç”¨ docker ä»¥ä¸‹å†…å®¹ä¸­ wslå’Œubuntuå«ä¹‰ç›¸åŒï¼Œconsoleå’Œå‘½ä»¤è¡Œå«ä¹‰ç›¸åŒã€‚ é…ç½® wsl å¯è§†åŒ– ç³»ç»Ÿè¦æ±‚æ˜¯ Win 10 1803+ ç‰ˆæœ¬ (ä½äº 1803 çš„ wsl åŠŸèƒ½æœ‰é—®é¢˜),å¿…é¡»æ˜¯ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆæ‰æœ‰ wsl åŠŸèƒ½ã€‚ä»¥ä¸‹å†…å®¹çš„å‘½ä»¤è¡Œå¦‚æœå¼€å¤´æœ‰\u003eå­—ç¬¦è¯·å¿½ç•¥ã€‚ windows å¼€å¯ wsl åŠŸèƒ½ æ§åˆ¶é¢æ¿\\ç¨‹åº\\ç¨‹åºå’ŒåŠŸèƒ½\\å¼€å‘æˆ–å…³é—­ Windows åŠŸèƒ½ \u003e å‹¾é€‰ â€˜é€‚ç”¨äº linux çš„ Windows å­ç³»ç»Ÿâ€™ å’Œ â€˜hyper-Vâ€™(docker for Windows éœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ virtualbox ä»£æ›¿), é‡å¯ç”µè„‘ã€‚ windows ä¸‹è½½ wsl Windows store æœç´¢\"wsl\"æˆ–è€…\"ubuntu\"ä¸‹è½½ ubuntu ç‰ˆæœ¬ã€‚ubuntu å’Œ ubuntu1804 æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œubuntu1604 æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚å®‰è£…å®Œæˆä½ çš„ Windows åº”ç”¨åˆ—è¡¨ä¼šæœ‰ä¸€ä¸ª ubuntu åº”ç”¨ï¼Œç‚¹å‡»å›¾æ ‡å³å¯æ‰“å¼€ ubuntu å‘½ä»¤è¡Œã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦ç­‰å¾…åˆå§‹åŒ–ï¼Œç„¶åè®¾ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚ç”±äºå­—ä½“éš¾çœ‹ï¼Œæ‰€ä»¥ä¸ç”¨è¿™ä¸ªè‡ªå¸¦çš„å‘½ä»¤è¡Œè€Œä½¿ç”¨ä¸‹é¢çš„ cmder. windws ä¸‹è½½ cmder è½¯ä»¶ cmder æ˜¯ Windows ä¸‹æœ€å¼ºçš„å‘½ä»¤è¡ŒåŠŸèƒ½ã€‚ä¸è¦ä¸‹è½½ mini é‚£ä¸ªï¼Œé‡Œé¢æ²¡ç”¨ vim å’Œ git.ç¬¬ä¸€æ¬¡å¯åŠ¨ cmder è®°å¾—ä¿®æ”¹ cmder å¯åŠ¨ç›®å½• (é»˜è®¤æ˜¯ c ç›˜) å’Œæ˜¾ç¤ºä¸­æ–‡è®¾ç½®ï¼Œå…·ä½“æ–¹æ³•è¯· google. wsl ä¿®æ”¹è½¯ä»¶æºï¼Œä½¿ç”¨é˜¿é‡Œäº‘çš„æºã€‚ \u003e sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak \u003e sudo sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list \u003e sudo apt update \u003e sudo apt upgrade -y wsl å®‰è£…å¿…è¦è½¯ä»¶ # å®‰è£…ä½ éœ€è¦çš„è½¯ä»¶,gitå’Œvimæ˜¯å¿…é¡»çš„,åé¢çš„ç¼–è¾‘å‘½ä»¤æ˜¯ä½¿ç”¨vim \u003esudo apt install openjdk-8-jdk-headless openjdk-8-jre-headless maven git unzip vim -y ä¿®æ”¹ wsl ä¸‹ Windows ç£ç›˜æŒ‚è½½ç‚¹ é»˜è®¤çš„ Windows ç£ç›˜åœ¨ wsl çš„è®¿é—®æ–¹å¼æ˜¯/mnt/d/å¼€å¤´ï¼Œd è¡¨ç¤º d ç›˜ã€‚ä½†æ˜¯ docker on linux çš„è®¿é—®è·¯å¾„æ˜¯ /d,æ‰€ä»¥è¿™é‡Œéœ€è¦ä¿®æ”¹æŒ‚è½½ç‚¹è·¯å¾„ã€‚ sudo vim /etc/wsl.conf ##æ·»åŠ 3è¡Œå†…å®¹ [automount] root = / options = \"metadata\" é€€å‡º wsl é‡å¯ï¼Œå‘ç°/mntå·²ç»æ²¡äº†ï¼Œå½“å‰ç›®å½•åº”è¯¥æ˜¯/c/xxxæˆ–è€…/d/xxx. wsl å®‰è£… vs code å’Œä¸­æ–‡å­—ä½“ å› ä¸º wsl æ²¡ç”¨ä¸­æ–‡å­—ä½“å°†æ˜¾ç¤ºè±†è…å—ã€‚ # install chinese fonts for wsl,font name: 'Noto Sans Mono CJK SC' sudo apt install -y fonts-noto-cjk fonts-noto-cjk-extra # Win10ä¸‹è½½vs codeçš„debåŒ…,cdåˆ°è¯¥ç›®å½•,ä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£… sudo apt install ./code_1.31.1-1549938243_amd64.deb # åœ¨wslè¦å¯åŠ¨codeå¿…è¦ä¾èµ– sudo apt install libgtk2.0-0 libxss1 libasound2 wsl è®¾ç½® SSH åŠŸèƒ½ è¿™æ ·å¯ä»¥å€ŸåŠ© VcXsrv çš„ X11 è½¬å‘åŠŸèƒ½æ‰“å¼€ GUI è½¯ä»¶ \u003esudo vim /etc/ssh/sshd_config #å–æ¶ˆPortçš„æ³¨é‡Š,å¹¶å°†ç«¯å£æ”¹ä¸º2222 (ç«¯å£éœ€è¦å¤§äº1000) #å°†PasswordAuthenticationçš„å€¼æ”¹ä¸ºyes. #é‡å¯ ssh server: sudo service ssh --full-restart #å°†ssh serverè®¾ç½®ä¸ºæœåŠ¡: sudo service ssh start windows å®‰è£… VcXsrv ç”¨å®ƒçš„ X11 è½¬å‘åŠŸèƒ½ã€‚å®‰è£…åé»˜è®¤é€‰é¡¹å³å¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ã€‚ å¯åŠ¨ wsl çš„ vs code åœ¨ wsl è¾“å…¥code .,ç­‰å¾… 2 ç§’ï¼Œä½ ä¼šå‘ç° Windows ä»»åŠ¡æ å¯åŠ¨äº†ä¸€ä¸ª vs codeï¼Œå¦‚æœæ²¡ç”¨å¯åŠ¨æˆåŠŸï¼Œè¯´æ˜ä½ çš„ VcXsrv çš„ X11 è½¬å‘åŠŸèƒ½æœ‰é—®é¢˜ã€‚ é…ç½® vs code. ä¸Šé¢æ‰“å¼€çš„ vs code æœ‰ 2 ä¸ªé—®é¢˜ï¼šä¸­æ–‡æ˜¾ç¤ºè±†è…å—ï¼Œå’Œä¸èƒ½å…¨å±ã€‚æ‰“å¼€ vs code çš„è®¾ç½® #åœ¨å­—ä½“é‡Œé¢å…ˆè®¾ç½®ä½ æƒ³è¦è‹±æ–‡å­—ä½“,é€—å·è·Ÿä¸Š'Noto Sans Mono CJK SC' #æœç´¢titleBarStyle,å°†'Window: title Bar Style'è®¾ç½®ä¸º native #ä¸Šé¢2ä¸ªè®¾ç½®ä¹Ÿå¯é€šè¿‡ç›´æ¥ç¼–è¾‘æ–‡ä»¶è®¾ç½®,ä¾‹å¦‚æˆ‘çš„vs codeæ–‡ä»¶è®¾ç½®æ˜¯ \u003e cat ~/.config/Code/User/settings.json { \"Window.titleBarStyle\": \"native\", \"editor.fontFamily\": \"monospace,'Noto Sans Mono CJK SC'\" } è‡³æ­¤ï¼Œå·²ç»å¯ä»¥åœ¨ linux ä¸‹é¢å¼€å‘äº†ã€‚å½“ç„¶ï¼Œå…¶ä»– GUI è½¯ä»¶æ²¡ç”¨æµ‹è¯•ä¸ç¡®å®šæ˜¯ä¸æ˜¯ä¼šæœ‰å°é—®é¢˜ã€‚ä½†æ˜¯ vs code å·²ç»å¯ä»¥åº”ä»˜å¾ˆå¤šå¼€å‘å·¥ä½œäº†ã€‚ åœ¨ wsl ä½¿ç”¨ docker ç›®å‰çš„ wsl æ˜¯ä¸æ”¯æŒè¿è¡Œ docker çš„ï¼Œä½†æ˜¯å¯ä»¥åœ¨ wsl ä½¿ç”¨ Windows çš„ dockerï¼Œåœ¨ä½¿ç”¨ä¸Šé¢æ˜¯æ— æ„Ÿçš„ã€‚ å®‰è£… docker for Windows. è¿™ä¸ªå°±ä¸ç»†è¯´äº†ï¼Œæ³¨æ„ docker ç¤¾åŒºç‰ˆä¹Ÿæ˜¯éœ€è¦æ³¨å†Œæ‰èƒ½ä¸‹è½½çš„ã€‚ å¯åŠ¨ docker for Windowsï¼Œå³é”®ä»»åŠ¡æ çš„ docker å›¾æ ‡ï¼Œâ€œsettingsâ€,å‹¾ä¸Š â€œexpose the daemon on tcp:/localhost:2375 without TLSâ€,è¿™æ ·åœ¨ wsl å¯ä»¥è®¿é—®è¿™ä¸ª docker æœåŠ¡ã€‚ wsl å®‰è£… dockerï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä¸‹é¢ä»…åˆ—å‡ºå¿…è¦ bash å‘½ä»¤ã€‚ #å®‰è£…å¿…è¦ç»„ä»¶ sudo apt install -y apt-transport-https ca-certificates curl software-properties-common #gpg ç­¾å curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo apt-key fingerprint 0EBFCD88 #æ·»åŠ  docker å®‰è£…æº sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable\" sudo apt update sudo apt install -y docker-ce #é€šè¿‡ pip å®‰è£… docker-compose sudo apt install -y python python-pip sudo usermod -aG docker $USER pip install --user docker-compose #éªŒè¯ docker å®‰è£…æ˜¯å¦æˆåŠŸ docker info docker-compose --version #ä¿®æ”¹ docker æœåŠ¡ä¸º Windows çš„ docker echo \"export DOCKER_HOST=tcp://localhost:2375\" \u003e\u003e ~/.bashrc \u0026\u0026 source ~/.bashrc #éªŒè¯æ˜¯å¦å¯ä»¥è®¿é—®Windowsçš„dockeræœåŠ¡,çœ‹image listå‘½ä»¤è¾“å‡ºå’ŒWindowsçš„å‘½ä»¤è¡Œä¸‹é¢çš„image listè¾“å‡ºæ˜¯ä¸æ˜¯å®Œå…¨ä¸€æ ·. å¯ä»¥å…ˆåœ¨Windowsä¸‹ç”¨dockeræ‹‰å‡ ä¸ªé•œåƒ.ç„¶ååœ¨wsléªŒè¯ docker image list è‡³æ­¤ï¼Œwsl çš„ docker æœåŠ¡ä¹Ÿé…ç½®å®Œæˆã€‚ ","title":"wsl-docker-environment","uri":"/post/wsl-docker-environment/"},{"content":"neo4j å›¾æ•°æ®åº“ä»‹ç» neo4j æ˜¯ç›®å‰æ’åæœ€é«˜çš„å›¾æ•°æ®åº“ï¼Œåˆ†ä¸ºå•†ä¸šå’Œç¤¾åŒºç‰ˆæœ¬ï¼Œç¤¾åŒºç‰ˆåªæ”¯æŒå•æœºï¼Œè€Œä¸”æŸ¥è¯¢çš„è¿è¡Œæ—¶ (runtime) ä¸åŒ (cypher runtime:interpreted(ç¤¾åŒºç‰ˆ),slotted(ä¼ä¸šç‰ˆ)). æ•°æ®åº“æ’åå¯ä»¥åœ¨ https://db-engines.com/en/ranking/graph+dbms æŸ¥çœ‹ï¼Œä¸‹ä¸€ä»£æœ€æœ‰å‰æ™¯çš„å¼€æºå›¾æ•°æ®åº“æ˜¯ dgraphï¼Œç›®å‰è¿˜ç§¯æå¼€å‘ä¸­ï¼Œç”Ÿäº§æœªå°±ç»ªï¼Œç­‰ä»–çš„ Java å®¢æˆ·ç«¯å†æˆç†Ÿä¸€ç‚¹å¯ä»¥è¯•ç”¨ã€‚ neo4j æ•°æ®åº“ä¸­åªæœ‰ 3 ä¸ªæ¦‚å¿µï¼šNode, Relationship, Properties. Node è¡¨ç¤ºå®ä½“ç±»åˆ«ï¼Œä½¿ç”¨ Label åŒºåˆ†ï¼Œä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ Person/Father ç­‰å¤šä¸ªæ ‡ç­¾ï¼ŒRelationship å³å…³ç³»ï¼Œé›‡ä½£å…³ç³»ï¼Œçˆ¶å­å…³ç³»ï¼ŒæŠ•èµ„å…³ç³»ï¼Œäº¤æ˜“å…³ç³»ç­‰ã€‚Node å’Œ Relationship éƒ½å¯ä»¥æœ‰ Proertiesï¼Œå±æ€§è‡ªèº«ä¸åˆ†æ˜¯å±äºèŠ‚ç‚¹è¿˜æ˜¯å±äºå…³ç³»ï¼Œä¾‹å¦‚ Person å¯ä»¥æœ‰å±æ€§ nameï¼Œå…³ç³»ä¹Ÿå¯ä»¥ç”¨å±æ€§ name.ä½ å¯ä»¥åœ¨ neo4j browser å·¦ä¾§çœ‹åˆ°å½“å‰æ•°æ®åº“çš„æ‰€æœ‰ Node Label,Relationship Type,Properties. æœ¬åœ°å®‰è£…å’Œåœ¨çº¿æ²™ç®± neo4j èƒŒåçš„å…¬å¸ä¸ºäº†å¸å¼•ç”¨æˆ·ï¼Œæä¾›äº†ä¸€äº›å¥½ç©çš„æ•°æ®åº“æ²™ç®±ï¼Œè¿™äº›æ²™ç®±æ•°æ®åº“å·²ç»æå‰æ”¾äº†ä¸€äº›ä¸»é¢˜æ•°æ®ï¼Œä¾‹å¦‚è´­ç‰©æ•°æ®ï¼Œå›½ä¼šå…³ç³»æ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡æ³¨å†Œç™»å½• https://neo4j.com/sandbox-v2/, é€‰æ‹©ä¸€ä¸ªæ•°æ®æ²™ç®±å®ä¾‹è¿›è¡Œå­¦ä¹ è¯•ç©ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸‹è½½ç¤¾åŒºç‰ˆï¼Œå‘½ä»¤è¡Œ neo4j.bat consoleå¯åŠ¨ï¼Œæ‰“å¼€ 127.0.0.1:7474 å¼€å§‹å­¦ä¹ ã€‚ ä¸€ä¸ª neo4j æ”¯æŒå¤šä¸ªæ•°æ®åº“ä½†æ˜¯ä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªæ•°æ®åº“æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨$neo4j_home\\data\\databases ç›®å½•çš„ç‹¬ç«‹æ–‡ä»¶å¤¹ï¼Œåœ¨ conf/neo4j.conf çš„dbms.active_database=graph.dbæŒ‡å®šæ¿€æ´»é‚£ä¸ªæ•°æ®åº“ã€‚ cypher æŸ¥è¯¢è¯­è¨€ neo4j ä½¿ç”¨ cypher è¯­è¨€ä½œä¸ºæŸ¥è¯¢è¯­è¨€ã€‚è¿™æ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…çš„å£°æ˜å¼è¯­è¨€ã€‚åŸºæœ¬è¯­æ³•å’Œ SQL ç›¸ä¼¼ã€‚ cypher ä¸­å¸¸ç”¨çš„å­å¥ (clause) æœ‰ï¼šMATCH,RETURN,WITH,WHERE,UNWIND,LIMIT,UNION,SKIP,SET. RETURN,LIMIT WHERE å’Œ SQL ä¸­æ˜¯ä¸€æ ·çš„ï¼ŒUNWIND è¿™äº›éœ€è¦ç”¨åˆ°å†æŸ¥çœ‹æ–‡æ¡£ï¼Œè¿™é‡Œä»‹ç» MATCH å’Œ WITH. MTACHç”¨äºæŒ‡å®šæœç´¢çš„æ¨¡å¼ã€‚ä¾‹å¦‚å¸Œæœ›æ‰¾åˆ°â€™Tom Hanksâ€™åœ¨ 2018 æ¼”è¿‡çš„æ‰€æœ‰ç”µå½±ï¼šMATCH (p:ACTOR {name:'Tom Hanks' }) -[r: ACT_IN]-\u003e(m:MOVIE {time: '2018'}),è¿™æ˜¯ä¸€ä¸ªæ¨¡å¼ï¼Œå¯ä»¥ç›´æ¥ REUREN è¿”å› p,r,m ç­‰å˜é‡ã€‚å¯ä»¥çœ‹åˆ°æ¨¡å¼ä¸­çš„èŠ‚ç‚¹ (Node Label) ä½¿ç”¨();å…³ç³»ç±»å‹ (Relationship Type) ä½¿ç”¨[]æŒ‡å®šï¼Œå¦‚æœä¸å…³å¿ƒ typeï¼Œé‚£ä¹ˆ[]å¯ä»¥çœç•¥ã€‚ä½¿ç”¨â€“; å±æ€§ (Properties) ä½¿ç”¨{pname: pvalue}æŒ‡å®šã€‚ WITHçš„ä½œç”¨å’Œ python çš„ with éå¸¸ç›¸ä¼¼ (å®é™…ä¸Š cypher è¯­è¨€å€Ÿé‰´äº† python çš„ list å¤„ç†è¯­æ³•),ç”¨äºä¿®æ”¹ä¸€äº›å˜é‡ï¼Œå˜é‡ä¸€èˆ¬éƒ½æ˜¯ä¸Šä¸€ä¸ªå­å¥çš„æŸ¥è¯¢ç»“æœï¼Œä¿®æ”¹ä¹‹åä¼ ç»™ä¸‹ä¸€ä¸ªå­å¥ã€‚ä¾‹å¦‚ä¸‹é¢çš„è¯­å¥æ‰¾åˆ°å’Œ Anders æœ‰å…³ç³»çš„äººçš„å¹´é¾„æœ€å¤§çš„é‚£ä¸ªäººï¼Œè¿”å›é‚£ä¸ªäººçš„æ‰€æœ‰è®¤è¯†çš„äººçš„åå­—ã€‚ MATCH (n { name: 'Anders' })--(m) WITH m ORDER BY m.age DESC LIMIT 1 MATCH (m)--(o) RETURN o.name cypher æ‰‹å†Œï¼šhttps://neo4j.com/docs/cypher-manual/3.5/clauses/ cypher çš„æ“ä½œç¬¦ å¦‚æœéœ€è¦è¿›è¡Œ cypher è°ƒä¼˜ï¼Œæœ‰å¿…è¦äº†è§£ä¸€ä¸‹ cypher çš„æ“ä½œç¬¦ã€‚ä¸€èˆ¬ç¼–ç¨‹è¯­è¨€çš„ä»£ç åœ¨è¢«æ‰§è¡Œå‰éƒ½ä¼šè¢«ç¼–è¯‘å¾—åˆ°æŠ½è±¡è¯­æ³•æ ‘ (AST). ä¾‹å¦‚ Java ä»£ç ï¼Œä¸€ä¸ª Java æ–‡ä»¶ä¼šè¢«æŠ½è±¡ä¸ºä¸€ä¸ª package,class, method,variable declare ç­‰ä¸åŒéƒ¨åˆ†å¾—åˆ°ä¸€ä¸ª Class å¯¹è±¡ã€‚cypher è¯­å¥ä¸€æ ·ä¼šè¢«ç¼–è¯‘å¾—åˆ°ä¸€æ£µè¯­æ³•æ ‘ (AST),æ¯ä¸ªæ ‘èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ“ä½œç¬¦ã€‚ä»å¶èŠ‚ç‚¹çš„æ“ä½œç¬¦å¼€å§‹æ‰§è¡Œï¼Œå¾—åˆ°çš„ç»“æœä¾æ¬¡è¿”å›ç»™çˆ¶èŠ‚ç‚¹è¿›ä¸€æ­¥å¤„ç†ã€‚å¸¸è§çš„æ“ä½œç¬¦æœ‰:AllNodesScan(å…¨å±€æ‰«æï¼Œåªèƒ½ä½œä¸ºå¶èŠ‚ç‚¹),NodeByLabelScan,Apply ç­‰ã€‚ä¾‹å¦‚MATCH (n) return nä¼šå¾—åˆ°ä¸€ä¸ªAllNodesScanå’ŒProduceResultsæ“ä½œç¬¦æ„æˆçš„ AST, ä½ å¯ä»¥é€šè¿‡PROFILEæŸ¥çœ‹ä½ è¯­å¥ç¼–è¯‘åå¾—åˆ°çš„æ“ä½œç¬¦æ„æˆçš„æ‰§è¡Œè®¡åˆ’ã€‚ # æ‰§è¡Œè¯­å¥å¾—åˆ°ä¸‹é¢çš„è¡¨æ ¼ PROFILE MATCH (p:Person { name: 'Tom Hanks' }) RETURN p # çœç•¥äº†éƒ¨åˆ†åˆ— +-----------------+----------------+------+---------+-----------------+ | Operator | Estimated Rows | Rows | DB Hits | Page Cache Hits | +-----------------+----------------+------+---------+-----------------+ | +ProduceResults | 1 | 1 | 0 | 0 | | | +----------------+------+---------+-----------------+ | +NodeIndexSeek | 1 | 1 | 2 | 0 | +-----------------+----------------+------+---------+-----------------+ cypher runtime pass neo4j browser ä»‹ç» å’Œå¤§å¤šæ•°æ•°æ®åº“ä¸€æ ·ï¼Œneo4j æ˜¯ server-client çš„æ•°æ®åº“ï¼Œæ”¯æŒ http å’Œ bolt2 ä¸­åè®®.neo4j è‡ªå¸¦ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯ï¼Œåªéœ€åœ¨æµè§ˆå™¨è¾“å…¥ serverIp:7474 å³å¯ä½¿ç”¨ã€‚ neo4j browser è‡ªå¸¦ä¸€ä¸ªæ•™ç¨‹å’Œç”µå½±å…³ç³»çš„æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ã€‚æ–¹ä¾¿ä½ å¯ä»¥å­¦ä¹ ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ã€‚ :help help å‘½ä»¤æ˜¾ç¤ºå„ç§å¸®åŠ©æç¤ºã€‚å¸¸è§çš„ topic æœ‰ :help cypher :help commands :help keys :help param :play äº¤äº’å¼å­¦ä¹ å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œ:play movie graph è¿›å…¥åŸºäºç”µå½±æ•°æ®åº“çš„æ•™ç¨‹ã€‚ :param å‘½ä»¤ï¼Œè®¾ç½®å˜é‡ã€‚ :param usrname =\u003e â€œzhimoeâ€,æ³¨æ„ï¼Œå˜é‡åå’Œ=\u003eä¹‹é—´æœ‰ç©ºæ ¼ã€‚è®¾ç½®å˜é‡ä¹‹åå¯ä»¥ä½¿ç”¨å˜é‡MATCH (n:Person) WHERE n.name = $usrname :params æ˜¾ç¤ºå½“å‰å·²ç»è®¾ç½®çš„æ‰€æœ‰å˜é‡ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨:params {name: â€˜Stellaâ€™, age: 24} è¦†ç›–ç›®å‰çš„å˜é‡ã€‚ä½†æ˜¯è¿™ä¸ªå‘½ä»¤æ²¡ç”¨ç±»å‹å®‰å…¨ã€‚ spring-neo4j é…ç½® pass cypher è°ƒä¼˜ cypher æ˜¯ä¸€ç§å£°æ˜å¼çš„ï¼Œæ¨¡å¼åŒ¹é…çš„æŸ¥è¯¢è¯­è¨€ã€‚æ¨¡å¼åœ¨ cypher è¯­è¨€ä¸­éå¸¸é‡è¦ã€‚å¦‚ä½•åˆç†åœ°è®¾è®¡æŸ¥è¯¢ä¸­çš„æ¨¡å¼æ˜¯ cypher æ€§èƒ½å¯è°ƒä¼˜ç©ºé—´æœ€å¤§çš„åœ°æ–¹ã€‚ä¸‹é¢ç»™å‡ºå¸¸è§çš„ä¼˜åŒ–å»ºè®®ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåé¢çš„è¿™äº›å»ºè®®å…¶å®å¤§éƒ½å¯ä»¥åœ¨cypher æ‰‹å†Œæ‰¾åˆ°ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå»ºè®®é€šè¯»è¿™ä»½é•¿æ–‡æ¡£â€¦ é¿å…å…¨å±€ scan cypher æ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…çš„è¯­è¨€ï¼Œé»˜è®¤ä¼šè¿›è¡Œå…¨å±€æ‰«æï¼Œé™¤éä½ å‘Šè¯‰å®ƒä¸è¦ã€‚æ‰€ä»¥èµ·å§‹èŠ‚ç‚¹çš„ label éå¸¸é‡è¦ã€‚èµ·å§‹çš„æ¨¡å¼åŒ¹é…åŸºæ•°å¤§å°ä¹Ÿéå¸¸é‡è¦ã€‚ ç¼“å­˜å’Œç¡¬ç›˜ IO neo4j æ•°æ®åº“å°†æ•°æ®æ–‡ä»¶å’Œ Page Cache ä½œäº†æ˜ å°„ï¼Œå¦‚æœåœ¨ç¼“å­˜ä¸­æ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œneo4j ä¼šä»ç¡¬ç›˜åŠ è½½æ•°æ®æ–‡ä»¶ã€‚ç¬¬äºŒæ¬¡æŸ¥è¯¢å°±å¯ä»¥èµ°ç¼“å­˜ã€‚æ‰€ä»¥éœ€è¦å……åˆ†åˆ©ç”¨ Page Cache.è®°ä½ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ€»æ˜¯ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ²¡ç”¨ç¼“å­˜.neo4j æœ‰ 2 çº§ç¼“å­˜:string cache å’Œ AST cache string cache é»˜è®¤ neo4j åœ¨ cache ä¸­ä¿ç•™ 1000 ä¸ªæŸ¥è¯¢è®¡åˆ’ï¼Œå¯åœ¨conf/neo4j.confä¸­å‚æ•° dbms.query_cache_sizeä¿®æ”¹è¿™ä¸ªè®¾ç½®ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ cache æ˜¯æ ¹æ®è¯­å¥çš„ string hash å€¼åˆ¤æ–­çš„ï¼Œæ‰€ä»¥ä¸€æ ·çš„è¯­å¥ä»…ä»…æ˜¯å¤§å°å†™ä¸ä¸€æ ·æˆ–è€…ç©ºç™½ç¬¦ä¸ä¸€æ ·å¯¹ç¼“å­˜æ¥è¯´ä¹Ÿæ˜¯ 2 ä¸ªè¯­å¥ã€‚ PROFILE/EXPLAINè¯­å¥åªä¼š cache å…¶å»æ‰PROFILE/EXPLAINä¹‹åçš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šMATCH (n) return COUNT(n);å’ŒPROFILE MATCH (n) return COUNT(n);çš„ cache æ˜¯ä¸€è‡´çš„ã€‚ AST cache ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¯­æ³•æ ‘ã€‚å¦‚æœåœ¨ string cache ä¸­æ²¡æœ‰æ‰¾åˆ°ç¼“å­˜ã€‚é‚£ä¹ˆä¼šå°†æŸ¥è¯¢æ­£è§„åŒ–ï¼Œå¾—åˆ°è¯­æ³•æ ‘å¹¶å°†å…¶ç¼“å­˜ã€‚æ­£è§„åŒ–çš„åŒæ—¶ä¹Ÿä¼šåšä¸€äº›ä¼˜åŒ–ï¼Œä¾‹å¦‚ match (n:Person {id:101}) return n;åœ¨æ­£è§„åŒ–ä¹‹åå¾—åˆ°match (n:Person) where n.id={param1} return n; {param1: 101},AST cache ä¸åŒºåˆ†å¤§å°å†™ï¼Œç©ºæ ¼ç­‰ï¼Œæ‰€ä»¥ä»¥ä¸‹æŸ¥è¯¢æ˜¯ä¸€è‡´çš„ï¼š match (n:Person) where n.id=101 return n; match (n:Person {id:101}) return n; MATCH ( n:Person { id : 101 } ) RETURN n; execution plan å½“ cypher å¼•æ“æ”¶åˆ°æŸ¥è¯¢è¯­å¥åå¦‚æœæ²¡ç”¨æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜ï¼Œé‚£ä¹ˆ Cypher query planner ä¼šå°†è¯­å¥è§„èŒƒåŒ–ï¼Œä¼˜åŒ–åç¼–è¯‘å¾—åˆ°ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ (execution plan).è¿™ä¸ªæ‰§è¡Œè®¡åˆ’ä¼šç¼“å­˜ä¸€åˆ‡ä¸”å¯ä»¥å¤ç”¨ã€‚å½“æŸ¥è¯¢ç¼“å­˜è¿‡å¤šï¼Œæˆ–è€…æ•°æ®åº“çš„æ•°æ®å˜åŒ–å¤§æ—¶ (è®¾ç½®å‚æ•°æ˜¯) è¿™ä¸ªæ‰§è¡Œè®¡åˆ’åˆ™å¤±æ•ˆè¢«ç§»é™¤ã€‚åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å­—é¢é‡å€¼ï¼Œå¯ä»¥æé«˜ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’çš„å¤ç”¨ç‡ã€‚ æ›´å¤šä¿¡æ¯å‚è€ƒæ–‡æ¡£:https://neo4j.com/docs/cypher-manual/3.5/execution-plans/#execution-plan-introduction æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’ å¦‚æœæƒ³è¦æŸ¥çœ‹æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢è¯­å¥å‰åŠ ä¸Š EXPLANIN OR PROFILE å…³é”®å­—ï¼Œä½ å¯ä»¥åœ¨ neo4j browser æŸ¥çœ‹ query plan æ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆã€‚ç»“æœå·¦ä¾§è¾¹é‡Œé¢ç¬¬ 3 ä¸ª tab ä¼šç»™å‡ºè¯¦ç»†çš„æ€§èƒ½è­¦å‘Š (warn). EXPLAINåªä¼šç»™å‡ºè¯­å¥çš„åˆ†æç»“æœ;è€ŒPROFILEåˆ™ä¼šæ‰§è¡Œä½ çš„æŸ¥è¯¢è¯­å¥æŠŠç»™å‡ºè€—æ—¶æœ€å¤šçš„æŠ¥å‘Šï¼Œä»¥åŠæ¯ä¸ªæ“ä½œç¬¦è¿”å›äº†å¤šå°‘è¡Œè®°å½•ã€‚æ³¨æ„ï¼Œprofiling ä¼šæ¶ˆè€—å¾ˆå¤šèµ„æºï¼Œæ‰€ä»¥ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é¢‘ç¹ä½¿ç”¨ã€‚è°ƒä¼˜çš„åŸºç¡€æ˜¯åŸºäº cypher çš„æ“ä½œç¬¦ï¼Œæ‰€ä»¥éœ€è¦ä½ å¯¹æ“ä½œç¬¦æœ‰åŸºæœ¬çš„äº†è§£ã€‚ ç´¢å¼• æ•°æ®åº“ç¦»ä¸å¼€ç´¢å¼•ã€‚è¿™é‡Œæœ‰ä¸ªå°é™·é˜±ï¼Œæœ€æ—©è°±ç³»çš„èŠ‚ç‚¹æ˜¯ä¼ä¸šå®¢æˆ· (label: COR_CUSTOMER)+å’Œå‡ åä¸ªé›¶å”®å®¢æˆ·èŠ‚ç‚¹ (label:RTL_CUSTOMER),æˆ‘åœ¨æŸ¥è¯¢è¯­å¥èµ·å§‹èŠ‚ç‚¹æ²¡æœ‰æŒ‡å®š labelï¼Œæ²¡ç”¨é‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œåæ¥åŠ å…¥äº† 3 ç™¾ä¸‡çš„ä¸ªäººèŠ‚ç‚¹æ•°æ®åï¼ŒåŸæ¥ 1s çš„æŸ¥è¯¢å˜æˆäº† 1 åˆ†åŠé’Ÿã€‚æ‰€ä»¥åœ¨å¹²æ‰°çš„ label æ¯”è¾ƒå°‘æ—¶ï¼Œä½ ä¸ä¼šå¯Ÿè§‰åˆ°æ€§èƒ½é—®é¢˜ã€‚åŠ¡å¿…åœ¨èµ·å§‹èŠ‚ç‚¹æŒ‡å®š labelï¼Œå³ä½¿ç›®å‰åªæœ‰ä¸€ä¸ª labelï¼Œæœ€å¥½ä¹Ÿæå‰åŠ ä¸Šã€‚ ç„¶è€Œï¼Œcypher è¯­å¥ç›®å‰ä¸å…è®¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å®šå¤šä¸ª labelï¼Œä¾‹å¦‚ä½ å¸Œæœ›èµ·ç‚¹ label æ˜¯COR_CUSTOMER|RTL_CUSTOMER,è¿™ä¸ªæ˜¯ä¸å…è®¸çš„ã€‚åªèƒ½åœ¨ where è¯­å¥æŒ‡å®šã€‚ MATCH n WHERE n:COR_CUSTOMER OR n:RTL_CUSTOMER RETURN n åœ¨ 3.0 ä¹‹å‰çš„ neo4j ä¸­ä½¿ç”¨ä¸Šé¢çš„è¯­å¥ï¼Œä¼šå¯¼è‡´ä¸€ä¸ª AllNodesScanï¼Œåœ¨ 3.0 ä¹‹åï¼Œè¯¥è¯­å¥åˆ™æ˜¯å°† 2 ä¸ª NodeByLabelScan åŒ¹é…ç»“æœUNIONç„¶åDISTINCTçš„ç»“æœã€‚æ‰€ä»¥æ˜¯æœç´¢ 2 æ¬¡å†åˆå¹¶ç»“æœã€‚ä½ å¯ä»¥åœ¨ä¸Šé¢çš„ cypher è¯­å¥å‰é¢æ·»åŠ EXPLAINæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå·²ç¡®å®šä½ çš„è¯­å¥æ˜¯å¦ä¼šå¯¼è‡´å…¨å±€æ‰«æã€‚ SO ä¸Šå…³äºå¤šä¸ª label åŒ¹é…çš„è®¨è®º å¤§ç»“æœé›† å¦‚æœä½ çš„æŸ¥è¯¢è¿”å›ç»“æœé›†å¤ªå¤§ï¼Œä¾‹å¦‚å‡  M å¤§å°ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦è€ƒè™‘ä½ çš„è®¾è®¡äº†ã€‚è¿‡å¤§çš„ç»“æœé›†ä¼šå¯¼è‡´æŸ¥è¯¢è¿”å›å˜æ…¢ï¼Œè¦æ³¨æ„ï¼Œè¿™äº›ç»“æœä¼šå ç”¨ä½ çš„ç¼“å­˜ç©ºé—´ï¼Œè€Œå¦‚æœåœ¨ç½‘ç»œæƒ…å†µä¸å¥½æ—¶ï¼Œæƒ…å†µæ›´åŠ ç³Ÿç³•äº†ã€‚ ç›®å‰è°±ç³»å¯¹è¿™ä¸€å—å¹¶æ²¡æœ‰ä¼˜åŒ–ï¼Œæœ€å¤§çš„è°±ç³»çš„è¿”å›æ¥å£å¯èƒ½è¾¾åˆ° 1M å¤šï¼ŒåŠ ä¸Š ES çš„æ•°æ®ï¼Œå‰ç«¯æ¥æ”¶æ•°æ®ä¼šæœ‰ 4M å¤šã€‚ é” å½“ä½ ä¿®æ”¹èŠ‚ç‚¹çš„ä¿¡æ¯æ—¶ï¼ŒèŠ‚ç‚¹ä¼šè¢«é”å®š;å¦‚æœä¿®æ”¹å…³ç³»ï¼Œå…³ç³»ä¼šè¢«é”å®š;å¦‚æœå¢åŠ /åˆ é™¤å…³ç³»ï¼Œé‚£ä¹ˆ 2 ä¸ªèŠ‚ç‚¹å’Œè¿™ä¸ªå…³ç³»éƒ½ä¼šè¢«é”å®šã€‚è€Œå¦‚æœæ­¤æ—¶æœ‰èŠ‚ç‚¹/å…³ç³»çš„ç›¸å…³æŸ¥è¯¢è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä¼šç­‰å¾…ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ éœ€è¦å°† 50 ä¸ªèŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªç»„ (group)â€“å³æ·»åŠ  50 ä¸ªå…³ç³»ï¼Œå¦‚æœä½ è°ƒç”¨ 50 æ¬¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ª group èŠ‚ç‚¹è¢« lock çš„æ—¶é—´è¾ƒé•¿ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡UNWINDå’Œåˆ—è¡¨ (list) å‚æ•°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ MATCH (g:Group { uuid: $groupUuid }) UNWIND $personUuidList as personUuid MATCH (p:Person { uuid : personUuid }) MERGE (p)-[:IS_MEMBER]-\u003e(g) å¸¸è§æŸ¥è¯¢é”™è¯¯ å˜é‡å label å¿˜è®°æ·»åŠ å†’å·ï¼Œä¾‹å¦‚ MATCH (Person) å’Œ MATCH (:Person) æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œå‰è€… Person æ˜¯å˜é‡ï¼Œä¸èµ°ç´¢å¼•ã€‚ æœ‰è¿‡å¤§çš„ä¸­é—´ç»“æœé›†ï¼Œä¼˜åŒ–ä½ çš„è¯­å¥æ—¶æ€è€ƒï¼šå°½æ—© distinctï¼Œå°½æ—© limitï¼Œä½¿ç”¨ collect å‡å°‘ç»“æœçš„è¡Œæ•°ï¼Œåœ¨æ­£ç¡®åœ°æ–¹ä½¿ç”¨ order by; å¤šä¸ª UNWIND è¯­å¥å¯¼è‡´ç¬›å¡å°”ç§¯ å¤šä¸ª UNWIND ä¼šå¯¼è‡´ä¸€ä¸ªç¬›å¡å°”ç§¯çš„ç»“æœï¼Œè¿™ä¸ªç»“æœå¯èƒ½ä¼šå¾ˆå¤§ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç»“æœä¼šå¾—åˆ° 3*3=9 è¡Œï¼Œæ‰€ä»¥å°½é‡é¿å…ç¬›å¡å°”ç§¯ã€‚ with ['a','b','c'] as lts, [1,2,3] as nrs unwind lts as char unwind nrs as nr return char,nr åœ¨ MATCH ä¸­ä½¿ç”¨å¤šä¸ªæ¨¡å¼ç¬›å¡å°”ç§¯ åœ¨ MATCH ä¸­ä½¿ç”¨å¤šä¸ªæ¨¡å¼ä¹Ÿä¼šå¯¼è‡´ç¬›å¡å°”ç§¯ï¼Œæ¯”è¾ƒä¸‹é¢çš„ 2 ä¸ªç»“æœç›¸åŒçš„è¯­å¥ï¼Œç¬¬ä¸€ä¸ªè€—æ—¶ 80sï¼Œç¬¬äºŒä¸ªåªéœ€ 8ms. # 1. ç¬›å¡å°”ç§¯ 80000 ms w/ ~900 players, ~40 teams, ~1200 games MATCH (pl:Player),(t:Team),(g:Game) RETURN COUNT(DISTINCT pl), COUNT(DISTINCT t), COUNT(DISTINCT g) # 2. 8ms w/~900 players, ~40 teams, ~1200 games MATCH (pl:Player) WITH COUNT(pl) as players MATCH (t:Team) WITH COUNT(t) as teams, players MATCH (g:Game) RETURN COUNT(g) as games, teams, players æ¨¡å¼ä¸­çš„æ–¹å‘ ä¸‹é¢çš„æŸ¥è¯¢ä¸­ï¼Œå¦‚æœç»™å…³ç³» ACTED_IN æ·»åŠ ä¸Šæ–¹å‘ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ MATCH (p:Person)-[:ACTED_IN]-(m) WHERE p.name = \"Tom Hanks\" RETURN m ","title":"Neo4j å…¥é—¨","uri":"/post/neo4j-intro/"},{"content":"notes åœ¨ pycharm å†™ä»£ç ä¸­å¦‚æœä½¿ç”¨åˆ°æ–°çš„ packageï¼Œä¾‹å¦‚numpy,åªéœ€è¦è¾“å…¥import numpy ç„¶å ALT+ENTER åœ¨æç¤ºä¸­é€‰æ‹© install new package å³å¯ã€‚\nåœ¨ notebook ä¸­ï¼Œç½‘ä¸Šçš„æ•™ç¨‹éƒ½è¯´æ˜¯!pip install numpy. ä½†æ˜¯è¿™ä¸ªå¯èƒ½æœ‰å‘ã€‚ç©¶å…¶åŸå› æ˜¯å› ä¸ºï¼š\né€šè¿‡ bash å¯åŠ¨çš„ notebook ä¸­çš„python pip condaè¿™å‡ ä¸ªå‘½ä»¤çš„ç¯å¢ƒå’Œå®é™…æ‰§è¡Œ notebook ä»£ç çš„ python ç¯å¢ƒå¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚\nè¿™ç§æƒ…å†µä¸€èˆ¬å‘ç”Ÿåœ¨ç³»ç»Ÿæœ‰å¥½å‡ ä¸ª python çš„æƒ…å†µï¼Œä¾‹å¦‚ç³»ç»Ÿè‡ªå¸¦ python å’Œç”¨æˆ·å®‰è£…çš„ anaconda python.\nå¯ä»¥é€šè¿‡å¯¹æ¯”ä»¥ä¸‹ä¸¤ä¸ª notebook å‘½ä»¤çš„è¾“å‡ºåˆ¤æ–­ pip æ‰§è¡Œç¯å¢ƒå’Œ notebook ä»£ç æ‰§è¡Œç¯å¢ƒæ˜¯å¦ä¸€è‡´ï¼š\n# pip æ‰§è¡Œç¯å¢ƒ python !type python # notebook ä»£ç æ‰§è¡Œç¯å¢ƒçš„ python import sys sys.executable å¦‚æœä¸ä¸€æ ·ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…æ‰èƒ½åœ¨ notebook ä¸­ç”Ÿæ•ˆï¼š\nimport sys\n!{sys.executable} -m pip install numpy\nsys å’Œ os åŒºåˆ« os: æ“ä½œç³»ç»Ÿçš„æŠ½è±¡ã€‚ sys: ä»£ç å’Œ python è§£é‡Šå™¨äº¤äº’çš„æ¥å£ã€‚æä¾›ä¸€ç³»åˆ—å‡½æ•°æ¥è®¿é—®ä¿®æ”¹ python è§£é‡Šå™¨ç¯å¢ƒè®¾ç½®ã€‚ source:installing new python package from jupyter notebook\n","title":"Jupyter Notebook Install New Package[ç¿»è¯‘]","uri":"/post/python-jupyter-notebook-install-new-package/"},{"content":"thread pool classes hierarchy java thread pool class hierarchy Executor (java.util.concurrent) |---ExecutorService (java.util.concurrent) |---AbstractExecutorService (java.util.concurrent) | |---ForkJoinPool (java.util.concurrent) | |---ThreadPoolExecutor (java.util.concurrent) | | |---ScheduledThreadPoolExecutor (java.util.concurrent) |---DelegatedExecutorService in Executors (java.util.concurrent) |---ScheduledExecutorService (java.util.concurrent) three thread pool interfaces Executor, a simple interface that supports launching new tasks. ExecutorService, a sub-interface of Executor, which adds features that help manage the life cycle, both of the individual tasks and of the executor itself. ScheduledExecutorService, a sub-interface of ExecutorService, supports future and/or periodic execution of tasks. common thread pool implements ThreadPoolExecutoræ˜¯ thread pool æœ€å¸¸ç”¨çš„å®ç°ã€‚ä¸€èˆ¬é€šè¿‡Executorsé™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºã€‚ //Executors.newFixedThreadPool //Executors.newCachedThreadPool //Executors.newSingleThreadExecutor //åŒæ ·çš„ï¼ŒExecutors è¿˜æä¾›äº† ScheduledExecutorService çš„å·¥å…·æ–¹æ³• //Executors.newSingleThreadScheduledExecutor /** * corePoolSize - ä¿ç•™å­˜æ´»çš„çº¿ç¨‹ä¸ªæ•° * maximumPoolSize - æœ€å¤§çº¿ç¨‹ä¸ªæ•° * keepAliveTime - çº¿ç¨‹æ•°è¶…è¿‡ corePoolSize æ—¶ï¼Œç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ * unit - keepAliveTime çš„å•ä½ï¼Œæ¯«ç§’ç§’åˆ†ç­‰ * workQueue â€“ ä»»åŠ¡é˜Ÿåˆ—ï¼Œåªä¿å­˜é€šè¿‡ execute() æ–¹æ³•æäº¤çš„ Runnable ä»»åŠ¡ * threadFactory â€“ ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å·¥å‚æ–¹æ³• * handler â€“ å½“çº¿ç¨‹æ± è¾¾åˆ°æ•°é‡é™åˆ¶æˆ–è€…ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¯¹æ–°ä»»åŠ¡æäº¤çš„å¤„ç†ç­–ç•¥ */ class ThreadPoolExecutor { public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) {} } JDK é»˜è®¤çš„æ‹’ç»ç­–ç•¥ RejectedExecutionHandler æœ‰ï¼š /** * ThreadPoolExecutor.AbortPolicy - é»˜è®¤çš„ handlerï¼ŒæŠ›å‡ºä¸€ä¸ª RejectedExecutionException * ThreadPoolExecutor.CallerRunsPolicy - æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ * ThreadPoolExecutor.DiscardPolicy - æŠ›å¼ƒè¿™ä¸ªä»»åŠ¡ * ThreadPoolExecutor.DiscardOldestPolicy - æŠ›å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­æœ€æ—©æäº¤ä¸Šæ¥çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•é‡æ–°æäº¤å½“å‰è¿™ä¸ªä»»åŠ¡ */ ä»»åŠ¡æäº¤æ‰§è¡Œæµç¨‹ fork/join æ¡†æ¶ fork/joinå’Œä¸Šé¢ThreadPoolExecutorçš„åŒºåˆ«åœ¨äºä½¿ç”¨äº†ä»»åŠ¡çªƒå–ç®—æ³•ï¼Œå·¥ä½œçº¿ç¨‹å®Œæˆè‡ªå·±çš„ä»»åŠ¡åå¯ä»¥ä»å…¶ä»–çº¿ç¨‹å·å–ä»»åŠ¡ï¼Œæé«˜æ•´ä½“çš„ä»»åŠ¡æ•ˆç‡. æ ¸å¿ƒæ˜¯ä¸€ä¸ªForkJoinPool class å’Œä¸€ä¸ªæ‰©å±•çš„AbstractExecutorService. æ‰§è¡ŒForkJoinTask ä»»åŠ¡ã€‚ åœ¨ JDK8 ä¸­æœ‰ä¸ªjava.util.Arrays.parallelSort()ä½¿ç”¨çš„å°±æ˜¯ fork/join. å½“ç„¶ï¼Œä¸æ˜¯æ‰€æœ‰äººéƒ½æ»¡æ„ JDK7 å¼•å…¥çš„ Fork/Join æ¡†æ¶. ","title":"Java å¹¶å‘ 4-çº¿ç¨‹æ± ä¸æ‰§è¡Œå™¨","uri":"/post/java-concurrency-4-threadpool-hierachy/"},{"content":"å¼•è¨€ å¤§æ•°æ®è®¡ç®—å’Œæ™®é€šçš„ç¨‹åºå¹¶æ— æœ¬è´¨åŒºåˆ«ï¼šæ•°æ®è¾“å…¥=\u003eè®¡ç®—=\u003eè¾“å‡ºå’Œç»“æœçš„æŒä¹…åŒ–ã€‚è¿™é‡Œçš„æŒ‘æˆ˜åœ¨äºè®¡ç®—çš„æ•ˆç‡å’Œå®¹é”™æ€§ã€‚ç”±äºæ•°æ®è¾“å…¥å·¨å¤§ï¼Œè®¡ç®—çš„æ•ˆç‡æ˜¯åŸºæœ¬çš„è¦æ±‚ã€‚ä¸ºäº†åœ¨é€šç”¨ç¡¬ä»¶ä¸Šé«˜æ•ˆå®Œæˆå¤§é‡è®¡ç®—ï¼Œå”¯ä¸€çš„é€”å¾„å°±æ˜¯å°†è®¡ç®—ä»»åŠ¡æ‹†åˆ†åˆ†å¸ƒå¼è®¡ç®—ã€‚è¿™å°±å¼•å‡ºäº†æ–°çš„é—®é¢˜ï¼šåˆ†å¸ƒå¼è®¡ç®—èµ„æºçš„ç®¡ç†ï¼ˆMesos,YARNï¼‰,åˆ†å¸ƒå¼è®¡ç®—å¤±è´¥åçš„æ¢å¤ï¼ˆå®¹é”™æ€§ï¼‰ï¼ˆSpark RDDï¼‰,ä»¥åŠåˆ†å¸ƒå¼çš„æ•°æ®è¾“å…¥å’Œä¿å­˜ï¼ˆåˆ†å¸ƒå¼æ–‡ä»¶ HDFSï¼‰.hadoop ç”Ÿæ€åœˆå°±æ˜¯ä¸ºäº†è§£å†³å‡ ä¸ªé—®é¢˜è®¾è®¡çš„ (YARN,MapR,HDFS).åªä¸è¿‡åœ¨è®¡ç®—è¿™ä¸€ç¯èŠ‚ Spark åšçš„æ›´åŠ é«˜æ•ˆå–ä»£äº† MapR.æ‰€ä»¥å…ˆçœ‹ä¸‹ hadoop çš„æ ¸å¿ƒä¸¤ä¸ªç»„ä»¶ã€‚ HDFS HDFS æ˜¯ hadoop çš„è™šæ‹Ÿåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚æ»¡è¶³å¤§æ•°æ®é—®é¢˜ä¸‹è¦æ±‚çš„ï¼šå¯æ‰©å±•çš„ï¼Œå®¹é”™çš„ï¼Œç¡¬ä»¶é€šç”¨çš„å’Œé«˜å¹¶å‘çš„ç‰¹æ€§.HDFS æœ€é‡è¦çš„ç‰¹æ€§æ˜¯ä¸å¯å˜æ€§â€“æ•°æ®æäº¤åˆ° HDFS åå³ä¸å¯æ›´æ–°äº†ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ WORM(write once read many). æ–‡ä»¶åœ¨ HDFS ä¸­æ˜¯ä»¥ block æ„æˆï¼Œé»˜è®¤ä¸€ä¸ª block æ˜¯ 128M.block æ˜¯æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå³å¦‚æœé›†ç¾¤ä¸­å¦‚æœæœ‰å¤šäº 1 ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœ‰æ–‡ä»¶å¯èƒ½ä¼šè¢«åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Š.block æ˜¯è¢«å¤åˆ¶çš„ï¼Œè¿™ä¸»è¦æ˜¯ä¸¤ä¸ªç›®çš„ï¼š1.å®¹é”™ï¼Œ2.å¢åŠ æ•°æ®å±€éƒ¨æ€§çš„æ¦‚ç‡ï¼Œæœ‰åˆ©äºè®¿é—®.block å¤åˆ¶åœ¨æ•°æ®èŠ‚ç‚¹æ¥æ”¶ï¼ˆingestï¼šæ¶ˆåŒ–ï¼‰block æ—¶åŒæ—¶å‘ç”Ÿã€‚å¦‚å›¾æ‰€ç¤ºï¼š NameNodeï¼šä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼ŒNameNode ä¸»è¦è´Ÿè´£ç®¡ç† HDFS çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ directoryï¼Œæ–‡ä»¶å¯¹è±¡å’Œç›¸å…³å±æ€§ï¼ˆe.g. ACL),å…ƒæ•°æ®æ˜¯å¸¸é©»å†…å­˜ä¸­çš„ï¼Œç¡¬ç›˜ä¸Šä¹Ÿæœ‰å¤‡ä»½ä»¥åŠæ—¥å¿—ä¿è¯æŒä¹…æ€§å’Œå´©æºƒåçš„ä¸€è‡´æ€§ï¼ˆå’Œæ•°æ®åº“ç›¸ä¼¼ï¼‰.è¿˜åŒ…æ‹¬ block çš„ä½ç½®ä¿¡æ¯â€“block ä¹‹é—´çš„å…³ç³»ã€‚æ³¨æ„ï¼Œæ•°æ®ï¼ˆæ–‡ä»¶ï¼‰å¹¶ä¸ç»è¿‡ NameNodeï¼Œå¦åˆ™å¾ˆå®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œæ•°æ®æ˜¯ç›´æ¥åˆ°è¾¾ DataNodeï¼Œå¹¶ä¸ŠæŠ¥ç»™ NameNode ç®¡ç†ã€‚ æ•°æ®èŠ‚ç‚¹ï¼ˆDataNodeï¼‰è´Ÿè´£ï¼šblock å¤åˆ¶ï¼›ç®¡ç†æœ¬èŠ‚ç‚¹çš„å­˜å‚¨ï¼›å‘ NameNode ä¸ŠæŠ¥ block ä¿¡æ¯ã€‚æ³¨æ„ï¼Œæ•°æ®èŠ‚ç‚¹ä¸ä¼šæ„è¯†åˆ° HDFS çš„ç›®å½•ï¼ˆdirectoryï¼‰å’Œæ–‡ä»¶ï¼ˆFilesï¼‰çš„æ¦‚å¿µï¼Œè¿™äº›ä¿¡æ¯æ˜¯ NameNode ç®¡ç†ä¿å­˜çš„ï¼Œå®¢æˆ·ç«¯åªä¼šå’Œ NameNode äº¤é“ã€‚ hdfs å®¢æˆ·ç«¯åˆ†ä¸ºï¼šfs shell;hdfs java api;rest proxy æ¥å£ï¼ˆHttpFS ç­‰ï¼‰. å¸¸è§å‘½ä»¤ï¼š # ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ -fè¡¨ç¤ºè¦†ç›– hadoop fs -put -f jour.txt /user/dahu/jour/ # ä¸‹è½½ hadoop fs -get /user/dahu/jour/jour.txt # ls hadoop fs -ls /user/dahu/ # åˆ é™¤ -rè¡¨ç¤ºé€’å½’,åˆ é™¤ç›®å½• hadoop fs -rm /user/dahu/jour/jour.txt hadoop fs -rm -r /user/dahu/jour YARN YARN:Yet Another Resource Negotiator æ˜¯ hadoop çš„èµ„æºç®¡ç†å™¨.YARN æœ‰ä¸ªå®ˆæŠ¤è¿›ç¨‹â€“ResourceManagerï¼Œè´Ÿè´£å…¨å±€çš„èµ„æºç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ï¼ŒæŠŠæ•´ä¸ªé›†ç¾¤å½“ä½œè®¡ç®—èµ„æºæ± ï¼Œåªå…³æ³¨åˆ†é…ï¼Œä¸ç®¡åº”ç”¨ï¼Œä¸”ä¸è´Ÿè´£å®¹é”™.YARN å°† applicationï¼ˆæˆ–è€…å« jobï¼‰åˆ†å‘ç»™å„ä¸ª NodeManager,NodeManager æ˜¯å®é™…çš„ worker æˆ–è€… worker çš„ä»£ç†.ResourceManager ä¸»è¦æœ‰ä¸¤ä¸ªç»„ä»¶ï¼šScheduler å’Œ ApplicationsManager. ä¸‹å›¾æ˜¯ YARN çš„ç»“æ„ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­ ResourceManager è´Ÿè´£ç®¡ç†å’Œåˆ†é…å…¨å±€çš„è®¡ç®—èµ„æºã€‚è€Œ NodeManager çœ‹ç€æ›´å¤æ‚ä¸€äº›ï¼š1.ç”¨æˆ·æäº¤ä¸€ä¸ª app ç»™ RMï¼ˆResourceManagerï¼‰ï¼›2.RM åœ¨èµ„æºå……è¶³çš„ NodeManager ä¸Šå¯åŠ¨ä¸€ä¸ª ApplicationMasterï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ª app å¯¹åº”çš„ç¬¬ä¸€ä¸ª containerï¼‰.3.ApplicationMaster è´Ÿè´£åœ¨æ‰€æœ‰ NodeManagers ä¸­åè°ƒåˆ›å»ºå‡ ä¸ª task containerï¼Œä¹ŸåŒ…æ‹¬ ApplicationMaster è‡ªå·±æ‰€åœ¨çš„ NodeManagerï¼ˆä¸Šå›¾ä¸­ç´«è‰² 2 ä¸ªå’Œçº¢è‰²çš„ 4 ä¸ªåˆ†åˆ«è¡¨ç¤º 2 ä¸ª app çš„ task container å’Œ ApplicationMasterï¼‰.4. NodeManager å‘å„ä¸ª ApplicationMaster æ±‡æŠ¥ task container çš„è¿›å±•å’ŒçŠ¶æ€.5. ApplicationMaster å‘ RM æ±‡æŠ¥åº”ç”¨çš„è¿›å±•å’ŒçŠ¶æ€.6.RM å‘ç”¨æˆ·è¿”å› app çš„è¿›åº¦ï¼ŒçŠ¶æ€ï¼Œç»“æœã€‚ç”¨æˆ·ä¸€èˆ¬å¯é€šè¿‡ Web UI æŸ¥çœ‹è¿™äº›ã€‚ ä¸Šé¢çš„ç¤ºæ„å›¾æ˜¯ YARN çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒSpark ç¨‹åºçš„è¿è¡Œç»“æ„ç¤ºæ„å›¾å’Œä¸Šé¢çš„ç¤ºæ„å›¾ç›¸åŒã€‚æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¿‘ä¼¼ä¸€æ ·çš„ç†è§£ï¼Œä¾‹å¦‚ï¼Œä¸Šé¢çš„ Client åœ¨ Spark ä¸­å« Driver ç¨‹åº;ResourceManager åœ¨ Spark ä¸­å« Cluster Managerï¼ˆä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œè®¤ä¸ºä¸€æ ·å³å¯ï¼ŒSpark çš„ ClusterManager ç›®å‰ä¸»è¦æœ‰ YARN,Mesos å’Œ Spark è‡ªå¸¦çš„ä¸‰ç§ï¼‰ï¼›NodeManager å°±æ˜¯ Spark ä¸­çš„ Worker Node. Spark åŸºæœ¬æ¦‚å¿µ ä¸Šå›¾ä¸­çš„ client ç¨‹åºåœ¨ Spark ä¸­å³ Driver ç¨‹åº.Driver å°±æ˜¯æˆ‘ä»¬ç¼–å†™ Spark ç¨‹åº app çš„ä¸»è¦éƒ¨åˆ†ï¼ŒåŒ…æ‹¬SparkContextçš„åˆ›å»ºå’Œå…³é—­ä»¥åŠè®¡ç®—ä»»åŠ¡ï¼ˆTaskï¼‰çš„è®¡åˆ’ï¼ˆPlanningï¼ŒåŒ…æ‹¬æ•°æ®æ•°æ®ï¼Œè½¬æ¢ï¼Œè¾“å‡ºï¼ŒæŒä¹…åŒ–ç­‰).SparkContextè´Ÿè´£å’Œ Cluster Manager é€šä¿¡ï¼Œè¿›è¡Œèµ„æºç”³è¯·ï¼Œä»»åŠ¡çš„åˆ†é…å’Œç›‘æ§ã€‚ä¸€èˆ¬è®¤ä¸ºSparkContextä»£è¡¨ Driver. ClusterManagerï¼šå°±æ˜¯ä¸Šé¢è¯´çš„ä¸‰ç§-Standalone,YARN,Mesos. WorkerNode: é›†ç¾¤ä¸­è¿è¡Œ app ä»£ç çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­ YARN çš„ NodeManager èŠ‚ç‚¹ã€‚ä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ª/å¤šä¸ª executor. Executorï¼šapp è¿è¡Œåœ¨ worker èŠ‚ç‚¹çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹è´Ÿè´£æ‰§è¡Œ task çš„ planning.Spark On YARN ä¸­è¿™ä¸ªè¿›ç¨‹å« CoarseGrainedExecutorBackend.æ¯ä¸ªè¿›ç¨‹èƒ½å¹¶è¡Œæ‰§è¡Œçš„ task æ•°é‡å–å†³äºåˆ†é…ç»™å®ƒçš„ CPU ä¸ªæ•°äº†ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ª Spark ç¨‹åºé›†ç¾¤æ¦‚è§ˆå›¾ï¼Œå’Œä¸Šå›¾å¾ˆç›¸ä¼¼ã€‚ ä»”ç»†å¯¹æ¯”ä¸Šé¢ä¸¤ä¸ªç¤ºæ„å›¾ï¼Œåœ¨ YARN çš„ç»“æ„ç¤ºæ„å›¾ä¸­ï¼ŒResourceManager ä¸ºç¨‹åºåœ¨æŸä¸ª NodeManager ä¸Šåˆ›å»ºçš„ç¬¬ä¸€ä¸ª container å« ApplicationMaster,ApplicationMaster è´Ÿè´£åªæ˜¯å…¶ä»–çš„ task container.åœ¨ Spark On YARN æœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼šclient å’Œ cluster æ¨¡å¼ã€‚åœ¨ cluster æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·ç¼–å†™çš„ driver ç¨‹åºè¿è¡Œåœ¨ YARN çš„ ApplicationMaster çš„å†…éƒ¨ã€‚ *RDD:Spark çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚åé¢è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸€ä¸ª Spark ç¨‹åºæ‰€æœ‰éœ€è¦å¤„ç†çš„æ•°æ®åœ¨ Spark ä¸­è¢«æŠ½è±¡æˆä¸€ä¸ª RDDï¼Œæ•°æ®éœ€è¦è¢«æ‹†åˆ†åˆ†å‘åˆ°å„ä¸ª worker å»è®¡ç®—ï¼Œæ‰€ä»¥ RDD æœ‰ä¸€ä¸ªåˆ†åŒºï¼ˆPartationï¼‰æ¦‚å¿µã€‚ä¸€èˆ¬æˆ‘ä»¬çš„æ•°æ®æ˜¯æ”¾åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ (e.g. HDFS),å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ª RDD åŒ…å«ä¸€æˆ–å¤šä¸ª Partationï¼Œæ¯ä¸ª Partation å¯¹åº”çš„å°±æ˜¯ HDFS çš„ä¸€ä¸ª block.å½“ç„¶ï¼ŒPartation ä¸æ˜¯å’Œ HDFS çš„ block ç»‘å®šçš„ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œå³ä½¿ä»–ä»¬åªæ˜¯å¾…å¤„ç†çš„ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶æˆ–è€…ä¸€ä¸ªå°æ•°ç»„ã€‚ä¸€ä¸ª Partation åŒ…å«ä¸€åˆ°å¤šä¸ª Record,Record å¯ä»¥ç†è§£ä¸ºæ–‡æœ¬ä¸­çš„ä¸€è¡Œï¼Œexcel çš„ä¸€æ¡è®°å½•æˆ–è€…æ˜¯ kafka çš„ä¸€æ¡æ¶ˆæ¯ã€‚ Taskï¼šRDD çš„ä¸€ä¸ª Patation å¯¹åº”ä¸€ä¸ª Task,Task æ˜¯å•ä¸ªåˆ†åŒºä¸Šæœ€å°çš„å¤„ç†å•å…ƒã€‚ RDD pass SparkStreaming pass SparkStreaming+Kafka import org.apache.kafka.clients.consumer.ConsumerRecord import org.apache.kafka.common.serialization.StringDeserializer import org.apache.spark.streaming.kafka010._ import org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistent import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribe val kafkaParams = Map[String, Object]( \"bootstrap.servers\" -\u003e \"localhost:9092,anotherhost:9092\", \"key.deserializer\" -\u003e classOf[StringDeserializer], \"value.deserializer\" -\u003e classOf[StringDeserializer], \"group.id\" -\u003e \"use_a_separate_group_id_for_each_stream\", \"auto.offset.reset\" -\u003e \"latest\", \"enable.auto.commit\" -\u003e (false: java.lang.Boolean) ) val topics = Array(\"topicA\", \"topicB\") val stream = KafkaUtils.createDirectStream[String, String]( streamingContext, PreferConsistent, Subscribe[String, String](topics, kafkaParams) ) stream.map(record =\u003e (record.key, record.value)) DStream çš„ elements:record is ConsumerRecord: A key/value pair to be received from Kafka. This consists of a topic name and a partition number, from which the record is being received and an offset that points to the record in a Kafka partition.åŒ…å« key(),offset(),partation() æ–¹æ³•ç­‰ã€‚ å½“ä¸€ä¸ª StreamingContext ä¸­æœ‰å¤šä¸ª input stream æ—¶ï¼Œè®°å¾—ä¿è¯ç»™ç¨‹åºåˆ†é…äº†è¶³å¤Ÿçš„èµ„æºï¼ˆç‰¹åˆ«æ˜¯ core çš„æ•°é‡ï¼Œå¿…é¡»å¤§äºè¾“å…¥æºçš„æ•°é‡ï¼‰. æœ¬åœ°æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸è¦ä½¿ç”¨â€œlocalâ€orâ€œlocal[1]â€as the master URL,streaming ç¨‹åºè‡³å°‘éœ€è¦ä¸¤ä¸ª threadï¼Œä¸€ä¸ªæ¥å—æ•°æ®ï¼Œä¸€ä¸ªå¤„ç†æ•°æ®ã€‚ç›´æ¥ä½¿ç”¨ local[n],n\u003eè¾“å…¥æºä¸ªæ•°ã€‚ DStream å’Œ RDD ä¸€æ ·æ”¯æŒå„ç§ trans å’Œ action DStream is batches of RDDs. å¸¸è§é”™è¯¯ æ•°æ®åº“ (mysql redis) è¿æ¥çš„å¯åºåˆ—åŒ–é—®é¢˜ dstream.foreachRDD { rdd =\u003e val connection = createNewConnection() // executed at the driver rdd.foreach { record =\u003e connection.send(record) // executed at the worker } } // ä¸Šé¢çš„å†™æ³•ä¼šå¯¼è‡´ connection ä¸å¯åºåˆ—åŒ–çš„é”™è¯¯ï¼šTask not serializable // RDD çš„å‡½æ•° (map,foreach) ä¼šè¢«åºåˆ—åŒ–å‘é€åˆ° worker èŠ‚ç‚¹æ‰§è¡Œï¼Œä½†æ˜¯ connection æ˜¯å’Œ tcp è¿æ¥ï¼Œå’Œæœºå™¨ç»‘å®šçš„ï¼Œæ— æ³•åºåˆ—åŒ– dstream.foreachRDD { rdd =\u003e rdd.foreach { record =\u003e // on worker node val connection = createNewConnection() // ç»™æ¯ä¸ª record å¤„ç†æ—¶æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„æ•°æ®åº“è¿æ¥æ€§èƒ½é—®é¢˜ connection.send(record) connection.close() } } // æ›´å¥½çš„æ–¹å¼æ˜¯ç»™æ¯ä¸ª partation æ–°å»ºä¸€ä¸ªè¿æ¥ dstream.foreachRDD { rdd =\u003e rdd.foreachPartition { partitionOfRecords =\u003e val connection = createNewConnection() partitionOfRecords.foreach(record =\u003e connection.send(record)) connection.close() } } // æœ€å¥½çš„æ–¹æ³•æ˜¯ç»´æŠ¤ä¸€ä¸ªé™æ€çº¿ç¨‹æ± ï¼š [ConnectionPool](https://github.com/RedisLabs/spark-redis/blob/master/src/main/scala/com/redislabs/provider/redis/ConnectionPool.scala) // then use in partition dstream.foreachRDD { rdd =\u003e rdd.foreachPartition { partitionOfRecords =\u003e // ConnectionPool is a static, lazily initialized pool of connections val connection = ConnectionPool.getConnection() partitionOfRecords.foreach(record =\u003e connection.send(record)) ConnectionPool.returnConnection(connection) // return to the pool for future reuse } } // Note that the connections in the pool should be lazily created on demand and timed out if not used for a while. // This achieves the most efficient sending of data to external systems. // ç¤ºä¾‹ case class RedisCluster(clusterHosts: String, password: String) extends Serializable { def this(conf: SparkConf) { this( conf.get(\"spark.redis.host\", Protocol.DEFAULT_HOST), conf.get(\"spark.redis.auth\", null) ) } /** * * @return use for JedisCluster or JedisPool */ def toSet(): java.util.Set[HostAndPort] = { val nodes: mutable.Set[HostAndPort] = mutable.Set() for (host_port \u003c- clusterHosts.split(\",\")) { val hp = host_port print(hp) nodes += HostAndPort.from(host_port) } nodes.asJava } } object RedisClusterUtils extends Serializable { @transient private lazy val pools: ConcurrentHashMap[RedisCluster, JedisCluster] = new ConcurrentHashMap[RedisCluster, JedisCluster]() /** * è·å–ä¸€ä¸ª JedisCluster * @param rc * @return */ def connect(rc: RedisCluster): JedisCluster = { pools.getOrElseUpdate(rc, { val poolConfig = new JedisPoolConfig(); poolConfig.setMaxTotal(250) poolConfig.setMaxIdle(32) poolConfig.setTestOnBorrow(false) poolConfig.setTestOnReturn(false) poolConfig.setTestWhileIdle(false) poolConfig.setNumTestsPerEvictionRun(-1) val jedisCluster = new JedisCluster(rc.toSet(), 3000, 3000, 5, rc.password, poolConfig) jedisCluster }) } /** * æŸ¥è¯¢å¸ç§å¯¹åº”æ±‡ç‡ * @param jedisCluster ç›®æ ‡ redis * @param ccyCd å¸ç§ä»£ç  * @return æŠ˜ç¾å…ƒæ±‡ç‡ */ def getCcyRatio(jedisCluster: JedisCluster, ccyCd:String): Double ={ val res = jedisCluster.get(\"CCY:\"+ccyCd) res.split(\":\")(2).toDouble } } å‚è€ƒ Design Patterns for using foreachRDD Redis on Spark:Task not serializable How to create connection(s) to a Datasource in Spark Streaming for Lookups DStream çš„ RDD åˆ†åŒºæ•°æ˜¯ç”± topic åˆ†åŒºæ•°ç›¸åŒçš„ã€‚ æœ€ä½³å®è·µ","title":"Spark Basic","uri":"/post/spark-basic/"},{"content":"æµ‹è¯•ä¸­å¦‚æœé‡åˆ°è¢«æµ‹è¯•æ–¹æ³•è°ƒç”¨ void æ–¹æ³•ï¼Œåœ¨ Mockito ä¸­æ”¹å¦‚ä½•å¤„ç†ï¼Ÿ å‡è®¾æœ‰å¦‚ä¸‹çš„æœåŠ¡ä¾èµ–ï¼š @Service class DepositSvc { @Autowired private AccountSvc accSvc; public List dps(String user) { List accounts = new ArrayList(); List banks = getBanks(); accSvc.addLinkedAccounts(user, accounts, banks);//accounts è¢«æ”¹åŠ¨äº†å¦‚ä½• mock? return accounts; } } @Service class AccountSvc { @Autowired private RestClient restClient; public void addLinkedAccounts(String user, List accounts, List banks) { acc = restClient.getAcc(user); accounts.add(acc); } } è¿™é‡Œçš„ AccountSvc åªæ˜¯æä¾›äº†ä¸€ä¸ª void æ–¹æ³•å¤„ç†äº†å…¥å‚ accountsï¼Œè™½ç„¶ä¿®æ”¹å…¥å‚æ˜¯è¢«æˆ‘æ‰€ä¸é½¿çš„ï¼Œä½†æ˜¯æœ‰æ—¶æ”¹å†™è¿™ç±»æ–¹æ³•æŒºéº»çƒ¦çš„ï¼Œç‰¹åˆ«å¦‚æœæ–¹æ³•ä¿®æ”¹äº†ä¸¤ä¸ªå…¥å‚çš„è¯ã€‚ è¿™ç§æƒ…å†µä¸‹å¦‚ä½•æµ‹è¯• DepositSvc.dps æ–¹æ³•å‘¢ï¼Ÿmockito çš„ doAnswerå°±æ˜¯ç”¨äºæ¨¡æ‹Ÿ void æ–¹æ³•å›è°ƒçš„ã€‚ class DepositSvcTest { @InjectMocks private DepositSvc depositSvc; @Mock private AccountSvc accountSvc; void test_dps() { // ... arrange // mock void method with arguments doAnswer((invocation) -\u003e { Object[] args = invocation.getArguments(); List accounts = (List) args[1]; //è¿™é‡Œå¯ä»¥æ‹¿åˆ°å…¥å‚ accounts.add(new Account(911); //ä¿®æ”¹å…¥å‚ return null; }).when(accountSvc).addLinkedAccounts(any(), anyList(), anyList()); // ...assert } } ","title":"java å•å…ƒæµ‹è¯•å¦‚ä½• Mock æœ‰å‚æ•°çš„ void æ–¹æ³•","uri":"/post/java-how-test-void-method-with-parameter/"},{"content":"æ³›å‹ // ç±» class Tuple { private T first; private S second; } // æ³›å‹æ–¹æ³•ä¹Ÿå¯åœ¨éæ³›å‹ç±»é‡Œé¢ class ArrayAlg { public static T getMiddle(T... a) { return a[a.length / 2]; } } String middle = ArrayAlg.getMiddle(\"]ohnM, \"Q.n, \"Public\");// right,å¯ä»¥çœç•¥ String middle = GenericCls.getMiddle(\"hello\",0,null);// error // Errr:(7, 45) java: ä¸å…¼å®¹çš„ç±»å‹ï¼šæ¨æ–­ç±»å‹ä¸ç¬¦åˆä¸Šé™ // æ¨æ–­ï¼šjava.lang.Object\u0026java.io.Serializable\u0026java.lang.Comparable\u003c? extends java.lang.Object\u0026java.io.Serializable\u0026java.lang.Comparable\u003c?\u003e\u003e // ä¸Šé™ï¼šjava.lang.String,java.lang.Object ç±»å‹é™å®š public static T min(T a) // å¦‚æœå¤šä¸ªç±»å‹ï¼Œåˆ™ï¼šT extends Comparable \u0026 Serializable // åªèƒ½æœ‰ä¸€ä¸ªç±»ï¼Œä¸”ç±»å¿…é¡»ç´§è·Ÿ extendsï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ¥å£ ç±»å‹æ“¦é™¤ //Tupleåœ¨è™šæ‹Ÿæœºå˜ä¸º class Tuple { private Object first;//å½“è°ƒç”¨ getFirst æ—¶ï¼Œåˆ™å‘ç”Ÿå¼ºåˆ¶è½¬æ¢ private Object second; } //æ³›å‹æ–¹æ³•åŒæ ·æœ‰æ“¦é™¤ public static T min(T a) // =\u003e public static Comparable min(Comparable a) çº¦æŸ ä¸èƒ½ç”¨åŸºæœ¬ç±»å‹å®ä¾‹åŒ–æ³›å‹ï¼ŒPairä¸å…è®¸ è¿è¡Œæ—¶å‚æ•°ç±»å‹æ£€æŸ¥åªèƒ½æ£€æŸ¥åŸå§‹ç±»å‹ if (a instanceof Pair) // Error if (a instanceof Pair) // Error Pair p = (Pair) a; //warning ä¸èƒ½åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ Pair[] table = new Pair[10]; // Error Pair[] table; //å£°æ˜æ˜¯åˆæ³•çš„ï¼Œåªæ˜¯æ— æ³•å®ä¾‹åŒ– å€ŸåŠ©@SafeVarargs å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ @SafeVarargs public static void addAll(Collection coll, T... ts) Class ç±»æœ¬èº«æ˜¯æ³›å‹ã€‚ä¾‹å¦‚ï¼ŒString.daSS æ˜¯ä¸€ä¸ª Class çš„å®ä¾‹ï¼ˆäº‹å®ä¸Šï¼Œå®ƒæ˜¯å”¯ä¸€çš„å®ä¾‹.) å› æ­¤ï¼ŒmakePair æ–¹æ³•èƒ½å¤Ÿæ¨æ–­å‡º pair çš„ç±»å‹ æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆ public class Singleton { private static T singlelnstance; // Error public static T getSinglelnstance{// Error if (singleinstance == null) {//construct new instance of T return singlelnstance; } } } ä¸èƒ½æŠ›å‡ºæˆ–æ•è·æ³›å‹ç±»çš„å®ä¾‹ public class Problem extends Exception { /* . . . */ } // Error can't extend Throwable æ³›å‹æ“¦é™¤çš„æ–¹æ³•å†²çª public class Pair { T first; T second; public boolean equals(T value) { //error å’Œ Object.equals å†²çª return first.equals(value) \u0026\u0026 second, equals(value); } } æ³›å‹ç»§æ‰¿ class Employee class Manager extends Employee //Pair å’Œ Pair æ²¡ç”¨ä»»ä½•ç»§æ‰¿å…³ç³» é€šé…ç¬¦ å’Œ PECS Pair\u003c? extends Employeeã€‰ Pair\u003c? super Manager åå°„å’Œæ³›å‹","title":"java generic","uri":"/post/java-generic/"},{"content":"ä¸Šæ¬¡æ€»ç»“äº† java ä¸­ä¸åŒè¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œè¿™æ¬¡æ€»ç»“ä¸€ä¸‹åŸºæœ¬çš„ IO æµã€‚ç½‘ä¸Šçš„æ€»ç»“å¤§éƒ¨åˆ†æ˜¯ä»¥ Stream å’Œ Readerã€Writer æ¥ä»‹ç»çš„ã€‚è¿™æ¬¡ä»å°è£…å±‚æ¬¡æ¥ä»‹ç»ã€‚\næ¦‚è§ˆ é¦–å…ˆç†è§£è®¡ç®—æœºæ–‡ä»¶æ ¼å¼éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚æ–‡æœ¬ï¼Œå›¾ç‰‡ï¼Œè§†é¢‘ï¼ŒéŸ³é¢‘ç­‰ï¼Œä½†æ˜¯æ–‡æœ¬éå¸¸ç‰¹æ®Šï¼Œæ‰€ä»¥å•ç‹¬æœ‰ä¸€ç±»å°è£…è®¾è®¡ã€‚\nå¯¹äºéæ–‡æœ¬ç±»çš„æ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯è¯»å–å­—èŠ‚ (stream)ï¼Œè€Œå¯¹äºæ–‡æœ¬ç±»æ–‡ä»¶ï¼Œåˆ™å¯ä»¥è¯»å–å­—ç¬¦ (reader)\nå½“ç„¶ï¼Œæ–‡æœ¬æ–‡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ inputstream è¯»å–åå†è½¬æ¢Reader reader = new InputStreamReader(inputStream, StandardCharsets.UTF_8);\nstream é¦–å…ˆæ˜¯ byte æµï¼Œæ¯æ¬¡ read() è¯»å– 8 bitsï¼Œå¹¶ç”¨ä¸€ä¸ª int çš„ä½å…«ä½ä¿å­˜ï¼š\nFileInputStream in = null; FileOutputStream out = null; try { in = new FileInputStream(\"xanadu.txt\"); out = new FileOutputStream(\"outagain.txt\"); int c; while ((c = in.read()) != -1) { out.write(c); } } finally { if (in != null) { in.close(); } if (out != null) { out.close(); } } byte æµæ˜¯å¾ˆåŸºç¡€çš„æµï¼Œæ¥ä¸‹æ¥æ˜¯å­—ç¬¦æµï¼Œä½¿ç”¨ int çš„ä½ 16 ä½ä¿å­˜è¯»å–å†…å®¹ï¼Œä¸€ä¸ªæ±‰å­—ï¼Œä½¿ç”¨ä¸Šé¢é‚£ä¸ªå­—èŠ‚æµï¼Œéœ€è¦è¯»å– 2 æ¬¡ï¼Œä½¿ç”¨ä¸‹é¢çš„å­—ç¬¦æµï¼Œåªç”¨ä¸€æ¬¡ã€‚å…¶å®èƒŒåè¿˜æ˜¯ä¸€ä¸ªæ¡¥æ¥\nå…·ä½“çš„å¯¹è±¡ä½“ç°ï¼š\nFileReader extemds InputStreamReader,\nFileWriter extends OutputStreamWriter\nInputStreamReader:å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢\nOutputStreamWriter:å­—ç¬¦åˆ°å­—èŠ‚çš„æ¡¥æ¢ï¼š\nFileReader inputReader = null; FileWriter outputStream = null; try { inputReader = new FileReader(\"xanadu.txt\"); outputStream = new FileWriter(\"characteroutput.txt\"); int c; while ((c = inputReader.read()) != -1) { outputStream.write(c); } } finally { if (inputReader != null) { inputReader.close(); } if (outputStream != null) { outputStream.close(); } } ByteArrayInputStreamã€StringBufferInputStreamã€FileInputStream æ˜¯ä¸‰ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«ä» Byte æ•°ç»„ã€StringBufferã€å’Œæœ¬åœ°æ–‡ä»¶ä¸­è¯»å–æ•°æ®.StringBufferInputStream å·²ç»è¢« Deprecatedï¼Œè®¾è®¡é”™è¯¯ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹ã€‚\nFile I/O ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œæ¨è nio2 çš„ Path åŠå…¶å·¥å…·ç±» Filesã€Paths;\nPath å®˜æ–¹æ•™ç¨‹\nObjectInputStream å’Œæ‰€æœ‰ FilterInputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµï¼ˆè£…é¥°å™¨æ¨¡å¼çš„ä¸»è§’ï¼‰\næ³¨æ„ï¼šOutputStream å­ç±»ä¸­æ²¡æœ‰ StringBuffer ä¸ºç›®çš„åœ°çš„ã€‚ObjectOutputStream å’Œæ‰€æœ‰ FilterOutputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµã€‚\nå‡ ä¸ªç‰¹æ®Šçš„ç±»ï¼š\nPushbackInputStream çš„åŠŸèƒ½æ˜¯æŸ¥çœ‹æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¸æ»¡æ„å°±æ”¾å…¥ç¼“å†²åŒºã€‚ä¸»è¦ç”¨åœ¨ç¼–è¯‘å™¨çš„è¯­æ³•ã€è¯æ³•åˆ†æéƒ¨åˆ†ã€‚è¾“å‡ºéƒ¨åˆ†çš„ BufferedOutputStream å‡ ä¹å®ç°ç›¸è¿‘çš„åŠŸèƒ½ã€‚\nPrintStream ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè¾…åŠ©å·¥å…·ã€‚ä¸»è¦å¯ä»¥å‘å…¶ä»–è¾“å‡ºæµï¼Œæˆ–è€… FileInputStream å†™å…¥æ•°æ®ï¼Œæœ¬èº«å†…éƒ¨å®ç°è¿˜æ˜¯å¸¦ç¼“å†²çš„ã€‚æœ¬è´¨ä¸Šæ˜¯å¯¹å…¶å®ƒæµçš„ç»¼åˆè¿ç”¨çš„ä¸€ä¸ªå·¥å…·è€Œå·²ã€‚ä¸€æ ·å¯ä»¥è¸¢å‡º IO åŒ…ï¼System.out å’Œ System.err å°±æ˜¯ PrintStream çš„å®ä¾‹ï¼System.in æ˜¯ InputStream çš„å®ä¾‹ï¼\nä½ æ°¸è¿œä¸åº”è¯¥ new PrintStreamï¼Œè¯·ç”¨ PrintWriter\nreader writer CharReaderã€StringReader æ˜¯ä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å°† Char æ•°ç»„ã€String ä¸­è¯»å–æ•°æ®.PipedReader æ˜¯ä»ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­è¯»å–æ•°æ®ã€‚\nBufferedReader å¾ˆæ˜æ˜¾å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒå’Œå…¶å­ç±»è´Ÿè´£è£…é¥°å…¶å®ƒ Reader å¯¹è±¡ã€‚\nFilterReader æ˜¯æ‰€æœ‰è‡ªå®šä¹‰å…·ä½“è£…é¥°æµçš„çˆ¶ç±»ï¼Œå…¶å­ç±» PushbackReader å¯¹ Reader å¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¼šå¢åŠ ä¸€ä¸ªè¡Œå·ã€‚\nInputStreamReader æ˜¯ä¸€ä¸ªè¿æ¥å­—èŠ‚æµå’Œå­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå®ƒå°†å­—èŠ‚æµè½¬å˜ä¸ºå­—ç¬¦æµ.FileReader å¯ä»¥è¯´æ˜¯ä¸€ä¸ªè¾¾åˆ°æ­¤åŠŸèƒ½ã€å¸¸ç”¨çš„å·¥å…·ç±»ï¼Œåœ¨å…¶æºä»£ç ä¸­æ˜æ˜¾ä½¿ç”¨äº†å°† FileInputStream è½¬å˜ä¸º Reader çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªç±»ä¸­å¾—åˆ°ä¸€å®šçš„æŠ€å·§.Reader ä¸­å„ä¸ªç±»çš„ç”¨é€”å’Œä½¿ç”¨æ–¹æ³•åŸºæœ¬å’Œ InputStream ä¸­çš„ç±»ä½¿ç”¨ä¸€è‡´ã€‚åé¢ä¼šæœ‰ Reader ä¸ InputStream çš„å¯¹åº”å…³ç³»ã€‚\nOutputStreamWriter æ˜¯ OutputStream åˆ° Writer è½¬æ¢çš„æ¡¥æ¢ï¼Œå®ƒçš„å­ç±» FileWriter å…¶å®å°±æ˜¯ä¸€ä¸ªå®ç°æ­¤åŠŸèƒ½çš„å…·ä½“ç±»ï¼ˆå…·ä½“å¯ä»¥ç ”ç©¶ä¸€ SourceCodeï¼‰.åŠŸèƒ½å’Œä½¿ç”¨å’Œ OutputStream æå…¶ç±»ä¼¼ï¼Œåé¢ä¼šæœ‰å®ƒä»¬çš„å¯¹åº”å›¾ã€‚\nPrintWriter å’Œ PrintStream æå…¶ç±»ä¼¼ï¼ŒåŠŸèƒ½å’Œä½¿ç”¨ä¹Ÿéå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸åŒçš„ï¼ŒPrintStream prints to an OutputStream, and PrintWriter prints to a Writer.\nä½ æ°¸è¿œä¸åº”è¯¥ new PrintStreamï¼Œè¯·ç”¨ PrintWriter\nPrintStream stream = new PrintStream(outputStream); //With the PrintWriter you can however pass an OutputStreamWriter with a specific encoding. PrintWriter writer = new PrintWriter(new OutputStreamWriter(outputStream, \"UTF-8\")); RandomAccessFile ç±» è¯¥å¯¹è±¡å¹¶ä¸æ˜¯æµä½“ç³»ä¸­çš„ä¸€å‘˜ï¼Œå…¶å°è£…äº†å­—èŠ‚æµï¼ŒåŒæ—¶è¿˜å°è£…äº†ä¸€ä¸ªç¼“å†²åŒºï¼ˆå­—ç¬¦æ•°ç»„ï¼‰ï¼Œé€šè¿‡å†…éƒ¨çš„æŒ‡é’ˆæ¥æ“ä½œå­—ç¬¦æ•°ç»„ä¸­çš„æ•°æ®ã€‚è¯¥å¯¹è±¡ç‰¹ç‚¹ï¼š\nè¯¥å¯¹è±¡åªèƒ½æ“ä½œæ–‡ä»¶ï¼Œæ‰€ä»¥æ„é€ å‡½æ•°æ¥æ”¶ä¸¤ç§ç±»å‹çš„å‚æ•°ï¼ša.å­—ç¬¦ä¸²æ–‡ä»¶è·¯å¾„ï¼›b.File å¯¹è±¡ã€‚\nè¯¥å¯¹è±¡æ—¢å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè¯»æ“ä½œï¼Œä¹Ÿèƒ½è¿›è¡Œå†™æ“ä½œï¼Œåœ¨è¿›è¡Œå¯¹è±¡å®ä¾‹åŒ–æ—¶å¯æŒ‡å®šæ“ä½œæ¨¡å¼ (rã€rw)\næ³¨æ„ï¼šè¯¥å¯¹è±¡åœ¨å®ä¾‹åŒ–æ—¶ï¼Œå¦‚æœè¦æ“ä½œçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼›å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå†™æ•°æ®æœªæŒ‡å®šä½ç½®ï¼Œä¼šä»å¤´å¼€å§‹å†™ï¼Œå³è¦†ç›–åŸæœ‰çš„å†…å®¹ã€‚å¯ä»¥ç”¨äºå¤šçº¿ç¨‹ä¸‹è½½æˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™æ•°æ®åˆ°æ–‡ä»¶ã€‚\nScanning and formatting The scanner API breaks input into individual tokens associated with bits of data,The formatting API assembles data into nicely formatted, human-readable form.\nformatting\nint i = 2; double r = Math.sqrt(i); System.out.format(\"The square root of %d is %f.%n\", i, r); Scanner s = new Scanner(new BufferedReader(new FileReader(\"xanadu.txt\"))); By default, a scanner uses white space to separate tokens. also,u can set :\ns.useDelimiter(\",\\\\s*\");\nI/O from commandline You might expect the Standard Streams to be character streams, but, for historical reasons, they are byte streams. System.out and System.err are defined as PrintStream objects. Although it is technically a byte stream, PrintStream utilizes an internal character stream object to emulate many of the features of character streams.(ï¼ï¼ï¼å¦ˆçš„ï¼Œè€å­å¼€å§‹å°±å›°æƒ‘å¾ˆä¹…äº†ï¼Œä¸€ç›´ä¸æ˜ç™½ System.out æ€ä¹ˆå¯ä»¥ç›´æ¥æ‰“å°å‡ºä¸­æ–‡.)\nBy contrast, System.in is a byte stream with no character stream features. To use Standard Input as a character stream, wrap System.in in InputStreamReader.\nInputStreamReader cin = new InputStreamReader(System.in);\njdk1.5 å¼€å§‹è¯»å†™æ§åˆ¶å°ä»¥å‰å¸¸ç”¨çš„æ˜¯ Scannerï¼š\nScanner scanner = new Scanner(System.in); scanner.nextLine(); ä» JDK1.6 å¼€å§‹ï¼ŒåŸºæœ¬ç±»åº“ä¸­å¢åŠ äº† java.io.Console ç±»ï¼Œç”¨äºè·å¾—ä¸å½“å‰ Java è™šæ‹Ÿæœºå…³è”çš„åŸºäºå­—ç¬¦çš„æ§åˆ¶å°è®¾å¤‡ã€‚åœ¨çº¯å­—ç¬¦çš„æ§åˆ¶å°ç•Œé¢ä¸‹ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°è¯»å–æ•°æ®ã€‚\nConsole console = System.console(); if (console == null) { throw new IllegalStateException(\"ä¸èƒ½ä½¿ç”¨æ§åˆ¶å°\"); } return console.readLine(prompt); Data Streams Data streams support binary I/O of primitive data type values (boolean, char, byte, short, int, long, float, and double) as well as String values. All data streams implement either the DataInput interface or the DataOutput interface. This section focuses on the most widely-used implementations of these interfaces, DataInputStream and DataOutputStream.\n","title":"IO-Java-Stream-Write-Reader","uri":"/post/java-io-basic/"},{"content":"å¦‚ä½•åœ¨ Java ä¸­è¯»å†™æ–‡ä»¶ï¼Œè¿™é‡Œä¿ç•™ Java6/7 ç‰ˆæœ¬ï¼Œä½†æ˜¯ä½ æ°¸è¿œä¸åº”è¯¥ä½¿ç”¨å®ƒä»¬ï¼Œä¼˜å…ˆä½¿ç”¨ Pathã€Filesã€Paths ä¸‰ä¸ªç±»ã€‚ èµ„æ–™ï¼šReading and writing text files Java8 æœ€ä½³å®è·µ ä¸è¦ç”¨ File å¯¹è±¡ï¼Œæ”¹ç”¨ Path å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ—¢è¡¨ç¤ºæ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿè¡¨ç¤ºæ–‡ä»¶æ–‡æœ¬ï¼ˆåº”è¯¥è®¤ä¸ºæ–‡ä»¶ä¹Ÿæ˜¯è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¯¹äºä»¥å‰çš„ Fileï¼Œå¯ä»¥ File.toPath() å¾—åˆ°ä¸€ä¸ª Path å¯¹è±¡ã€‚ Files æ˜¯ä¸€ä¸ªé™æ€ç±»ï¼Œæ“ä½œæ–‡ä»¶å†…å®¹.Paths æ˜¯é™æ€å·¥å…·ç±»ï¼Œæ“ä½œæ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚æ‹¼æ¥æ–‡ä»¶è·¯å¾„ï¼Œä»¥å‰è¦ä½¿ç”¨å¹³å°æ— å…³çš„åˆ†éš”ç¬¦è¡¨ç¤ºï¼šFile.pathSeparatorã€File.separator. ä¾‹å¦‚ï¼Œæ„å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼šPath path = Paths.get(\"~/test/\", \"foo\", \"bar\", \"a.txt\"); read file to string in java 6/7/8 package angus.java.interview; import java.io.BufferedReader; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; import java.io.InputStreamReader; import java.nio.charset.StandardCharsets; import java.nio.file.Files; import java.nio.file.Paths; public class FileToStringJava678 { public static void main(String[] args) throws IOException { // How to read file into String before Java 7 InputStream is = new FileInputStream(\"filetoStringjava678.txt\"); BufferedReader buf = new BufferedReader(new InputStreamReader(is)); String line = buf.readLine(); StringBuilder sb = new StringBuilder(); while (line != null) { sb.append(line).append(\"\\n\"); line = buf.readLine(); } String fileAsString = sb.toString(); System.out.println(\"Contents (before Java 7) : \" + fileAsString); // Reading file into Stirng in one line in JDK 7 with using proper character encoding String fileString = new String(Files.readAllBytes(Paths.get(\"filetoStringjava678.txt\")), StandardCharsets.UTF_8); System.out.println(\"Contents (Java 7 with character encoding ) : \" + fileString); //java 7 æŒ‰è¡Œè¯»å– BufferedReader br = new BufferedReader(new FileReader(file)); String line; while((line = br.readLine()) != null) { // do something with line. } //java 8 æŒ‰è¡Œè¯»å– String fileName = \"c:/lines.txt\"; try (Stream stream = Files.lines(Paths.get(fileName))) { stream.forEach(System.out::println);//or other thing you do with stream } catch (IOException e) { e.printStackTrace(); } // It's even easier in Java 8 Files.lines(Paths.get(\"filetoStringjava678.txt\"), StandardCharsets.UTF_8).forEach(System.out::println); } } java 8 file io demo public class Java8IO { public static void main(String[] args) throws IOException { //è¯»å–æ‰€æœ‰å­—èŠ‚ï¼š Path path = Paths.get(\"alice.txt\"); String content = new String(Files.readAllBytes(path), StandardCharsets.UTF_8); System.out.println(\"Characters: \" + content.length()); // è¯»å–æ‰€æœ‰è¡Œï¼š List lines = Files.readAllLines(path, StandardCharsets.UTF_8); System.out.println(\"Lines: \" + lines.size()); // JAVA 8 å»¶è¿Ÿå¤„ç†ï¼š try (Stream lineStream = Files.lines(path, StandardCharsets.UTF_8)) { System.out.println(\"Average line length: \" + lineStream.mapToInt(String::length).average().orElse(0)); } // æŒ‰å•è¯è¯»å–ï¼š try (Scanner in = new Scanner(path, \"UTF-8\")) { in.useDelimiter(\"\\\\PL+\");//ï¼Ÿ int words = 0; while (in.hasNext()) { in.next(); words++; } System.out.println(\"Words: \" + words); } // è¯»å–ä¸€ä¸ªç½‘é¡µï¼š URL url = new URL(\"https://horstmann.com/index.html\"); try (BufferedReader reader = new BufferedReader(new InputStreamReader(url.openStream()))) { Stream lineStream = reader.lines();////!!!! BufferedReader TO Stream System.out.println(\"Average line length: \" + lineStream.mapToInt(String::length).average().orElse(0)); } // PrintWriter å‘æ–‡æœ¬å†™æ–‡ä»¶ï¼š path = Paths.get(\"hello.txt\"); try (PrintWriter out = new PrintWriter(Files.newBufferedWriter(path, StandardCharsets.UTF_8))) { out.println(\"Hello\"); } // Files.write å‘æ–‡æœ¬å†™æ–‡ä»¶ï¼š content = \"World\\n\"; Files.write(path, content.getBytes(StandardCharsets.UTF_8), StandardOpenOption.APPEND); // å¤šè¡Œå†™å…¥ String fileName = \"file.txt\"; Path path = Paths.get(\"file1.txt\"); List list = new ArrayList\u003c\u003e(); try (Stream lines = Files.lines(Paths.get(fileName))) { lines.forEach(list::add); Files.write(path, list, StandardCharsets.UTF_8); } catch (IOException e) { e.printStackTrace(); } // æ‰“å°é”™è¯¯æ ˆï¼š StringWriter writer = new StringWriter(); Throwable throwable = new IllegalStateException(); throwable.printStackTrace(new PrintWriter(writer)); String stackTrace = writer.toString(); System.out.println(\"Stack trace: \" + stackTrace); // è¾“å…¥æµä¿å­˜åˆ°æ–‡ä»¶ï¼š Files.copy(inputStream,filepath,StandardCopyOption.REPLACE_EXISTING); // ç›´æ¥å°† url ä¸­çš„ pdf ä¿å­˜ä¸‹æ¥ï¼š // é€‚ç”¨äºä»»ä½•äºŒè¿›åˆ¶æ–‡ä»¶ï¼š URL url = new URL(\"http://www.cninfo.com.cn/1202417936.PDF\"); try (InputStream in = new BufferedInputStream(url.openStream())) { Files.copy(in, Paths.get(url.getFile().substring(1)),StandardCopyOption.REPLACE_EXISTING); } // url.getFile().substring(1) å»æ‰èµ·å§‹åœ°æ–œæ ç¬¦ // copy() æœ‰ä¸‰ç§å½¢å¼ // è¿˜æœ‰ä¸€ç§æ–¹å¼ç”¨äº jdk7 ä¹‹å‰ï¼š URL website = new URL(\"XXX.pdf\"); ReadableByteChannel rbc = Channels.newChannel(website.openStream()); FileOutputStream fos = new FileOutputStream(url.getFile().substring(1)); fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE); // FileChannel çš„æŠ½è±¡æ–¹æ³• abstract long\ttransferFrom(ReadableByteChannel src, long position, long count) } } ","title":"Java 6/7/8 ä¸­æ–‡ä»¶è¯»å†™","uri":"/post/java-file-in-v678/"},{"content":"Java AOP: æ‰¾åˆ°ä¸€ä¸ªæœ€ç®€å•çš„ä»‹ç»ï¼Œä¸æ€ä¹ˆæƒ³ç¿»è¯‘ï¼Œç›´æ¥çœ‹åŸæ–‡å§ï¼š\nA Simple Introduction to AOP\næ³¨æ„ï¼Œä½¿ç”¨æ³¨è§£çš„æ–¹å¼å£°æ˜åˆ‡é¢æ—¶ï¼Œå¢åŠ äº†ä¸€ä¸ªç©ºæ–¹æ³•å»å®šä¹‰ Pointcutï¼Œå³ï¼š\nclass Test{ @Pointcut(\"execution(* org.bk.inventory.service.*.*(..))\") public void serviceMethods(){ //è¿™æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ç”¨äºå£°æ˜ Pointcutï¼Œ //åç»­çš„ @Before @Around æ–¹æ³•éƒ½å…³è”è¿™ä¸ªæ–¹æ³• } } åœ¨ä½¿ç”¨ xml é…ç½®çš„è¯ï¼Œå°±ä¸éœ€è¦è¿™ä¸ªæ–¹æ³•äº†ï¼ŒserviceMethods æ–¹æ³•åæ˜¯åé¢é…ç½®åˆ‡ç‚¹çš„å¼•ç”¨ã€‚\nå¦‚æœä¸æƒ³å¼•å…¥ spring çš„è¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ aspectj æˆ–è€… jboss aopã€‚\n","title":"Java AOP example","uri":"/post/java-aop-example/"},{"content":"åŸºæœ¬æ¦‚å¿µ çº¿ç¨‹ï¼šä»»åŠ¡æ‰§è¡Œçš„ç¯å¢ƒï¼Œå¯ä»¥ç†è§£ä¸ºä¼ é€å¸¦ã€‚æ³¨æ„ä»»åŠ¡å¿…é¡»åœ¨çº¿ç¨‹ä¸Šé¢è¢«æ‰§è¡Œã€‚ ä»»åŠ¡ï¼šRunnable/Callable çš„å®ç°ï¼Œå¯ä»¥ç†è§£ä¸ºä¼ é€å¸¦ä¸Šé¢çš„å·¥åºã€‚ èµ„æºï¼šçº¿ç¨‹åœ¨å¤„ç†ä»»åŠ¡å…·ä½“å·¥åºæ—¶éœ€è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œä¾‹å¦‚ä¿¡å·é‡ï¼Œé”ï¼Œå¹¶å‘é›†åˆã€‚éœ€è¦æ³¨æ„ï¼Œä»»åŠ¡æœ¬èº«æè¿°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³ Runnable/Callable å­ç±»å®ä¾‹ï¼‰ï¼Œæ‰€ä»¥åœ¨ Runnable ä»£ç é‡Œé¢ä½ ä¼šçœ‹åˆ° synchronized(this) çš„ç”¨æ³•ï¼Œå°±æ˜¯æŠŠä»»åŠ¡æè¿°æœ¬èº«å½“ä½œä¸€ä¸ªèµ„æºï¼Œç”šè‡³ Thread å†…éƒ¨ä¹Ÿå¯ä»¥å°†å½“å‰ thread å¯¹è±¡å½“åšèµ„æºã€‚ ä»»åŠ¡ å¤šçº¿ç¨‹ç¼–ç¨‹çš„æ ¸å¿ƒå…ƒç´ å°±æ˜¯ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯ç‹¬ç«‹çš„æ´»åŠ¨ï¼Œä¸ä¾èµ–å…¶ä»–ä»»åŠ¡çš„çŠ¶æ€ã€ç»“æœã€ä»¥åŠè¾¹ç•Œæ•ˆåº”ã€‚å®šä¹‰ä»»åŠ¡çš„å†…å®¹ä½¿ç”¨ Runnable å’Œ Callableã€‚ Runnable æ¥å£è¡¨ç¤ºæ²¡æœ‰è¿”å›çš„ä¸€ä¸ªè¿‡ç¨‹ï¼ˆprocedureï¼‰ï¼Œæ²¡æœ‰å—æ£€å¼‚å¸¸ï¼› Callable æ¥å£çš„ call æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œå¹¶æœ‰å¯èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚å¦‚æœè¦è¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥ä½¿ç”¨Callableï¼Œä½†æ˜¯ä¸é¼“åŠ±ä½¿ç”¨è¿™ä¸ªä»£æ›¿ Runnableï¼Œå½“ä¸€ä¸ªä»»åŠ¡å†…å®¹æ²¡æœ‰è¿”å›å€¼ï¼Œåªæ˜¯åˆ©ç”¨å‰¯ä½œç”¨æ—¶ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨ Runableï¼Œä½¿å¾—å«ä¹‰æ¸…æ™°ï¼Œå¹¶ä¸” JDK ä¸­ScheduledExecutorServiceä¹Ÿæœ‰åªèƒ½æ¥æ”¶ Runable çš„æ–¹æ³•ã€‚ Future æ¥å£æè¿°äº†ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶æä¾›æ–¹æ³•è·å¾—ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚è¯¥æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»ï¼šFutureTask.è¯¥ç±»çš„å®ä¾‹ä¸€å®šå’Œä¸€ä¸ªå…·ä½“ä»»åŠ¡ç›¸å…³ã€‚ExecutorServiceæ‰€æœ‰çš„ submit æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ª Future å®ä¾‹ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ FutureTask æ„é€ å‡½æ•°å°† Runnable/Callable å¯¹è±¡æ„å»ºæˆä¸€ä¸ª FutureTask å®ä¾‹ï¼Œè¯¥å®ä¾‹å°†ç®¡ç†è¯¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ³¨æ„ï¼ŒFutureTask å®ç°äº† Runnable å’Œ Futureï¼ˆé€šè¿‡å®ç° RunnableFuture æ¥å£ï¼‰ï¼Œæ‰€ä»¥æ—¢å¯ä»¥ä½¿ç”¨ ExecutorServiceï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Thread æ‰§è¡Œ FutureTask ä»»åŠ¡å†…å®¹ã€‚ // FutureTask æ¥å£å…³ç³» interface RunnableFuture extends Runnable, Future public class FutureTask implements RunnableFuture çº¿ç¨‹ Thread åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•æ˜¯ new Thread()ï¼Œä½†æ˜¯å‘çº¿ç¨‹æäº¤ä»»åŠ¡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€æ˜¯ç›´æ¥ç»§æ‰¿ Thread å°†ä»»åŠ¡ç¼–ç åœ¨è‡ªå®šä¹‰ Thread çš„ run æ–¹æ³•é‡Œé¢ï¼›äºŒæ˜¯å°† Runnable å®ä¾‹ä¼ é€’ç»™ Thread æ„é€ å‡½æ•°ï¼ŒåŒºåˆ«åªä¸è¿‡æ˜¯å¦å°†ä»»åŠ¡ç»‘å®šåœ¨çº¿ç¨‹å®ä¾‹ä¸Šè€Œå·²ï¼Œç¬¬äºŒç§æ–¹å¼æ›´çµæ´»å®ç°äº†çº¿ç¨‹ä¸ä»»åŠ¡çš„è§£è€¦ï¼Œæƒè´£åˆ†æ˜ã€‚ å¯åŠ¨çº¿ç¨‹ä½¿ç”¨ t.start()ï¼Œæ³¨æ„ï¼Œå¦‚æœæ˜¯è°ƒç”¨ t.run() æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸æ˜¯æ–°çº¿ç¨‹ã€‚ çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ è¯¦ç»†è¯´æ˜å‚è€ƒJava å¹¶å‘ç¼–ç¨‹ Thread.join æ–¹æ³• å½“è°ƒç”¨ t.join æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹ï¼ˆcalling threadï¼‰ä¼šæš‚åœï¼Œä¸€ç›´åˆ°çº¿ç¨‹ t ç»ˆæ­¢æˆ–è€…æŠ›å‡ºä¸€ä¸ª InterruptedExceptionã€‚ The join() method may also return if the referenced thread was interrupted. In this case, the join method throws an InterruptedException. ExecutorService æ‰§è¡Œå™¨æ¡†æ¶ï¼Œroot æ¥å£æ˜¯ Executorï¼Œåªæœ‰ä¸€ä¸ª execute æ–¹æ³•æ‰§è¡Œ runnable å®ä¾‹ã€‚æ›´å¸¸ç”¨æ˜¯å­æ¥å£ ExecutorServiceï¼Œé™¤äº†å¯ä»¥æ‰§è¡Œ runnable,callableï¼Œè¿˜å¯ä»¥ invoke ä¸€ä¸ª callable é›†åˆï¼š List","title":"Java å¹¶å‘ 1-çº¿ç¨‹ä¸ä»»åŠ¡","uri":"/post/java-concurrency-1-thread/"},{"content":"Object.wait/notify/notifyAll è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯åœ¨ class Object ä¸Šé¢çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½æœ‰è¿™ä¸ªæ–¹æ³•ã€‚è¿™é‡Œå¯¹è±¡å°±æ˜¯ä¸Šä¸€ç¯‡ä¸­ç±»æ¯”çš„èµ„æºï¼Œå¯ä»¥å½“æˆä¸€ä¸ªä¿¡å·é‡ã€‚ Object.wait() to suspend a threadï¼ˆç­‰ä»·äºsem.wait()ï¼‰ã€‚å°†å½“å‰çº¿ç¨‹æš‚åœå¹¶é‡Šæ”¾å½“å‰å¯¹è±¡é”ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†å½“å‰å¯¹è±¡çš„ notify/notifyAll æ–¹æ³•ã€‚ Object.notify() to wake a thread upï¼ˆç­‰ä»·sem.signal()ï¼‰ã€‚å”¤é†’ä¸€ä¸ªåœ¨ç­‰å¾…å½“å‰å¯¹è±¡é”çš„çº¿ç¨‹ã€‚ ä»¥å‰ç”¨ wait/notify çš„åœ°æ–¹ï¼Œç°åœ¨å¯ä»¥ç”¨ CyclicBarrier å’Œ CountDownLatch åŒæ­¥å·¥å…·ä»£æ›¿ wait æ–¹æ³•ä½¿ç”¨æ¨¡æ¿ï¼š synchronized (obj) { while (condition does not hold){ // è¿™é‡Œå³ä½¿çº¿ç¨‹è¢«è™šå‡å”¤é†’ï¼Œæ¡ä»¶è¿˜æ˜¯ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­ wait obj.wait(); } //... Perform action appropriate to condition } ä¸ºä»€ä¹ˆ wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿå› ä¸ºéœ€è¦ä¿è¯ while åˆ¤æ–­å’Œ wait ä¸¤ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚ ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å° A/B public static void main(String[] args) { PrintTask pt = new PrintTask(\"A\"); new Thread(pt::print).start(); new Thread(pt::print).start(); } static class PrintTask { private String currentChar; PrintTask(String initialChar) { this.currentChar = initialChar; } public void print() { synchronized (this) { while (true) { System.out.println(Thread.currentThread().getId() +\" \"+currentChar); if (\"A\".equals(currentChar)) { currentChar = \"B\"; } else { currentChar = \"A\"; } try { this.notifyAll(); this.wait(); } catch (InterruptedException e) { throw new RuntimeException(e); } } } } } synchronized å’Œ volatile volatile æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç†è§£ä¸ºå°†ä¸€ä¸ªå˜é‡å¼ºåˆ¶åŒæ­¥ç»™æ‰€æœ‰çº¿ç¨‹å¯è§ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³å¹¶å‘å†™çš„é—®é¢˜ã€‚ java çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰å†…åœ¨é”ï¼ˆæˆ–è€…å«ç›‘è§†å™¨é”ï¼Œintrinsic lock or monitor lockï¼‰ï¼Œæ¶‰åŠä¸¤ä¸ª JVM æŒ‡ä»¤ï¼šmonitorenterã€monitorexitã€‚ synchronized method å’Œ synchronized block çš„åŒºåˆ«ï¼š å¦‚æœæ˜¯ synchronized(this),é‚£ä¹ˆå’Œ synchronized æ–¹æ³•æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œé”å®šå¯¹è±¡éƒ½æ˜¯æ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡ã€‚ ä½†æ˜¯ synchronized block å¯ä»¥é”å®šå…¶ä»–å¯¹è±¡ï¼Œè€Œä¸” synchronized block çš„èŒƒå›´æ˜¯å¯ä»¥æ§åˆ¶æ›´çµæ´»ï¼Œsynchronized æ–¹æ³•çš„è¾¹ç•Œåªèƒ½æ˜¯æ•´ä¸ªæ–¹æ³• ä½¿ç”¨ ReentrantLock åœºæ™¯ï¼š éœ€è¦ä»¥ä¸‹é«˜çº§ç‰¹æ€§æ—¶ï¼šå¯å®šæ—¶çš„ï¼Œå¯è½®è¯¢çš„ï¼Œå¯ä¸­æ–­çš„é”ï¼Œå…¬å¹³é˜Ÿåˆ—ï¼Œéå—ç»“æ„ã€‚ Synchronization vs Lock-stackoverflow Semaphore å¯ä»¥ç†è§£ä¸ºèµ„æºçš„è®¸å¯è¯æ•°é‡ã€‚ sem.acquire(2): è·å–ä¸¤ä¸ªè®¸å¯è¯ã€‚ sem.release() é‡Šæ”¾èµ„æºçš„ä¸€ä¸ªè®¸å¯è¯ã€‚ ä¿¡å·é‡éå¸¸æœ‰ç”¨ï¼Œä¹Ÿæ˜¯åŸºç¡€ï¼ŒåŸºäºä¿¡å·é‡ï¼Œå¯ä»¥æ„å»ºå‡ºå¾ˆå¤šå…¶ä»–çš„åŒæ­¥å·¥å…·ï¼šturnstile å’Œ rendezvousï¼Œbarrierï¼Œmutexï¼ŒMultiplex CountDownLatch CountDownLatch æ˜¯ç®¡ç†ä¸€ç»„çº¿ç¨‹å’Œä¸€ä¸ªä¸»çº¿ç¨‹çš„å…ˆåã€‚ä¸»çº¿ç¨‹ wait åå°±é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„ CountDownLatch è°ƒç”¨ countDown åä¸»çº¿ç¨‹æ¥ç€å¼€å§‹ã€‚ package zhimoe.intrview.concurrent; import java.util.concurrent.CountDownLatch; import java.util.concurrent.TimeUnit; public class CountDownLatchTest { // è¿™ä¸ªæ–¹æ³•å°†å¯åŠ¨å¤šä¸ªä»»åŠ¡ï¼Œå¹¶è®©å®ƒä»¬åŒæ—¶æ‰§è¡Œï¼Œè®¡ç®—å®Œæˆçš„æ—¶é—´ public long timer(int taskNums) throws InterruptedException { CountDownLatch startLatch = new CountDownLatch(1); CountDownLatch finishLatch = new CountDownLatch(taskNums); for (int i = 0; i \u003c taskNums; i++) { Task task = new Task(startLatch, finishLatch, i); new Thread(task).start(); } long start = System.nanoTime(); startLatch.countDown();// å‡†å¤‡å¥½çº¿ç¨‹åå¼€å§‹åŒæ—¶å¯åŠ¨æ‰€æœ‰ä»»åŠ¡ finishLatch.await();// ç­‰å¾…ä»»åŠ¡å®Œæˆ long end = System.nanoTime(); return end - start; } public static void main(String[] args) throws InterruptedException { CountDownLatchTest ct = new CountDownLatchTest(); long time = ct.timer(100); System.out.println( TimeUnit.NANOSECONDS.toSeconds(time) + \" SENCODS\"); } } class Task implements Runnable { CountDownLatch startLatch; CountDownLatch finishLatch; int time; Task(CountDownLatch startLatch, CountDownLatch finishLatch, int time) { this.startLatch = startLatch; this.finishLatch = finishLatch; this.time = time; } @Override public void run() { try { startLatch.await();// ç­‰å¾…ä¸»çº¿ç¨‹é€šçŸ¥ä»»åŠ¡å¼€å§‹ System.out.println(\"doing the task!\"); Thread.sleep(time * 100); // æ¨¡æ‹Ÿä»»åŠ¡è¿‡ç¨‹ } catch (InterruptedException e1) { // TODO Auto-generated catch block e1.printStackTrace(); } finally { System.out.println(\"task done\"); finishLatch.countDown();// å‘Šè¯‰ä¸»çº¿ç¨‹ä»»åŠ¡å®Œæˆ } } } CyclicBarrier TBD Exchanger TBD Lock TBD ","title":"Java å¹¶å‘ 2-åŒæ­¥ä¸é”","uri":"/post/java-concurrency-2-control/"},{"content":"åœ¨é€šå¸¸çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼ŒThreadLocal æœ‰ä¸¤ç§å…¸å‹çš„ä½¿ç”¨åœºæ™¯ã€‚ åœºæ™¯ 1ï¼ŒThreadLocal ç”¨ä½œä¿å­˜æ¯ä¸ªçº¿ç¨‹ç‹¬äº«çš„å¯¹è±¡ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ä¿®æ”¹è‡ªå·±æ‰€æ‹¥æœ‰çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„å‰¯æœ¬ï¼Œç¡®ä¿äº†çº¿ç¨‹å®‰å…¨ã€‚ åœºæ™¯ 2ï¼ŒThreadLocal ç”¨ä½œæ¯ä¸ªçº¿ç¨‹å†…éœ€è¦ç‹¬ç«‹ä¿å­˜ä¿¡æ¯ï¼Œä»¥ä¾¿ä¾›å…¶ä»–æ–¹æ³•æ›´æ–¹ä¾¿åœ°è·å–è¯¥ä¿¡æ¯çš„åœºæ™¯ã€‚æ¯ä¸ªçº¿ç¨‹è·å–åˆ°çš„ä¿¡æ¯å¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰é¢æ‰§è¡Œçš„æ–¹æ³•ä¿å­˜äº†ä¿¡æ¯åï¼Œåç»­æ–¹æ³•å¯ä»¥é€šè¿‡ ThreadLocal ç›´æ¥è·å–åˆ°ï¼Œé¿å…äº†ä¼ å‚ï¼Œç±»ä¼¼äºå…¨å±€å˜é‡çš„æ¦‚å¿µã€‚ åœºæ™¯ 1ï¼šä¿å­˜çº¿ç¨‹ä¸å®‰å…¨çš„å·¥å…·ç±» æ³¨æ„ï¼šå®é™…å¼€å‘ä¸­ä½¿ç”¨ DateTimeFormatter ä»£æ›¿ SimpleDateFormat. import java.text.SimpleDateFormat; import java.util.Random; public class ThreadLocalExample implements Runnable{ // SimpleDateFormat is not thread-safe, so give one to each thread private static final ThreadLocal formatter = ThreadLocal.withInitial(() -\u003e new SimpleDateFormat(\"yyyyMMdd HHmm\")); public static void main(String[] args) throws InterruptedException { ThreadLocalExample obj = new ThreadLocalExample(); for(int i=0 ; i\u003c10; i++){ Thread t = new Thread(obj, \"\"+i); Thread.sleep(new Random().nextInt(1000)); t.start(); } } @Override public void run() { System.out.println(\"Thread Name= \"+Thread.currentThread().getName()+\" default Formatter = \"+formatter.get().toPattern()); try { Thread.sleep(new Random().nextInt(1000)); } catch (InterruptedException e) { e.printStackTrace(); } //formatter pattern is changed here by thread, but it won't reflect to other threads formatter.set(new SimpleDateFormat()); System.out.println(\"Thread Name= \"+Thread.currentThread().getName()+\" formatter = \"+formatter.get().toPattern()); } } åœºæ™¯ 2ï¼šä¸åŒçº¿ç¨‹ä¿å­˜ç‹¬ç«‹ä¿¡æ¯ ä¾‹å¦‚éœ€è¦è®°å½• mysql çš„ SQL æ‰§è¡Œè€—æ—¶ä»¥åŠå…¶ä»–ç›¸å…³ä¿¡æ¯ public class MysqlQueryInterceptor implements com.mysql.cj.interceptors.QueryInterceptor { private final ThreadLocal startTimeHolder = new ThreadLocal\u003c\u003e(); @Override public T preProcess(Supplier supplier, Query query) { startTimeHolder.set(LocalDateTime.now()); return null; } } ä¸Šé¢çš„ ThreadLocal ä¹Ÿå¯ä»¥ä½¿ç”¨ slf4j çš„ MDC(Mapped Diagnostic Context)ã€‚ ","title":"Java å¹¶å‘ 3-ThreadLocal","uri":"/post/java-concurrency-3-threadlocal/"},{"content":"å¥½æ–‡ Java åŠ¨æ€ä»£ç†æœºåˆ¶åˆ†æåŠæ‰©å±•ï¼Œæ›´æ·±å…¥çš„ä¸€ç¯‡ï¼šjava è®¾è®¡æ¨¡å¼ - åŠ¨æ€ä»£ç†æ¨¡å¼ ä¼˜åŠ¿ ç›¸æ¯” é™æ€ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å…·æœ‰æ›´å¼ºçš„ çµæ´»æ€§ï¼Œå› ä¸ºå®ƒä¸ç”¨åœ¨æˆ‘ä»¬è®¾è®¡å®ç°çš„æ—¶å€™å°±æŒ‡å®š æŸä¸€ä¸ªä»£ç†ç±»æ¥ä»£ç†å“ªä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æŒ‡å®šå»¶è¿Ÿåˆ°ç¨‹åºè¿è¡Œæ—¶ç”± JVM æ¥å®ç°ã€‚ å®ä¾‹ åŠ¨æ€ä»£ç†ç±»æ¥å£ï¼Œæ¥å£è§„èŒƒæ–¹æ³•ã€‚ package angus.interview.proxy; public interface Subject { public void request(); } éœ€è¦è¢«ä»£ç†çš„çœŸå®çš„ç±»ï¼š package angus.interview.proxy; public class SubjectImpl implements Subject { @Override public void request() { System.out.println(\" subject request\"); } } å…ˆåˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚ç„¶ååˆ©ç”¨åå°„åˆ›å»ºä¸€ä¸ªç”¨çœŸå®ç±»åŠ è½½å™¨åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ã€‚è¯¥å¯¹è±¡è°ƒç”¨ request æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†ç±»çš„ invoke æ–¹æ³•ã€‚ package angus.interview.proxy; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; public class DynamicProxy implements InvocationHandler { private Object target; public Object bind(Object target) { this.target = target; return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this); // è¦ç»‘å®šæ¥å£ this(è¿™æ˜¯ä¸€ä¸ªç¼ºé™·ï¼Œcglib å¼¥è¡¥äº†è¿™ä¸€ç¼ºé™·) } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\"------------------before------------------\"); Object result = method.invoke(target, args); System.out.println(\"-------------------after------------------\"); return result; } } static void main(){ DynamicProxy proxy = new DynamicProxy(); Subject subject= proxy.bind(SubjectImpl); subject.request(); } å’Œé™æ€ä»£ç†æ¨¡å¼æ¯”è¾ƒçš„å¥½å¤„ åœ¨é™æ€ä»£ç†æ¨¡å¼æ—¶ï¼Œä¸€ä¸ªçœŸå®è§’è‰²å¿…é¡»å¯¹åº”ä¸€ä¸ªä»£ç†è§’è‰²ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨ä¼šå¯¼è‡´ç±»çš„æ€¥å‰§è†¨èƒ€;è€ŒåŠ¨æ€ä»£ç†åˆ™ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†æ¥å£ä¸­çš„æ–¹æ³•å§”æ‰˜ç»™ invoke æ–¹æ³•ï¼Œå¹¶åœ¨ invoke ä¸­å®ç°æ‹¦æˆªã€‚ æºç åˆ†æ å‚è€ƒ:http://rejoy.iteye.com/blog/1627405 ä¸»è¦åŸæ¥ï¼šç”Ÿæˆäº†ä¸€ä¸ªä»£ç†ç±»çš„ class æ–‡ä»¶ã€‚Proxy.newProInstance() æ–¹æ³• public static Object newProxyInstance(ClassLoader loader,Class\u003c?\u003e[] interfaces,InvocationHandler h) throws IllegalArgumentException { if (h == null) { throw new NullPointerException(); } final Class\u003c?\u003e[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) { checkProxyAccess(Reflection.getCallerClass(), loader, intfs); } // è¿™é‡Œæ˜¯ç”Ÿæˆ class çš„åœ°æ–¹ Class\u003c?\u003e cl = getProxyClass0(loader, intfs); // ä½¿ç”¨æˆ‘ä»¬å®ç°çš„ InvocationHandler ä½œä¸ºå‚æ•°è°ƒç”¨æ„é€ æ–¹æ³•æ¥è·å¾—ä»£ç†ç±»çš„å®ä¾‹ try { final Constructor\u003c?\u003e cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; if (sm != null \u0026\u0026 ProxyAccessHelper.needsNewInstanceCheck(cl)) { return AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return newInstance(cons, ih); } }); } else { return newInstance(cons, ih); } } catch (NoSuchMethodException e) { throw new InternalError(e.toString()); } } å…¶ä¸­ newInstance åªæ˜¯è°ƒç”¨ Constructor.newInstance æ¥æ„é€ ç›¸åº”çš„ä»£ç†ç±»å®ä¾‹ï¼Œè¿™é‡Œé‡ç‚¹æ˜¯çœ‹ getProxyClass0 è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š private static Class\u003c?\u003e getProxyClass0(ClassLoader loader, Class\u003c?\u003e... interfaces) { // ä»£ç†çš„æ¥å£æ•°é‡ä¸èƒ½è¶…è¿‡ 65535ï¼Œè¿™æ˜¯ class æ–‡ä»¶æ ¼å¼å†³å®šçš„ if (interfaces.length \u003e 65535) { throw new IllegalArgumentException(\"interface limit exceeded\"); } // JDK å¯¹ä»£ç†è¿›è¡Œäº†ç¼“å­˜ï¼Œå¦‚æœå·²ç»å­˜åœ¨ç›¸åº”çš„ä»£ç†ç±»ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šé€šè¿‡ ProxyClassFactory æ¥åˆ›å»ºä»£ç† return proxyClassCache.get(loader, interfaces); } å…¶ä¸­ä»£ç†ç¼“å­˜æ˜¯ä½¿ç”¨ WeakCache å®ç°çš„ï¼Œå¦‚ä¸‹ private static final WeakCache","title":"Java åŠ¨æ€ä»£ç†","uri":"/post/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"content":"æ³¨è§£å¤„ç† æ³¨è§£æ˜¯ jdk1.5 å‡ºç°çš„ï¼Œä½†æ˜¯è‡ªå®šä¹‰å¤„ç†æ³¨è§£çš„åŠŸèƒ½æ˜¯ 1.6 æ‰æœ‰çš„ã€‚Element ç­‰å…³äºæ³¨è§£æºç æŠ½è±¡çš„æ”¯æŒç±»éƒ½æ˜¯ 1.6 å‡ºç°çš„ã€‚ åŸºæœ¬çŸ¥è¯† annotation processing integrated into javac compiler since Java 6.0, known as pluggable annotation processing. compiler automatically searches for annotation processors unless disabled with -proc:none option for javac. processors can be specified explicitly with -processor option for javac or -cp processor.jar, processor.jar must include the /META-INF/service/javax.annotation.processing.Processor file and your processor decalared in file; implement a processor class: â€“ must implement Processor interface â€“ typically derived from AbstractProcessor â€“ new package javax.annotation.processing åŒæ—¶è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨éœ€è¦æŒ‡å®šæ³¨è§£é€‰é¡¹ï¼š â€“ by means of annotations: @SupportedAnnotationTypes @SupportedOptions @SupportedSourceVersion ç¼–è¯‘å™¨ç¼–è¯‘æºç æ˜¯ä¼šæœ‰å¾ˆå¤šè½® (round)ï¼š ç¬¬ä¸€è½®ç¼–è¯‘å™¨å¾—åˆ°æ‰€æœ‰çš„æ³¨è§£ - è·å–æ‰€æœ‰çš„æ³¨è§£å¤„ç†å™¨ - è¿›è¡Œ match å¹¶ processï¼Œå¦‚æœåŒ¹é…çš„å¤„ç†å™¨ä¸­ process æ–¹æ³•çš„è¿”å›å€¼æ˜¯trueï¼Œè¡¨ç¤ºè¯¥æ³¨è§£è¢« claimï¼Œä¸å†æŸ¥è¯¢å…¶ä»–å¤„ç†å™¨ã€‚å¦‚æœæ˜¯falseï¼Œæ¥ç€æŸ¥è¯¢åŒ¹é…å¤„ç†å™¨å¤„ç†ï¼Œæ‰€ä»¥æ³¨è§£å¤„ç†å™¨åœ¨ META-INF/services/javax.annotation.processing.Processor å£°æ˜é¡ºåºæ˜¯æœ‰å…³ç³»çš„â€“ æ‰€æœ‰çš„æ³¨è§£éƒ½è¢« claim åï¼Œæ³¨è§£å¤„ç†å®Œæˆã€‚ å¦‚æœæ³¨è§£å¤„ç†å™¨äº§ç”Ÿæ–°çš„ java æ–‡ä»¶ï¼Œé‚£ä¹ˆæ–°çš„ä¸€è½®å¤„ç†å¼€å§‹ï¼Œå‰é¢è¢«è°ƒç”¨çš„é‚£äº›å¤„ç†å™¨åˆè¢«è°ƒç”¨ï¼Œç›´åˆ°æ²¡æœ‰ java æ–‡ä»¶äº§ç”Ÿã€‚ æœ€åä¸€è½®åˆè¦è°ƒç”¨ä¸€éæ‰€æœ‰å¤„ç†å™¨ï¼Œå®Œæˆä»–ä»¬çš„å„è‡ªå·¥ä½œã€‚ æœ€æœ€åï¼Œç¼–è¯‘å™¨ç¼–è¯‘æºç å’Œæ³¨è§£å¤„ç†å™¨ç”Ÿæˆçš„æºç ã€‚ è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç±» AbstractProcessorï¼šæœ‰ä¸€ä¸ªå¼•ç”¨ processingEnv æä¾›äº†ä¸¤ä¸ªé‡è¦å·¥å…·ç±»ï¼š â€“ Filer for creation of new source, class, or auxiliary files â€“ Messager to report errors, warnings, and other notices æ­¤å¤–ï¼Œä¸€ä¸ªç”Ÿæˆ java æ–‡ä»¶çš„é‡è¦æ–¹æ³•ï¼š FileObject sourceFile = processingEnv.getFiler().createSourceFile(beanClassName); // process() method takes 2 arguments: Set\u003c? extends TypeElement\u003e annotations â€“ the annotation types requested to be processed â€“ subset of the supported annotations RoundEnvironment roundenv â€“ environment for information about the current and prior round â€“ supplies elements annotated with a given annotation or all root elements in the source ä¸€ä¸ªè‡ªå®šä¹‰çš„æ³¨è§£å¤„ç†å™¨æ ¼å¼å¦‚ä¸‹ï¼š @SupportedAnnotationTypes({\"Property\"}) @SupportedSourceVersion(SourceVersion.RELEASE_6) public class PropertyAnnotationProcessor extends AbstractProcessor { public boolean process( Set\u003c? extends TypeElement\u003e annotations, RoundEnvironment env) { // process the source file elements using the mirror API } } jdk1.6 å¯¹æ³¨è§£çš„å¤„ç†æ”¯æŒå»ºç«‹åœ¨å¯¹æºç çš„æŠ½è±¡ï¼ŒElement æ˜¯javax.lang.model.*ä¸­å®šä¹‰çš„ï¼Œå„ç§ Element æ˜¯å¯¹æºç æŠ½è±¡æ•°æ®ç»“æ„ï¼Œå¦‚ï¼š package com.example;\t// PackageElement public class Foo {\t// TypeElement private int a; // VariableElement private Foo other; // VariableElement public Foo () {} // ExecuteableElement } TypeElement ä¸èƒ½æä¾›çˆ¶ç±»çš„ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦è¿™äº›ä¿¡æ¯ï¼Œéœ€è¦ä» Element ä¸­å¾—åˆ° TypeMirror.TypeMirror::element.asType() å®æˆ˜ åŠ¨æ‰‹å†™æ³¨è§£å¤„ç†å™¨ï¼šå®šä¹‰ä¸€ä¸ªæ³¨è§£@Comparatorï¼Œä½¿ç”¨åœ¨æ–¹æ³•ä¸Šã€‚é€šè¿‡ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨ï¼Œè§£ææ‰€æœ‰è¢«æ³¨é‡Šçš„æ–¹æ³•ï¼Œä¸ºæ¯ä¸€ä¸ªæ–¹æ³•äº§ç”Ÿä¸€ä¸ª Comparator ç±»ã€‚ ä¸€å…±ä¸‰ä¸ªç±»ï¼Œæ³¨è§£å®šä¹‰ï¼Œæ³¨è§£ä½¿ç”¨ï¼Œæ³¨è§£å¤„ç†å™¨ã€‚ ç»™å‡ºæ³¨è§£å®šä¹‰å‰çœ‹çœ‹æ³¨è§£æ€ä¹ˆä½¿ç”¨ï¼š package moe.zhi; public class Name { private final String first; private final String last; public Name(String f, String l) { first = f; last = l; } @Comparator(\"NameByFirstNameComparator\") public int compareToByFirstName(Name other) { if (this == other) return 0; int result; if ((result = this.first.compareTo(other.first)) != 0) return result; return this.last.compareTo(other.last); } } å…¶ä¸­è¢«æ³¨è§£æ³¨é‡Šçš„æ–¹æ³•å°†äº§ç”Ÿä¸€ä¸ª NameByFirstNameComparator.java æ–‡ä»¶ï¼š package moe.zhi; public class NameByFirstNameComparator implements java.util.Comparator { public int compare(Name o1, Name o2) { return o1.compareToByFirstName(o2); } public boolean equals(Object other) { return this.getClass() == other.getClass(); } } å®šä¹‰æ³¨è§£ï¼š package moe.zhi; import java.lang.annotation.Documented; import java.lang.annotation.ElementType; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; import java.lang.annotation.Target; @Documented @Target(ElementType.METHOD) @Retention(RetentionPolicy.SOURCE) public @interface Comparator { String value(); } æ¥ä¸‹æ¥å®šä¹‰æ³¨è§£å¤„ç†å™¨ï¼Œæœ‰è¯¦ç»†æ³¨è§£ï¼Œç‰¹åˆ«æ³¨æ„ generate æºç ä¸­çš„ç©ºæ ¼å’Œåˆ†å·ä¸è¦å¼„ä¸¢äº†ï¼š package moe.zhi; import java.io.IOException; import java.io.PrintWriter; import java.util.Set; import javax.annotation.processing.AbstractProcessor; import javax.annotation.processing.RoundEnvironment; import javax.annotation.processing.SupportedAnnotationTypes; import javax.annotation.processing.SupportedSourceVersion; import javax.lang.model.SourceVersion; import javax.lang.model.element.Element; import javax.lang.model.element.ExecutableElement; import javax.lang.model.element.TypeElement; import javax.lang.model.type.PrimitiveType; import javax.lang.model.type.TypeKind; import javax.lang.model.type.TypeMirror; import javax.tools.Diagnostic; import javax.tools.FileObject; import static java.lang.StringTemplate.STR; @SupportedAnnotationTypes({\"moe.zhi.Comparator\"}) @SupportedSourceVersion(SourceVersion.RELEASE_8) public class MyProcessor extends AbstractProcessor { @Override public boolean process(Set\u003c? extends TypeElement\u003e annotations, RoundEnvironment roundEnv) { for (final Element element : roundEnv.getElementsAnnotatedWith(Comparator.class)) { if (element instanceof ExecutableElement m) { TypeElement className = (TypeElement) m.getEnclosingElement(); Comparator annotation = m.getAnnotation(Comparator.class); if (annotation == null) { continue; } TypeMirror returnType = m.getReturnType(); if (!(returnType instanceof PrimitiveType) || returnType.getKind() != TypeKind.INT) { processingEnv.getMessager().printMessage(Diagnostic.Kind.ERROR, \"@Comparator can only be applied to methods that return int\"); continue; } // prepare for java file generation String theProcessedClassesName = className.getQualifiedName().toString(); String comparatorClassName = annotation.value(); String compareToMethodName = m.getSimpleName().toString(); try { writeComparatorFile(theProcessedClassesName, comparatorClassName, compareToMethodName); } catch (IOException e) { e.printStackTrace(); } } } // end for return true; // claimed now,no need next processor } // be careful with spaces and \";\" in content private void writeComparatorFile(String fullClassName, String comparatorClassName, String compareToMethodName) throws IOException { int lastIndexOfDot = fullClassName.lastIndexOf(\".\"); String packageName = fullClassName.substring(0, lastIndexOfDot); FileObject sourceFile = processingEnv.getFiler().createSourceFile(packageName + \".\" + comparatorClassName); if (sourceFile == null) { System.out.println(\"create source file failed\"); throw new IOException(\"create source file failed:\" + packageName + \".\" + comparatorClassName); } PrintWriter out = new PrintWriter(sourceFile.openWriter()); String parametrizedType = fullClassName.substring(lastIndexOfDot + 1); //!! careful the index var packageLine = \"\"; if (lastIndexOfDot \u003e 0) { packageLine = STR.\"package \\{ packageName };\" ; } // ä¸‹é¢ä½¿ç”¨äº† Java 21 çš„ STR æ¨¡æ¿ var content = STR.\"\"\" \\{ packageLine } public class \\{ comparatorClassName } implements java.util.Comparator\u003c\\{ parametrizedType }\u003e { public int compare( \\{ parametrizedType } o1, \\{ parametrizedType } o2 ){ return o1.\\{ compareToMethodName }(o2); } public boolean equals(Object other) { return this.getClass() == other.getClass(); } } \"\"\" ; out.println(content); out.close(); } } æµ‹è¯•å¤„ç†å™¨ ä»£ç ç”Ÿæˆå·¥å…· æ–¹æ³• 1ï¼šä½¿ç”¨ javapoet MethodSpec main = MethodSpec.methodBuilder(\"main\") .addModifiers(Modifier.PUBLIC, Modifier.STATIC) .returns(void.class) .addParameter(String[].class, \"args\") .addStatement(\"$T.out.println($S)\", System.class, \"Hello, JavaPoet!\") .build(); TypeSpec helloWorld = TypeSpec.classBuilder(\"HelloWorld\") .addModifiers(Modifier.PUBLIC, Modifier.FINAL) .addMethod(main) .build(); JavaFile javaFile = JavaFile.builder(\"com.example.helloworld\", helloWorld) .build(); javaFile.writeTo(System.out); æ–¹æ³• 2ï¼šä½¿ç”¨ STR å‚è€ƒä¸Šé¢çš„ä¾‹å­ å‚è€ƒ java æ³¨è§£ ","title":"Java æ³¨è§£å’Œæ³¨è§£å¤„ç†å™¨","uri":"/post/java-annotation-processing/"},{"content":"samples code and notes on java == and equals\n/** * samples for == and equal() * @author zhimoe * */ class TestObj { // the class for test == and equal() } public class EqualAndCompare { public static void main(String[] args) { TestObj obj1 = new TestObj(); TestObj obj2 = new TestObj(); TestObj obj3 = obj1; System.out.println(obj1 == obj2);// false , // == Compares references, not values System.out.println(obj1 == obj3);// true System.out.println(obj1.equals(obj2));// false, // equal() method is derived from java.lang.Object, if not override,nor // in superclass,then equal behave as same as == // Always remember to override hashCode if you override equals so as not // to \"break the contract\". // As per the API, the result returned from the hashCode() method for // two objects must be the same if their equals methods shows that they // are equivalent. The converse is not necessarily true. String s1 = \"haha\";// constant pool String s2 = new String(\"haha\");// defined in ?heap System.out.println(s1 == s2);// false ,== Compares references, not // values, there is a exception for // static field in class, static String // in class == and equal both always // return *true* // for more infomation,see : // http://stackoverflow.com/questions/7520432/what-is-the-difference-between-vs-equals-in-java System.out.println(s1.equals(s2)); // true compare the // value String s3 = s2.intern();// find the same value String in constant pool System.out.println(s1 == s3);// true int i1 = 2;// primitive type has no equal() method Integer i3 = Integer.valueOf(2); System.out.println(i1 == i3);// true, i3 automatic unboxing into int; System.out.println(i3.equals(i1));// auto boxing into Integer Integer i2 = 2; System.out.println(i3.compareTo(i2)); } /* * Comparable interface, a.compareTo(b) return -1ï¼šless,0:equal,1:greater. 0 * should always be returned for objects when the .equals() comparisons * return true. All Java classes that have a natural ordering implement this * (String, Double, BigInteger, ...). * * * Comparator interface: is a util for compare two instance,then you can use * the comparator to sort array and other things * */ } ","title":"Java-==-and-equals","uri":"/post/java--and-equal/"},{"content":"Java å•ä¾‹æ¨¡å¼çš„å„ç§å†™æ³•å’Œåºåˆ—åŒ–\nå‚è€ƒèµ„æ–™\né¥±æ±‰å¼ public class Singleton { private static Singleton instance = null private Singleton (){} public static Singleton getInstance() { if(instance == null) instance = new Singleton(); return instance; } } //é¥±æ±‰å¼ï¼Œä½¿ç”¨æ—¶åˆ›å»º é¥¿æ±‰å¼ //åŠ è½½æ—¶åˆ›å»ºå¯¹è±¡ static public class Singleton { private Singleton instance = null; static { instance = new Singleton(); } private Singleton (){} public static Singleton getInstance() { return this.instance; } } é™æ€å†…éƒ¨ç±» public class Singleton { private Singleton (){} private static class SingletonHolder { private static final Singleton INSTANCE = new Singleton(); } public static final Singleton getInstance() { return SingletonHolder.INSTANCE; } } //è¿™ä¸ªæ¯”è¾ƒå¥½,çº¿ç¨‹å®‰å…¨,ä¹Ÿè¾¾åˆ°äº†å»¶è¿ŸåŠ è½½æ•ˆæœ. æšä¸¾ç±» //è¿™ä¸ªæ˜¯æœ€å¥½çš„ è¿™ç§æ–¹å¼æ˜¯Effective Javaä½œè€…Josh Bloch æå€¡çš„æ–¹å¼,å®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜,è€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡,å¯è°“æ˜¯å¾ˆåšå¼ºçš„å£å’å•Š public enum Singleton { INSTANCE; public void whateverMethod() { } } è®¿é—®è¿™ä¸ªå•ä¾‹ Singleton.INSTANCE åŒé‡æ ¡éªŒé” å…¶å®æ˜¯ä¸å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹å¼€é”€å¾ˆå¤§ï¼Œç”šè‡³æ­»é”ã€‚åŸå› åœ¨äºæŒ‡ä»¤é‡æ’åºã€‚\npublic class Singleton { private volatile static Singleton singleton; private Singleton (){} public static Singleton getSingleton() { if (singleton == null) { synchronized (Singleton.class) { if (singleton == null) { singleton = new Singleton(); } } } return singleton; } } åºåˆ—åŒ– ä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¸¾ä¾‹ï¼Œåªè¦æä¾›ä¸€ä¸ª readResolve æ–¹æ³•\npublic class Singleton { private Singleton (){} private static class SingletonHolder { private static final Singleton INSTANCE = new Singleton(); } public static final Singleton getInstance() { return SingletonHolder.INSTANCE; } private Object readResolve() throws ObjectStreamException{ return SingletonHolder.INSTANCE; } } æ— è®ºæ˜¯å®ç° Serializable æ¥å£ï¼Œæˆ–æ˜¯ Externalizable æ¥å£ï¼Œå½“ä» I/O æµä¸­è¯»å–å¯¹è±¡æ—¶ï¼ŒreadResolve() æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨åˆ°ã€‚å®é™…ä¸Šå°±æ˜¯ç”¨ readResolve() ä¸­è¿”å›çš„å¯¹è±¡ç›´æ¥æ›¿æ¢åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œè€Œè¢«åˆ›å»ºçš„å¯¹è±¡åˆ™ä¼šè¢«åƒåœ¾å›æ”¶æ‰ã€‚\n","title":"å•ä¾‹æ¨¡å¼å’Œåºåˆ—åŒ–","uri":"/post/java%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%BA%8F%E5%88%97%E5%8C%96/"},{"content":"åœ¨çœ‹è¿™ä¸ªä¹‹å‰ï¼Œå¸Œæœ›ä½ æœ‰ç”¨ ant æˆ–è€… maven çš„ä½¿ç”¨ç»éªŒï¼Œè¿˜æœ‰ï¼Œå¯¹ groovy çš„è¯­æ³•æœ‰ä¸€ä¸ªç®€å•çš„äº†è§£ï¼Œä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œä¸‹é¢ä¼šä»‹ç»ã€‚ ç†è§£ gradle æ–‡ä»¶çš„å‰ææ˜¯ç†è§£ä¸€ä¸ªé‡è¦çš„ groovy æ¦‚å¿µ â€“ closure closure ä¸€ä¸ª closure æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨ groovy æ–‡ä»¶ä¸­çš„{}ä»£ç å—ï¼Œè¿™ä¸ªä»£ç å—ç±»ä¼¼ js ä¸­çš„åŒ¿åå‡½æ•°ï¼Œå®ƒå¯ä»¥è¢«èµ‹å€¼ç»™å˜é‡ï¼Œå¯ä»¥è¢«è°ƒç”¨ï¼Œå¯ä»¥æ¥æ”¶å‚æ•°ï¼Œè¿˜å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™åˆ«çš„å‡½æ•°ã€‚ closure ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µæ˜¯å§”æ‰˜å¯¹è±¡å’Œä½œä¸ºå‚æ•°ä¼ é€’çš„è¯­æ³•æ ¼å¼ï¼ˆç†è§£ gradle æ–‡ä»¶å¾ˆé‡è¦ï¼‰ã€‚ groovy æ–¹æ³•è°ƒç”¨æ‹¬å·çš„çœç•¥ groovy æä¾›éå¸¸ä¼˜é›…çš„æ–¹æ³•è°ƒç”¨æ ¼å¼ï¼Œæ€»ç»“èµ·æ¥æ˜¯ï¼š //å¯ä»¥çœç•¥å‚æ•°æ‹¬å·,å¹¶ä¸”é“¾å¼è°ƒç”¨ // equivalent to: turn(left).then(right) turn left then right //groovyæ•°å­—å¯ä»¥ç›´æ¥è½¬æ¢æˆå­—ç¬¦ä¸² // equivalent to: take(2.pills).of(chloroquinine).after(6.hours) take 2.pills of chloroquinine after 6.hours //ä¸¤ä¸ªå‚æ•°ç”¨é€—å·éš”å¼€ // equivalent to: paint(wall).with(red, green).and(yellow) paint wall with red, green and yellow //å‘½åå‚æ•°ç”¨å†’å· // with named parameters too // equivalent to: check(that: margarita).tastes(good) check that: margarita tastes good //é—­åŒ…ä½œä¸ºå‚æ•°ä¹Ÿå¯ä»¥çœç•¥æ‹¬å· // with closures as parameters // equivalent to: given({}).when({}).then({}) given { } when { } then { } //æ²¡æœ‰å‚æ•°çš„æ–¹æ³•å¿…é¡»æœ‰æ‹¬å· // equivalent to: select(all).unique().from(names) select all unique() from names //å¦‚æœè°ƒç”¨é“¾å…ƒç´ ä¸ºå¥‡æ•°,é‚£ä¹ˆæœ€åä¸€ä¸ªå…ƒç´ æ˜¯å‰é¢æ–¹æ³•é“¾è¿”å›å¯¹è±¡çš„å±æ€§ //cookies æ˜¯take(3)è¿”å›å€¼çš„ä¸€ä¸ªå±æ€§ // equivalent to: take(3).cookies // and also this: take(3).getCookies() take 3 cookies ä¸Šé¢è°ƒç”¨çš„æ ¼å¼æ˜¯ dsl çš„åŸºç¡€ã€‚ä¹Ÿæ˜¯çœ‹æ‡‚ gradle æ–‡ä»¶æ ¼å¼çš„åŸºç¡€ã€‚ è®©æˆ‘ä»¬å†æ·±å…¥ä¸€ç‚¹ï¼Œä¸Šé¢è®²çš„æ˜¯è°ƒç”¨æ ¼å¼ï¼Œé‚£ä¹ˆæ€ä¹ˆåˆ›å»ºè¿™ç§å¯ä»¥é“¾å¼è°ƒç”¨çš„æ–¹æ³•å‘¢ï¼Ÿ groovy å’Œ scala çš„æ–¹æ³•è¿”å›å€¼ä¸éœ€è¦ returnï¼Œæœ€åä¸€è¡Œå°±æ˜¯è¿”å›å€¼ã€‚ closure æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ ¼å¼{ [closureParameters -\u003e ] statements },é»˜è®¤è‡ªå¸¦ä¸€ä¸ªåä¸º it çš„å‚æ•°ï¼Œæ‰€ä»¥åªæ¥å—ä¸€ä¸ªå‚æ•°æ—¶å¯ä»¥çœç•¥-\u003e. closure å¯ä»¥è®¿é—® scopeï¼ˆä½œç”¨åŸŸï¼‰å†…ä»»ä½•å˜é‡ã€‚å¹¶ä¸”è¿™ä¸ª scope æ˜¯å¯ä»¥é€šè¿‡å§”æ‰˜æ¥æ”¹å˜çš„ã€‚ groovy ä¸­ Map å¯¹è±¡çš„ value å¦‚æœæ˜¯ closureï¼Œé‚£ä¹ˆå¯ä»¥æ¥ç€è°ƒç”¨ï¼šm .k { arg_expressiong } æœ‰äº†ä¸Šé¢çš„åŸºç¡€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼š //å°†closureèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡,è¿™ä¸ªclosureæ¥æ”¶ä¸€ä¸ªå‚æ•°,å‚æ•°åæ˜¯é»˜è®¤çš„ it show = { println it } square_root = { Math.sqrt(it) } //ä¸ºäº†å®¹æ˜“ç†è§£,æˆ‘å°†å‚æ•°çš„typeéƒ½æ·»åŠ ä¸Šäº†, //pleaseæ–¹æ³•éœ€è¦ä¸€ä¸ªclosure,æ¥ç€è¿”å›ä¸€ä¸ªmap,mapçš„keyæ˜¯the,valueæ˜¯ä¸€ä¸ªclosure, //è¿™ä¸ªclosureæ¥æ”¶ä¸€ä¸ªclosure,å¹¶è¿”å›ä¸€ä¸ªmap, //è¿™ä¸ªmapçš„keyuæ˜¯of,valueåˆæ˜¯ä¸€ä¸ªclosure(ä¸è¦æ™•äº†) //æœ€åä¸€ä¸ªclosureæ¥æ”¶ä¸€ä¸ªå‚æ•°n def please(Closure action) { [the: { Closure what -\u003e [of: { n -\u003e action(what(n)) }] }] } //è°ƒç”¨: please show the square_root of 100 // ä¸Šé¢ç­‰ä»· please(show).the(square_root).of(100) // æˆ– please { println it } .the { Math.sqrt(it) } .of 100 æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œå°†ä½ éœ€è¦çš„æ“ä½œå°è£…æˆä¸€ä¸ª closureï¼Œç»™ä¸€ä¸ªç›´è§‚çš„å‘½åï¼Œä¿è¯æ•´ä¸ª DSL è°ƒç”¨è¯­å¥æœ‰è¯­ä¹‰ï¼Œå®šä¹‰è¿”å›ä¸€ä¸ª map çš„å‡½æ•°ä½œä¸ºå…¥å£ï¼Œmap çš„ key æ˜¯æ–¹æ³•åï¼Œvalue æ˜¯ closureï¼Œè¿™æ ·å¯ä»¥åœ¨ key åé¢ä¼ é€’ä¸€ä¸ª closure æ¥ç€è°ƒç”¨è¿™ä¸ª value. å§”æ‰˜å¯¹è±¡ gradle è„šæœ¬æ˜¯ä¸€ä¸ªé…ç½®è„šæœ¬ï¼Œç±»ä¼¼ maven ä¸­ pom.xml æ–‡ä»¶ï¼Œä¸è¿‡ gradle è„šæœ¬æ›´ä¸ºå¼ºå¤§ï¼Œå› ä¸º.gradle æ–‡ä»¶å°±æ˜¯ groovy æ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜å¯ä»¥åœ¨è„šæœ¬é‡Œé¢ç›´æ¥å®šä¹‰ groovy å¯¹è±¡è®©è„šæœ¬ä½¿ç”¨ã€‚ å§”æ‰˜å¯¹è±¡å°±æ˜¯ä¸€ä¸ª groovy å¯¹è±¡ï¼Œç”¨æ¥æ‰§è¡Œ gradle æ„å»ºè„šæœ¬ä¸­çš„ closure. as a build script executes, it configures an object of type Project. This object is called the delegate object of the script. The following table shows the delegate for each type of Gradle script. ä¸‰ç§ä¸åŒçš„gradleè„šæœ¬å¯¹åº”çš„å§”æ‰˜å¯¹è±¡ Build scriptï¼ˆbuild.gradleï¼‰ -\u003eProject Init script\t-\u003eGradle Settings script(setting.gradle)\t-\u003eSettings æ„å»ºä¸­çš„æ¯ä¸€ä¸ª projectï¼ŒGradle éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Project å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡ä¸æ„å»ºè„šæœ¬ç›¸å…³è”ã€‚ Project å¯¹è±¡ä¸ build.gradle æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ Gradle çš„è„šæœ¬æ˜¯é…ç½®è„šæœ¬ï¼Œå½“è„šæœ¬æ‰§è¡Œæ—¶ï¼Œå®ƒæ˜¯åœ¨é…ç½®æŸä¸€ä¸ªç‰¹æ®Šç±»å‹çš„å¯¹è±¡ã€‚æ¯”å¦‚ä¸€ä¸ªæ„å»ºè„šæœ¬çš„æ‰§è¡Œï¼Œå®ƒå°±æ˜¯åœ¨é…ç½®ä¸€ä¸ª Project ç±»å‹çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å«åšè„šæœ¬çš„ä»£ç†å¯¹è±¡ã€‚ å§”æ‰˜æœ‰ä¸ªé‡è¦çš„æ¦‚å¿µå°±æ˜¯ scopeï¼ŒæŒ‡ closure çš„å˜é‡å¼•ç”¨èŒƒå›´ï¼šæœ‰æ—¶å˜é‡ä¸åœ¨å½“å‰ scope ä¸­ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å§”æ‰˜ï¼Œæ”¹å˜ closure çš„å§”æ‰˜å¯¹è±¡ï¼Œè¿™æ ·å°±æ‹¥æœ‰äº†å§”æ‰˜è€…çš„ scopeï¼Œä»è€Œå¯ä»¥åœ¨ closure ä¸­ä½¿ç”¨å§”æ‰˜è€…çš„å˜é‡ã€‚ å…³äº groovy closure çš„å§”æ‰˜æœ‰ä¸‰ä¸ªé‡è¦å±æ€§ â€¢ this: refers to the instance of the class that the closure was defined in. â€¢ owner: is the same as this, unless the closure was defined inside another closure in which case the owner refers to the outer closure. â€¢ delegate: is the same as owner. But, it is the only one that can be programmatically changed, and it is the one that makes Groovy closures really powerful. the closure itself will be checked first, followed by the closure's this scope, then the closure's owner, then its delegate. However, Groovy is so flexible this strategy can be changed. Every closure has a property called resolvedStrategy. This can be set to: â€¢ Closure.OWNER_FIRST â€¢ Closure.DELEGATE_FIRST â€¢ Closure.OWNER_ONLY â€¢ Closure.DELEGATE_ONLY æ¥è‡ª gradle æ˜¯ dsl è§£æå·¥å…·ï¼Œæ˜¯å¯¹ groovy è¯­æ³•çš„æ‰©å±•ï¼Œbuild.gradle å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ª.groovy æ–‡ä»¶ï¼Œgradle ä¼šè§£æè¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°é‡Œé¢çš„ closureï¼Œå¹¶å°†è¿™äº› closure å§”æ‰˜ç»™ä¸€ä¸ªå¯¹è±¡å»æ‰§è¡Œã€‚ gradle å°† groovy çš„å§”æ‰˜æœºåˆ¶å‘æŒ¥åˆ°æè‡´ï¼Œè¦ç†è§£ gradle å†…éƒ¨ï¼Œå°±è¦ç†è§£ closure çš„å§”æ‰˜ï¼ closure ä½œä¸ºå‚æ•°ä¼ é€’ å°† closure ä½œä¸ºå‚æ•°ä¼ é€’çš„æ–¹æ³•æœ‰å¤šç§ï¼š //method accepts 1 parameter - closure myMethod(myClosure) //if method accepts only 1 parameter - parentheses can be omitted myMethod myClosure //I can create in-line closure myMethod {println 'Hello World'} //method accepts 2 parameters myMethod(arg1, myClosure) //or the same as '4', but closure is in-line myMethod(arg1, { println 'Hello World' }) //if last parameter is closure - it can be moved out of parentheses myMethod(arg1) { println 'Hello World' } æ³¨æ„ç¬¬ä¸‰ç§å’Œæœ€åä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œæ˜¯ä¸æ˜¯å’Œ gradle æ–‡ä»¶ä¸­å¾ˆçœ¼ç†Ÿï¼Ÿåªä¸è¿‡åœ¨ gradle è„šæœ¬ä¸­å‡ºç°çš„ closure æ›´åŠ å¤æ‚ï¼Œå› ä¸ºæœ‰ closure åµŒå¥—ï¼ï¼ï¼ä½†æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šä»‹ç»åµŒå¥—ä¸è¿‡æ˜¯å§”æ‰˜é“¾çš„è¡¨ç°ã€‚ çœ‹ä¸€ä¸ªè„šæœ¬ä»£ç ï¼š buildscript { repositories { jcenter() } dependencies { classpath 'com.android.tools.build:gradle:1.2.3' } } buildscript æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ª closure.è‡³äºè¿™ä¸ªæ–¹æ³•åœ¨å“ªï¼Œå¯ä»¥å®šä¹‰åœ¨ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸€å®šèƒ½å¤Ÿè¢« Project å¯¹è±¡è°ƒç”¨ã€‚ å› ä¸º build.gradle è„šæœ¬å°±æ˜¯å§”æ‰˜ç»™ Project å¯¹è±¡æ‰§è¡Œçš„ã€‚äº‹å®ä¸Šï¼ŒProject å¯¹è±¡ä¹Ÿä¸æ˜¯äº²è‡ªæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯å§”æ‰˜ç»™ ScriptHandler æ‰§è¡Œã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬ ScriptHandler å¯¹è±¡ä¼šæœç´¢åˆ°ä¸¤ä¸ªé…ç½® closure:repositories å’Œ dependencies.æˆ‘ä»¬å¯ä»¥åœ¨ ScriptHandler api ä¸­æœç´¢åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä» api ä¸­æˆ‘ä»¬åˆå‘ç°ï¼š ä¼ é€’ç»™ dependencies çš„ closure åˆè¢«å§”æ‰˜ç»™äº†DependencyHandlerå¯¹è±¡â€¦â€¦. è¿™å°±æ˜¯å§”æ‰˜é“¾ã€‚ ScriptHandler api Project api æ³¨æ„:è¿™é‡Œ buildscript {â€¦}æ•´ä½“ç§°ä¸ºä¸€ä¸ª script block. è„šæœ¬å—å°±æ˜¯ä¸€ä¸ªæ¥å— closure å‚æ•°çš„æ–¹æ³•è°ƒç”¨ã€‚è¿˜æœ‰çš„æ–¹æ³•æ˜¯ä¸æ¥å— closure çš„ï¼Œé‚£äº›ç§°ä¸º statementï¼ˆçœ‹ä¸‹é¢è§£é‡Šï¼‰. A script block is a method call which takes a closure as a parameter æ’ä»¶ å…ˆçœ‹çœ‹æ„å»ºè„šæœ¬çš„æ„æˆï¼š A build script is made up of zero or more statements and script blocks. Statements can include method calls, property assignments, and local variable definitions. A script block is a method call which takes a closure as a parameter. The closure is treated as a configuration closure which configures some delegate object as it executes. å°±æ˜¯è¯´è„šæœ¬æœ‰ä¸¤ç§å†…å®¹:script block å’Œ statement. Project æ¥å£é¢„å…ˆå®šä¹‰äº†å‡ ä¸ª block: allprojects { }\tConfigures this project and each of its sub-projects. artifacts { }\tConfigures the published artifacts for this project. buildscript { }\tConfigures the build script classpath for this project. configurations { }\tConfigures the dependency configurations for this project. dependencies { }\tConfigures the dependencies for this project. repositories { }\tConfigures the repositories for this project. sourceSets { }\tConfigures the source sets of this project. subprojects { }\tConfigures the sub-projects of this project. publishing { }\tConfigures the PublishingExtension added by the publishing plugin. è¿™äº› closure å‚æ•°åŸºæœ¬éƒ½æ˜¯å§”æ‰˜ç»™å…¶ä»–å¯¹è±¡æ‰§è¡Œçš„ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒProject å¯¹è±¡çš„æ–¹æ³•æ˜¯æœ‰é™è€Œä¸”é€šç”¨çš„ã€‚çœŸæ­£æœ‰ç”¨çš„æ˜¯æ’ä»¶ï¼Œgradle çš„å¾ˆå¤šåŠŸèƒ½ä¹Ÿæ˜¯é€šè¿‡å®˜æ–¹å†™çš„æ’ä»¶æä¾›çš„ã€‚ å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªé¡¶çº§å±‚çš„something { ... }blockï¼Œä½†æ˜¯åœ¨ Project æºç ä¸­æ²¡æœ‰æ‰¾åˆ° something block çš„ä»»ä½•ä¿¡æ¯ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±æ˜¯é€šè¿‡æ’ä»¶æä¾›çš„ï¼Œgradle è‡ªå¸¦å¾ˆå¤šæ’ä»¶ï¼Œåƒ javaï¼Œeclipseï¼Œgroovyï¼Œandroid ç­‰ã€‚ çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š åœ¨ android å¼€å‘ä¸­çš„æ„å»ºè„šæœ¬ï¼š apply plugin: 'com.android.application' android { compileSdkVersion 22 buildToolsVersion \"22.0.1\" defaultConfig { applicationId \"com.trickyandroid.testapp\" minSdkVersion 16 targetSdkVersion 22 versionCode 1 versionName \"1.0\" } buildTypes { release { minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' } } } è¿™é‡Œï¼Œå‡ºç°äº† android{},Project å¯¹è±¡å¹¶æ²¡æœ‰è¿™ä¸ª script block.æ‰€ä»¥ï¼Œè¿™å…¶å®æ˜¯ç”±æ’ä»¶æä¾›çš„ block.æˆ‘ä»¬æ‰¾åˆ° com.android.applicationå…¥å£ä»£ç  extension = project.extensions.create('android', AppExtension, this, (ProjectInternal) project, instantiator, buildTypeContainer, productFlavorContainer, signingConfigContainer) setDefaultConfig(extension.defaultConfig, extension.sourceSetsContainer) extensions æ˜¯ä¸€ä¸ª ExtensionContainer å®ä¾‹ï¼Œå…¶ä¸­ create API: T\tcreate(String name, Class type, Object... constructionArguments) è¿™é‡Œå°±åˆ›å»ºäº†ä¸€ä¸ª android å±æ€§ï¼Œæ˜¯ä¸€ä¸ª AppExtension å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬ä¸­æä¾›ç»™ android block çš„{}å…¶å®æ˜¯é…ç½®äº†ä¸€ä¸ª AppExtension å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ AppExtension ä¸­æ‰¾åˆ° compileSdkVersion ç­‰å±æ€§ã€‚ æ‰€ä»¥ï¼Œæ’ä»¶æ‰©å±•çš„ Project å¯¹è±¡ï¼Œæä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œè¿™æ ·ï¼Œå¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨æ’ä»¶å®šä¹‰çš„æ–¹æ³•ï¼ˆscript blockï¼‰äº†ã€‚ ä¸€ä¸ªæ’ä»¶å°±æ˜¯å®ç°å®ç°äº† org.gradle.api.Plugin æ¥å£çš„ groovy ç±»ã€‚ æˆ‘ä»¬çœ‹æ€ä¹ˆå†™ä¸€ä¸ªæ’ä»¶ï¼š //build.gradle apply plugin: GreetingPlugin //è¿™é‡Œæä¾›closure æ¥é…ç½®æ’ä»¶æä¾›çš„greeting script block greeting { message = 'Hi' greeter = 'Gradle' } class GreetingPlugin implements Plugin { void apply(Project project) {//æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚æœæ‰©å±•Projectå¯¹è±¡çš„,é€šè¿‡extensionså¯¹è±¡åˆ›å»ºä¸€ä¸ªscript block:greeting,è€Œè¿™ä¸ªblockå…³è”çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ project.extensions.create(\"greeting\", GreetingPluginExtension) project.task('hello') \u003c\u003c { //æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨greetingçš„,æ²¡æœ‰é€šè¿‡extensioins println \"${project.greeting.message} from ${project.greeting.greeter}\" } } } class GreetingPluginExtension { String message String greeter } /* project.task('hello') \u003c\u003c { println \"${project.greeting.message} from ${project.greeting.greeter}\" } ä½¿ç”¨äº†é‡è½½æ“ä½œç¬¦,ç­‰ä»·: project.task('hello').leftShift({ println \"${project.greeting.message} from ${project.greeting.greeter}\" }) */ å®˜æ–¹æ–‡æ¡£ï¼šå¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªæ’ä»¶ #####å‚è€ƒï¼š gradle-tip-2 Gradle æ·±å…¥ä¸å®æˆ˜ï¼ˆå…­ï¼‰Gradle çš„èƒŒåæ˜¯ä»€ä¹ˆï¼Ÿ DSL è¯­æ³• gradle ä½¿ç”¨çš„åŸºäº groovy ä¸­çš„ DSL è¯­æ³•ï¼Œæ‰€è°“çš„ dslï¼Œå°±æ˜¯åŸºäº groovy å‘æ˜çš„æ–°çš„â€œç¼–ç¨‹è¯­è¨€â€,gradle dsl æ˜¯ groovy çš„è¶…é›†ï¼Œå°±æ˜¯ä½ å¯ä»¥å®Œå…¨ä½¿ç”¨ groovy çš„è¯­æ³•ï¼Œä½†æ˜¯ä½ è¿˜æ˜¯ä¼šçœ‹åˆ°å¾ˆå¤šä¸æ˜¯ groovy è¯­æ³•ï¼Œè¿™æ—¶ä¸è¦å›°æƒ‘ï¼Œè¿™äº›è¯­æ³•ä¸è¿‡æ˜¯ gradle åˆ©ç”¨ groovy æä¾›çš„å…ƒç¼–ç¨‹èƒ½åŠ›æä¾›çš„æ–°è¯­æ³•ã€‚ ä»¥æ–°å»º task çš„è¯­æ³•ä¸ºä¾‹ï¼Œåœ¨ Project API ä¸­æœ‰å››ä¸ªé‡è½½å½¢å¼ï¼š Task task(String name, Closure configureClosure); Task task(Map args, String name, Closure configureClosure); Task task(Map args, String name) throws InvalidUserDataException; Task task(String name) throws InvalidUserDataException; ä½†æ˜¯ä½ ä¼šçœ‹åˆ°è¿™æ ·çš„è°ƒç”¨æ–¹å¼ï¼š task intro(dependsOn: hello) { doLast { println \"I'm Gradle\" } } è¿™æ˜¯ dslï¼Œå…·ä½“çš„è§£ææ–¹å¼åœ¨TaskDefinitionScriptTransformer å…·ä½“è§æˆ‘åœ¨ sf çš„æé—®gradle task method syntax in build.gradle more tips gradle-tips ","title":"ç†è§£ Gradle build è„šæœ¬ç»“æ„ä¸è¯­æ³•","uri":"/post/gradle-buildscript/"},{"content":"æœ€è¿‘éå¸¸ç«çš„ä¸€é“æºç¨‹é¢è¯•é¢˜ Java public class Base { private String baseName = \"base\"; public Base() { callName(); } public void callName() { System.out.println(baseName); } static class Sub extends Base { private String baseName = \"sub\"; public void callName() { System.out.println(baseName); } } public static void main(String[] args) { Base b = new Sub(); // è¾“å‡ºï¼Ÿ } } æˆ‘çš„ç†è§£ï¼š å…ˆç†è§£ä¸¤ä¸ªæ–¹æ³•ï¼š class çš„ (clinit) æ–¹æ³•å’Œ (init) æ–¹æ³•ä¸åŒï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ä¸€ä¸ªæ˜¯è™šæ‹Ÿæœºåœ¨è£…è½½ä¸€ä¸ªç±»åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨çš„ï¼ˆï¼‰.å¦ä¸€ä¸ªæ˜¯åœ¨ç±»å®ä¾‹åŒ–æ—¶è°ƒç”¨çš„ï¼ˆï¼‰. åœ¨åŠ è½½ç±»æ—¶éœ€è¦ç±»çš„åˆå§‹åŒ–ï¼ŒJVM å¯¹åº”çš„å­—èŠ‚ç æ–¹æ³•æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆå§‹åŒ– static å˜é‡å’Œæ‰§è¡Œ static{}ä»£ç å—ï¼ŒæŒ‰æºç å®šä¹‰çš„é¡ºåºæ‰§è¡Œã€‚æ³¨æ„ï¼šå¦‚æœ static{}ä»£ç å—ä¸­å¼•ç”¨äº† static å˜é‡ï¼Œé‚£ä¹ˆä¸€å®šè¦ä½¿ç”¨ä¹‹å‰å®šä¹‰ static å˜é‡.ide ä¼šæç¤ºçš„ã€‚ è¿™æ—¶ï¼Œclass çš„å…¶ä»–æˆå‘˜å˜é‡å’Œæ–¹æ³•éƒ½æ²¡æœ‰è¢«æ‰§è¡Œã€‚å˜é‡çš„å†…å­˜éƒ½å·²ç»åˆ†é…ï¼Œå€¼ä¸º null æˆ–è€… 0ï¼ˆåŸºæœ¬ç±»å‹ï¼‰ï¼Œfalse(å¸ƒå°”ç±»å‹). å½“åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆå§‹åŒ–é static å˜é‡å’Œæ‰§è¡Œ{}ä»£ç å—ã€‚æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªä¹Ÿæ˜¯æŒ‰æºç é¡ºåºæ‰§è¡Œçš„ã€‚æ‰€ä»¥ä»£ç å—å¦‚æœè¦ä½¿ç”¨é static å˜é‡ï¼Œä¸€å®šè¦å…ˆå®šä¹‰ã€‚åŒæ · ide ä¸€èˆ¬ä¼šæç¤ºçš„ã€‚ä½†æ˜¯è¦æ˜ç™½è¿™ä¸ªé¡ºåºã€‚ ä»¥ä¸Šè¯´çš„æ‰§è¡Œé¡ºåºé€šè¿‡ eclipse è°ƒè¯•å¯ä»¥ç¡®å®šæ˜¯æ­£ç¡®çš„ã€‚ æ‰€ä»¥ç»„åˆèµ·æ¥ åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡éœ€è¦ä¸‹é¢çš„é¡ºåºï¼š çˆ¶ç±»P staticä»£ç å—å’Œstaticå˜é‡åˆå§‹åŒ– -\u003e å­ç±»S staticä»£ç å—å’Œstaticå˜é‡åˆå§‹åŒ– -\u003e çˆ¶ç±»P éstaticä»£ç å—å’Œéstaticå˜é‡åˆå§‹åŒ– -\u003e çˆ¶ç±»Pæ„é€ å‡½æ•° -\u003e å­ç±»Séstaticä»£ç å—å’Œéstaticå˜é‡åˆå§‹åŒ– -\u003e å­ç±»Sæ„é€ å‡½æ•° å›åˆ°é¢è¯•é¢˜ï¼šæˆ‘ä»¬çœ‹çœ‹åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„è°ƒç”¨æ ˆï¼š å¯ä»¥çœ‹åˆ°ä¾æ¬¡è¿›å…¥ 16ï¼Œ8ï¼Œ21 è¡Œä»£ç ï¼š 16 è¡Œï¼š static class Sub extends Base 8 è¡Œï¼š callName();//Base()æ„é€ å‡½æ•°ä¸­ 21 è¡Œï¼š System.out.println (baseName) ;//Subçš„callName() æ ¹æ®å‰é¢çš„åˆ†æï¼Œè¿™ä¸ªç±»æ²¡æœ‰ static ä»£ç å—å’Œ static å˜é‡ï¼Œä¹Ÿæ²¡æœ‰ä»£ç å—ã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ˜¯çˆ¶ç±»éé™æ€æˆå‘˜çš„ base=â€œbaseâ€;æ¥ç€æ‰§è¡Œæ„é€ å‡½æ•° Base();è¿™é‡Œåˆ°äº†é­”æ³•çš„ä¸€æ­¥ï¼Œè°ƒç”¨çš„ callName() æ˜¯å­ç±»ï¼ˆ21 è¡Œï¼‰çš„æ–¹æ³•ã€‚è¿™ä¸ªè¡Œä¸ºå°±æ˜¯åŠ¨æ€å•åˆ†æ´¾.è¯¦ç»†èµ„æ–™çœ‹æœ€åã€‚ç”±äºå­ç±»çš„é static å˜é‡åˆå§‹åŒ–æ²¡æœ‰å®Œæˆï¼Œæ‰€æœ‰å­ç±»ä¸­çš„ base å˜é‡æ˜¯ null.è¾“å‡ºä¹Ÿæ˜¯ null. ï¼ï¼ï¼æ‰€ä»¥ï¼Œä¸è¦å†æ„é€ å‡½æ•°ä¸­è°ƒç”¨å¯èƒ½ä¼šè¢«å­ç±»è¦†ç›–çš„æ–¹æ³•ã€‚ æœ‰çš„é¢è¯•é¢˜ä¼šå‡ºç°é™·é˜±ï¼šåœ¨è°ƒç”¨ callName() æ–¹æ³•æ”¹ä¸º this.callName(). å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨è°ƒç”¨ Base æ„é€ å‡½æ•°æ—¶æ²¡æœ‰ Base çš„å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨è€…å…¶å®è¿˜æ˜¯ Base$Sub è¿™ä¸ªç±»ã€‚ è¿˜æœ‰ä¸€ä¸ªè¿›é˜¶ç‰ˆï¼š public class Basic { public void add(int i) { System.out.println(\"Basic add\"); } public Basic() { add('a'); } public static void main(String[] args) { Basic a = new A(); B b = new B(); } } class A extends Basic { public void add(int i) { System.out.println(\"A add\"); } } class B extends Basic { public void add(char i) { System.out.println(\"B add\"); } } ä¸ä»…è€ƒå¯Ÿå•åˆ†æ´¾ï¼Œè¿˜æœ‰é‡è½½çš„é™æ€å¤šåˆ†æ´¾ã€‚è¿›é˜¶ç‰ˆé—®é¢˜çš„è§£é‡Šéœ€ä»¥ä¸‹çŸ¥è¯†ç‚¹-java çš„é™æ€åˆ†æ´¾å’ŒåŠ¨æ€å•åˆ†æ´¾ã€‚ CSDN-ç±»åŠ è½½æœºåˆ¶ - æ·±å…¥ java è™šæ‹Ÿæœº è¯»ä¹¦ç¬”è®° æ–¹æ³•åˆ†æ´¾ é‡è½½æ˜¯é™æ€å¤šåˆ†æ´¾ï¼Œç¼–è¯‘æ—¶æœŸç¡®å®šã€‚ è¦†ç›–æ˜¯åŠ¨æ€å•åˆ†æ´¾ï¼Œè¿è¡Œæ—¶é€šè¿‡å®é™…ç±»å‹ç»‘å®šã€‚ é™æ€å¤šåˆ†æ´¾ï¼šæ‰€æœ‰ä¾èµ–é™æ€ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾è¿‡ç¨‹å°±å«åšé™æ€åˆ†æ´¾ï¼Œé™æ€åˆ†æ´¾æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯æ–¹æ³•é‡è½½ã€‚ åŠ¨æ€å•åˆ†æ´¾ï¼šæ ¹æ®è¿è¡ŒæœŸå®é™…ç±»å‹ç¡®å®šæ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾è¿‡ç¨‹å«åšåŠ¨æ€åˆ†æ´¾ï¼ŒåŠ¨æ€åˆ†æ´¾æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯æ–¹æ³•é‡å†™ã€‚ åŒæ—¶ç†è§£ï¼šåŠ¨æ€å•åˆ†æ´¾å°±æ˜¯å¤šæ€ï¼Œjava çš„é¢å‘æ¥å£ç¼–ç¨‹çš„æ ¹åŸºå°±æ˜¯å¤šæ€ã€‚ ","title":"é¢è¯•é¢˜ - ç±»åŠ è½½è¿‡ç¨‹å’Œå­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨","uri":"/post/java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E5%92%8C%E5%AD%90%E7%B1%BB%E9%87%8D%E5%86%99%E7%88%B6%E7%B1%BB%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8/"},{"content":"çŸ¥ä¹å›ç­”å¤‡ä»½ï¼ŒåŸç­”æ¡ˆå†™äº 15 å¹´\n6,404 äººèµåŒäº†è¯¥å›ç­”\n4 å¹´ä¹‹åæ„Ÿè§‰è‡ªå·±å½“å¹´å†™çš„çœŸå¥½ã€‚O(âˆ©_âˆ©)O å“ˆå“ˆ~\nè¯„è®ºé‡Œé¢æœ‰äººå†™åˆ°ç°åœ¨éƒ½ç”¨ spring bootï¼Œä¸ªäººè§‰å¾— boot åªè¦ææ¸…æ¥šä¸€ä¸ª autoconfig å°±æ‡‚äº†å°åŠäº†ã€‚\nå­¦ä¹ æ¡†æ¶çš„åŒæ—¶è¿˜æ˜¯éœ€è¦é’ˆå¯¹æ€§åœ°æ·±å…¥å­¦ä¹ ä¸€äº› Java åŸºç¡€ï¼Œä¾‹å¦‚åå°„ï¼ŒCDIï¼ŒJDBCï¼ŒClass ç±»å’Œ MySQL ä»¥åŠ httpï¼ˆnginx çš„ä½¿ç”¨ï¼‰ã€‚æ±‚ç²¾ä¸æ±‚å¤šï¼Œæ–°æ‰‹ä¹Ÿä¸è¦æä»€ä¹ˆ mongodbï¼Œetcdï¼Œzk è¿™äº›ï¼Œæœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œåé¢ä¸Šæ‰‹ä½¿ç”¨æ–°ä¸œè¥¿ä¼šå¾ˆå¿«çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¾ˆå¤šäººå­¦ä¹  mybatis çš„ä½¿ç”¨ï¼Œä½†æ˜¯ JDBC åªä¼šä¸€ä¸ª Class.forName+Statementï¼Œæ˜¾ç„¶ä¹Ÿä¸çŸ¥é“ mybatis çš„å¥½å¤„å’Œåº•å±‚çš„ã€‚\nè¿˜æ˜¯è¦å¤šå†™ï¼Œä¸è¦å¤åˆ¶ï¼Œå•ä¸ªé¡¹ç›®å»æ‰å¤åˆ¶ä»£ç è¿˜æœ‰ 5000 è¡Œçš„è¯ï¼Œå…¶å®å°±èƒ½å¤Ÿç†è§£åˆ°è¯¾æœ¬ä¸Šçš„â€œé«˜å†…èšï¼Œä½è€¦åˆâ€æ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚\nåŸå›ç­” 1 æƒ³è¯´è¯´è‡ªå·± Spring çš„å­¦ä¹ è·¯ç¨‹ã€‚è¯¾ä½™è‡ªå­¦ Spring å°†è¿‘ä¸€å¹´äº†ï¼Œè¿˜æ˜¯ä¸å¾—å…¶é“ã€‚èµ·åˆæ˜¯å»å¹´ï¼ˆ14 å¹´ï¼‰æš‘å‡å­¦ä¹ äº†ä¸€ä¸‹ JSPï¼Œå¹¶æ²¡æœ‰æ·±å…¥ç†è§£ï¼Œæ‰€ä»¥å¯¼è‡´å­¦ä¹  Spring æ—¶å¯¹ç€ä¹¦æœ¬å†™ä¸€äº› demoï¼Œæ„Ÿè§‰è‡ªå·±ç†è§£äº†ï¼Œå…¶å®å¹¶ä¸çŸ¥é“å†…éƒ¨æ—¶ä»€ä¹ˆåŸç†ï¼Œå‡ºäº†é—®é¢˜ä¸åœçš„ç™¾åº¦ï¼Œä¸€ä¸ªå°é—®é¢˜å¥½å‡ å¤©è§£å†³ä¸äº†ã€‚\nå­¦ä¹ ä¸€ç§æ¡†æ¶æœ€å…ˆéœ€è¦çŸ¥é“çš„æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨è¿™ä¸ªæ¡†æ¶ï¼Œä»»ä½•ä¸€ä¸ªæ¡†æ¶çš„å‘æ˜éƒ½æ˜¯ä¸ºäº†è§£å†³ç¼–ç¨‹ä¸­çš„ä¸€äº›ç—›ç‚¹ï¼Œæ‰“å¼€ä»»ä½•ä¸€æœ¬ hibernate æˆ–è€…å…¶ä»–æ¡†æ¶çš„å…¥é—¨ä¹¦ï¼Œç¬¬ä¸€ç« éƒ½æ˜¯ä»‹ç»æ¡†æ¶çš„ç†å¿µå’Œä¼˜åŠ¿ã€‚å¦‚æœéœ€è¦ç†è§£è¿™äº›ç†å¿µå’Œä¼˜åŠ¿ï¼Œé‚£ä¹ˆä½ éœ€è¦çŸ¥é“ä¸ä½¿ç”¨è¿™ä¸ªæ¡†æ¶ä¹‹å‰æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œæ‰èƒ½çŸ¥é“æ¡†æ¶åšäº†ä¸€äº›ä»€ä¹ˆäº‹æƒ…ã€‚\né’ˆå¯¹ Spring çš„å­¦ä¹ ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯äº†è§£æ²¡æœ‰ spring å’Œ struts æ¡†æ¶ä¹‹å‰çš„ Java web æ˜¯å¦‚ä½•å¼€å‘çš„ã€‚ä½ ä¼šçŸ¥é“é‚£æ—¶å€™ä½¿ç”¨ JSP å’Œ Servletï¼Œç„¶åä½ å°±çŸ¥é“ï¼ŒServlet æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œé‚£åœ¨ Spring é‡Œé¢ï¼ŒServlet å»å“ªäº†ï¼Ÿè¿™æ—¶å€™ä½ çŸ¥é“äº† DispatchServletã€‚ç„¶åä½ ä¼šäº†è§£åˆ° IoC å’Œ AOPã€‚\nå¾ˆå¤šæ–°çš„æŠ€æœ¯åªä¸è¿‡æ˜¯å¼•å…¥äº†æ–°çš„ç¼–ç¨‹å…ƒç´ å¯¹åŸæ¥æŠ€æœ¯è¿›è¡Œäº†å°è£…ã€‚\n2 å…¶å® Java Web å¼€å‘ï¼Œspring ä¸æ˜¯ç¬¬ä¸€æ­¥ï¼Œé¦–å…ˆéœ€è¦ç†è§£çš„æ˜¯ HTTP åè®®ã€‚chrome çš„ DevTools å’Œ curlã€postman è¦æœ‰åŸºæœ¬ä½¿ç”¨ã€‚\nè¿˜è¦çŸ¥é“æœåŠ¡å™¨å‘é€ç»™æµè§ˆå™¨çš„å“åº”æ˜¯æ²¡æœ‰æ²¡æœ‰ JSã€CSS å’Œå›¾ç‰‡ç­‰å¤–éƒ¨èµ„æºçš„ï¼Œæµè§ˆå™¨åœ¨è§£æå“åº”æ—¶æ‰ä¼šå†æ¬¡è¯·æ±‚è¿™äº›èµ„æºï¼Œè¿™é‡Œä¼šå‡ºç°ä¸€äº›é™æ€èµ„æºè¯·æ±‚ä¸åˆ°çš„é—®é¢˜ï¼ŒSpringMVC æ˜¯æ€ä¹ˆé…ç½®çš„ï¼Ÿè¿˜æœ‰ chrome å¹¶å‘è¯·æ±‚æ•°é‡é™åˆ¶ï¼Œå¦‚ä½•åˆå¹¶é›ªç¢§å›¾æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ç­‰çŸ¥è¯†ç‚¹ï¼Œå±äº http çŸ¥è¯†äº†ã€‚\næ¥ä¸‹æ¥ï¼Œå­¦ä¹  Servlet å’Œ JSPã€‚è¿™ä¸ªæ­¥éª¤ä¸æ˜¯å¯ä»¥è·³è¿‡çš„ï¼Œç°åœ¨æµè¡Œçš„æ¡†æ¶ Spring MVC å’Œ Struts2 å…¶å®éƒ½æ˜¯åŸºäº Servlet çš„ï¼Œåªæœ‰æ·±å…¥ç†è§£äº† Servlet æ‰èƒ½ç†è§£åé¢çš„æ–°æŠ€æœ¯ã€‚\nä¸‹é¢å‡ ä¸ªçŸ¥è¯†ç‚¹å¯ä»¥æ£€æµ‹ä½ æ˜¯å¦ç†è§£äº† Servletï¼š\n1ã€ä»€ä¹ˆæ˜¯ ServletContextï¼Œå’Œ tomcat ç­‰ web å®¹å™¨çš„å…³ç³»æ—¶ä»€ä¹ˆï¼ŸServlet å·¥ä½œåŸç†è§£æ\nç®€å•çš„è¯´ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ç‚¹å‡»é“¾æ¥å’ŒæŒ‰é’®äº§ç”Ÿçš„æ¶ˆæ¯ä¸æ˜¯å‘é€ç»™ Servlet çš„ï¼Œè€Œæ˜¯å‘é€ç»™ web å®¹å™¨çš„ (åœ¨ JSP å‡ºç°ä¹‹å‰ï¼Œweb å®¹å™¨ä¹Ÿå« Servlet å®¹å™¨)ã€‚web å®¹å™¨æ¥æ”¶æ¶ˆæ¯åä¸çŸ¥é“æ€ä¹ˆå¤„ç†ï¼Œè½¬äº¤ç»™æˆ‘ä»¬ç¼–å†™çš„ Servlet å¤„ç†ï¼Œé‚£ä¹ˆ web å®¹å™¨æ€ä¹ˆå’Œ Servlet äº¤æµå‘¢ï¼Ÿäºæ˜¯å°±å‡ºç°äº† Servlet æ¥å£ï¼Œæ¥å£æ˜¯å®šä¹‰ä¸€ç§è§„èŒƒçš„è‰¯å¥½è¡¨è¾¾å½¢å¼ã€‚åªè¦æˆ‘ä»¬ç¼–å†™çš„ Java ç±»ç¬¦åˆ Servlet è§„èŒƒï¼Œé‚£ä¹ˆå°±èƒ½è¢« Web å®¹å™¨è¯†åˆ«å¹¶è¢«å®¹å™¨ç®¡ç†ã€‚\n2ã€ä»€ä¹ˆæ˜¯ Sessionï¼ŸSession åœ¨å®é™…å·¥ç¨‹ä¸­çš„åº”ç”¨åœºæ™¯ã€‚ä»¥åŠ@SessionAttribute æ³¨è§£çš„å±€é™æ€§ã€‚\n3ã€JSP æ˜¯é¢å‘æœåŠ¡å™¨çš„ï¼Œå®ƒå¹¶ä¸çŸ¥é“æµè§ˆå™¨æ˜¯ä»€ä¹ˆé¬¼ï¼Œæ˜¯æˆ‘ä»¬åœ¨å†™ JSP æ—¶é¢„è®¾å®¢æˆ·ç«¯æ˜¯æµè§ˆå™¨ï¼ŒJSP å°±æ˜¯ä¸€ä¸ª Servletï¼ŒJSP çš„å¸¸ç”¨å¯¹è±¡å’ŒæŒ‡ä»¤ã€‚\n4ã€JSP çš„ä¸­æ–‡ç¼–ç ä¹±ç æœ‰å‡ ç§æƒ…å†µï¼Ÿå„è‡ªçš„è§£å†³æ–¹æ³•ï¼Ÿæç¤ºï¼šJSP æ–‡ä»¶çš„ç¼–ç ï¼Œæµè§ˆå™¨çš„è§£æç¼–ç ï¼ŒGET è¯·æ±‚çš„ç¼–ç ï¼ŒPOST çš„ç¼–ç ã€‚\n5ã€Servlet æ˜¯ä¸€ç§æ¥å£è§„èŒƒï¼Œå…¶ä¸­è¯·æ±‚å’Œå“åº”æ˜¯ Servlet å®¹å™¨é€šè¿‡å‘æ–¹æ³•çš„å‚æ•°èµ‹å€¼ HttpServletRequest æˆ–è€… HttpServletResponse ä¼ é€’çš„ã€‚åœ¨ Struts1 é‡Œé¢ï¼Œå°† doGet() æ–¹æ³•é‡Œçš„å“åº”ç§»åˆ°è¿”å›å€¼é‡Œã€‚åœ¨ Struts2 é‡Œåˆ™ï¼š\nåœ¨ Controller ä¸­å½»åº•æœç»å¼•å…¥ HttpServletRequest æˆ–è€… HttpServletResponse è¿™æ ·çš„åŸç”Ÿ Servlet å¯¹è±¡ã€‚\nåŒæ—¶å°†è¯·æ±‚å‚æ•°å’Œå“åº”æ•°æ®éƒ½ä»å“åº”æ–¹æ³•ä¸­å‰¥ç¦»åˆ°äº† Controller ä¸­çš„å±æ€§å˜é‡ã€‚\nè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŠ€æœ¯æ”¹é€ ï¼Œä¹Ÿé€ æˆäº† Struts2 çš„ç››è¡Œã€‚Spring MVC èµ°çš„æ˜¯ä¸­é—´è·¯çº¿ï¼ŒSpring çš„ 2.0.8 ä¹‹å‰çš„ç‰ˆæœ¬ç”šè‡³ç›´æ¥ä½¿ç”¨ Servlet çš„ doGet çš„ã€‚Spring MVC ç°åœ¨å¼€å§‹æµè¡Œä¸»è¦è¿˜æ˜¯å› ä¸º Schema xml çš„ç²¾ç®€å’ŒåŸºäºæ³¨è§£çš„é…ç½®ã€‚æ‰€ä»¥è¿™é‡Œå‡ºç°äº†æ–°çš„çŸ¥è¯†ç‚¹ï¼šSchema Based XML çš„ç›¸å…³çŸ¥è¯†å’Œ Java5 å¼•å…¥çš„æ³¨è§£åŸç†ã€‚\nä¹¦ç±ï¼šæ¨èè®¸ä»¤æ³¢çš„ä¹¦ã€Šæ·±å…¥åˆ†æ Java Web æŠ€æœ¯å†…å¹• (ä¿®è®¢ç‰ˆ)ã€‹å’Œè®¡æ–‡æŸ¯çš„ã€Šæ·±å…¥ç†è§£ spring æŠ€æœ¯å†…å¹•ã€‹ã€‚ç‰¹åˆ«æ˜¯ç¬¬äºŒæœ¬ï¼Œå¯¹ spring çš„åˆ†æå¾ˆæ˜¯å½»åº•ã€‚\n","title":"Java æ–°æ‰‹å¦‚ä½•å­¦ä¹  SpringMVC æ¡†æ¶","uri":"/post/how-do-newbie-learn-spring/"},{"content":"å¥½ä¹…æ²¡çœ‹è¿‡çˆ±æƒ…ç”µå½±äº†ï¼Œå½“ã€Šå±±æ¥‚æ ‘ã€‹èµšå°½çœ¼æ³ªæ—¶æˆ‘æ²¡æœ‰çœ‹ï¼Œå½“ã€Šé‚£äº›å¹´ã€‹çº¢éä¸¤å²¸æ—¶ï¼Œæˆ‘æ²¡æœ‰çœ‹ã€‚å› ä¸ºæ²¡æœ‰é€‰æ‹©ï¼Œçœ‹äº†è¿™éƒ¨ç”µå½±ã€‚\nã€ŠHANAMITSUKIã€‹æ˜¯è¿™ä¸ªåå­—ï¼Œä¸­æ–‡åæ˜¯å«ã€ŠèŠ±æ°´æœ¨ã€‹ã€‚\næˆ‘åŠªåŠ›æƒ³è®°èµ·å½“ä¸­é‚£æ®µè®©æˆ‘çœ¼çœ¶æ¹¿æ¶¦çš„ç‰‡æ®µï¼Œå´æš‚æ—¶ç©ºç™½ã€‚é‚£äº›è®°ä½çš„ç‰‡æ®µæ°¸è¿œéƒ½æ˜¯å¥³ä¸»è§’é‚£æ¸©æƒ…çš„è„¸åºå’Œç”·ä¸»äººå…¬çš„çœ‰å¤´ç´§é”ï¼Œè¿˜æœ‰é‚£äº›é£˜é€¸çš„èŠ±ç“£ï¼Œå­¤ç‹¬å®ˆæœ›çš„ç¯å¡”ï¼Œè”šè“çš„å¤©ç©ºå’Œæµ·æ´‹ï¼Œç—›è‹¦çš„æ³ªæ°´å’Œå¹¸ç¦çš„æ³ªæ»´ã€‚\nç‰‡ä¸­æ‰€æ¶‰åŠåˆ°çš„äº²æƒ…å‹æƒ…çˆ±æƒ…ï¼Œæˆ‘æ˜¯æƒ³è§£é‡Šéƒ½è§£é‡Šä¸æ¸…çš„ï¼Œæµ“æµ“çš„åŒ–ä¸å¼€ï¼Œæš–æš–çš„è®©äººçªç„¶è§‰å¾—è¯¥åçœè‡ªå·±å»çæƒœè‡ªå·±èº«è¾¹çš„äº†å—ã€‚æˆ–è€…åæ€æˆ‘èº«è¾¹æœ‰é‚£ä¹ˆç±»ä¼¼çš„æ„ŸåŠ¨å—ï¼Œåº”è¯¥åšä¸ªè®©åˆ«äººä¹Ÿæ„Ÿåˆ°æ¸©é¦¨çš„äººå§ã€‚æ„ŸåŠ¨äº†ï¼Œå°±æ˜¯éƒ¨å¥½ç”µå½±ï¼Œè§‰å¾—æœ‰è¶£ä¹Ÿæ˜¯éƒ¨å¥½ç”µå½±ï¼Œæ”¶è·äº†ç†è§£äº†ï¼Œå¥¹å°±å€¼å¾—å»è¢«äººä»¬çŸ¥é“ã€‚\nç°åœ¨çœ‹åˆ°å¦‚æ­¤çš„æƒ…èŠ‚ï¼Œè‡ªå·±çš„å¿ƒå°±ä¼šæŠ½ç—›ï¼Œä»¥å‰æå°‘è¿™æ ·çš„ï¼Œä¹Ÿè®¸æ˜¯æ¯”ä»¥å‰åˆé©¶è¿‡äº†ä¸€äº›å¹´å²ï¼Œå…¶å®å¿ƒé‡Œå¾ˆä¸æ„¿æ„æ‰¿è®¤çš„è¯å°±æ˜¯â€œå°èµ„â€â€œå¤šæ„å–„æ„Ÿâ€ï¼Œå°±æ˜¯æˆ–è®¸æœ‰çš„æ—¶å€™å°±æ˜¯ä¸€ç§å…±é¸£ï¼Œç„¶åæ˜¯æ‰€è°“çš„å®£æ³„ã€‚å¿ƒç—›ï¼Œçœ¼çœ¶æ¹¿äº†ï¼Œè¿™å°±æ˜¯æ–¹å¼ä¸é€”å¾„ã€‚\nç”µå½±ï¼Œæ˜¯äºŒåå››æ ¼çš„çœŸå®ã€‚ æ•…äº‹é‡Œçš„æƒ…èŠ‚ä¸åœåœ°è®©äººæƒ³åˆ°è‡ªå·±ã€‚çˆ±æƒ…ï¼Œéœ€è¦é¢å¯¹çš„å¤ªå¤šã€‚æ‚¬æ®Šçš„ç”Ÿæ´»ç¯å¢ƒï¼Œä¸åŒçš„ç”Ÿæ´»è¯é¢˜ï¼Œé•¿é•¿çš„è·ç¦»ï¼Œæ¸ºèŒ«ä¸æ¸…çš„æœªæ¥ï¼Œè¯ºè¨€ï¼Œåœ¨è¿™äº›é¢å‰æ˜¯å¤šä¹ˆè‹ç™½æ— åŠ›ï¼ç°å®å¦‚æ­¤ç°å®ï¼Œå¦‚æœçº¯ä¸€æ²¡æœ‰ç‰ºç‰²ï¼Œæ•…äº‹ä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿç”µå½±é‡Œç¾å¥½çš„ç»“å±€è¢«è‡ªå·±å¿ƒé‡Œçš„ä¸€ä¸ªå‡è®¾å‡»çš„ç²‰ç¢ã€‚ä¸€æ®µçœŸçˆ±ï¼Œç”¨å°½åå¹´æ‰èµ°åœ¨ä¸€èµ·ï¼Œç»ˆç©¶ç»™æ‰€æœ‰äººä»¥å¸Œæœ›å’Œé¼“åŠ±ã€‚åˆ›ä½œè€…æœ€å¤§çš„å¹¸ç¦æ˜¯å¯ä»¥è®©ç”µå½±ä¸åƒç°å®é‚£æ ·åˆ°å¤„é—æ†¾ï¼Œè§‚èµè€…æœ€å¤§çš„å¿«ä¹å°±æ˜¯ç”¨çœ¼ç›æ‘¸ä¸€æ‘¸è‡ªå·±çš„ç†æƒ³ï¼ï¼æˆ–æ˜¯æœ‰å…³çˆ±æƒ…çš„ï¼Œæˆ–æ˜¯æœ‰å…³äº‹ä¸šçš„ã€‚\nç”µå½±ï¼Œé£æ™¯ï¼Œæƒ³æ‰€æƒ³ï¼Œæ€ç»ªæ— è¾¹æ— é™…ã€‚å¤šæƒ³ä¹Ÿèƒ½è¿œç¦»å–§åš£å‡¡ä¿—æ‚äº‹ï¼Œæš‚æ—¶æ²‰æµ¸åœ¨ç¾å¥½å½“ä¸­ã€‚\nç¬¬äºŒéå¿«è¿›çœ‹äº†ä¸€éï¼Œå½“å¹³æ³½å›åˆ°æ—¥æœ¬ï¼Œå¯¹ç€æ”¾ä¸‹æ‰‹ä¸­çš„æ´»æ¥æ¬¢è¿å¥¹çš„æ¯äº²ä¸€ç¬‘çš„é‚£ä¸ªç”»é¢æˆ‘ç»™æˆªäº†ä¸‹æ¥ã€‚é‚£æ˜¯æ€æ ·çš„ä¸€ç§ç¹åè½ï¼Œå§‹å¾—äººç”Ÿä¹‹ä¹‰ã€‚æœ€åçš„æœ€åï¼Œä¸€åˆ‡è¿˜æ˜¯å›åˆ°äº†èµ·ç‚¹ï¼Œè€Œæˆ‘ä»¬å·²ç»ä¸æ˜¯é‚£ä¸ªæ›¾ç»çš„äººäº†ï¼Œå†ç»åƒè¾›ä¸‡è‹¦ï¼Œæˆ‘ä»¬æ›´åŠ çæƒœã€‚\næ–°çš„ä¸€å¹´ï¼Œæˆ‘æƒ³å¯¹å±å¹•å‰çš„ä½ è¯´ï¼Œåœ¨å¯»æ‰¾å¹¸ç¦çš„è·¯ä¸Šï¼Œå‹‡æ•¢åœ°å»äº‰å–æ¸´æœ›çš„ï¼Œæ›´è¦çæƒœæ‹¥æœ‰çš„ï¼Œåœ¨è¿™ä¸ªæ›²æŠ˜çš„äººç”Ÿè·¯ä¸Šï¼Œé”™è¿‡ï¼Œå°±å’Œç›¸é‡ä¸€æ ·çš„å¶ç„¶ã€‚ç›¸ä¿¡çˆ±ï¼Œå› ä¸ºï¼Œç¾å¥½çš„ï¼Œä¹Ÿæ˜¯æ˜“ç¢çš„ã€‚\nå¾ˆå–œæ¬¢å­™ç‡•èµ„çš„â€œé‡è§â€ï¼Œä¸ä»…å› ä¸ºå£°éŸ³ï¼Œè¿˜ä¸ºæ­Œè¯ã€‚\nå¬è§ å†¬å¤©çš„ç¦»å¼€ æˆ‘åœ¨æŸå¹´æŸæœˆ é†’è¿‡æ¥ æˆ‘æƒ³ æˆ‘ç­‰ æˆ‘æœŸå¾… æœªæ¥å´ä¸èƒ½ç†æ™ºå®‰æ’ é˜´å¤© å‚æ™š è½¦çª—å¤– æœªæ¥æœ‰ä¸€ä¸ªäººåœ¨ç­‰å¾… å‘å·¦ å‘å³ å‘å‰çœ‹ çˆ±è¦æ‹å‡ ä¸ªå¼¯æ‰æ¥ æˆ‘é‡è§è° ä¼šæœ‰æ€æ ·çš„å¯¹ç™½ æˆ‘ç­‰çš„äºº ä»–åœ¨å¤šè¿œçš„æœªæ¥ æˆ‘å¬è§é£æ¥è‡ªåœ°é“å’Œäººæµ· æˆ‘æ’ç€é˜Ÿ æ‹¿ç€çˆ±çš„å·ç ç‰Œ é˜´å¤© å‚æ™š è½¦çª—å¤– æœªæ¥æœ‰ä¸€ä¸ªäººåœ¨ç­‰å¾… å‘å·¦ å‘å³ å‘å‰çœ‹ çˆ±è¦æ‹å‡ ä¸ªå¼¯æ‰æ¥ æˆ‘é‡è§è° ä¼šæœ‰æ€æ ·çš„å¯¹ç™½ æˆ‘ç­‰çš„äºº ä»–åœ¨å¤šè¿œçš„æœªæ¥ æˆ‘å¬è§é£æ¥è‡ªåœ°é“å’Œäººæµ· æˆ‘æ’ç€é˜Ÿ æ‹¿ç€çˆ±çš„å·ç ç‰Œ æˆ‘å¾€å‰é£ é£è¿‡ä¸€ç‰‡æ—¶é—´æµ· æˆ‘ä»¬ä¹Ÿå¸¸åœ¨çˆ±æƒ…é‡Œå—ä¼¤å®³ æˆ‘çœ‹ç€è·¯ æ¢¦çš„å…¥å£æœ‰ç‚¹çª„ æˆ‘é‡è§ä½ æ˜¯æœ€ç¾çš„æ„å¤– ç»ˆæœ‰ä¸€å¤© æˆ‘çš„è°œåº•ä¼šæ­å¼€ ","title":"ä½ çš„åŠæ­¥ï¼Œæˆ‘çš„å¤©æ¶¯","uri":"/post/hanamitsuki-movie-review/"},{"content":" æ—¶å…‰å¦‚æ°´ï¼Œå“—å•¦å•¦åˆæ˜¯ä¸€å¹´ï¼› å²æœˆå¦‚æ­Œï¼Œå”å“©å“©å”±ä¸æˆè°ƒã€‚ å»å¹´å…‰æ£èŠ‚å†™äº†ç‚¹æ„Ÿæ…¨ï¼Œæœ€åæ˜¯â€œè¿™ä»ç„¶è¿˜æ˜¯æœ€å¥½çš„å¹´ä»£ï¼Œå´ä¹Ÿæ˜¯æœ€åçš„å¹´ä»£ã€‚2011 å¹´çš„å†¬å¤©ï¼Œè™½ç„¶é˜³å…‰å¾ˆå¥½ï¼Œä½†é£è¿˜æ˜¯æœ‰äº›å†·ï¼Œæ„¿ä¸å›å…±å‹‰ï¼Œä½†å†·æš–è‡ªçŸ¥ã€‚â€\näº‹å®æ˜¯ 2012ï¼Œå†¬å¤©æ›´å†·ã€‚\nè¿™ä¼šå„¿åç€å›æƒ³ä»Šå¹´ä¸€å¹´ï¼Œå‘ç°å¯¹ä¸ŠåŠå¹´çš„è®°å¿†æ˜¯ä¸€ç‰‡ç©ºç™½ã€‚æ‰€æœ‰çš„è®°å¿†æ˜¯ä»æš‘å‡å›å®¶å¼€å§‹çš„ã€‚äº‹å…ˆæ²¡æœ‰è¯´ï¼Œå‡ºè½¦ç«™æ—¶å‘äº†ä¸€æ¡çŸ­ä¿¡ï¼Œäº”åˆ†é’Ÿåæœ±æ¥æ¥æˆ‘ï¼Œæ¯æ¬¡æ”¾å‡éƒ½æ˜¯å¦‚æ­¤ã€‚ç¬¬äºŒå¤©è¿˜æ²¡èµ·åºŠï¼Œå¾å·²ç»å†’é›¨åˆ°è½¦ç«™æ¥æˆ‘ï¼Œæœ€åå†’é›¨å»ä»–å®¶ä½äº†ä¸€æ™šã€‚æˆ‘è¿™ä¸ªæœ‹å‹ï¼Œä¸€ä¸ªå­¦æœŸé‡Œç”µè¯éƒ½å¾ˆå°‘æ‰“ä¸€ä¸ªï¼Œå’Œä»–ä»¬ä¹Ÿæ²¡æœ‰å…±åŒçš„å…´è¶£çˆ±å¥½ï¼Œå´åœ¨ä¸€èµ·å³ä½¿ä¸è¯´è¯ä¹Ÿä¸è§‰å¾—å°´å°¬ã€‚\nåœ¨å®¶é‡Œçš„äºŒåå‡ å¤©ï¼Œå¦ˆå¦ˆå˜ç€èŠ±æ ·åœ°åšé¥­èœï¼Œæˆ‘æ²¡é•¿èƒ–ï¼Œå¥¹è‡ªå·±å´é•¿äº†å‡ æ–¤ã€‚\nå‡æœŸåªå‡ºå»ç©äº†ä¸€æ¬¡ï¼Œå’Œå¾å»æ¨å®¶ç©äº†ä¸€å¤©ï¼Œæ™šä¸Šä¸‰ä¸ªäººçœ‹å¥¥è¿ä¼šï¼Œç„¶åä¸‰ä¸ªæ¨ªç€èººåœ¨åºŠä¸Šå¬ä»–ä»¬è¯´å’Œå¥³å‹è®¤è¯†çš„æ•…äº‹ï¼ŒèŠå¤§å­¦ç”Ÿæ´»ï¼Œå¿«ä¸¤ç‚¹æ‰ç¡ç€ã€‚ç¬¬äºŒå¤©è¿˜æ˜¯ä¸‹é›¨ï¼Œä¸‰ä¸ªäººèººåœ¨åºŠä¸Šçœ‹ç”µè§†ï¼Œæ²¡æœ‰å¤šè¯´ä¸€å¥ï¼›ä¸‹åˆå†’é›¨å»æ°´åº“ç©ã€‚\nç„¶åå°±æ˜¯é’å²›å®ä¹ ã€‚æ¯å¤©éƒ½æ˜¯ç™½å¤©åè½¦çœ‹å†›èˆ°çœ‹æ½œè‰‡ï¼Œæ™šä¸Šåƒçƒ§çƒ¤å’Œæ‰å•¤ã€‚\nè¿˜è®°å¾—ç©¿ç€è£¤è¡©ï¼Œè¶¿ç€æ‹–é‹å»çœ‹æµ·åº•ä¸–ç•Œçš„å¿ƒæƒ…ï¼›ä¸ºé˜¿å…‰é¥¯è¡Œé‚£ä¸ªæ™šä¸Šå–å¾—æ”¾çºµï¼›å°è±¡æœ€æ·±åˆ»çš„è¿˜æ˜¯é»„å²›çš„é£å…‰â€”â€”æ²¿ç€æµ·å²¸å…¬è·¯ï¼Œçœ‹åˆ°çš„æ˜¯é£æ ¼å„å¼‚çš„åˆ«å¢…ï¼Œæ•°ä¸æ¸…çš„é«˜å°”å¤«çƒåœºï¼Œæ¼«å±±éé‡çš„æ¡ƒæ ‘ï¼Œè“Šéƒçš„æ ‘æ—ï¼Œæ€ªçŸ³å¶™å³‹çš„å¤§ç å±±ï¼Œçº¯æœ´çš„å°æ¸”æ‘ï¼›è¿˜æœ‰é‚£è…¥å‘³çš„æµ·é£â€¦ä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆæ–°ï¼Œé‚£ä¹ˆç¾ã€‚\nå¼€å­¦åï¼Œå¹³é™äº†ã€‚è§†åŠ›æ€¥å‰§ä¸‹é™ï¼Œä»¥è‡´æ— æ³•æ­£å¸¸çœ‹ä¹¦ã€‚å†™å‘¨è®°çš„ä¹ æƒ¯ä¹Ÿæ–­äº†ï¼Œæ¯æ¯æƒ³å¥½äº†ï¼Œå´åˆè§‰å¾—æ²¡æœ‰å¿…è¦äº†ã€‚æˆ–è®¸åšçš„æœ€æœ‰æ„ä¹‰çš„ä¸€ä»¶äº‹å°±æ˜¯é”»ç‚¼å§ï¼Œèº«ä½“ç»“å®äº†å¾ˆå¤šã€‚\n2012ï¼Œæœ«æ—¥æ²¡æœ‰åˆ°æ¥ï¼Œæ˜å¤©è¿˜åœ¨è”“å»¶ï¼Œæ¸©æš–æ„ŸåŠ¨å¾ˆå¤šï¼Œä¸é¡ºçš„äº‹æƒ…æ›´å¤šã€‚2013ï¼Œä½†æ„¿è¿æ°”å¥½ä¸€äº›ã€‚\n2013ï¼Œåœ¨è¡°è€ä¸­æˆç†Ÿï¼Œç”¨ä¼ªè£…çš„åšå¼ºå»æ„ŸæŸ“ç”Ÿæ´»ã€‚\nè¾æ—§è¿æ–°çš„æ—¶åˆ»ï¼Œæ‘˜æŠ„è¥¿ç­ç‰™è¯—äººåŠ è¥¿äºšÂ·æ´›å°”å¡çš„è¯—å¥ï¼Œä½œä¸ºæˆ‘ä»¬å¹´å¤ä¸€å¹´çš„æ–°å¹´è®¸æ„¿çš„ç†ç”±ï¼šâ€œå› ä¸ºæˆ‘ä»¬æƒ³è¦æ¯å¤©åƒçš„é¢åŒ…ï¼Œæƒ³è¦æ¡¤æœ¨çš„èŠ±æœµå’Œæ°¸ä¹…çš„æ¸©å­˜ã€‚å› ä¸ºæˆ‘ä»¬è¦æ±‚å¤§åœ°çš„æ„å¿—èƒ½å¤Ÿå®ç°ï¼Œå°†å®ƒçš„æœå®åˆ†ç»™æ‰€æœ‰äººã€‚â€\n","title":"å†™åœ¨ 2012 å²æœ«","uri":"/post/goodbye-2012/"},{"content":"æˆ‘ä¸å–œæ¬¢è¥¿å®‰ï¼Œå–œæ¬¢ä¸€ä¸ªåœ°æ–¹éœ€è¦æ—¶é—´ï¼Œè€Œæˆ‘è¿˜æ‰¾ä¸åˆ°ç†ç”±ã€‚æˆ‘ä¸å–œæ¬¢å› ä¸ºæˆ‘ä»…ä»…æ˜¯åœ¨è¿™é‡Œç”Ÿæ´»ã€‚\næˆ‘å–œæ¬¢ç‰å±±ï¼Œå› ä¸ºé‚£é‡Œæœ‰æ›¾ç»çš„æˆ‘ã€‚ä¸€ä¸ªäººèµ°åœ¨è¡—ä¸Šï¼Œå¿½ç„¶å°±è§‰å¾—è¿™ä¸€å¹•å¥½ç†Ÿæ‚‰ï¼Œåˆ†æ˜æœ‰ä¸€å¤©è‡ªå·±ä¹Ÿæ˜¯è¿™ä¹ˆèµ°ç€ï¼Œé‚£å¤©æˆ‘è¦å»å¹²ä»€ä¹ˆï¼Ÿæˆ‘å·²ç»è®°ä¸å¾—ï¼Œç”šè‡³æœ‰å¯èƒ½æ˜¯ä¸€ç§å¹»è§‰ã€‚\nä¸€ä¸ªèƒ½è®©è‡ªå·±äº§ç”Ÿå¹»è§‰çš„åœ°æ–¹ï¼Œå¿…ç„¶æ˜¯ä½ ç•™ä¸‹äº†å¤ªå¤šçš„è®°å¿†åœ¨é‚£é‡Œï¼Œç•™ä¸‹äº†å¤ªå¤šçš„ä¸èˆå’Œç‰µæŒ‚ã€‚\nè¥¿å®‰æ²¡æœ‰ç»™æˆ‘ä»€ä¹ˆï¼Œæˆ–è€…è¯´è¿˜æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆï¼Œå¥¹æ— éœ€ç»™æˆ‘ä»€ä¹ˆï¼Œæ˜¯æˆ‘çš„é²è½é—¯å…¥ã€‚å¤šæƒ…åœ°æƒ³èµ·äº†ç‰å±±é‚£ä¸ªå°åŸã€‚å¤šå°‘å¹´åå½“æˆ‘å›æƒ³èµ·è¥¿å®‰ä¼šä¸ä¼šä¹Ÿåƒæƒ³èµ·ç‰å±±ä¸€æ ·â€“äº›è®¸ç”œèœœäº›è®¸å¿§ä¼¤äº›è®¸æ»¡è¶³äº›è®¸é—æ†¾ï¼Ÿ\nç‰å±±æœ€é«˜çš„åœ°æ–¹æ˜¯å¡”å±±ï¼Œè€Œæˆ‘ç«Ÿæ²¡æœ‰ç™»è¿‡é¡¶ã€‚å¦‚æœé‚£å¤©æˆ‘æ¥è¿‡äº†ä½ é€’è¿‡æ¥å‰¥å¥½çš„ç“œå­ä»ï¼Œäº‹æƒ…ä¼šä¸ä¼šæ˜¯å¦ä¸€ç•ªæ¨¡æ ·ï¼Ÿ\nâ€œå®¶åœ¨æ•…æ—å´æ¥šé—´ï¼Œå†°ä¸ºæºªæ°´ç‰ä¸ºå±±â€é¢˜ç›®é—®ä½œè€…æ˜¯è°ã€‚æˆ‘æ²¡æœ‰è®°ä½è€å¸ˆç»™çš„ç­”æ¡ˆã€‚ä¸¤å¹´åæˆ‘ç«™åœ¨ä½œè€…çš„å¡‘åƒå‰ï¼Œä¸€ç›´æƒ³èµ·å½“æ—¶æ²¡æœ‰ç­”ä¸Šé—®é¢˜æ—¶ä½ åœ¨æœæˆ‘å·ç¬‘çš„ç”»é¢ã€‚\nâ€œå¤ªé˜³æ–œäº†ï¼ŒåŸé‡Œå¤´èµ·äº†ç‚ŠçƒŸï¼Œæ°´ä¸Šçš„çƒŸæ³¢ä¹Ÿå¸¦ä¸Šäº†çº¢å½±ã€‚è¥¿åŒ—çš„é«˜å±±ä¸€å¸¦ï¼Œæœ‰ä¸€ä¸ªå°–å³°ï¼Œæ´»åƒå€’æ’çš„ç¬”å°–ï¼Œå¤§çº¦æ˜¯æ€€ç‰å±±äº†ç½¢ï¼Ÿ\"â€è¿™æ˜¯ 1933 å¹´çš„ç‰å±±ã€‚å½“å¹´éƒè¾¾å¤«è¯´çš„â€œå®åœ¨æ˜¯å¨å°¼æ–¯é‡Œçš„ä¸€æ¡é€šè¡¢â€çš„æ²¿æ²³ï¼Œå¦‚ä»Šè¢«æ”¹å»ºçš„åƒç”»ä¸€èˆ¬ã€‚\nå¾ˆå–œæ¬¢æ²¿æ²³è·¯ï¼Œå¯†å¯†çš„æŸ³æ¡ï¼Œæ’’åœ¨æ–‘é©³çš„é˜³å…‰ï¼Œèµ°åœ¨å…¶é—´ï¼Œèƒ½è§¦æ‘¸åˆ°å¿ƒä¸­çš„æ‚²æ‚²æˆšæˆšã€‚å°±é‚£ä¹ˆé™é™åœ°çœ‹ç€é‚£äº›å‚é’“è€…ï¼Œæˆ–è€…ç«™åœ¨çŸ³æ¡Œæ—çœ‹é‚£ç¾¤è€è€…ä¸‹æ£‹ï¼Œéƒ½æ˜¯é‚£ä¹ˆè®©äººäº«å—ã€‚è¶´åœ¨æ æ†ä¸Šï¼Œæœ›ç€é‚£è¥¿æµè€Œå»çš„å†°æºªæ°´ï¼Œå¾®å‡‰çš„æƒ…ç»ªä¹Ÿä¼šéšç€æ²³é¢è¿‡æ¥çš„é£æ‘†è¡ã€‚å­¦æ ¡å—é—¨å¤–çš„ä¸€æ®µï¼Œç•™ä½äº†å¤ªå¤šä¸€ä¸­å­¦å­çš„è®°å¿†ã€‚å¤šå°‘å¹´è½»çš„èª“è¨€æ¢¦å‘€ï¼Œéƒ½å’Œé‚£é‡Œçš„éº»è¾£çƒ«æœ‰å…³ã€‚é‚£äº›çƒ­é—¹çš„å¤œæ™šï¼Œç°åœ¨è¿˜ä¼šä¸ä¼šæœ‰ï¼Ÿ\nâ€œçƒ­é—¹æ˜¯ä»–ä»¬çš„ã€ã€ã€â€\nç«™åœ¨é˜³å°ä¸Šï¼Œçœ‹ç€ç§¦å²­ï¼Œæƒ³åˆ°é‚£å¥â€œè¥¿åŒ—æœ›é•¿å®‰ï¼Œå¯æ€œæ— æ•°å±±â€ï¼Œç§¦å²­ç”±ä¸œå‘è¥¿èµ°ï¼Œæ— è®ºä»è¥¿åŒ—å¾€é•¿å®‰çœ‹ï¼Œè¿˜æ˜¯ä»é•¿å®‰å¾€è¥¿åŒ—çœ‹ï¼Œéƒ½æ²¡æœ‰æ¯”ç§¦å²­æ›´é«˜çš„å±±äº†ã€‚ä¸çŸ¥é“æ€ä¹ˆè§£é‡Šï¼Œè¿™é‡Œå¤ªé˜³è‡ªç„¶ä¹Ÿä¸‹å¾—æ™šï¼Œå…­ç‚¹å¤šäº†è¿˜æ˜¯çƒ­æƒ…ä¸å‡ï¼Œè®©äººè§‰å¾—ç§¦å²­æ˜¯ç«™é”™äº†ä½ç½®ï¼Œå®¤å‹è¯´è¦æ˜¯çœŸç«™åœ¨è¥¿è¾¹ï¼Œå†¬å¤©ä½ åˆè¯¥æŠ±æ€¨äº†ã€‚æˆ‘è‹¦ç¬‘ï¼Œæˆ–è®¸æ˜¯å§ï¼åæ­£æˆ‘å¯¹è‡ªå·±ä¸äº†è§£ã€‚\næœ›ç€ç§¦å²­ï¼Œæƒ³ç€ç‰å±±çš„å¡”å±±ä¸å†°æºªæ²³ï¼Œæƒ³åˆ°äº†é‚£å¥â€œæ—¥æš®ä¹¡å…³ä½•å¤„æ˜¯ï¼ŒçƒŸæ³¢æ±Ÿä¸Šä½¿äººæ„â€ã€‚\n","title":"å°åŸ","uri":"/post/essay-small-town/"},{"content":"æˆ‘æƒ³è¿™ä¸æ˜¯ä¸€ç¯‡å›å¿†ï¼Œè€Œæ˜¯å¿ƒæƒ…ã€‚é»˜å­˜è¯´æˆ‘ä»¬å¹´è½»æ—¶å¾ˆå®¹æ˜“æŠŠè‡ªå·±çš„å†™ä½œå†²åŠ¨å½“æˆä¸€ç§å†™ä½œæ‰èƒ½ã€‚æˆ‘è‡ªçŸ¥æ²¡æœ‰å¦‚æ­¤é«˜é›…çš„æ‰èƒ½ã€‚ä½†ä¹Ÿä¸æƒ³åœ¨æŸä¸€å¤©çªç„¶å‘ç°è‡ªå·±è¢«æ—¶é—´æ¨ç€å¾€å‰èµ°ã€‚é˜¿ä¸ƒè¯´é•¿æ—¶é—´çš„å¯‚å¯æ˜¯æ‰€æœ‰å†™ä½œçš„æ»¥è§ã€‚æˆ–è®¸æˆ‘çš„ç¡®æ˜¯å¯‚å¯çš„å§ï¼ä¸€ä¸ªäººèµ°åœ¨æ— äººçš„è·¯ä¸Šï¼Œå¾€äº‹å°±åœ¨è¡—è§’å¤„çœ‹è§äº†â€¦â€¦\nä¸­è€ƒåçš„ç¬¬äºŒå¤©ï¼Œæˆ‘å°±è¯´æœæ¯äº²è®©æˆ‘å»æ‰“å·¥ã€‚å¥¹åœ¨æ‹…å¿ƒä¹‹ä½™è¯•å›¾é˜»æ­¢ï¼Œå´ç”¨é”™äº†æ–¹æ³•ï¼ï¼æ€»æ˜¯æŒ–è‹¦æˆ‘ï¼šä¸€å®šæ˜¯æ²¡è€ƒå¥½å§ï¼Ÿæƒ³èº²å‡ºå»å§ï¼Ÿè¢«æ¿€å°†çš„æˆ‘æ›´åŠ åšå®šè¦å»æ‰“å·¥äº†ã€‚è¯´å®è¯è€ƒäº†ä»¥åçœŸçš„æ²¡åº•ï¼Œæ„Ÿè§‰å¾ˆä¸€èˆ¬ï¼Œè¯´ä¸å‡ºå¥½ä¹Ÿè¯´ä¸å‡ºåã€‚è€Œè¿™ç§æƒ…å†µæ˜¯æœ€æŠ˜ç£¨äººçš„ï¼Œç—›è‹¦çš„åƒéš¾äº§ã€‚ä¸­è€ƒåçš„ç¬¬ä¸‰å¤©ï¼Œæˆ‘ç‹¬è‡ªä¸€äººç™»ä¸Šäº†å»ä¸½æ°´çš„ç«è½¦ã€‚\nè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åç«è½¦ã€‚æ¯äº²å¸®æˆ‘ä¹°äº†è½¦ç¥¨åå°±å›å»äº†ï¼Œè€Œæˆ‘ç‹¬è‡ªç­‰äº†ä¸€ä¸ªå¤šå°æ—¶çš„è½¦ã€‚æˆ‘æƒ³æ¯äº²çš„ä¼Ÿå¤§å°±åœ¨äºè¿™æ ·æ”¾å¿ƒè€Œåˆç”¨å¿ƒåœ°å»åŸ¹å…»è‡ªå·±çš„å­©å­çš„è‡ªç«‹èƒ½åŠ›å§ï¼è™½ç„¶æœ‰æ—¶æˆ‘ä¹Ÿæ€€ç–‘æ˜¯å¦å› ä¸ºå“¥å“¥ç»§æ‰¿äº†å¥¹çš„æ‰€æœ‰ä¼˜ç§€å“è´¨ï¼Œä»å°åˆ°å¤§è®©å¥¹æ˜¯å¦‚æ­¤åœ°æ”¾å¿ƒä¸éª„å‚²ä»¥è‡´äºå¥¹è®¤ä¸ºå¥¹çš„å­©å­éƒ½åº”è¯¥æ˜¯é‚£æ ·çš„ç‹¬ç«‹è‡ªä¸»ã€‚\næˆ‘èƒŒç€ä¸ªå¤§ä¹¦åŒ…ç«™åœ¨é‚£æœ›ç€æ¯äº²çš„èƒŒå½±ï¼Œè™½ç„¶æ­£åˆåäºŒç‚¹çš„çƒˆæ—¥ä¸‹é‚£æ™ƒåŠ¨çš„ç©ºæ°”è®©èƒŒå½±æœ‰ç‚¹æ¨¡ç³Šï¼ŒåŠ ä¸Šåœ¨é‚£æ–°å»ºçš„ç«è½¦ç«™å¹¿åœºä¸Šï¼Œçœ‹ä¸Šå»èƒŒå½±æ›´åŠ æ˜¾å¾—å°äº†ï¼Œä½†é‚£ä¸€åˆ»ï¼Œæœ›ç€æ¯äº²çš„èƒŒå½±ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆæ¬£æ…°ï¼Œæ˜¯çš„ï¼Œæ˜¯æ¬£æ…°ï¼Œæˆ–è€…è¯´æ˜¯æ»¡è¶³ã€‚é‚£ä¸ªæ›¾ç»ç—…å¾—åªå‰©ä¸åˆ°ä¸ƒåæ–¤çš„äººï¼Œç°åœ¨å·²ç»èƒ½å¥æ­¥å¦‚é£äº†ï¼›é‚£ä¸ªæ›¾ç»ç—…å¾—æ²¡æœ‰ä¸€æ ¹å¤´å‘çš„äººï¼Œç°åœ¨åˆæœ‰äº†ä¸€å¤´é»‘å‘ï¼Œè™½ç„¶è¿‘çœ‹æœ‰äº›è®¸é“¶ä¸ï¼›é‚£å¼ æ›¾ç»å› ä¸ºè¿›å£è¯å’Œç—…æ¯’è€Œå½»åº•å˜å½¢çš„è„¸ç°åœ¨åˆæ¢å¤å¥åº·äº†ï¼Œè™½ç„¶æœ‰ä¸€ç‚¹æµ®è‚¿â€¦ä½†ç»ˆç©¶è¿˜æ˜¯å¥åº·çš„ã€‚è¿™ä¸ªä¼Ÿå¤§çš„æ¯äº²ï¼Œæˆ–è®¸æ˜¯æ”¾ä¸ä¸‹è‡ªå·±çš„å®¶äººï¼Œåœ¨è¢«åŒ»ç”Ÿå®£å¸ƒæ— æ•‘ååˆæ´»è¿‡æ¥äº†ï¼Œé‚£ä¸€å¤©ï¼Œå’Œæ¯äº²åŒç—…æˆ¿çš„æœ‰ä¸¤ä¸ªæ‰‹æœ¯å¤±è´¥æ°¸è¿œåœ°èµ°äº†â€¦\næˆ‘æ°¸è¿œéƒ½å¿˜ä¸äº†é‚£ä¸€å¤©ï¼Œæˆ‘åœ¨ä¸Šç¬¬ä¸‰èŠ‚è¯¾æ—¶å¤§å¨˜æ¥æ‰¾æˆ‘ï¼Œæ²¡æœ‰ä¸Šè¿‡ä¸€å¤©å­¦çš„å¥¹ä¸€ç›´ç­‰åˆ°æ”¾å­¦æ‰æ•¢è¿›ç­å«æˆ‘ã€‚æˆ‘è·Ÿç€å¥¹å›å®¶ï¼Œèµ°åˆ°å°è·¯ä¸Šï¼Œå¥¹ä»¥é‚£ç§æ—äººè«ä¸å…³å¿ƒçš„è¯­æ°”è¯´ï¼šâ€œä½ å¦ˆä¸è¡Œäº†ï¼Œä»Šå¤©å°±è¦å›æ¥äº†ã€‚â€ä¸çŸ¥æ˜¯å¹´å°‘å¯¹æ­»äº¡çš„æ— çŸ¥æ— æƒ§è¿˜æ˜¯å¿«ä¸¤å¹´æ²¡æœ‰è§åˆ°æ¯äº²å·²ç»å¯¹è¿™ä¸ªæ¦‚å¿µæ²¡æœ‰å¤šå°‘æ„Ÿè§‰äº†ï¼Œå¬åˆ°è¿™å¥è¯åæˆ‘å¾ˆå®‰é™ï¼Œåªæ˜¯çªç„¶è§‰å¾—å¤©å¿«é»‘äº†ï¼Œåº”è¯¥å¿«ç‚¹å›å»ã€‚æˆ‘ä¸€è·¯å°è·‘ï¼ŒæŠŠå¤§å¨˜ç”©åœ¨åé¢ã€‚è¯¥æ€æ ·å»åŸè°…è‡ªå·±ï¼Œæ›¾ç»çš„æ— çŸ¥ä¸å¹¼ç¨šã€‚è¿‘ä¸¤å¹´é‡Œæˆ‘åªè§è¿‡æ¯äº²ä¸€é¢ï¼Œæš‘å‡é‡Œæˆ‘ç†äº†ä¸ªå…‰å¤´å»å¤–å©†å®¶ï¼Œåœ¨é‚£é‡Œæˆ‘çœ‹åˆ°äº†æ¯äº²ï¼Œå¥¹å¿ƒç–¼åœ°é—®ä¸ºä»€ä¹ˆç†å…‰å¤´ï¼Œæ˜¯ä¸æ˜¯è‡ªå·±ä¸ä¼šæ´—å¤´ï¼Ÿæˆ‘æ‰§æ‹—åœ°æ²¡æœ‰å›ç­”ï¼Œå¿ƒé‡Œæ€ä¹ˆä¹Ÿä¸æ„¿æ„æ‰¿è®¤èººåœ¨åºŠä¸Šçš„é‚£ä¸ªäººå°±æ˜¯æ¯äº²ã€‚ä¹Ÿæ˜¯åœ¨é‚£ä¸€åˆ»ï¼Œæˆ‘å‘ç°è‡ªå·±ä»¥å‰ä»æ²¡æœ‰ä»”ç»†çœ‹è¿‡æ¯äº²é‚£å¼ æ¼‚äº®çš„è„¸ï¼Œç°åœ¨ç•™ä¸‹çš„åªæ˜¯æ¨¡ç³Šçš„å›å¿†ã€‚è€Œå½“æˆ‘åœ¨å†™è¿™äº›å­—æ—¶ï¼Œæˆ‘åªèƒ½å›æƒ³èµ·ä¸€ä¸ªç”»é¢ï¼é‚£æ—¶åº”è¯¥è¿˜å…­ä¸ƒå²æ—¶ï¼Œæˆ‘å’Œæ¯äº²å»å±±ä¸Šæ‰“æŸ´ï¼Œæ¯äº²æ‰“æŸ´æ—¶æˆ‘å°±åœ¨è¾¹ä¸Šæ‰¾é¹…åµçŸ³ï¼Œæœ‰ç‰¹è‰²çš„çŸ³å¤´ã€‚åˆè®©å¥¹ç»™æˆ‘åšä¸€æŸ„æœ¨å‰‘ï¼ŒæŠŠæ‰€æœ‰çš„æ ‘å½“æˆæ•Œäººå»ç ã€‚å›å»æ—¶ï¼Œå¥¹æŒ‘ç€ä¸€æ‹…æŸ´ï¼Œæˆ‘è·Ÿåœ¨å¥¹åé¢ï¼Œå£è¢‹é‡Œè£…æ»¡äº†çŸ³å¤´ï¼Œæ‹¿ç€é•¿æœ¨å‰‘ï¼Œçªç„¶è„šä¸€æ»‘æ‘”å€’äº†ï¼Œå¥¹é©¬ä¸Šæ‰”ä¸‹æ‹…è·‘è¿‡æ¥æ‰¶æˆ‘èµ·æ¥ï¼Œå¸®æˆ‘æ“¦æ±—å¹¶è¹²ä¸‹æ¥ç¬‘ç€æŠŠæˆ‘å£è¢‹é‡Œçš„çŸ³å¤´éƒ½è£…è¿›å¥¹çš„è¢‹å­é‡Œï¼Œä¹Ÿå°±æ˜¯åœ¨é‚£ä¸€åˆ»æˆ‘çœ‹äº†çœ‹æ¯äº²çš„è„¸ï¼Œç™½çš™çš„ï¼Œé“ºæ»¡äº†ç¢ç¢çš„æ±—ç ï¼Œå¾®ç¬‘ç€è´£æ€ªæˆ‘è£…è¿™ä¹ˆå¤šçŸ³å¤´ã€‚æˆ‘æŠŠç©äº†æ³¥å·´çš„æ‰‹å¾€å¥¹è„¸ä¸Šä¸€æŠ¹æ’’è…¿å°±è·‘ï¼Œå¥¹ä¹Ÿä¸è¿½ï¼Œæ‹¿ä¸‹æ¯›å·¾ä»”ç»†åœ°æŠŠè„¸æ“¦å¹²å‡€äº†æ‰èµ·èº«ã€‚æœ€ç»ˆæˆ‘è¿˜æ˜¯æ²¡è®°ä½æ¯äº²å½“å¹´çš„æ¨¡æ ·ï¼Œåªæ˜¯æƒ³èµ·é‚£å¾®ç¬‘çš„æ„Ÿè§‰ä¾æ—§æ˜¯é‚£æ ·çš„æ¸©æš–ã€‚æœ‰æ—¶è®¿äº²æ—¶èƒ½ä»äº²å‹ä»¬çš„å£ä¸­çŸ¥é“æ¯äº²å¹´è½»æ—¶çš„ç¡®æ˜¯å¾ˆå¥½çœ‹çš„â€¦â€¦â€¦\næˆ‘å°±å°±é‚£æ ·ç«™åœ¨çƒˆæ—¥ä¸‹æœ›ç€æ¯äº²è½¬è¿‡è¡—è§’ï¼Œä¸€é¢—æ±—ç æ²¿ç€æˆ‘çš„ç«æ¯›æ»‘è¿›äº†çœ¼çœ¶ï¼Œåˆç«‹åˆ»æº¢äº†å‡ºæ¥ï¼Œé¡ºç€è„¸é¢Šæ»´åœ¨åœ°ä¸Šï¼Œè¿˜æ²¡æ¥å¾—åŠæº…å¼€å°±è¢«é‚£åšåšçš„ç°ç»™å¸å¹²äº†ï¼Œå·æˆäº†ä¸€ä¸ªæ³¥ç ã€‚\nåœ¨å€™è½¦å®¤é‡Œæˆ‘çœ‹åˆ°è®¸å¤šå­¦ç”Ÿï¼Œæœ‰äº›æ˜¯æˆ‘çš„åŒå­¦ï¼Œä»–ä»¬ä¹Ÿåœ¨ç­‰è½¦ï¼Œä»–ä»¬ä¸­æœ‰çš„æ˜¯å»å®¶é•¿é‚£é‡Œç©ï¼Œæ›´å¤šçš„æ˜¯å·²ç»å†³å®šäº†ä¸è¯»ä¹¦äº†ï¼Œå‡ºå»æ‰“å·¥ï¼Œåšç”Ÿæ„ã€‚çœ‹ç€ä»–ä»¬æœ‰è¯´æœ‰ç¬‘ï¼Œæˆ‘å¿½ç„¶è§‰å¾—ä»–ä»¬æ˜¯å¹¸ç¦çš„ï¼Œå› ä¸ºä»–ä»¬å·²ç»æ¸…æ¥šäº†æ–¹å‘ï¼Œè™½ç„¶å‰é€”è‰°è¾›è€Œæ¼«é•¿ï¼Œä½†ä»–ä»¬æ˜¯é‚£æ ·çš„å¹´è½»è€Œä¹è§‚ï¼Œå°†ç”¨è‡ªå·±çš„åŒæ‰‹å»å¼€åˆ›è‡ªå·±çš„æœªæ¥ã€‚è€Œæˆ‘å‘¢ï¼Œå°±åƒä¸€åªè¢«æåœ¨ç©ºä¸­çš„é¸­å­ï¼Œä¸çŸ¥é“è¢«æ‰”ä¸‹å»æ—¶ä¸‹é¢æ˜¯æ°´è¿˜æ˜¯æ²¹ã€‚\nç«è½¦å¯åŠ¨çš„é‚£ä¸€åˆ»ï¼Œæˆ‘é€è¿‡ç»ç’ƒçœ‹ç€é™Œç”Ÿçš„ç«™å°ï¼Œå¿ƒé‡Œç¬¬ä¸€æ¬¡æœ‰äº†ä¸€ç‚¹å­¤ç‹¬æ„Ÿï¼Œé‚£è¯ºå¤§çš„ç«™å°äº¦æ˜¯ä¸€æ ·å§ï¼šç›®é€ç€ä¸€æ‰¹åˆä¸€æ‰¹çš„äººç”Ÿæ‹“è’è€…ï¼Œè§è¯ç€ä¸€åœºåˆä¸€åœºåˆ†åˆ«æ—¶çš„æ³ªé£ï¼Œè¿æ¥äº†ä¸€ç¾¤åˆä¸€ç¾¤éª„å‚²æˆ–è½é­„çš„å½’å®¢â€¦ä»–æ˜¯çŸ¥é“çš„é‚£ä¹ˆå¤šï¼Œä»–æœ‰é‚£ä¹ˆå¤šçš„æ•…äº‹å¯è®²ï¼Œå¯æ˜¯æ²¡æœ‰äººè‚¯åœä¸‹æ¥å¬ä¸€å¬ä»–çš„è¯‰è¯´ï¼Œè½¦ç«™é‡Œçš„äººæ°¸è¿œæ˜¯é‚£æ ·çš„åŒ†å¿™â€¦â€¦â€¦\n2010 å¹´ 7 æœˆ\n","title":"ä¸€ç‚¹å›å¿†","uri":"/post/essay-memories-about-mother/"},{"content":"Powered by fuse.js. support search operators: hello | world (or), hello world (and), \"hello world\"(exact phrase)\n","title":"æœç´¢","uri":"/search/"}]